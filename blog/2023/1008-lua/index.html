<!DOCTYPE html>
<html lang="en" class="astro-BVZIHDZO">
	<head>
		<!-- Use Google Fonts, if you don't wanna prefer a self-hosted version --><!-- <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap" rel="stylesheet"> --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>最近のLua</title>
<meta name="title" content="最近のLua">


<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="shortcut icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- Open Graph Tags (Facebook) -->
<meta property="og:type" content="website">
<meta property="og:title" content="最近のLua">




<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:title" content="最近のLua">





<script>
  const theme = (() => {
    if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
      return localStorage.getItem("theme");
    }
    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      return "dark";
    }
    return "light";
  })();

  if (theme === "light") {
    document.documentElement.classList.remove("dark");
  } else {
    document.documentElement.classList.add("dark");
  }
</script>
		
	<link rel="stylesheet" href="/_astro/about.6111bb3a.css" />
<link rel="stylesheet" href="/_astro/about.657f8f57.css" />
<link rel="stylesheet" href="/_astro/about.ee60a110.css" />
<link rel="stylesheet" href="/_astro/about.dcb84f3d.css" /><script type="module" src="/_astro/hoisted.e6960f2c.js"></script></head>

	<body class="astro-BVZIHDZO">
		<header class="header astro-3EF6KSR2">
    <div class="header__logo astro-3EF6KSR2">
        <a href="/" class="avatar astro-3EF6KSR2">
            <img class="header__logo-img astro-3EF6KSR2" src="/assets/logo.svg" alt="Astro logo">
        </a>
    </div>
    <div class="header__meta flex-1 astro-3EF6KSR2">
        <h3 class="header__title dark:text-theme-dark-secondary astro-3EF6KSR2">
            <a href="" class="astro-3EF6KSR2">三次元日誌(astro)</a>
        </h3>
        <div class="header__meta-more flex astro-3EF6KSR2">
            <p class="header__desc astro-3EF6KSR2">
                Crisp, minimal, personal blog theme for Astro
            </p>
            <nav class="header__nav flex astro-3EF6KSR2">
                <ul class="header__ref-list astro-3EF6KSR2">
                    <li class="astro-3EF6KSR2">
                        <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var r=(i,c,n)=>{let s=async()=>{await(await i())()},t=new IntersectionObserver(e=>{for(let o of e)if(o.isIntersecting){t.disconnect(),s();break}});for(let e of n.children)t.observe(e)};(self.Astro||(self.Astro={})).visible=r;window.dispatchEvent(new Event("astro:visible"));})();;(()=>{var d;{let p={0:t=>u(t),1:t=>l(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(l(t)),5:t=>new Set(l(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},h=t=>{let[e,n]=t;return e in p?p[e](n):void 0},l=t=>t.map(h),u=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([e,n])=>[e,h(n)]));customElements.get("astro-island")||customElements.define("astro-island",(d=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=async()=>{var i;if(!this.hydrator||!this.isConnected)return;let e=(i=this.parentElement)==null?void 0:i.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let n=this.querySelectorAll("astro-slot"),o={},a=this.querySelectorAll("template[data-astro-template]");for(let r of a){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(o[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of n){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(o[r.getAttribute("name")||"default"]=r.innerHTML)}let c;try{c=this.hasAttribute("props")?u(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",y=this.getAttribute("component-export");throw y&&(s+=` (export ${y})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}await this.hydrator(this)(this.Component,c,o,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))}}connectedCallback(){!this.hasAttribute("await-children")||this.firstChild?this.childrenConnectedCallback():new MutationObserver((e,n)=>{n.disconnect(),setTimeout(()=>this.childrenConnectedCallback(),0)}).observe(this,{childList:!0})}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}start(){let e=JSON.parse(this.getAttribute("opts")),n=this.getAttribute("client");if(Astro[n]===void 0){window.addEventListener(`astro:${n}`,()=>this.start(),{once:!0});return}Astro[n](async()=>{let o=this.getAttribute("renderer-url"),[a,{default:c}]=await Promise.all([import(this.getAttribute("component-url")),o?import(o):()=>()=>{}]),i=this.getAttribute("component-export")||"default";if(!i.includes("."))this.Component=a[i];else{this.Component=a;for(let r of i.split("."))this.Component=this.Component[r]}return this.hydrator=c,this.hydrate},e,this)}attributeChangedCallback(){this.hydrate()}},d.observedAttributes=["props"],d))}})();</script><astro-island uid="2iKzVC" component-url="/_astro/SearchBtn.984510f3.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-3EF6KSR2&quot;]}" ssr="" client="visible" opts="{&quot;name&quot;:&quot;SearchBtn&quot;,&quot;value&quot;:true}" await-children=""><button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <path fill-rule="evenodd" clip-rule="evenodd" d="M16.2071 4.89344C19.0923 7.77862 19.3131 12.3193 16.8693 15.4578C16.8846 15.4713 16.8996 15.4854 16.9143 15.5L21.1569 19.7427C21.5474 20.1332 21.5474 20.7664 21.1569 21.1569C20.7664 21.5474 20.1332 21.5474 19.7427 21.1569L15.5 16.9143C15.4854 16.8996 15.4713 16.8846 15.4578 16.8693C12.3193 19.3131 7.77862 19.0923 4.89344 16.2071C1.76924 13.083 1.76924 8.01763 4.89344 4.89344C8.01763 1.76924 13.083 1.76924 16.2071 4.89344ZM14.7929 14.7929C17.1361 12.4498 17.1361 8.6508 14.7929 6.30765C12.4498 3.96451 8.6508 3.96451 6.30765 6.30765C3.96451 8.6508 3.96451 12.4498 6.30765 14.7929C8.6508 17.1361 12.4498 17.1361 14.7929 14.7929Z" fill="currentColor"></path></svg></button></astro-island>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <a href="https://github.com/one-aalam/astro-ink" title="三次元日誌(astro)'s Github URL'" class="astro-3EF6KSR2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    
                                <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" class="astro-3EF6KSR2"></path>
                            
</svg>
                        </a>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <a href="/rss.xml" title="RSS" class="astro-3EF6KSR2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    
                                <path d="M4 11a9 9 0 0 1 9 9" class="astro-3EF6KSR2"></path>
                                <path d="M4 4a16 16 0 0 1 16 16" class="astro-3EF6KSR2"></path>
                                <circle cx="5" cy="19" r="1" class="astro-3EF6KSR2"></circle>
                            
</svg>
                        </a>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <astro-island uid="h8S6z" component-url="/_astro/ModeSwitcherBtn.0ddc5d6d.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-3EF6KSR2&quot;]}" ssr="" client="visible" opts="{&quot;name&quot;:&quot;ModeSwitcherBtn&quot;,&quot;value&quot;:true}" await-children=""><button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle> <line x1="12" y1="1" x2="12" y2="3"></line> <line x1="12" y1="21" x2="12" y2="23"></line> <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line> <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line> <line x1="1" y1="12" x2="3" y2="12"></line> <line x1="21" y1="12" x2="23" y2="12"></line> <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line> <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></button></astro-island>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</header>
		<main class="astro-BVZIHDZO">
			<article class="astro-BVZIHDZO">
				<div class="hero-image astro-BVZIHDZO">
					
				</div>
				<div class="prose astro-BVZIHDZO">
					<div class="title astro-BVZIHDZO">
						<div class="date astro-BVZIHDZO">
							<time datetime="2023-10-08T00:00:00.000Z">
	Oct 8, 2023
</time>
							
						</div>
						<h1 class="astro-BVZIHDZO">最近のLua</h1>
						<hr class="astro-BVZIHDZO">
					</div>
					
	<p>script 用途には python を愛用していたのだけど、
python-3.10 で入った match 文が気に入りすぎて、
linux とか mac のデフォルトの python が 3.9 であったりすることが悲しかったので、 lua 使いになった。
(dotfiles の script を match から if に書きなおしたw)</p>
<p>というわけでもなく、nvim に常用して lua の使用頻度が上がったので、
ついでに主力のスクリプト言語が変わった。
<code>nvim</code> 以外に、 <code>wezterm</code>, <code>nyagos</code> という lua で設定するツールを採用した。</p>
<p>nvim は luajit(lua-5.1互換) で、wezterm は lua-5.4 で、 nyagos は gopherlua(lua-5.1互換) ということから, lua-5.1 向けの lua を使う。
lua は、5.1 で完成形ということでこれで良いのだ。</p>
<p>OpenGL は <code>love2D</code>(luajit), OpenXR は <code>lovr</code>(luajit) である。
WebRTC は <code>janus</code>(lua-5.3)。</p>
<p>luajit が人気なわけだが jit で速いだけでなく、
ffi の使い勝手が最高に良いというのもある。
luabinding の無い c のライブラリがあったとしても、
c の ヘッダーのコピーをベースにしてわりと簡単に ffi で使ってしまうことができるし、
lua に無い型付きの数値配列とかはこれで作れるので便利。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">local</span><span style="color: #E1E4E8"> array </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> ffi.</span><span style="color: #79B8FF">new</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">'float[5000]'</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">array[</span><span style="color: #79B8FF">0</span><span style="color: #E1E4E8">] </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">1.5</span><span style="color: #E1E4E8"> </span><span style="color: #6A737D">-- 0 origin なのだ w</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">--- pointer は配列を使うことが多い</span></span>
<span class="line"><span style="color: #F97583">local</span><span style="color: #E1E4E8"> p_open </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> ffi.</span><span style="color: #79B8FF">new</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">'bool[1]'</span><span style="color: #E1E4E8">, </span><span style="color: #79B8FF">true</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #F97583">if</span><span style="color: #E1E4E8"> imgui.</span><span style="color: #79B8FF">Begin</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">'hello'</span><span style="color: #E1E4E8">, p_open) </span><span style="color: #F97583">then</span></span>
<span class="line"><span style="color: #F97583">end</span></span></code></pre>
<p>要するに、<code>OpenGL</code> とか <code>cimgui</code> を使える。
(python の ctypes とだいたい同じ能力)</p>
<p>nvim の影響なのか lua の開発環境は近年良くなってきていて、
LuaLanguageServer と stylua の組みあわせが気に入っている。
LuaLanguageServer により型情報を追加してある程度Editorの支援を良くすることができる。</p>
<p><a href="https://luals.github.io/wiki/annotations/">https://luals.github.io/wiki/annotations/</a></p>
<p>によるとついに <code>EmmyLua annotations </code> と袂を分って独自路線のようである。</p>
<p>人間の方が LanguageServer に積極的に型情報を提供する。
LuaLanguageServer に合わせてこんなスタイルになった。
LanguageServer でオブジェクトの field と method がちゃんと出るために継承の記述を使う。
先頭から <code>new</code> 関数まで定型コード。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #6A737D">---</span><span style="color: #F97583">@class</span><span style="color: #6A737D"> </span><span style="color: #79B8FF">Point</span><span style="color: #F97583">:</span><span style="color: #6A737D"> </span><span style="color: #79B8FF">PointInstance</span></span>
<span class="line"><span style="color: #F97583">local</span><span style="color: #E1E4E8"> Point </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> {}</span></span>
<span class="line"><span style="color: #E1E4E8">Point.</span><span style="color: #B392F0">__index</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> Point</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">---</span><span style="color: #F97583">@param</span><span style="color: #6A737D"> </span><span style="color: #B392F0">x</span><span style="color: #6A737D"> </span><span style="color: #79B8FF">integer</span></span>
<span class="line"><span style="color: #6A737D">---</span><span style="color: #F97583">@param</span><span style="color: #6A737D"> </span><span style="color: #B392F0">y</span><span style="color: #6A737D"> </span><span style="color: #79B8FF">integer</span></span>
<span class="line"><span style="color: #6A737D">---</span><span style="color: #F97583">@return</span><span style="color: #6A737D"> </span><span style="color: #79B8FF">Point</span></span>
<span class="line"><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Point</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">new</span><span style="color: #E1E4E8">(x, y)</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #6A737D">---</span><span style="color: #F97583">@class</span><span style="color: #6A737D"> </span><span style="color: #79B8FF">PointInstance</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">local</span><span style="color: #E1E4E8"> instance</span><span style="color: #F97583">=</span><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    x </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> x,</span></span>
<span class="line"><span style="color: #E1E4E8">    y </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> y,</span></span>
<span class="line"><span style="color: #E1E4E8">  }</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #6A737D">---</span><span style="color: #F97583">@type</span><span style="color: #6A737D"> </span><span style="color: #79B8FF">Point</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">setmetatable</span><span style="color: #E1E4E8">(instance, Point)</span></span>
<span class="line"><span style="color: #F97583">end</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">---</span><span style="color: #F97583">@param</span><span style="color: #6A737D"> </span><span style="color: #B392F0">rhs</span><span style="color: #6A737D"> </span><span style="color: #79B8FF">Point</span></span>
<span class="line"><span style="color: #6A737D">---</span><span style="color: #F97583">@return</span><span style="color: #6A737D"> </span><span style="color: #79B8FF">Point</span></span>
<span class="line"><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Point</span><span style="color: #E1E4E8">:</span><span style="color: #B392F0">__add</span><span style="color: #E1E4E8">(rhs)</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> Point.</span><span style="color: #79B8FF">new</span><span style="color: #E1E4E8">(</span><span style="color: #79B8FF">self</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">x</span><span style="color: #F97583">+</span><span style="color: #E1E4E8">rhs.</span><span style="color: #B392F0">x</span><span style="color: #E1E4E8">, </span><span style="color: #79B8FF">self</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">y</span><span style="color: #F97583">+</span><span style="color: #E1E4E8">rhs.</span><span style="color: #B392F0">y</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #F97583">end</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">---</span><span style="color: #F97583">@return</span><span style="color: #6A737D"> </span><span style="color: #79B8FF">number</span></span>
<span class="line"><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Point</span><span style="color: #E1E4E8">:</span><span style="color: #B392F0">norm</span><span style="color: #E1E4E8">()</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">math.sqrt</span><span style="color: #E1E4E8">(</span><span style="color: #79B8FF">self</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">x</span><span style="color: #F97583">*</span><span style="color: #79B8FF">self</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">x</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">+</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">self</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">y</span><span style="color: #F97583">*</span><span style="color: #79B8FF">self</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">y</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #F97583">end</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">return</span><span style="color: #E1E4E8"> Point</span></span></code></pre>
<p><code>：</code> による self シンタックスシュガーを避けていたのだけど、
LanguageServer のおかげで間違えて <code>.</code> を使う間違いは気付きやすくなった。
それと呼びだしだけでなく定義するときにも使えることがわかったので、
使ってもいいかという気になった。
<code>.</code> が static method で、<code>:</code> が instance method と使い分ける慣習。</p>
<p>あと、LuaLanguageServer に Project 毎のライブラリの情報を伝えることができる。
project root に <code>.luarc.json</code> を配置する。
わりと設定できるので、ちゃんとやると良くなる。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #79B8FF">"runtime.version"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"LuaJIT"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #79B8FF">"runtime.special"</span><span style="color: #E1E4E8">: {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"love.filesystem.load"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"loadfile"</span></span>
<span class="line"><span style="color: #E1E4E8">  },</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #79B8FF">"runtime.path"</span><span style="color: #E1E4E8">: [</span><span style="color: #9ECBFF">"libs/?.lua"</span><span style="color: #E1E4E8">, </span><span style="color: #9ECBFF">"libs/?/init.lua"</span><span style="color: #E1E4E8">],</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #79B8FF">"workspace.library"</span><span style="color: #E1E4E8">: [</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #9ECBFF">"${3rd}/busted/library"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #9ECBFF">"${3rd}/luassert/library"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #9ECBFF">"${3rd}/love2d/library"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #9ECBFF">"${3rd}/lfs/library"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #9ECBFF">"meta/gltf/library"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #9ECBFF">"meta/cimgui/library"</span></span>
<span class="line"><span style="color: #E1E4E8">  ],</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #79B8FF">"format.enable"</span><span style="color: #E1E4E8">: </span><span style="color: #79B8FF">false</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #79B8FF">"diagnostics.disable"</span><span style="color: #E1E4E8">: [</span><span style="color: #9ECBFF">"empty-block"</span><span style="color: #E1E4E8">, </span><span style="color: #9ECBFF">"unused-local"</span><span style="color: #E1E4E8">, </span><span style="color: #9ECBFF">"unused-vararg"</span><span style="color: #E1E4E8">]</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre>
<p>特に c モジュールは型情報を追加しないと、どんなメンバーがあるかわからなくて、
直接 c を使っているよりもコードが書きにくいということになりがちなので、 型情報は重要である。
(luaのモジュールは LuaLanguageServer が解析できるのだが LUA_PATH は教える必要がある)</p>
<p>LuaLanguageServer が組込みで型情報をもっているがそれ以外はここにあるぽい。
<a href="https://github.com/orgs/LuaCATS/repositories">https://github.com/orgs/LuaCATS/repositories</a></p>
<p><code>require</code> したものや組み込み変数の型はコメントで指定することができる。
いや、指定しないと判らないのではないか。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #6A737D">--- luarocks の場合</span></span>
<span class="line"><span style="color: #6A737D">---</span><span style="color: #F97583">@class</span><span style="color: #6A737D"> </span><span style="color: #79B8FF">uv</span></span>
<span class="line"><span style="color: #F97583">local</span><span style="color: #E1E4E8"> uv </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">require</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"luv"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">--- nvim の場合</span></span>
<span class="line"><span style="color: #6A737D">---</span><span style="color: #F97583">@class</span><span style="color: #6A737D"> </span><span style="color: #79B8FF">uv</span></span>
<span class="line"><span style="color: #F97583">local</span><span style="color: #E1E4E8"> uv </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> vim.</span><span style="color: #B392F0">loop</span></span></code></pre>
<p>それでも警告がいっぱいでてうまくいかないときは諦めて、<code>any</code> の型を付ける。</p>
<p>避けていた <code>luarocks</code> も慣れた。
特に Windows 環境では導入ではまりやすいのだけど慣れた。
python の venv のような使いかたもできる。
<code>vc</code> or <code>mingw</code>, <code>system</code> or <code>user</code> or <code>project</code>, <code>standlone</code> or <code>embedded</code>,
<code>lua</code> or <code>luajit</code> という選択肢の多さが <code>luarocks</code> の難しさにつながる。
どの <code>lua</code> 向けのモジュールなのかを明確にして制御していく。
<code>Windows</code> では project local で <code>hererocks</code> するのも手かもしれない。</p>

				</div>
			</article>
		</main>
		<footer class="footer astro-SZ7XMLTE">
    <nav class="nav astro-SZ7XMLTE">
        <div class="astro-SZ7XMLTE">2021  &copy; Copyright notice |  <a href="https://github.com/one-aalam/astro-ink" title="三次元日誌(astro)'s Github URL'" class="astro-SZ7XMLTE">三次元日誌(astro)</a>
        <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><astro-island uid="1QEdto" component-url="/_astro/ModeLabel.e3ff75e7.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-SZ7XMLTE&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;ModeLabel&quot;,&quot;value&quot;:true}" await-children=""><span slot="dark" data-svelte-h="svelte-14ov3lc">(dark)</span></astro-island> theme on <a href="https://astro.build/" class="astro-SZ7XMLTE">Astro</a></div>
        <astro-island uid="1I86to" component-url="/_astro/NetlifyIdentity.94b8edb0.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-SZ7XMLTE&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;NetlifyIdentity&quot;,&quot;value&quot;:true}"></astro-island>
    </nav>
</footer>
	</body></html>