<!DOCTYPE html>
<html lang="en" class="astro-BVZIHDZO">
	<head>
		<!-- Use Google Fonts, if you don't wanna prefer a self-hosted version --><!-- <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap" rel="stylesheet"> --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>hugoで作ったサイトにSphinxを埋めこむ</title>
<meta name="title" content="hugoで作ったサイトにSphinxを埋めこむ">


<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="shortcut icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- Open Graph Tags (Facebook) -->
<meta property="og:type" content="website">
<meta property="og:title" content="hugoで作ったサイトにSphinxを埋めこむ">




<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:title" content="hugoで作ったサイトにSphinxを埋めこむ">





<script>
  const theme = (() => {
    if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
      return localStorage.getItem("theme");
    }
    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      return "dark";
    }
    return "light";
  })();

  if (theme === "light") {
    document.documentElement.classList.remove("dark");
  } else {
    document.documentElement.classList.add("dark");
  }
</script>
		
	<link rel="stylesheet" href="/_astro/about.6111bb3a.css" />
<link rel="stylesheet" href="/_astro/about.657f8f57.css" />
<link rel="stylesheet" href="/_astro/about.ee60a110.css" />
<link rel="stylesheet" href="/_astro/about.dcb84f3d.css" /><script type="module" src="/_astro/hoisted.e6960f2c.js"></script></head>

	<body class="astro-BVZIHDZO">
		<header class="header astro-3EF6KSR2">
    <div class="header__logo astro-3EF6KSR2">
        <a href="/" class="avatar astro-3EF6KSR2">
            <img class="header__logo-img astro-3EF6KSR2" src="/assets/logo.svg" alt="Astro logo">
        </a>
    </div>
    <div class="header__meta flex-1 astro-3EF6KSR2">
        <h3 class="header__title dark:text-theme-dark-secondary astro-3EF6KSR2">
            <a href="" class="astro-3EF6KSR2">三次元日誌(astro)</a>
        </h3>
        <div class="header__meta-more flex astro-3EF6KSR2">
            <p class="header__desc astro-3EF6KSR2">
                Crisp, minimal, personal blog theme for Astro
            </p>
            <nav class="header__nav flex astro-3EF6KSR2">
                <ul class="header__ref-list astro-3EF6KSR2">
                    <li class="astro-3EF6KSR2">
                        <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var r=(i,c,n)=>{let s=async()=>{await(await i())()},t=new IntersectionObserver(e=>{for(let o of e)if(o.isIntersecting){t.disconnect(),s();break}});for(let e of n.children)t.observe(e)};(self.Astro||(self.Astro={})).visible=r;window.dispatchEvent(new Event("astro:visible"));})();;(()=>{var d;{let p={0:t=>u(t),1:t=>l(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(l(t)),5:t=>new Set(l(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},h=t=>{let[e,n]=t;return e in p?p[e](n):void 0},l=t=>t.map(h),u=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([e,n])=>[e,h(n)]));customElements.get("astro-island")||customElements.define("astro-island",(d=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=async()=>{var i;if(!this.hydrator||!this.isConnected)return;let e=(i=this.parentElement)==null?void 0:i.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let n=this.querySelectorAll("astro-slot"),o={},a=this.querySelectorAll("template[data-astro-template]");for(let r of a){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(o[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of n){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(o[r.getAttribute("name")||"default"]=r.innerHTML)}let c;try{c=this.hasAttribute("props")?u(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",y=this.getAttribute("component-export");throw y&&(s+=` (export ${y})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}await this.hydrator(this)(this.Component,c,o,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))}}connectedCallback(){!this.hasAttribute("await-children")||this.firstChild?this.childrenConnectedCallback():new MutationObserver((e,n)=>{n.disconnect(),setTimeout(()=>this.childrenConnectedCallback(),0)}).observe(this,{childList:!0})}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}start(){let e=JSON.parse(this.getAttribute("opts")),n=this.getAttribute("client");if(Astro[n]===void 0){window.addEventListener(`astro:${n}`,()=>this.start(),{once:!0});return}Astro[n](async()=>{let o=this.getAttribute("renderer-url"),[a,{default:c}]=await Promise.all([import(this.getAttribute("component-url")),o?import(o):()=>()=>{}]),i=this.getAttribute("component-export")||"default";if(!i.includes("."))this.Component=a[i];else{this.Component=a;for(let r of i.split("."))this.Component=this.Component[r]}return this.hydrator=c,this.hydrate},e,this)}attributeChangedCallback(){this.hydrate()}},d.observedAttributes=["props"],d))}})();</script><astro-island uid="2iKzVC" component-url="/_astro/SearchBtn.984510f3.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-3EF6KSR2&quot;]}" ssr="" client="visible" opts="{&quot;name&quot;:&quot;SearchBtn&quot;,&quot;value&quot;:true}" await-children=""><button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <path fill-rule="evenodd" clip-rule="evenodd" d="M16.2071 4.89344C19.0923 7.77862 19.3131 12.3193 16.8693 15.4578C16.8846 15.4713 16.8996 15.4854 16.9143 15.5L21.1569 19.7427C21.5474 20.1332 21.5474 20.7664 21.1569 21.1569C20.7664 21.5474 20.1332 21.5474 19.7427 21.1569L15.5 16.9143C15.4854 16.8996 15.4713 16.8846 15.4578 16.8693C12.3193 19.3131 7.77862 19.0923 4.89344 16.2071C1.76924 13.083 1.76924 8.01763 4.89344 4.89344C8.01763 1.76924 13.083 1.76924 16.2071 4.89344ZM14.7929 14.7929C17.1361 12.4498 17.1361 8.6508 14.7929 6.30765C12.4498 3.96451 8.6508 3.96451 6.30765 6.30765C3.96451 8.6508 3.96451 12.4498 6.30765 14.7929C8.6508 17.1361 12.4498 17.1361 14.7929 14.7929Z" fill="currentColor"></path></svg></button></astro-island>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <a href="https://github.com/one-aalam/astro-ink" title="三次元日誌(astro)'s Github URL'" class="astro-3EF6KSR2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    
                                <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" class="astro-3EF6KSR2"></path>
                            
</svg>
                        </a>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <a href="/rss.xml" title="RSS" class="astro-3EF6KSR2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    
                                <path d="M4 11a9 9 0 0 1 9 9" class="astro-3EF6KSR2"></path>
                                <path d="M4 4a16 16 0 0 1 16 16" class="astro-3EF6KSR2"></path>
                                <circle cx="5" cy="19" r="1" class="astro-3EF6KSR2"></circle>
                            
</svg>
                        </a>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <astro-island uid="h8S6z" component-url="/_astro/ModeSwitcherBtn.0ddc5d6d.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-3EF6KSR2&quot;]}" ssr="" client="visible" opts="{&quot;name&quot;:&quot;ModeSwitcherBtn&quot;,&quot;value&quot;:true}" await-children=""><button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle> <line x1="12" y1="1" x2="12" y2="3"></line> <line x1="12" y1="21" x2="12" y2="23"></line> <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line> <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line> <line x1="1" y1="12" x2="3" y2="12"></line> <line x1="21" y1="12" x2="23" y2="12"></line> <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line> <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></button></astro-island>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</header>
		<main class="astro-BVZIHDZO">
			<article class="astro-BVZIHDZO">
				<div class="hero-image astro-BVZIHDZO">
					
				</div>
				<div class="prose astro-BVZIHDZO">
					<div class="title astro-BVZIHDZO">
						<div class="date astro-BVZIHDZO">
							<time datetime="2017-09-16T00:00:00.000Z">
	Sep 16, 2017
</time>
							
						</div>
						<h1 class="astro-BVZIHDZO">hugoで作ったサイトにSphinxを埋めこむ</h1>
						<hr class="astro-BVZIHDZO">
					</div>
					
	<p>MarkdownできるらしいのでSphinxを入れてみる。</p>
<p>テストページ</p>
<p>Sphinx install
pyenvでpython-3.6.2を導入した。
$ pyenv global 3.6.2
$ python -V
Python 3.6.2
$ pip install sphinx</p>
<p><a href="http://www.sphinx-doc.org/en/stable/markdown.html">http://www.sphinx-doc.org/en/stable/markdown.html</a></p>
<p>ドキュメントを作ってみる</p>
<p>project_name
author_name
version</p>
<p>は必須で作る時に決めなければならない。
$ sphinx-quickstart</p>
<p>いろいろ質問が出てくるが面倒なのでリターン連打。
ウイザード方式ではなくコマンドラインで一息に入力する方式だとこんな感じか。
$ sphinx-quickstart -q -p project_name -a author_name -v 1.0 —sep directory_name
Creating file directory_name↲/source/conf.py.
Creating file directory_name↲/source/index.rst.
Creating file directory_name↲/Makefile.
Creating file directory_name↲/make.bat.</p>
<p>Finished: An initial directory structure has been created.</p>
<p>You should now populate your master file directory_name↲/source/index.rst and create other documentation
source files. Use the Makefile to build the docs, like so:
make builder
where “builder” is one of the supported builders, e.g. html, latex or linkcheck.</p>
<p>ディレクトリ構成はこんな感じに。
directory_name
+ souce
+ conf.py
+ index.rst
+ Makefile
+ build
+ html # make htmlの出力</p>
<p>hugoのサブフォルダにビルド結果をコピーする
hugoroot
+ sphinxroot
+ build
+html
+ public
sphinx # ../sphinxroot/build/html/*をコピーする</p>
<p>hugosite$ sphinx-quickstart -q -p project_name -a author_name -v 1.0 —sep sphinxroot
hugosite$ hugo
hugosite$ pushd shphinxroot
hugosite/sphinxroot$ make html
hugosite/sphinxroot$ rsync -av build/html ../public/sphinx
sending incremental file list
created directory ../public/sphinx
html/
html/.buildinfo
html/genindex.html
html/index.html
html/objects.inv
html/search.html
html/searchindex.js
html/_sources/
html/_sources/index.rst.txt
html/_static/
html/_static/ajax-loader.gif
html/_static/alabaster.css
html/_static/basic.css
html/_static/comment-bright.png
html/_static/comment-close.png
html/_static/comment.png
html/_static/custom.css
html/_static/doctools.js
html/_static/down-pressed.png
html/_static/down.png
html/_static/file.png
html/_static/jquery-3.1.0.js
html/_static/jquery.js
html/_static/minus.png
html/_static/plus.png
html/_static/pygments.css
html/_static/searchtools.js
html/_static/underscore-1.3.1.js
html/_static/underscore.js
html/_static/up-pressed.png
html/_static/up.png
html/_static/websupport.js
hugosite/sphinxroot$ popd</p>
<p>rsyncの呼び方変更。ソースの指定の最後を/にすることでディレクトリそのものではなく中身を送る意味になる。
$ rsync -av build/html/ ../public/sphinx
sending incremental file list
created directory ../public/sphinx
./
.buildinfo
genindex.html
index.html
objects.inv
search.html
searchindex.js
_sources/
_sources/index.rst.txt
_static/
_static/ajax-loader.gif
_static/alabaster.css
_static/basic.css
_static/comment-bright.png
_static/comment-close.png
_static/comment.png
_static/custom.css
_static/doctools.js
_static/down-pressed.png
_static/down.png
_static/file.png
_static/jquery-3.1.0.js
_static/jquery.js
_static/minus.png
_static/plus.png
_static/pygments.css
_static/searchtools.js
_static/underscore-1.3.1.js
_static/underscore.js
_static/up-pressed.png
_static/up.png
_static/websupport.js</p>
<p>hugosite/public$ python -m http.server</p>
<p><a href="http://localhost:8000/sphinx/">http://localhost:8000/sphinx/</a>
で生成したサイトが表示できた。
livereloadで自動更新サーバー</p>
<p>Python Livereload を使って Sphinx でドキュメントを書く
<a href="https://pypi.python.org/pypi/livereload">https://pypi.python.org/pypi/livereload</a></p>
<p>#!/usr/bin/env python
import os</p>
<p>os.system(‘make html’)</p>
<p>from livereload import Server, shell</p>
<p>server = Server()
server.watch(‘source/<strong>/*.rst’, shell(‘make html’))
server.watch(‘source/</strong>/*.md’, shell(‘make html’))
server.serve(
open_url=False,
root=‘build/html’,
port=8080,
host=‘0.0.0.0’
)</p>
<p>markdownを使う</p>
<p>Markdownを使う
<a href="http://www.sphinx-doc.org/en/stable/markdown.html">http://www.sphinx-doc.org/en/stable/markdown.html</a></p>
<p>ImportError: cannot import name DocParser</p>
<p>SphinxでMarkdownを使うときに注意すること</p>
<p>バージョン固定
いろいろエラーが出る。
TypeError: ‘NoneType’ object is not callable</p>
<p>documented that 1.6 breaks recommonmark
Sphinx 1.5.x was the last working version for recommonmark 0.4.0</p>
<p>$ pip install recommonmark==0.4.0
$ pip install sphix==1.5</p>
<p>1.5にすると・・・
AttributeError: module ‘locale’ has no attribute ‘normalize’</p>
<p>localeがsphinx.localeで置き換えられとる。
仕方ないので
強制的に再インポートするコードを入れた。
site-packages/sphinx/<strong>init</strong>.py
def main(argv=sys.argv):
# reimport locale
if ‘locale’ in sys.modules:
del sys.modules[‘locale’]
if sys.path[0].find(‘sphinx’)!=-1:↲
head=sys.path.pop(0)↲
import locale↲</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">if sys.argv[1:2] == ['-M']:↲</span></span>
<span class="line"><span style="color: #e1e4e8">    sys.exit(make_main(argv))↲</span></span>
<span class="line"><span style="color: #e1e4e8">else:↲</span></span>
<span class="line"><span style="color: #e1e4e8">    sys.exit(build_main(argv))↲</span></span></code></pre>
<p>とりあえず動くようになった。ぐぬぬ・・・
TOC
AutoStructifyでできると書いてあるがバージョンを0.4.0に固定したからかうまく動かぬ。
eval_rstで。
'''eval_rst
.. toctree::</p>
<p>item
'''</p>
<p>エラー
TOCツリーにこの指定を入れるとエラーになる
.. toctree::
:caption: Contents:↲</p>
<p>themeを変える</p>
<p>見やすいテーマを設定する</p>
<p>日本語</p>
<p>日本語セクションにアンカーが貼られるようにする</p>
<p>github
.nojekyllでいいらしいがうまくいかなかったので。</p>
<p><a href="https://github.com/michaeljones/sphinx-to-github">https://github.com/michaeljones/sphinx-to-github</a></p>
<p>python3だと修正が要る。python2では試していない。</p>

				</div>
			</article>
		</main>
		<footer class="footer astro-SZ7XMLTE">
    <nav class="nav astro-SZ7XMLTE">
        <div class="astro-SZ7XMLTE">2021  &copy; Copyright notice |  <a href="https://github.com/one-aalam/astro-ink" title="三次元日誌(astro)'s Github URL'" class="astro-SZ7XMLTE">三次元日誌(astro)</a>
        <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><astro-island uid="1QEdto" component-url="/_astro/ModeLabel.e3ff75e7.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-SZ7XMLTE&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;ModeLabel&quot;,&quot;value&quot;:true}" await-children=""><span slot="dark" data-svelte-h="svelte-14ov3lc">(dark)</span></astro-island> theme on <a href="https://astro.build/" class="astro-SZ7XMLTE">Astro</a></div>
        <astro-island uid="1I86to" component-url="/_astro/NetlifyIdentity.94b8edb0.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-SZ7XMLTE&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;NetlifyIdentity&quot;,&quot;value&quot;:true}"></astro-island>
    </nav>
</footer>
	</body></html>