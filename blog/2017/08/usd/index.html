<!DOCTYPE html>
<html lang="en" class="astro-BVZIHDZO">
	<head>
		<!-- Use Google Fonts, if you don't wanna prefer a self-hosted version --><!-- <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap" rel="stylesheet"> --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>PixarのUniversal Scene Descriptionをビルドしてみる</title>
<meta name="title" content="PixarのUniversal Scene Descriptionをビルドしてみる">


<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="shortcut icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- Open Graph Tags (Facebook) -->
<meta property="og:type" content="website">
<meta property="og:title" content="PixarのUniversal Scene Descriptionをビルドしてみる">




<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:title" content="PixarのUniversal Scene Descriptionをビルドしてみる">





<script>
  const theme = (() => {
    if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
      return localStorage.getItem("theme");
    }
    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      return "dark";
    }
    return "light";
  })();

  if (theme === "light") {
    document.documentElement.classList.remove("dark");
  } else {
    document.documentElement.classList.add("dark");
  }
</script>
		
	<link rel="stylesheet" href="/_astro/about.6111bb3a.css" />
<link rel="stylesheet" href="/_astro/about.657f8f57.css" />
<link rel="stylesheet" href="/_astro/about.ee60a110.css" />
<link rel="stylesheet" href="/_astro/about.dcb84f3d.css" /><script type="module" src="/_astro/hoisted.e6960f2c.js"></script></head>

	<body class="astro-BVZIHDZO">
		<header class="header astro-3EF6KSR2">
    <div class="header__logo astro-3EF6KSR2">
        <a href="/" class="avatar astro-3EF6KSR2">
            <img class="header__logo-img astro-3EF6KSR2" src="/assets/logo.svg" alt="Astro logo">
        </a>
    </div>
    <div class="header__meta flex-1 astro-3EF6KSR2">
        <h3 class="header__title dark:text-theme-dark-secondary astro-3EF6KSR2">
            <a href="" class="astro-3EF6KSR2">三次元日誌(astro)</a>
        </h3>
        <div class="header__meta-more flex astro-3EF6KSR2">
            <p class="header__desc astro-3EF6KSR2">
                Crisp, minimal, personal blog theme for Astro
            </p>
            <nav class="header__nav flex astro-3EF6KSR2">
                <ul class="header__ref-list astro-3EF6KSR2">
                    <li class="astro-3EF6KSR2">
                        <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var r=(i,c,n)=>{let s=async()=>{await(await i())()},t=new IntersectionObserver(e=>{for(let o of e)if(o.isIntersecting){t.disconnect(),s();break}});for(let e of n.children)t.observe(e)};(self.Astro||(self.Astro={})).visible=r;window.dispatchEvent(new Event("astro:visible"));})();;(()=>{var d;{let p={0:t=>u(t),1:t=>l(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(l(t)),5:t=>new Set(l(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},h=t=>{let[e,n]=t;return e in p?p[e](n):void 0},l=t=>t.map(h),u=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([e,n])=>[e,h(n)]));customElements.get("astro-island")||customElements.define("astro-island",(d=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=async()=>{var i;if(!this.hydrator||!this.isConnected)return;let e=(i=this.parentElement)==null?void 0:i.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let n=this.querySelectorAll("astro-slot"),o={},a=this.querySelectorAll("template[data-astro-template]");for(let r of a){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(o[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of n){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(o[r.getAttribute("name")||"default"]=r.innerHTML)}let c;try{c=this.hasAttribute("props")?u(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",y=this.getAttribute("component-export");throw y&&(s+=` (export ${y})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}await this.hydrator(this)(this.Component,c,o,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))}}connectedCallback(){!this.hasAttribute("await-children")||this.firstChild?this.childrenConnectedCallback():new MutationObserver((e,n)=>{n.disconnect(),setTimeout(()=>this.childrenConnectedCallback(),0)}).observe(this,{childList:!0})}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}start(){let e=JSON.parse(this.getAttribute("opts")),n=this.getAttribute("client");if(Astro[n]===void 0){window.addEventListener(`astro:${n}`,()=>this.start(),{once:!0});return}Astro[n](async()=>{let o=this.getAttribute("renderer-url"),[a,{default:c}]=await Promise.all([import(this.getAttribute("component-url")),o?import(o):()=>()=>{}]),i=this.getAttribute("component-export")||"default";if(!i.includes("."))this.Component=a[i];else{this.Component=a;for(let r of i.split("."))this.Component=this.Component[r]}return this.hydrator=c,this.hydrate},e,this)}attributeChangedCallback(){this.hydrate()}},d.observedAttributes=["props"],d))}})();</script><astro-island uid="2iKzVC" component-url="/_astro/SearchBtn.984510f3.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-3EF6KSR2&quot;]}" ssr="" client="visible" opts="{&quot;name&quot;:&quot;SearchBtn&quot;,&quot;value&quot;:true}" await-children=""><button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <path fill-rule="evenodd" clip-rule="evenodd" d="M16.2071 4.89344C19.0923 7.77862 19.3131 12.3193 16.8693 15.4578C16.8846 15.4713 16.8996 15.4854 16.9143 15.5L21.1569 19.7427C21.5474 20.1332 21.5474 20.7664 21.1569 21.1569C20.7664 21.5474 20.1332 21.5474 19.7427 21.1569L15.5 16.9143C15.4854 16.8996 15.4713 16.8846 15.4578 16.8693C12.3193 19.3131 7.77862 19.0923 4.89344 16.2071C1.76924 13.083 1.76924 8.01763 4.89344 4.89344C8.01763 1.76924 13.083 1.76924 16.2071 4.89344ZM14.7929 14.7929C17.1361 12.4498 17.1361 8.6508 14.7929 6.30765C12.4498 3.96451 8.6508 3.96451 6.30765 6.30765C3.96451 8.6508 3.96451 12.4498 6.30765 14.7929C8.6508 17.1361 12.4498 17.1361 14.7929 14.7929Z" fill="currentColor"></path></svg></button></astro-island>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <a href="https://github.com/one-aalam/astro-ink" title="三次元日誌(astro)'s Github URL'" class="astro-3EF6KSR2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    
                                <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" class="astro-3EF6KSR2"></path>
                            
</svg>
                        </a>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <a href="/rss.xml" title="RSS" class="astro-3EF6KSR2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    
                                <path d="M4 11a9 9 0 0 1 9 9" class="astro-3EF6KSR2"></path>
                                <path d="M4 4a16 16 0 0 1 16 16" class="astro-3EF6KSR2"></path>
                                <circle cx="5" cy="19" r="1" class="astro-3EF6KSR2"></circle>
                            
</svg>
                        </a>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <astro-island uid="h8S6z" component-url="/_astro/ModeSwitcherBtn.0ddc5d6d.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-3EF6KSR2&quot;]}" ssr="" client="visible" opts="{&quot;name&quot;:&quot;ModeSwitcherBtn&quot;,&quot;value&quot;:true}" await-children=""><button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle> <line x1="12" y1="1" x2="12" y2="3"></line> <line x1="12" y1="21" x2="12" y2="23"></line> <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line> <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line> <line x1="1" y1="12" x2="3" y2="12"></line> <line x1="21" y1="12" x2="23" y2="12"></line> <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line> <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></button></astro-island>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</header>
		<main class="astro-BVZIHDZO">
			<article class="astro-BVZIHDZO">
				<div class="hero-image astro-BVZIHDZO">
					
				</div>
				<div class="prose astro-BVZIHDZO">
					<div class="title astro-BVZIHDZO">
						<div class="date astro-BVZIHDZO">
							<time datetime="2017-08-14T00:00:00.000Z">
	Aug 14, 2017
</time>
							
						</div>
						<h1 class="astro-BVZIHDZO">PixarのUniversal Scene Descriptionをビルドしてみる</h1>
						<hr class="astro-BVZIHDZO">
					</div>
					
	<h1 id="pixarのuniversal-scene-descriptionをビルドしてみる">PixarのUniversal Scene Descriptionをビルドしてみる</h1>
<p>20170902。実はビルドスクリプトがあって、簡単になっていた。</p>
<p>動画でCEDEC2017のセッションを聞いてよさげな気がしたので再度やってみた(ちょっと前に途中までやって放置していた)。
usdviewが使えるようにするとよいらしい。</p>
<h2 id="pixar-usd-の-windows-ビルド方法20179-版">Pixar USD の Windows ビルド方法（2017/9 版）</h2>
<p>自動ビルドスクリプトがついているので放っておくだけなのだけど、うまくいかなかったところを補足する。
環境は、<code>Windows10(64bit)</code> + <code>VisualStudio2017</code> + <code>VisualStudio2015 のコンパイラ追加インストール(VisualStudio2017のインストールメニューにある)</code>
visualstudio補足
VisualStudioは、最近のバージョンに限ってもいろいろある。</p>
<ul>
<li>VisualStudio2017(MSVC14.1)のみ</li>
<li>VisualStudio2017(MSVC14.1)にVS2015(MSVC14.0)のコンパイラが追加インストールされている(うちはこれ)</li>
<li>VisualStudio2015(MSVC14.0)のみ</li>
<li>Visual C++ 2015 Build Tools(MSVC14.0)Python3ビルド向けにIDEの無いバージョン)</li>
</ul>
<p>ものによって <code>vcvars.bat</code> の場所が違って、<code>bjam</code> とか <code>distutils</code> がコンパイラの発見に失敗したりする場合があるようだ。
<code>cl.exe</code> が見つからないような場合、visualstudioの提供する設定済みのdosプロンプトから始めるのが手堅いかもしれない。
一応、
<code>VisualStudio2017 - x64 native tools command prompt</code> からはじめる。
CMakeはVisualStudioの検出にあまり失敗しないので、おもにBoostのビルド対策。
効果があったかは不明。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">D:\work> cl</span></span>
<span class="line"><span style="color: #e1e4e8">Microsoft(R) C/C++ Optimizing Compiler Version 19.10.25019 for x64</span></span>
<span class="line"><span style="color: #e1e4e8">Copyright (C) Microsoft Corporation.  All rights reserved.</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">使い方: cl [ オプション... ] ファイル名... [ /link リンク オプション... ]</span></span></code></pre>
<p><code>VS2017</code> しか入っていないとき
build_usd.py内Boost.Pythonに関してmsvc=14.0指定(VS2015)があるので、これをコメントアウトすればたぶんVS2017しかなくてもビルドできる。Windows版のPython2.7のビルドコンパイラは <code>VS2008(MSVC9.0)</code> らしい。</p>
<p><a href="https://www.microsoft.com/en-us/download/details.aspx?id=44266">https://www.microsoft.com/en-us/download/details.aspx?id=44266</a></p>
<h2 id="python補足">python補足</h2>
<p>Python27以外のPythonが入っているとはまる率が上がる。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">D:\work> python -V</span></span>
<span class="line"><span style="color: #e1e4e8">Python 3.6.0 :: Anaconda 4.3.0 (64-bit)</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">違うPythonだー。</span></span>
<span class="line"><span style="color: #e1e4e8">D:\work> set PATH=D:\Python27;D:\Python27\Scripts;%PATH%</span></span>
<span class="line"><span style="color: #e1e4e8">D:\work> python -V</span></span>
<span class="line"><span style="color: #e1e4e8">Python 2.7.14rc1</span></span>
<span class="line"><span style="color: #e1e4e8">D:\work> pip install pyside</span></span>
<span class="line"><span style="color: #e1e4e8">Collecting pyside</span></span>
<span class="line"><span style="color: #e1e4e8">  Downloading PySide-1.2.4-cp27-none-win_amd64.whl (45.0MB)</span></span>
<span class="line"><span style="color: #e1e4e8">    100% |################################| 45.0MB 36kB/s</span></span>
<span class="line"><span style="color: #e1e4e8">Installing collected packages: pyside</span></span>
<span class="line"><span style="color: #e1e4e8">Successfully installed pyside-1.2.4</span></span></code></pre>
<p>python使いたるもの２系、３系両方入っていたりするものである。
cloneしてビルドスクリプトを実行</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">D:\work> git clone https://github.com/PixarAnimationStudios/USD</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">D:\work> mkdir USD_build</span></span>
<span class="line"><span style="color: #e1e4e8">D:\work> cd USD_build</span></span>
<span class="line"><span style="color: #e1e4e8">D:\work\USD_build></span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">D:\work\USD_build> python ..\USD\build_scripts\build_usd.py</span></span>
<span class="line"><span style="color: #e1e4e8">usage: build_usd.py [-h] [-n] [-v | -q] [--build BUILD]</span></span>
<span class="line"><span style="color: #e1e4e8">                    [--generator GENERATOR]</span></span>
<span class="line"><span style="color: #e1e4e8">                    [--build-shared | --build-monolithic] [--src SRC]</span></span>
<span class="line"><span style="color: #e1e4e8">                    [--inst INST] [--force FORCE_BUILD] [--force-all]</span></span>
<span class="line"><span style="color: #e1e4e8">                    [--tests | --no-tests] [--docs | --no-docs]</span></span>
<span class="line"><span style="color: #e1e4e8">                    [--imaging | --usd-imaging | --no-imaging]</span></span>
<span class="line"><span style="color: #e1e4e8">                    [--ptex | --no-ptex] [--embree | --no-embree]</span></span>
<span class="line"><span style="color: #e1e4e8">                    [--embree-location EMBREE_LOCATION]</span></span>
<span class="line"><span style="color: #e1e4e8">                    [--alembic | --no-alembic] [--hdf5 | --no-hdf5]</span></span>
<span class="line"><span style="color: #e1e4e8">                    [--maya | --no-maya] [--maya-location MAYA_LOCATION]</span></span>
<span class="line"><span style="color: #e1e4e8">                    [--katana | --no-katana]</span></span>
<span class="line"><span style="color: #e1e4e8">                    [--katana-api-location KATANA_API_LOCATION]</span></span>
<span class="line"><span style="color: #e1e4e8">                    [--houdini | --no-houdini]</span></span>
<span class="line"><span style="color: #e1e4e8">                    [--houdini-location HOUDINI_LOCATION]</span></span>
<span class="line"><span style="color: #e1e4e8">                    install_dir</span></span>
<span class="line"><span style="color: #e1e4e8">build_usd.py: error: too few arguments</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">D:\work\USD_build> python ..\USD\build_scripts\build_usd.py .</span></span>
<span class="line"><span style="color: #e1e4e8">ERROR: CMake not found -- please install it and adjust your PATH</span></span></code></pre>
<p>こんな風に足りないツールのメッセージが出るのでせっせとインストールしてパスを設定する。</p>
<blockquote>
<p>set PATH=D:\Program Files\CMake\bin;%PATH%
set PATH=D:\Program Files\NASM;%PATH%</p>
</blockquote>
<p>build…</p>
<h2 id="alembicとか無しの最小ビルド">Alembicとか無しの最小ビルド。</h2>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">D:\work\USD_build> python ..\USD\build_scripts\build_usd.py .</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">Building with settings:</span></span>
<span class="line"><span style="color: #e1e4e8">  USD source directory          D:\work\USD</span></span>
<span class="line"><span style="color: #e1e4e8">  USD install directory         D:\work\USD_build</span></span>
<span class="line"><span style="color: #e1e4e8">  3rd-party source directory    D:\work\USD_build\src</span></span>
<span class="line"><span style="color: #e1e4e8">  3rd-party install directory   D:\work\USD_build</span></span>
<span class="line"><span style="color: #e1e4e8">  Build directory               D:\work\USD_build\build</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">  Building                      Shared libraries</span></span>
<span class="line"><span style="color: #e1e4e8">    Imaging                     On</span></span>
<span class="line"><span style="color: #e1e4e8">      Ptex support:             Off</span></span>
<span class="line"><span style="color: #e1e4e8">    UsdImaging                  On</span></span>
<span class="line"><span style="color: #e1e4e8">    Documentation               Off</span></span>
<span class="line"><span style="color: #e1e4e8">    Tests                       Off</span></span>
<span class="line"><span style="color: #e1e4e8">    Alembic Plugin              Off</span></span>
<span class="line"><span style="color: #e1e4e8">      HDF5 support:             Off</span></span>
<span class="line"><span style="color: #e1e4e8">    Maya Plugin                 Off</span></span>
<span class="line"><span style="color: #e1e4e8">    Katana Plugin               Off</span></span>
<span class="line"><span style="color: #e1e4e8">    Houdini Plugin              Off</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    Dependencies                zlib, boost, TBB, JPEG, TIFF, PNG, OpenEXR, GLEW, OpenImageIO, OpenSubdiv, PyOpenGL</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">STATUS: Installing zlib...</span></span>
<span class="line"><span style="color: #e1e4e8">STATUS: Installing boost...</span></span>
<span class="line"><span style="color: #e1e4e8">STATUS: Installing TBB...</span></span>
<span class="line"><span style="color: #e1e4e8">STATUS: Installing JPEG...</span></span>
<span class="line"><span style="color: #e1e4e8">STATUS: Installing TIFF...</span></span>
<span class="line"><span style="color: #e1e4e8">STATUS: Installing PNG...</span></span></code></pre>
<p>こんな感じに順番にビルドが進んでいく。</p>
<h2 id="pngのビルドでこけた">pngのビルドでこけた</h2>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">pngrutil.obj : error LNK2019: 未解決の外部シンボル inflateValidate が関数 png_inflate_claim で参照されました。</span></span></code></pre>
<p>何故か、zlibへのリンクがうまくいっていない？
CMakeのGUIでsourceをUSD_build/src/libpng-1.6.29、buildをD:/dev/_alembic/USD_build/build/libpng-1.6.29にして確認するとZLIB_LIBRARY_RELEASEがC:/Program Files/Anaconda3/Library/lib/z.libになっていてお察し。
pythonをフルパスで指定したらなんか治った。違うPythonが意図せず使われていたか。
dos窓は、whichコマンドが無いしよくわからん。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">work\USD_build> D:\python27\python ..\USD\build_scripts\build_usd.py . --force png</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">STATUS: Installing PNG...</span></span>
<span class="line"><span style="color: #e1e4e8">STATUS: Installing OpenEXR...</span></span>
<span class="line"><span style="color: #e1e4e8">STATUS: Installing GLEW...</span></span>
<span class="line"><span style="color: #e1e4e8">STATUS: Installing OpenImageIO...</span></span>
<span class="line"><span style="color: #e1e4e8">STATUS: Installing OpenSubdiv...</span></span>
<span class="line"><span style="color: #e1e4e8">STATUS: Installing PyOpenGL...</span></span>
<span class="line"><span style="color: #e1e4e8">STATUS: Installing PyOpenGL...</span></span>
<span class="line"><span style="color: #e1e4e8">STATUS: Installing USD...</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">Success! To use USD, please ensure that you have:</span></span>
<span class="line"><span style="color: #e1e4e8">  The following in your PYTHONPATH environment variable:</span></span>
<span class="line"><span style="color: #e1e4e8">    D:\dev\_alembic\USD_build\lib\python</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">  The following in your PATH environment variable:</span></span>
<span class="line"><span style="color: #e1e4e8">    D:\dev\_alembic\USD_build\bin</span></span>
<span class="line"><span style="color: #e1e4e8">    D:\dev\_alembic\USD_build\lib</span></span></code></pre>
<p>ビルドできた。</p>
<h2 id="boostpythonメモ">Boost.Pythonメモ</h2>
<p><code>boost_python-vc140-mt-1_61.dll</code> が <code>python36.dll</code> とか違うのにリンクしてしまう場合。
最悪PythonをすべてアンインストールしてPython27(64bit)だけをインストールすればいけるのだが、それでは負けた気がするのでBoost.Pythonに使うPythonを強制する方法。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">USD_BUILD/user-conifg.jam</span></span>
<span class="line"><span style="color: #e1e4e8">using python</span></span>
<span class="line"><span style="color: #e1e4e8">    : 2.7                   # Version</span></span>
<span class="line"><span style="color: #e1e4e8">    : C:\\Python27\\python.exe      # Python Path</span></span>
<span class="line"><span style="color: #e1e4e8">    : C:\\Python27\\include         # include path</span></span>
<span class="line"><span style="color: #e1e4e8">    : C:\\Python27\\libs            # lib path(s)</span></span>
<span class="line"><span style="color: #e1e4e8">    ;</span></span></code></pre>
<p>を作って環境変数 <code>BOOST_BUILD_PATH</code> を <code>user-config.jam</code> のあるディレクトリに指定する。
<code>%USERROFILE%\user-config.jam</code> に作って <code>BOOST_BUILD_PATH</code> 無しでもよいが、消し忘れるとあとではまる可能性が増えると思う。</p>
<p><a href="http://www.boost.org/build/doc/html/bbv2/overview/configuration.html">http://www.boost.org/build/doc/html/bbv2/overview/configuration.html</a></p>
<p>WindowsのBoost.Pythonは作るときも使うときもリンクではまる。</p>
<h2 id="usdviewを使ってみる">usdviewを使ってみる</h2>
<p>USD_BUILD/bin/usdviewがある。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">USD_BUILD\bin> D:\python27\python usdview</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">sys.path</span></span>
<span class="line"><span style="color: #e1e4e8">Traceback (most recent call last):</span></span>
<span class="line"><span style="color: #e1e4e8">  File "usdview", line 25, in &#x3C;module></span></span>
<span class="line"><span style="color: #e1e4e8">    import pxr.Usdviewq as Usdviewq</span></span>
<span class="line"><span style="color: #e1e4e8">ImportError: No module named pxr.Usdviewq</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">environ[‘PATH’]</span></span>
<span class="line"><span style="color: #e1e4e8">Traceback (most recent call last):</span></span>
<span class="line"><span style="color: #e1e4e8">  File "usdview", line 37, in &#x3C;module></span></span>
<span class="line"><span style="color: #e1e4e8">    Usdviewq.Launcher().Run()</span></span>
<span class="line"><span style="color: #e1e4e8">  File "D:\dev\_alembic\USD_build\lib\python\pxr\Usdviewq\__init__.py", line 54, in Run</span></span>
<span class="line"><span style="color: #e1e4e8">    valid = self.ValidateOptions(arg_parse_result)</span></span>
<span class="line"><span style="color: #e1e4e8">  File "D:\dev\_alembic\USD_build\lib\python\pxr\Usdviewq\__init__.py", line 167, in ValidateOptions</span></span>
<span class="line"><span style="color: #e1e4e8">    from pxr import Sdf</span></span>
<span class="line"><span style="color: #e1e4e8">  File "D:\dev\_alembic\USD_build\lib\python\pxr\Sdf\__init__.py", line 24, in &#x3C;module></span></span>
<span class="line"><span style="color: #e1e4e8">    import _sdf</span></span>
<span class="line"><span style="color: #e1e4e8">ImportError: DLL load failed: 指定されたモジュールが見つかりません。</span></span></code></pre>
<p>usdviewを改造してしまおう。
環境変数PATHとPYTHONPATHを追加。
usdview.cmd改造でもよいがpythonの方が書きやすいので。
usdviewの冒頭のimport前に下記を追加。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> os</span></span>
<span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> sys</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">basepath</span><span style="color: #F97583">=</span><span style="color: #E1E4E8">os.path.dirname(os.path.dirname(os.path.abspath(</span><span style="color: #79B8FF">__file__</span><span style="color: #E1E4E8">)))</span></span>
<span class="line"><span style="color: #E1E4E8">bin_dir</span><span style="color: #F97583">=</span><span style="color: #E1E4E8">os.path.join(basepath, </span><span style="color: #9ECBFF">'bin'</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">lib_dir</span><span style="color: #F97583">=</span><span style="color: #E1E4E8">os.path.join(basepath, </span><span style="color: #9ECBFF">'lib'</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">libpython_dir</span><span style="color: #F97583">=</span><span style="color: #E1E4E8">os.path.join(lib_dir, </span><span style="color: #9ECBFF">'python'</span><span style="color: #E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">sys.path.append(libpython_dir)</span></span>
<span class="line"><span style="color: #E1E4E8">os.environ[</span><span style="color: #9ECBFF">'PATH'</span><span style="color: #E1E4E8">]</span><span style="color: #F97583">=</span><span style="color: #9ECBFF">"</span><span style="color: #79B8FF">%s</span><span style="color: #9ECBFF">;</span><span style="color: #79B8FF">%s</span><span style="color: #9ECBFF">;"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">%</span><span style="color: #E1E4E8"> (bin_dir, lib_dir) </span><span style="color: #F97583">+</span><span style="color: #E1E4E8"> os.environ[</span><span style="color: #9ECBFF">'PATH'</span><span style="color: #E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> pxr.Usdviewq </span><span style="color: #F97583">as</span><span style="color: #E1E4E8"> Usdviewq</span></span></code></pre>
<p>実行。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">USD_BUILD\bin> D:\python27\python usdview</span></span>
<span class="line"><span style="color: #e1e4e8">usage: usdview [-h] [--renderer {opt,simple}] [--select PRIMPATH]</span></span>
<span class="line"><span style="color: #e1e4e8">               [--camera CAMERA] [--mask PRIMPATH[,PRIMPATH...]]</span></span>
<span class="line"><span style="color: #e1e4e8">               [--clearsettings] [--norender] [--unloaded] [--timing]</span></span>
<span class="line"><span style="color: #e1e4e8">               [--memstats {none,stage,stageAndImaging}]</span></span>
<span class="line"><span style="color: #e1e4e8">               [--numThreads NUMTHREADS] [--ff FIRSTFRAME] [--lf LASTFRAME]</span></span>
<span class="line"><span style="color: #e1e4e8">               [--complexity COMPLEXITY] [--quitAfterStartup]</span></span>
<span class="line"><span style="color: #e1e4e8">               usdFile</span></span>
<span class="line"><span style="color: #e1e4e8">usdview: error: too few arguments</span></span></code></pre>
<p>引数が必要と。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">cube.usd</span></span>
<span class="line"><span style="color: #e1e4e8">#usda 1.0</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">def Cube "Cube"</span></span>
<span class="line"><span style="color: #e1e4e8">{</span></span>
<span class="line"><span style="color: #e1e4e8">}</span></span></code></pre>
<p>実行。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">Warning: in Link at line 180 of D:\dev\_alembic\USD\pxr\imaging\lib\hd\glslProgram.cpp -- Failed to link shader:</span></span>
<span class="line"><span style="color: #e1e4e8">Geometry shader(s) failed to link.</span></span>
<span class="line"><span style="color: #e1e4e8">Geometry link error: HW_UNSUPPORTED.</span></span>
<span class="line"><span style="color: #e1e4e8">ERROR: Internal compile error, error code: E_SC_LITERAL_NOT_DEFINED</span></span>
<span class="line"><span style="color: #e1e4e8">Shader not supported by HW</span></span></code></pre>
<p>Windowは出た。しかしglslのエラーで3DViewの描画ができぬ。
Rx480がだめなのだろうか。
GTX買わねば・・・</p>
<p>Alembic追加する
ToDo</p>

				</div>
			</article>
		</main>
		<footer class="footer astro-SZ7XMLTE">
    <nav class="nav astro-SZ7XMLTE">
        <div class="astro-SZ7XMLTE">2021  &copy; Copyright notice |  <a href="https://github.com/one-aalam/astro-ink" title="三次元日誌(astro)'s Github URL'" class="astro-SZ7XMLTE">三次元日誌(astro)</a>
        <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><astro-island uid="1QEdto" component-url="/_astro/ModeLabel.e3ff75e7.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-SZ7XMLTE&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;ModeLabel&quot;,&quot;value&quot;:true}" await-children=""><span slot="dark" data-svelte-h="svelte-14ov3lc">(dark)</span></astro-island> theme on <a href="https://astro.build/" class="astro-SZ7XMLTE">Astro</a></div>
        <astro-island uid="1I86to" component-url="/_astro/NetlifyIdentity.94b8edb0.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-SZ7XMLTE&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;NetlifyIdentity&quot;,&quot;value&quot;:true}"></astro-island>
    </nav>
</footer>
	</body></html>