<!DOCTYPE html>
<html lang="en" class="astro-BVZIHDZO">
	<head>
		<!-- Use Google Fonts, if you don't wanna prefer a self-hosted version --><!-- <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap" rel="stylesheet"> --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>distutilsでcl.exeが見つからない</title>
<meta name="title" content="distutilsでcl.exeが見つからない">


<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="shortcut icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- Open Graph Tags (Facebook) -->
<meta property="og:type" content="website">
<meta property="og:title" content="distutilsでcl.exeが見つからない">




<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:title" content="distutilsでcl.exeが見つからない">





<script>
  const theme = (() => {
    if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
      return localStorage.getItem("theme");
    }
    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      return "dark";
    }
    return "light";
  })();

  if (theme === "light") {
    document.documentElement.classList.remove("dark");
  } else {
    document.documentElement.classList.add("dark");
  }
</script>
		
	<link rel="stylesheet" href="/_astro/about.6111bb3a.css" />
<link rel="stylesheet" href="/_astro/about.657f8f57.css" />
<link rel="stylesheet" href="/_astro/about.ee60a110.css" />
<link rel="stylesheet" href="/_astro/about.dcb84f3d.css" /><script type="module" src="/_astro/hoisted.e6960f2c.js"></script></head>

	<body class="astro-BVZIHDZO">
		<header class="header astro-3EF6KSR2">
    <div class="header__logo astro-3EF6KSR2">
        <a href="/" class="avatar astro-3EF6KSR2">
            <img class="header__logo-img astro-3EF6KSR2" src="/assets/logo.svg" alt="Astro logo">
        </a>
    </div>
    <div class="header__meta flex-1 astro-3EF6KSR2">
        <h3 class="header__title dark:text-theme-dark-secondary astro-3EF6KSR2">
            <a href="" class="astro-3EF6KSR2">三次元日誌(astro)</a>
        </h3>
        <div class="header__meta-more flex astro-3EF6KSR2">
            <p class="header__desc astro-3EF6KSR2">
                Crisp, minimal, personal blog theme for Astro
            </p>
            <nav class="header__nav flex astro-3EF6KSR2">
                <ul class="header__ref-list astro-3EF6KSR2">
                    <li class="astro-3EF6KSR2">
                        <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var r=(i,c,n)=>{let s=async()=>{await(await i())()},t=new IntersectionObserver(e=>{for(let o of e)if(o.isIntersecting){t.disconnect(),s();break}});for(let e of n.children)t.observe(e)};(self.Astro||(self.Astro={})).visible=r;window.dispatchEvent(new Event("astro:visible"));})();;(()=>{var d;{let p={0:t=>u(t),1:t=>l(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(l(t)),5:t=>new Set(l(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},h=t=>{let[e,n]=t;return e in p?p[e](n):void 0},l=t=>t.map(h),u=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([e,n])=>[e,h(n)]));customElements.get("astro-island")||customElements.define("astro-island",(d=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=async()=>{var i;if(!this.hydrator||!this.isConnected)return;let e=(i=this.parentElement)==null?void 0:i.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let n=this.querySelectorAll("astro-slot"),o={},a=this.querySelectorAll("template[data-astro-template]");for(let r of a){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(o[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of n){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(o[r.getAttribute("name")||"default"]=r.innerHTML)}let c;try{c=this.hasAttribute("props")?u(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",y=this.getAttribute("component-export");throw y&&(s+=` (export ${y})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}await this.hydrator(this)(this.Component,c,o,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))}}connectedCallback(){!this.hasAttribute("await-children")||this.firstChild?this.childrenConnectedCallback():new MutationObserver((e,n)=>{n.disconnect(),setTimeout(()=>this.childrenConnectedCallback(),0)}).observe(this,{childList:!0})}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}start(){let e=JSON.parse(this.getAttribute("opts")),n=this.getAttribute("client");if(Astro[n]===void 0){window.addEventListener(`astro:${n}`,()=>this.start(),{once:!0});return}Astro[n](async()=>{let o=this.getAttribute("renderer-url"),[a,{default:c}]=await Promise.all([import(this.getAttribute("component-url")),o?import(o):()=>()=>{}]),i=this.getAttribute("component-export")||"default";if(!i.includes("."))this.Component=a[i];else{this.Component=a;for(let r of i.split("."))this.Component=this.Component[r]}return this.hydrator=c,this.hydrate},e,this)}attributeChangedCallback(){this.hydrate()}},d.observedAttributes=["props"],d))}})();</script><astro-island uid="2iKzVC" component-url="/_astro/SearchBtn.984510f3.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-3EF6KSR2&quot;]}" ssr="" client="visible" opts="{&quot;name&quot;:&quot;SearchBtn&quot;,&quot;value&quot;:true}" await-children=""><button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <path fill-rule="evenodd" clip-rule="evenodd" d="M16.2071 4.89344C19.0923 7.77862 19.3131 12.3193 16.8693 15.4578C16.8846 15.4713 16.8996 15.4854 16.9143 15.5L21.1569 19.7427C21.5474 20.1332 21.5474 20.7664 21.1569 21.1569C20.7664 21.5474 20.1332 21.5474 19.7427 21.1569L15.5 16.9143C15.4854 16.8996 15.4713 16.8846 15.4578 16.8693C12.3193 19.3131 7.77862 19.0923 4.89344 16.2071C1.76924 13.083 1.76924 8.01763 4.89344 4.89344C8.01763 1.76924 13.083 1.76924 16.2071 4.89344ZM14.7929 14.7929C17.1361 12.4498 17.1361 8.6508 14.7929 6.30765C12.4498 3.96451 8.6508 3.96451 6.30765 6.30765C3.96451 8.6508 3.96451 12.4498 6.30765 14.7929C8.6508 17.1361 12.4498 17.1361 14.7929 14.7929Z" fill="currentColor"></path></svg></button></astro-island>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <a href="https://github.com/one-aalam/astro-ink" title="三次元日誌(astro)'s Github URL'" class="astro-3EF6KSR2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    
                                <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" class="astro-3EF6KSR2"></path>
                            
</svg>
                        </a>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <a href="/rss.xml" title="RSS" class="astro-3EF6KSR2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    
                                <path d="M4 11a9 9 0 0 1 9 9" class="astro-3EF6KSR2"></path>
                                <path d="M4 4a16 16 0 0 1 16 16" class="astro-3EF6KSR2"></path>
                                <circle cx="5" cy="19" r="1" class="astro-3EF6KSR2"></circle>
                            
</svg>
                        </a>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <astro-island uid="h8S6z" component-url="/_astro/ModeSwitcherBtn.0ddc5d6d.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-3EF6KSR2&quot;]}" ssr="" client="visible" opts="{&quot;name&quot;:&quot;ModeSwitcherBtn&quot;,&quot;value&quot;:true}" await-children=""><button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle> <line x1="12" y1="1" x2="12" y2="3"></line> <line x1="12" y1="21" x2="12" y2="23"></line> <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line> <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line> <line x1="1" y1="12" x2="3" y2="12"></line> <line x1="21" y1="12" x2="23" y2="12"></line> <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line> <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></button></astro-island>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</header>
		<main class="astro-BVZIHDZO">
			<article class="astro-BVZIHDZO">
				<div class="hero-image astro-BVZIHDZO">
					
				</div>
				<div class="prose astro-BVZIHDZO">
					<div class="title astro-BVZIHDZO">
						<div class="date astro-BVZIHDZO">
							<time datetime="2017-08-06T00:00:00.000Z">
	Aug 6, 2017
</time>
							
						</div>
						<h1 class="astro-BVZIHDZO">distutilsでcl.exeが見つからない</h1>
						<hr class="astro-BVZIHDZO">
					</div>
					
	<p>Python じゃなくて VisualStudio 側の問題のようなのだけど、setup.py でネイティブモジュールをビルドするときに顕在化したので。</p>
<p>こういう感じのネイティブモジュールを作った。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">from</span><span style="color: #E1E4E8"> distutils.core </span><span style="color: #F97583">import</span><span style="color: #E1E4E8"> setup, Extension</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">imgui_module </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> Extension(</span><span style="color: #9ECBFF">'_swig_imgui'</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #FFAB70">sources</span><span style="color: #F97583">=</span><span style="color: #E1E4E8">[</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #6A737D">#'imgui_wrap.cxx',</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #9ECBFF">'imgui.i'</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #9ECBFF">'imgui/imgui.cpp'</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #9ECBFF">'imgui/imgui_draw.cpp'</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #9ECBFF">'imgui/imgui_demo.cpp'</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">            ],</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #FFAB70">swig_opts</span><span style="color: #F97583">=</span><span style="color: #E1E4E8">[</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #6A737D">#'-modern',</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #9ECBFF">'-c++'</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #9ECBFF">'-py3'</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">            ]</span></span>
<span class="line"><span style="color: #E1E4E8">        )</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">setup (</span><span style="color: #FFAB70">name</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'swig_imgui'</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #FFAB70">version</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'0.1'</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #FFAB70">author</span><span style="color: #E1E4E8">      </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"ousttrue"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #FFAB70">description</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"""imgui wrapper using swig"""</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #FFAB70">ext_modules</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> [imgui_module],</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #FFAB70">py_modules</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> [</span><span style="color: #9ECBFF">"swig_imgui"</span><span style="color: #E1E4E8">],</span></span>
<span class="line"><span style="color: #E1E4E8">        )</span></span></code></pre>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">> python setup.py build</span></span></code></pre>
<p>とするとエラーになる。
Windows10(64bit)上の vs2017 + vcbuildtools の組み合わせの環境である。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">cl.exe /c /nologo /Ox /W3 /GL /DNDEBUG /MD -ID:\Anaconda3\include -ID:\Anaconda3\include /EHsc /Tpimgui_wrap.cpp /Fobuild\temp.win-amd64-3.6\Release\imgui_wrap.obj</span></span>
<span class="line"><span style="color: #e1e4e8">error: command 'cl.exe' failed: No such file or directory</span></span></code></pre>
<p>distutils が cl.exe を探すのに失敗しているようなのである。
lib/distutils 下を調べてみた。
どうやら lib/distutils/_msvccompiler.py で vcvarsall.bat から環境変数を得ることに失敗しているらしい。
実際、C:\Program Files (x86)\Microsoft Visual Studio\Shared\14.0\VC\vcvarsall.bat の呼び出しが失敗していることを突き止めた。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">Error in script usage. The correct usage is:</span></span>
<span class="line"><span style="color: #e1e4e8">"C:\Program Files (x86)\Microsoft Visual Studio\Shared\14.0\VC\vcvarsall.bat" [option]</span></span>
<span class="line"><span style="color: #e1e4e8">or</span></span>
<span class="line"><span style="color: #e1e4e8">"C:\Program Files (x86)\Microsoft Visual Studio\Shared\14.0\VC\vcvarsall.bat" [option] store</span></span>
<span class="line"><span style="color: #e1e4e8">or</span></span>
<span class="line"><span style="color: #e1e4e8">"C:\Program Files (x86)\Microsoft Visual Studio\Shared\14.0\VC\vcvarsall.bat" [option] [version number]</span></span>
<span class="line"><span style="color: #e1e4e8">or</span></span>
<span class="line"><span style="color: #e1e4e8">"C:\Program Files (x86)\Microsoft Visual Studio\Shared\14.0\VC\vcvarsall.bat" [option] store [version number]</span></span>
<span class="line"><span style="color: #e1e4e8">where [option] is: x86 | amd64 | arm | x86_amd64 | x86_arm | amd64_x86 | amd64_arm</span></span>
<span class="line"><span style="color: #e1e4e8">where [version number] is either the full Windows 10 SDK version number or "8.1" to use the windows 8.1 SDK</span></span>
<span class="line"><span style="color: #e1e4e8">:</span></span>
<span class="line"><span style="color: #e1e4e8">The store parameter sets environment variables to support</span></span>
<span class="line"><span style="color: #e1e4e8">store (rather than desktop) development.</span></span>
<span class="line"><span style="color: #e1e4e8">:</span></span>
<span class="line"><span style="color: #e1e4e8">For example:</span></span>
<span class="line"><span style="color: #e1e4e8">"C:\Program Files (x86)\Microsoft Visual Studio\Shared\14.0\VC\vcvarsall.bat" x86_amd64</span></span>
<span class="line"><span style="color: #e1e4e8">"C:\Program Files (x86)\Microsoft Visual Studio\Shared\14.0\VC\vcvarsall.bat" x86_arm store</span></span>
<span class="line"><span style="color: #e1e4e8">"C:\Program Files (x86)\Microsoft Visual Studio\Shared\14.0\VC\vcvarsall.bat" x86_amd64 10.0.10240.0</span></span>
<span class="line"><span style="color: #e1e4e8">"C:\Program Files (x86)\Microsoft Visual Studio\Shared\14.0\VC\vcvarsall.bat" x86_arm store 10.0.10240.0</span></span>
<span class="line"><span style="color: #e1e4e8">"C:\Program Files (x86)\Microsoft Visual Studio\Shared\14.0\VC\vcvarsall.bat" x64 8.1</span></span>
<span class="line"><span style="color: #e1e4e8">"C:\Program Files (x86)\Microsoft Visual Studio\Shared\14.0\VC\vcvarsall.bat" x64 store 8.1</span></span></code></pre>
<p>コマンドラインから実行しても失敗していて、vcvarsall.bat に以下のコードがあるのだが、</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">:setup_buildsku</span></span>
<span class="line"><span style="color: #e1e4e8">if not exist "%~dp0..\..\..\Microsoft Visual C++ Build Tools\vcbuildtools.bat" goto usage</span></span>
<span class="line"><span style="color: #e1e4e8">set CurrentDir=%CD%</span></span>
<span class="line"><span style="color: #e1e4e8">call "%~dp0..\..\..\Microsoft Visual C++ Build Tools\vcbuildtools.bat" %1 %2</span></span>
<span class="line"><span style="color: #e1e4e8">cd /d %CurrentDir%</span></span>
<span class="line"><span style="color: #e1e4e8">goto :eof</span></span></code></pre>
<p>C:\Program Files (x86)\Microsoft Visual Studio\Shared\14.0\VC\vcvarsall.bat
から
C:\Program Files (x86)\Microsoft Visual C++ Build Tools\vcbuildtools.bat”
への相対パスだと一致しないよなーと。
これが原因で cl.exe のパスが取れない。
setup.py にモンキーパッチを当てて cl.exe を発見できるようにしてみた。
以下を setup.py の先頭に追加。</p>
<h1 id="monkey-patch-for-_msvccompiler">monkey patch for _msvccompiler</h1>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> distutils.\</span><span style="color: #FDAEB7; font-style: italic">_msvccompiler</span></span>
<span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> os</span></span>
<span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> subprocess</span></span>
<span class="line"><span style="color: #F97583">def</span><span style="color: #E1E4E8"> \</span><span style="color: #FDAEB7; font-style: italic">_get_vc_env(plat_spec):</span></span>
<span class="line"><span style="color: #F97583">if</span><span style="color: #E1E4E8"> os.getenv(</span><span style="color: #9ECBFF">"DISTUTILS_USE_SDK"</span><span style="color: #E1E4E8">):</span></span>
<span class="line"><span style="color: #F97583">return</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">key.lower(): value</span></span>
<span class="line"><span style="color: #F97583">for</span><span style="color: #E1E4E8"> key, value </span><span style="color: #F97583">in</span><span style="color: #E1E4E8"> os.environ.items()</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    vcvarsall, vcruntime </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> distutils._msvccompiler._find_vcvarsall(plat_spec)</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">if</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">not</span><span style="color: #E1E4E8"> vcvarsall:</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">raise</span><span style="color: #E1E4E8"> DistutilsPlatformError(</span><span style="color: #9ECBFF">"Unable to find vcvarsall.bat"</span><span style="color: #E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">try</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">        out </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> subprocess.check_output(</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #9ECBFF">'cmd /u /c "</span><span style="color: #79B8FF">{}</span><span style="color: #9ECBFF">" </span><span style="color: #79B8FF">{}</span><span style="color: #9ECBFF"> &#x26;&#x26; set'</span><span style="color: #E1E4E8">.format(vcvarsall, plat_spec),</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #FFAB70">stderr</span><span style="color: #F97583">=</span><span style="color: #E1E4E8">subprocess.</span><span style="color: #79B8FF">STDOUT</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        ).decode(</span><span style="color: #9ECBFF">'utf-16le'</span><span style="color: #E1E4E8">, </span><span style="color: #FFAB70">errors</span><span style="color: #F97583">=</span><span style="color: #9ECBFF">'replace'</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #6A737D">#######################################################################</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">if</span><span style="color: #E1E4E8"> out.startswith(</span><span style="color: #9ECBFF">"Error in script usage"</span><span style="color: #E1E4E8">):</span></span>
<span class="line"><span style="color: #E1E4E8">            out </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> subprocess.check_output(</span></span>
<span class="line"><span style="color: #E1E4E8">                </span><span style="color: #9ECBFF">'cmd /u /c "</span><span style="color: #79B8FF">{}</span><span style="color: #9ECBFF">" </span><span style="color: #79B8FF">{}</span><span style="color: #9ECBFF"> &#x26;&#x26; set'</span><span style="color: #E1E4E8">.format(</span><span style="color: #9ECBFF">"C:</span><span style="color: #79B8FF">\\</span><span style="color: #9ECBFF">Program Files (x86)</span><span style="color: #79B8FF">\\</span><span style="color: #9ECBFF">Microsoft Visual C++ Build Tools</span><span style="color: #79B8FF">\\</span><span style="color: #9ECBFF">vcbuildtools.bat"</span><span style="color: #E1E4E8">, plat_spec),</span></span>
<span class="line"><span style="color: #E1E4E8">                </span><span style="color: #FFAB70">stderr</span><span style="color: #F97583">=</span><span style="color: #E1E4E8">subprocess.</span><span style="color: #79B8FF">STDOUT</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">            ).decode(</span><span style="color: #9ECBFF">'utf-16le'</span><span style="color: #E1E4E8">, </span><span style="color: #FFAB70">errors</span><span style="color: #F97583">=</span><span style="color: #9ECBFF">'replace'</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #6A737D">#######################################################################</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">except</span><span style="color: #E1E4E8"> subprocess.CalledProcessError </span><span style="color: #F97583">as</span><span style="color: #E1E4E8"> exc:</span></span>
<span class="line"><span style="color: #E1E4E8">        log.error(exc.output)</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">raise</span><span style="color: #E1E4E8"> DistutilsPlatformError(</span><span style="color: #9ECBFF">"Error executing </span><span style="color: #79B8FF">{}</span><span style="color: #9ECBFF">"</span></span>
<span class="line"><span style="color: #E1E4E8">                .format(exc.cmd))</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    env </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">        key.lower(): value</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">for</span><span style="color: #E1E4E8"> key, _, value </span><span style="color: #F97583">in</span></span>
<span class="line"><span style="color: #E1E4E8">        (line.partition(</span><span style="color: #9ECBFF">'='</span><span style="color: #E1E4E8">) </span><span style="color: #F97583">for</span><span style="color: #E1E4E8"> line </span><span style="color: #F97583">in</span><span style="color: #E1E4E8"> out.splitlines())</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">if</span><span style="color: #E1E4E8"> key </span><span style="color: #F97583">and</span><span style="color: #E1E4E8"> value</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">if</span><span style="color: #E1E4E8"> vcruntime:</span></span>
<span class="line"><span style="color: #E1E4E8">        env[</span><span style="color: #9ECBFF">'py_vcruntime_redist'</span><span style="color: #E1E4E8">] </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> vcruntime</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> env</span></span></code></pre>
<p><code>distutils.\_msvccompiler.\_get_vc_env=\_get_vc_env</code></p>
<p>以前にもこんなことやったことあるような気がする・・・。</p>

				</div>
			</article>
		</main>
		<footer class="footer astro-SZ7XMLTE">
    <nav class="nav astro-SZ7XMLTE">
        <div class="astro-SZ7XMLTE">2021  &copy; Copyright notice |  <a href="https://github.com/one-aalam/astro-ink" title="三次元日誌(astro)'s Github URL'" class="astro-SZ7XMLTE">三次元日誌(astro)</a>
        <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><astro-island uid="1QEdto" component-url="/_astro/ModeLabel.e3ff75e7.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-SZ7XMLTE&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;ModeLabel&quot;,&quot;value&quot;:true}" await-children=""><span slot="dark" data-svelte-h="svelte-14ov3lc">(dark)</span></astro-island> theme on <a href="https://astro.build/" class="astro-SZ7XMLTE">Astro</a></div>
        <astro-island uid="1I86to" component-url="/_astro/NetlifyIdentity.94b8edb0.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-SZ7XMLTE&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;NetlifyIdentity&quot;,&quot;value&quot;:true}"></astro-island>
    </nav>
</footer>
	</body></html>