<!DOCTYPE html>
<html lang="en" class="astro-BVZIHDZO">
	<head>
		<!-- Use Google Fonts, if you don't wanna prefer a self-hosted version --><!-- <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap" rel="stylesheet"> --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>WindowsでPyAlembicできるのか</title>
<meta name="title" content="WindowsでPyAlembicできるのか">


<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="shortcut icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- Open Graph Tags (Facebook) -->
<meta property="og:type" content="website">
<meta property="og:title" content="WindowsでPyAlembicできるのか">




<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:title" content="WindowsでPyAlembicできるのか">





<script>
  const theme = (() => {
    if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
      return localStorage.getItem("theme");
    }
    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      return "dark";
    }
    return "light";
  })();

  if (theme === "light") {
    document.documentElement.classList.remove("dark");
  } else {
    document.documentElement.classList.add("dark");
  }
</script>
		
	<link rel="stylesheet" href="/_astro/about.6111bb3a.css" />
<link rel="stylesheet" href="/_astro/about.657f8f57.css" />
<link rel="stylesheet" href="/_astro/about.ee60a110.css" />
<link rel="stylesheet" href="/_astro/about.dcb84f3d.css" /><script type="module" src="/_astro/hoisted.e6960f2c.js"></script></head>

	<body class="astro-BVZIHDZO">
		<header class="header astro-3EF6KSR2">
    <div class="header__logo astro-3EF6KSR2">
        <a href="/" class="avatar astro-3EF6KSR2">
            <img class="header__logo-img astro-3EF6KSR2" src="/assets/logo.svg" alt="Astro logo">
        </a>
    </div>
    <div class="header__meta flex-1 astro-3EF6KSR2">
        <h3 class="header__title dark:text-theme-dark-secondary astro-3EF6KSR2">
            <a href="" class="astro-3EF6KSR2">三次元日誌(astro)</a>
        </h3>
        <div class="header__meta-more flex astro-3EF6KSR2">
            <p class="header__desc astro-3EF6KSR2">
                Crisp, minimal, personal blog theme for Astro
            </p>
            <nav class="header__nav flex astro-3EF6KSR2">
                <ul class="header__ref-list astro-3EF6KSR2">
                    <li class="astro-3EF6KSR2">
                        <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var r=(i,c,n)=>{let s=async()=>{await(await i())()},t=new IntersectionObserver(e=>{for(let o of e)if(o.isIntersecting){t.disconnect(),s();break}});for(let e of n.children)t.observe(e)};(self.Astro||(self.Astro={})).visible=r;window.dispatchEvent(new Event("astro:visible"));})();;(()=>{var d;{let p={0:t=>u(t),1:t=>l(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(l(t)),5:t=>new Set(l(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},h=t=>{let[e,n]=t;return e in p?p[e](n):void 0},l=t=>t.map(h),u=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([e,n])=>[e,h(n)]));customElements.get("astro-island")||customElements.define("astro-island",(d=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=async()=>{var i;if(!this.hydrator||!this.isConnected)return;let e=(i=this.parentElement)==null?void 0:i.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let n=this.querySelectorAll("astro-slot"),o={},a=this.querySelectorAll("template[data-astro-template]");for(let r of a){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(o[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of n){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(o[r.getAttribute("name")||"default"]=r.innerHTML)}let c;try{c=this.hasAttribute("props")?u(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",y=this.getAttribute("component-export");throw y&&(s+=` (export ${y})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}await this.hydrator(this)(this.Component,c,o,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))}}connectedCallback(){!this.hasAttribute("await-children")||this.firstChild?this.childrenConnectedCallback():new MutationObserver((e,n)=>{n.disconnect(),setTimeout(()=>this.childrenConnectedCallback(),0)}).observe(this,{childList:!0})}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}start(){let e=JSON.parse(this.getAttribute("opts")),n=this.getAttribute("client");if(Astro[n]===void 0){window.addEventListener(`astro:${n}`,()=>this.start(),{once:!0});return}Astro[n](async()=>{let o=this.getAttribute("renderer-url"),[a,{default:c}]=await Promise.all([import(this.getAttribute("component-url")),o?import(o):()=>()=>{}]),i=this.getAttribute("component-export")||"default";if(!i.includes("."))this.Component=a[i];else{this.Component=a;for(let r of i.split("."))this.Component=this.Component[r]}return this.hydrator=c,this.hydrate},e,this)}attributeChangedCallback(){this.hydrate()}},d.observedAttributes=["props"],d))}})();</script><astro-island uid="2iKzVC" component-url="/_astro/SearchBtn.984510f3.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-3EF6KSR2&quot;]}" ssr="" client="visible" opts="{&quot;name&quot;:&quot;SearchBtn&quot;,&quot;value&quot;:true}" await-children=""><button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <path fill-rule="evenodd" clip-rule="evenodd" d="M16.2071 4.89344C19.0923 7.77862 19.3131 12.3193 16.8693 15.4578C16.8846 15.4713 16.8996 15.4854 16.9143 15.5L21.1569 19.7427C21.5474 20.1332 21.5474 20.7664 21.1569 21.1569C20.7664 21.5474 20.1332 21.5474 19.7427 21.1569L15.5 16.9143C15.4854 16.8996 15.4713 16.8846 15.4578 16.8693C12.3193 19.3131 7.77862 19.0923 4.89344 16.2071C1.76924 13.083 1.76924 8.01763 4.89344 4.89344C8.01763 1.76924 13.083 1.76924 16.2071 4.89344ZM14.7929 14.7929C17.1361 12.4498 17.1361 8.6508 14.7929 6.30765C12.4498 3.96451 8.6508 3.96451 6.30765 6.30765C3.96451 8.6508 3.96451 12.4498 6.30765 14.7929C8.6508 17.1361 12.4498 17.1361 14.7929 14.7929Z" fill="currentColor"></path></svg></button></astro-island>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <a href="https://github.com/one-aalam/astro-ink" title="三次元日誌(astro)'s Github URL'" class="astro-3EF6KSR2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    
                                <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" class="astro-3EF6KSR2"></path>
                            
</svg>
                        </a>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <a href="/rss.xml" title="RSS" class="astro-3EF6KSR2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    
                                <path d="M4 11a9 9 0 0 1 9 9" class="astro-3EF6KSR2"></path>
                                <path d="M4 4a16 16 0 0 1 16 16" class="astro-3EF6KSR2"></path>
                                <circle cx="5" cy="19" r="1" class="astro-3EF6KSR2"></circle>
                            
</svg>
                        </a>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <astro-island uid="h8S6z" component-url="/_astro/ModeSwitcherBtn.0ddc5d6d.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-3EF6KSR2&quot;]}" ssr="" client="visible" opts="{&quot;name&quot;:&quot;ModeSwitcherBtn&quot;,&quot;value&quot;:true}" await-children=""><button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle> <line x1="12" y1="1" x2="12" y2="3"></line> <line x1="12" y1="21" x2="12" y2="23"></line> <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line> <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line> <line x1="1" y1="12" x2="3" y2="12"></line> <line x1="21" y1="12" x2="23" y2="12"></line> <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line> <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></button></astro-island>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</header>
		<main class="astro-BVZIHDZO">
			<article class="astro-BVZIHDZO">
				<div class="hero-image astro-BVZIHDZO">
					
				</div>
				<div class="prose astro-BVZIHDZO">
					<div class="title astro-BVZIHDZO">
						<div class="date astro-BVZIHDZO">
							<time datetime="2017-08-07T00:00:00.000Z">
	Aug 7, 2017
</time>
							
						</div>
						<h1 class="astro-BVZIHDZO">WindowsでPyAlembicできるのか</h1>
						<hr class="astro-BVZIHDZO">
					</div>
					
	<p>Windows 上で PyAlembic を使いたいのだができるのか。
素直に Linux でやるべきでは・・・
Windows10(64bit) + Python-3.6(64bit)</p>
<p>作業場。</p>
<p><a href="https://github.com/ousttrue/openexr">https://github.com/ousttrue/openexr</a></p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">Anaconda3(Windows10 64bit)でモジュール探す</span></span>
<span class="line"><span style="color: #e1e4e8">> conda install -c conda-forge alembic</span></span></code></pre>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">しかし、これは違う Alembic だった。</span></span>
<span class="line"><span style="color: #e1e4e8">Python の alembic は、database migrations tool と名前が被っております。</span></span>
<span class="line"><span style="color: #e1e4e8">なるほど・・・。</span></span>
<span class="line"><span style="color: #e1e4e8">Python2.7 なら</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">http://www.lfd.uci.edu/~gohlke/pythonlibs/#pyalembic</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">あとから発見。わいは、Python3.6 にしたいので。</span></span>
<span class="line"><span style="color: #e1e4e8">自前でビルドを試みる</span></span>
<span class="line"><span style="color: #e1e4e8">alembic-1.7.1/python/PyAlembic がそれですな。</span></span>
<span class="line"><span style="color: #e1e4e8">問題が２つある。</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">Python2(Python3 にしたい)</span></span>
<span class="line"><span style="color: #e1e4e8">Boost.Python(PyBind11 にしてリンク問題とおさらばしたい)</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">さすがに PyBind11 差し替えはやるにしても後にするべきなので、 Python3 化だけやる。</span></span>
<span class="line"><span style="color: #e1e4e8">Boost.Python のビルド</span></span>
<span class="line"><span style="color: #e1e4e8">Boost.Python で使う Python を明示するには、user-config.jam に記述する。</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">```</span></span>
<span class="line"><span style="color: #e1e4e8">BOOST_DIR/user-conifg.jam</span></span>
<span class="line"><span style="color: #e1e4e8">using python</span></span>
<span class="line"><span style="color: #e1e4e8">    : 3.6                   # Version</span></span>
<span class="line"><span style="color: #e1e4e8">    : D:\\Anaconda3\\python.exe      # Python Path</span></span>
<span class="line"><span style="color: #e1e4e8">    : D:\\Anaconda3\\include         # include path</span></span>
<span class="line"><span style="color: #e1e4e8">    : D:\\Anaconda3\\libs            # lib path(s)</span></span>
<span class="line"><span style="color: #e1e4e8">    : &#x3C;define>BOOST_ALL_NO_LIB=1</span></span>
<span class="line"><span style="color: #e1e4e8">    ;</span></span>
<span class="line"><span style="color: #e1e4e8">```</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">ビルド</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">```</span></span>
<span class="line"><span style="color: #e1e4e8">boost> b2.exe -j3 --stagedir=stage\x86_64 link=shared runtime-link=shared threading=multi toolset=msvc-14.0 address-model=64 --with-python</span></span>
<span class="line"><span style="color: #e1e4e8">```</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">link=shared にして dll を生成することが必要。</span></span>
<span class="line"><span style="color: #e1e4e8">これは、iex.pyd と imath.pyd 間で Boost.Python の static 変数を共有するために必須である(pyex の型登録周りか)。</span></span>
<span class="line"><span style="color: #e1e4e8">IlmBase を修正</span></span>
<span class="line"><span style="color: #e1e4e8">ilmbase-2.2.0/IexMath/IexMathFloatExc.h</span></span>
<span class="line"><span style="color: #e1e4e8">の以下の部分を修正する。多分、記述ミスなのだけど誰も Windows ビルドしないので気付かれていないのであろう。</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">```c++</span></span>
<span class="line"><span style="color: #e1e4e8">//#if defined(IEX_EXPORTS)↲</span></span>
<span class="line"><span style="color: #e1e4e8">#if defined(IEXMATH_EXPORTS)↲</span></span>
<span class="line"><span style="color: #e1e4e8">```</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">これで ilmbase をビルドしておく。vcpkg を使った。</span></span>
<span class="line"><span style="color: #e1e4e8">alembic を修正</span></span>
<span class="line"><span style="color: #e1e4e8">alembic-1.7.1/lib/Alembic/AbcCoreLayer/CMakeLists.txt を修正してヘッダを追加する(PyAlembic が使う)</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">```cmake</span></span>
<span class="line"><span style="color: #e1e4e8">INSTALL(FILES Read.h Util.h</span></span>
<span class="line"><span style="color: #e1e4e8">    Foundation.h # 追加</span></span>
<span class="line"><span style="color: #e1e4e8">    DESTINATION include/Alembic/AbcCoreLayer)</span></span>
<span class="line"><span style="color: #e1e4e8">```</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">これも、vcpkg を使った。</span></span>
<span class="line"><span style="color: #e1e4e8">PyIlmBase のビルド</span></span>
<span class="line"><span style="color: #e1e4e8">OpenEXR のサイトにある pyilmbase-2.2.0tar.gz を使おうとしたのだけど、github の方が新しいようなのでこちらを使う。</span></span>
<span class="line"><span style="color: #e1e4e8">Python3 向けの修正</span></span>
<span class="line"><span style="color: #e1e4e8">Python2 と Pytnon3 間での非互換によるコンパイルエラーを直していく。</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">```</span></span>
<span class="line"><span style="color: #e1e4e8">PySliceObject_XXX -> PyObject_XXX</span></span>
<span class="line"><span style="color: #e1e4e8">PyInt_XXX -> PyLong_XXX</span></span>
<span class="line"><span style="color: #e1e4e8">PyString_AsString -> PyUnicode_AsUTF8</span></span>
<span class="line"><span style="color: #e1e4e8">_PyThreadState_Current -> _PyThreadState_UncheckedGet()</span></span>
<span class="line"><span style="color: #e1e4e8">```</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">参考</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">Python3 Advent Calendar - Python で 2/3 両方で動くコードを書く(C/API)</span></span>
<span class="line"><span style="color: #e1e4e8">Fix build for Python 3.5</span></span>
<span class="line"><span style="color: #e1e4e8">http://py3c.readthedocs.io/en/latest/guide.html</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">CMake 設定</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">```cmake</span></span>
<span class="line"><span style="color: #e1e4e8">CMAKE_INSTALL_PREFIX</span></span>
<span class="line"><span style="color: #e1e4e8">BOOST_ROOT</span></span>
<span class="line"><span style="color: #e1e4e8">ILMBASE_PACKAGE_PREFIX</span></span>
<span class="line"><span style="color: #e1e4e8">FIND_PACKAGE(numpy)をコメントアウト</span></span>
<span class="line"><span style="color: #e1e4e8">DebugでもPython36.libにリンクするように、#include &#x3C;Python.h>を除去(boost/python.hpp経由でインクルードさせればそうなる)</span></span>
<span class="line"><span style="color: #e1e4e8">```</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">ビルドが通るようになった。</span></span>
<span class="line"><span style="color: #e1e4e8">PyAlembic のビルド</span></span>
<span class="line"><span style="color: #e1e4e8">当初、Alembic のプロジェクトで Python フラグを有効にして一緒にビルドしようとしていたが、PyIlmBase 傘下に PyAlembic をコピーする方式に変えた。</span></span>
<span class="line"><span style="color: #e1e4e8">alembic-1.7.1/python/PyAlembic を ilmbase-2.2.0/PyIlmBase にコピーして、CMakeLists.txt を調整する。</span></span>
<span class="line"><span style="color: #e1e4e8">CMake 設定</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">```cmake</span></span>
<span class="line"><span style="color: #e1e4e8">Alembic_ROOT</span></span>
<span class="line"><span style="color: #e1e4e8">```</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">参考</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">uimac 実装メモ - PyImath</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">PyAlembic のビルドが通ったので実行してみよう</span></span>
<span class="line"><span style="color: #e1e4e8">PyAlembic/Tests/testPolyMesh.py を動かしてみようと思う。</span></span>
<span class="line"><span style="color: #e1e4e8">こういう感じに準備する。</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">```</span></span>
<span class="line"><span style="color: #e1e4e8">testPolyMesh.py</span></span>
<span class="line"><span style="color: #e1e4e8">iex.pyd</span></span>
<span class="line"><span style="color: #e1e4e8">PyIex.dll</span></span>
<span class="line"><span style="color: #e1e4e8">imath.pyd</span></span>
<span class="line"><span style="color: #e1e4e8">PyImath.dll</span></span>
<span class="line"><span style="color: #e1e4e8">alembic.lib</span></span>
<span class="line"><span style="color: #e1e4e8">alembic.pyd</span></span>
<span class="line"><span style="color: #e1e4e8">boost_python-vc140-mt-1_61.dll # debug buildもこれ</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">> C:/python36/python.exe testPolyMesh.py</span></span>
<span class="line"><span style="color: #e1e4e8">```</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">import alembic でクラッシュする。デバッガで追ってみると、モジュールの初期化でエラーが発生している。一個ずつ直す。</span></span>
<span class="line"><span style="color: #e1e4e8">初期化の修正</span></span>
<span class="line"><span style="color: #e1e4e8">Python3 化による変更？</span></span>
<span class="line"><span style="color: #e1e4e8">AbcView</span></span>
<span class="line"><span style="color: #e1e4e8">今回の作業目標。</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">http://alembic.github.io/abcview/</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">これを動作させたい。</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">```</span></span>
<span class="line"><span style="color: #e1e4e8">AbcView has the following requirements:</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">Python 2.6+ => Python 3.6 で動くように改造する(print 文とか)</span></span>
<span class="line"><span style="color: #e1e4e8">PyAlembic。できた</span></span>
<span class="line"><span style="color: #e1e4e8">PyAbcOpenGL。できた</span></span>
<span class="line"><span style="color: #e1e4e8">PyOpenGL。pip</span></span>
<span class="line"><span style="color: #e1e4e8">argparse。pip</span></span>
<span class="line"><span style="color: #e1e4e8">PyQt4。http://www.lfd.uci.edu/~gohlke/pythonlibs/#pyalembic</span></span>
<span class="line"><span style="color: #e1e4e8">numpy-mkl。http://www.lfd.uci.edu/~gohlke/pythonlibs/#pyalembic</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">PyQt4 をインストール</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">https://stackoverflow.com/questions/22640640/how-to-install-pyqt4-on-windows-using-pip</span></span>
<span class="line"><span style="color: #e1e4e8">http://www.lfd.uci.edu/~gohlke/pythonlibs/#pyqt4</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">こんな感じで公式の Python3.6(64bit)に対してインストール。</span></span>
<span class="line"><span style="color: #e1e4e8">D:\Python36\Scripts\pip.exe install .\PyQt4-4.11.4-cp36-cp36m-win_amd64.whl</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">https://www.tutorialspoint.com/pyqt/pyqt_hello_world.htm</span></span>
<span class="line"><span style="color: #e1e4e8">```</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">```python</span></span>
<span class="line"><span style="color: #e1e4e8">import sys</span></span>
<span class="line"><span style="color: #e1e4e8">from PyQt4 import QtGui</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">def window():</span></span>
<span class="line"><span style="color: #e1e4e8">    app = QtGui.QApplication(sys.argv)</span></span>
<span class="line"><span style="color: #e1e4e8">    w = QtGui.QWidget()</span></span>
<span class="line"><span style="color: #e1e4e8">    b = QtGui.QLabel(w)</span></span>
<span class="line"><span style="color: #e1e4e8">    b.setText("Hello World!")</span></span>
<span class="line"><span style="color: #e1e4e8">    w.setGeometry(100,100,200,50)</span></span>
<span class="line"><span style="color: #e1e4e8">    b.move(50,20)</span></span>
<span class="line"><span style="color: #e1e4e8">    w.setWindowTitle("PyQt")</span></span>
<span class="line"><span style="color: #e1e4e8">    w.show()</span></span>
<span class="line"><span style="color: #e1e4e8">    sys.exit(app.exec_())</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">if __name__ == '__main__':</span></span>
<span class="line"><span style="color: #e1e4e8">    window()</span></span>
<span class="line"><span style="color: #e1e4e8">```</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">動いた。</span></span>
<span class="line"><span style="color: #e1e4e8">alembicgl.pyd, alembic.pyd, imath.pyd, iex.pyd と依存 dll 群を wheel 化する</span></span>
<span class="line"><span style="color: #e1e4e8">同じ dll を参照する pyd を同じフォルダに配置したいので、</span></span>
<span class="line"><span style="color: #e1e4e8">共通の親モジュールとして ilm を定義してその中にすべての pyd と dll を収めることにした。</span></span>
<span class="line"><span style="color: #e1e4e8">そのうえでこれを間接的にエクスポートするモジュール’iex’, ‘imath’, ‘alembic’, ‘alembicgl’</span></span>
<span class="line"><span style="color: #e1e4e8">を作る計画。</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">```</span></span>
<span class="line"><span style="color: #e1e4e8">ilm</span></span>
<span class="line"><span style="color: #e1e4e8">    + __init__.py</span></span>
<span class="line"><span style="color: #e1e4e8">    + iex.pyd</span></span>
<span class="line"><span style="color: #e1e4e8">    + imath.pyd</span></span>
<span class="line"><span style="color: #e1e4e8">    + alembic.pyd</span></span>
<span class="line"><span style="color: #e1e4e8">    + alembicgl.pyd</span></span>
<span class="line"><span style="color: #e1e4e8">    + PyEx.dll</span></span>
<span class="line"><span style="color: #e1e4e8">    + PyImath.dll</span></span>
<span class="line"><span style="color: #e1e4e8">    + boost_python.dll</span></span>
<span class="line"><span style="color: #e1e4e8">    + Alembic.dll # VCPKG BUILD</span></span>
<span class="line"><span style="color: #e1e4e8">    + ilmbase.dll # VCPKG BUILD</span></span>
<span class="line"><span style="color: #e1e4e8">    + iex.dll # VCPKG BUILD</span></span>
<span class="line"><span style="color: #e1e4e8">    + imath.dll # VCPKG BUILD</span></span>
<span class="line"><span style="color: #e1e4e8">    + half.dll # VCPKG BUILD</span></span>
<span class="line"><span style="color: #e1e4e8">    + hdf5.dll # VCPKG BUILD</span></span>
<span class="line"><span style="color: #e1e4e8">    + zip.dll # VCPKG BUILD</span></span>
<span class="line"><span style="color: #e1e4e8">    + szip.dll # VCPKG BUILD</span></span>
<span class="line"><span style="color: #e1e4e8">iex</span></span>
<span class="line"><span style="color: #e1e4e8">    + __init__.py # ilm.iexを公開</span></span>
<span class="line"><span style="color: #e1e4e8">imath</span></span>
<span class="line"><span style="color: #e1e4e8">    + __init__.py # ilm.imathを公開</span></span>
<span class="line"><span style="color: #e1e4e8">alembic</span></span>
<span class="line"><span style="color: #e1e4e8">    + __init__.py # ilm.alembicを公開</span></span>
<span class="line"><span style="color: #e1e4e8">alembicgl</span></span>
<span class="line"><span style="color: #e1e4e8">    + __init__.py # ilm.alembicglを公開</span></span>
<span class="line"><span style="color: #e1e4e8">setup.py</span></span>
<span class="line"><span style="color: #e1e4e8">```</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">iex/init.py</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">```</span></span>
<span class="line"><span style="color: #e1e4e8">from ilm.iex import \*</span></span>
<span class="line"><span style="color: #e1e4e8">```</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">こういうのを iex, imath, alembic, alembicgl それぞれに作った。</span></span>
<span class="line"><span style="color: #e1e4e8">setup.py</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">```python</span></span>
<span class="line"><span style="color: #e1e4e8">#!/usr/bin/env python</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">from setuptools import setup, Distribution</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">setup(</span></span>
<span class="line"><span style="color: #e1e4e8">        name='alembic',</span></span>
<span class="line"><span style="color: #e1e4e8">        version='0.1',</span></span>
<span class="line"><span style="color: #e1e4e8">        description='Alembic Library',</span></span>
<span class="line"><span style="color: #e1e4e8">        packages=['ilm', 'iex', 'imath', 'alembic', 'alembicgl'],</span></span>
<span class="line"><span style="color: #e1e4e8">        package_data={</span></span>
<span class="line"><span style="color: #e1e4e8">            'ilm':['*.pyd', '*.dll'],</span></span>
<span class="line"><span style="color: #e1e4e8">            },</span></span>
<span class="line"><span style="color: #e1e4e8">        )</span></span>
<span class="line"><span style="color: #e1e4e8">```</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">```</span></span>
<span class="line"><span style="color: #e1e4e8">py_package> D:\Python36\python.exe setup.py bidst_wheel</span></span>
<span class="line"><span style="color: #e1e4e8">py_package> D:\Python36\Scripts\pip.exe install .\dist\alembic-0.1-cp36-cp36m-win_amd64.whl</span></span>
<span class="line"><span style="color: #e1e4e8">```</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">AbcView を実行してみる</span></span>
<span class="line"><span style="color: #e1e4e8">こういう感じに配置して、abcview_main.py を実行してみる。</span></span>
<span class="line"><span style="color: #e1e4e8">abcview_main.py `# bin/abcview から改名(名前がフォルダと被らないように変更)</span></span>
<span class="line"><span style="color: #e1e4e8">abcview</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">```</span></span>
<span class="line"><span style="color: #e1e4e8">**init**.py</span></span>
<span class="line"><span style="color: #e1e4e8">```</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">python2 仕様の部分をまとめて修正。</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">https://docs.python.jp/3/library/2to3.html</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">AbcView> D:\Python36\python.exe D:\Python36\Tools\scripts\2to3.py -w .</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">print 文、except 文などの定型的な文法問題はこれで一網打尽。ディレクトリを指定することでまとめて処理できる。</span></span>
<span class="line"><span style="color: #e1e4e8">file.toAscii() => file</span></span>
<span class="line"><span style="color: #e1e4e8">これも Python2 との非互換か。</span></span>
<span class="line"><span style="color: #e1e4e8">QtCore.QString(str(value)) => str(value)</span></span>
<span class="line"><span style="color: #e1e4e8">QString は、Python の String でよさげ。</span></span>
<span class="line"><span style="color: #e1e4e8">動いた</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">https://github.com/ousttrue/openexr/releases/tag/v0.1</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">タイムラインを操作したら蛸が動いた。</span></span></code></pre>

				</div>
			</article>
		</main>
		<footer class="footer astro-SZ7XMLTE">
    <nav class="nav astro-SZ7XMLTE">
        <div class="astro-SZ7XMLTE">2021  &copy; Copyright notice |  <a href="https://github.com/one-aalam/astro-ink" title="三次元日誌(astro)'s Github URL'" class="astro-SZ7XMLTE">三次元日誌(astro)</a>
        <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><astro-island uid="1QEdto" component-url="/_astro/ModeLabel.e3ff75e7.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-SZ7XMLTE&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;ModeLabel&quot;,&quot;value&quot;:true}" await-children=""><span slot="dark" data-svelte-h="svelte-14ov3lc">(dark)</span></astro-island> theme on <a href="https://astro.build/" class="astro-SZ7XMLTE">Astro</a></div>
        <astro-island uid="1I86to" component-url="/_astro/NetlifyIdentity.94b8edb0.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-SZ7XMLTE&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;NetlifyIdentity&quot;,&quot;value&quot;:true}"></astro-island>
    </nav>
</footer>
	</body></html>