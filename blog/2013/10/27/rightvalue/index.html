<!DOCTYPE html>
<html lang="en" class="astro-BVZIHDZO">
	<head>
		<!-- Use Google Fonts, if you don't wanna prefer a self-hosted version --><!-- <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap" rel="stylesheet"> --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>右辺値の理解</title>
<meta name="title" content="右辺値の理解">


<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="shortcut icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- Open Graph Tags (Facebook) -->
<meta property="og:type" content="website">
<meta property="og:title" content="右辺値の理解">




<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:title" content="右辺値の理解">





<script>
  const theme = (() => {
    if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
      return localStorage.getItem("theme");
    }
    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      return "dark";
    }
    return "light";
  })();

  if (theme === "light") {
    document.documentElement.classList.remove("dark");
  } else {
    document.documentElement.classList.add("dark");
  }
</script>
		
	<link rel="stylesheet" href="/_astro/about.6111bb3a.css" />
<link rel="stylesheet" href="/_astro/about.657f8f57.css" />
<link rel="stylesheet" href="/_astro/about.ee60a110.css" />
<link rel="stylesheet" href="/_astro/about.dcb84f3d.css" /><script type="module" src="/_astro/hoisted.e6960f2c.js"></script></head>

	<body class="astro-BVZIHDZO">
		<header class="header astro-3EF6KSR2">
    <div class="header__logo astro-3EF6KSR2">
        <a href="/" class="avatar astro-3EF6KSR2">
            <img class="header__logo-img astro-3EF6KSR2" src="/assets/logo.svg" alt="Astro logo">
        </a>
    </div>
    <div class="header__meta flex-1 astro-3EF6KSR2">
        <h3 class="header__title dark:text-theme-dark-secondary astro-3EF6KSR2">
            <a href="" class="astro-3EF6KSR2">三次元日誌(astro)</a>
        </h3>
        <div class="header__meta-more flex astro-3EF6KSR2">
            <p class="header__desc astro-3EF6KSR2">
                Crisp, minimal, personal blog theme for Astro
            </p>
            <nav class="header__nav flex astro-3EF6KSR2">
                <ul class="header__ref-list astro-3EF6KSR2">
                    <li class="astro-3EF6KSR2">
                        <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var r=(i,c,n)=>{let s=async()=>{await(await i())()},t=new IntersectionObserver(e=>{for(let o of e)if(o.isIntersecting){t.disconnect(),s();break}});for(let e of n.children)t.observe(e)};(self.Astro||(self.Astro={})).visible=r;window.dispatchEvent(new Event("astro:visible"));})();;(()=>{var d;{let p={0:t=>u(t),1:t=>l(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(l(t)),5:t=>new Set(l(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},h=t=>{let[e,n]=t;return e in p?p[e](n):void 0},l=t=>t.map(h),u=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([e,n])=>[e,h(n)]));customElements.get("astro-island")||customElements.define("astro-island",(d=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=async()=>{var i;if(!this.hydrator||!this.isConnected)return;let e=(i=this.parentElement)==null?void 0:i.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let n=this.querySelectorAll("astro-slot"),o={},a=this.querySelectorAll("template[data-astro-template]");for(let r of a){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(o[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of n){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(o[r.getAttribute("name")||"default"]=r.innerHTML)}let c;try{c=this.hasAttribute("props")?u(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",y=this.getAttribute("component-export");throw y&&(s+=` (export ${y})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}await this.hydrator(this)(this.Component,c,o,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))}}connectedCallback(){!this.hasAttribute("await-children")||this.firstChild?this.childrenConnectedCallback():new MutationObserver((e,n)=>{n.disconnect(),setTimeout(()=>this.childrenConnectedCallback(),0)}).observe(this,{childList:!0})}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}start(){let e=JSON.parse(this.getAttribute("opts")),n=this.getAttribute("client");if(Astro[n]===void 0){window.addEventListener(`astro:${n}`,()=>this.start(),{once:!0});return}Astro[n](async()=>{let o=this.getAttribute("renderer-url"),[a,{default:c}]=await Promise.all([import(this.getAttribute("component-url")),o?import(o):()=>()=>{}]),i=this.getAttribute("component-export")||"default";if(!i.includes("."))this.Component=a[i];else{this.Component=a;for(let r of i.split("."))this.Component=this.Component[r]}return this.hydrator=c,this.hydrate},e,this)}attributeChangedCallback(){this.hydrate()}},d.observedAttributes=["props"],d))}})();</script><astro-island uid="2iKzVC" component-url="/_astro/SearchBtn.984510f3.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-3EF6KSR2&quot;]}" ssr="" client="visible" opts="{&quot;name&quot;:&quot;SearchBtn&quot;,&quot;value&quot;:true}" await-children=""><button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <path fill-rule="evenodd" clip-rule="evenodd" d="M16.2071 4.89344C19.0923 7.77862 19.3131 12.3193 16.8693 15.4578C16.8846 15.4713 16.8996 15.4854 16.9143 15.5L21.1569 19.7427C21.5474 20.1332 21.5474 20.7664 21.1569 21.1569C20.7664 21.5474 20.1332 21.5474 19.7427 21.1569L15.5 16.9143C15.4854 16.8996 15.4713 16.8846 15.4578 16.8693C12.3193 19.3131 7.77862 19.0923 4.89344 16.2071C1.76924 13.083 1.76924 8.01763 4.89344 4.89344C8.01763 1.76924 13.083 1.76924 16.2071 4.89344ZM14.7929 14.7929C17.1361 12.4498 17.1361 8.6508 14.7929 6.30765C12.4498 3.96451 8.6508 3.96451 6.30765 6.30765C3.96451 8.6508 3.96451 12.4498 6.30765 14.7929C8.6508 17.1361 12.4498 17.1361 14.7929 14.7929Z" fill="currentColor"></path></svg></button></astro-island>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <a href="https://github.com/one-aalam/astro-ink" title="三次元日誌(astro)'s Github URL'" class="astro-3EF6KSR2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    
                                <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" class="astro-3EF6KSR2"></path>
                            
</svg>
                        </a>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <a href="/rss.xml" title="RSS" class="astro-3EF6KSR2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    
                                <path d="M4 11a9 9 0 0 1 9 9" class="astro-3EF6KSR2"></path>
                                <path d="M4 4a16 16 0 0 1 16 16" class="astro-3EF6KSR2"></path>
                                <circle cx="5" cy="19" r="1" class="astro-3EF6KSR2"></circle>
                            
</svg>
                        </a>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <astro-island uid="h8S6z" component-url="/_astro/ModeSwitcherBtn.0ddc5d6d.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-3EF6KSR2&quot;]}" ssr="" client="visible" opts="{&quot;name&quot;:&quot;ModeSwitcherBtn&quot;,&quot;value&quot;:true}" await-children=""><button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle> <line x1="12" y1="1" x2="12" y2="3"></line> <line x1="12" y1="21" x2="12" y2="23"></line> <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line> <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line> <line x1="1" y1="12" x2="3" y2="12"></line> <line x1="21" y1="12" x2="23" y2="12"></line> <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line> <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></button></astro-island>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</header>
		<main class="astro-BVZIHDZO">
			<article class="astro-BVZIHDZO">
				<div class="hero-image astro-BVZIHDZO">
					
				</div>
				<div class="prose astro-BVZIHDZO">
					<div class="title astro-BVZIHDZO">
						<div class="date astro-BVZIHDZO">
							<time datetime="2013-10-27T00:00:00.000Z">
	Oct 27, 2013
</time>
							
						</div>
						<h1 class="astro-BVZIHDZO">右辺値の理解</h1>
						<hr class="astro-BVZIHDZO">
					</div>
					
	<p>右辺値の理解
そろそろ右辺値を抑えておきたい気がしたのでテストコードを書きながら実験してみた(VC2010
Express Edition)。
<a href="http://msdn.microsoft.com/ja-jp/library/vstudio/dd293665.aspx">http://msdn.microsoft.com/ja-jp/library/vstudio/dd293665.aspx</a>
を参考に右辺値実験クラス RightKun を書いた。
コピーコンストラクタと同じくシグニチャは決まったものがあって
右辺値代入演算のオーバーロードとペアになるらしい。
各関数の呼び出しでメッセージを表示するように仕込んだ。
<a href="https://gist.github.com/ousttrue/7178535">https://gist.github.com/ousttrue/7178535</a></p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">#include</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">&#x3C;memory></span></span>
<span class="line"><span style="color: #F97583">#include</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">&#x3C;iostream></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">class</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">RightKun</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #F97583">public:</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8">()</span></span>
<span class="line"><span style="color: #E1E4E8">    {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #B392F0">std</span><span style="color: #E1E4E8">::cout </span><span style="color: #F97583">&#x3C;&#x3C;</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">this</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x3C;&#x3C;</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">":default constructor"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x3C;&#x3C;</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">std</span><span style="color: #E1E4E8">::endl;</span></span>
<span class="line"><span style="color: #E1E4E8">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">~RightKun</span><span style="color: #E1E4E8">()</span></span>
<span class="line"><span style="color: #E1E4E8">    {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #B392F0">std</span><span style="color: #E1E4E8">::cout </span><span style="color: #F97583">&#x3C;&#x3C;</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">this</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x3C;&#x3C;</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">":destructor"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x3C;&#x3C;</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">std</span><span style="color: #E1E4E8">::endl;</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">    // 左辺値によるコピーコンストラクタ</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8">(</span><span style="color: #F97583">const</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x26;</span><span style="color: #FFAB70">src</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">    {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #B392F0">std</span><span style="color: #E1E4E8">::cout </span><span style="color: #F97583">&#x3C;&#x3C;</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">this</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x3C;&#x3C;</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">":copy constructor: "</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">*</span><span style="color: #79B8FF">this</span><span style="color: #F97583">=</span><span style="color: #E1E4E8">src;</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x26;operator</span><span style="color: #B392F0">=</span><span style="color: #E1E4E8">(</span><span style="color: #F97583">const</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x26;</span><span style="color: #FFAB70">src</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">    {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #B392F0">std</span><span style="color: #E1E4E8">::cout </span><span style="color: #F97583">&#x3C;&#x3C;</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"left value operator= "</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x3C;&#x3C;</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x26;</span><span style="color: #E1E4E8">src </span><span style="color: #F97583">&#x3C;&#x3C;</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">std</span><span style="color: #E1E4E8">::endl;</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">*</span><span style="color: #79B8FF">this</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">    // 右辺値によるムーブコンストラクタ</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x26;&#x26;</span><span style="color: #FFAB70">src</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">    {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #B392F0">std</span><span style="color: #E1E4E8">::cout </span><span style="color: #F97583">&#x3C;&#x3C;</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">this</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x3C;&#x3C;</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">":move constructor: "</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">*</span><span style="color: #79B8FF">this</span><span style="color: #F97583">=</span><span style="color: #B392F0">std</span><span style="color: #E1E4E8">::</span><span style="color: #B392F0">move</span><span style="color: #E1E4E8">(src);</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x26;operator</span><span style="color: #B392F0">=</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x26;&#x26;</span><span style="color: #FFAB70">src</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">    {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #B392F0">std</span><span style="color: #E1E4E8">::cout </span><span style="color: #F97583">&#x3C;&#x3C;</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"right value operator= "</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x3C;&#x3C;</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x26;</span><span style="color: #E1E4E8">src </span><span style="color: #F97583">&#x3C;&#x3C;</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">std</span><span style="color: #E1E4E8">::endl;</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">*</span><span style="color: #79B8FF">this</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"><span style="color: #E1E4E8">};</span></span></code></pre>
<p>とりあえず使ってみる</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #6A737D">    // default</span></span>
<span class="line"><span style="color: #E1E4E8">    RightKun r1;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">    // copy</span></span>
<span class="line"><span style="color: #E1E4E8">    RightKun r2</span><span style="color: #F97583">=</span><span style="color: #E1E4E8">r1;</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">結果</span></span>
<span class="line"><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FE33</span><span style="color: #E1E4E8">:</span><span style="color: #F97583">default</span><span style="color: #E1E4E8"> constructor</span></span>
<span class="line"><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FE32</span><span style="color: #E1E4E8">:copy constructor: left value operator</span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FE33</span></span>
<span class="line"><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FE32</span><span style="color: #E1E4E8">:destructor</span></span>
<span class="line"><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FE33</span><span style="color: #E1E4E8">:destructor</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">問題ない。</span></span>
<span class="line"><span style="color: #E1E4E8">通常の値返しの呼び出し</span></span>
<span class="line"><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">create</span><span style="color: #E1E4E8">()</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8">();</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">使う</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    RightKun r</span><span style="color: #F97583">=</span><span style="color: #B392F0">create</span><span style="color: #E1E4E8">();</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">結果</span></span>
<span class="line"><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FE2E</span><span style="color: #E1E4E8">:</span><span style="color: #F97583">default</span><span style="color: #E1E4E8"> constructor</span></span>
<span class="line"><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FE2E</span><span style="color: #E1E4E8">:destructor</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">おや、コピーコンストラクタが呼ばれない。</span></span>
<span class="line"><span style="color: #E1E4E8">RVO</span></span>
<span class="line"><span style="color: #E1E4E8">調べてみたらこれはコンパイラの</span><span style="color: #B392F0">RVO</span><span style="color: #E1E4E8">(Return Value Optimization)という機能で</span></span>
<span class="line"><span style="color: #E1E4E8">返り値が変数に代入されていない場合(いわゆる右辺値)に代入を無しにできるというものらしい。</span></span>
<span class="line"><span style="color: #E1E4E8">なるほど。</span></span>
<span class="line"><span style="color: #E1E4E8">よくある</span></span>
<span class="line"><span style="color: #B392F0">vec3</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">cross</span><span style="color: #E1E4E8">(</span><span style="color: #F97583">const</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">vec3</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x26;</span><span style="color: #FFAB70">lhs</span><span style="color: #E1E4E8">, </span><span style="color: #F97583">const</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">vec3</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x26;</span><span style="color: #FFAB70">rhs</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #6A737D">  // x, y, z...</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">vec3</span><span style="color: #E1E4E8">(x, y, z);</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">vec3 out</span><span style="color: #F97583">=</span><span style="color: #B392F0">cross</span><span style="color: #E1E4E8">(v1, v2);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">的なものを</span></span>
<span class="line"><span style="color: #F97583">void</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">cross</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">vec3</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">*</span><span style="color: #FFAB70">out</span><span style="color: #E1E4E8">, </span><span style="color: #F97583">const</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">vec3</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">*</span><span style="color: #FFAB70">lhs</span><span style="color: #E1E4E8">, </span><span style="color: #F97583">const</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">vec3</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">*</span><span style="color: #FFAB70">rhs</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #6A737D">  // x, y, z...</span></span>
<span class="line"><span style="color: #E1E4E8">  out->x</span><span style="color: #F97583">=</span><span style="color: #E1E4E8">x;</span></span>
<span class="line"><span style="color: #E1E4E8">  out->y</span><span style="color: #F97583">=</span><span style="color: #E1E4E8">y;</span></span>
<span class="line"><span style="color: #E1E4E8">  out->z</span><span style="color: #F97583">=</span><span style="color: #E1E4E8">z;</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">vec3 out;</span></span>
<span class="line"><span style="color: #B392F0">cross</span><span style="color: #E1E4E8">(</span><span style="color: #F97583">&#x26;</span><span style="color: #E1E4E8">out, </span><span style="color: #F97583">&#x26;</span><span style="color: #E1E4E8">v1, </span><span style="color: #F97583">&#x26;</span><span style="color: #E1E4E8">v2);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">と書いても別にパフォーマンスが変わらんと言うことですな。</span></span>
<span class="line"><span style="color: #E1E4E8">最近のコンパイラなら大丈夫というのは、RVOがたぶん効くということか。</span></span>
<span class="line"><span style="color: #E1E4E8">むしろ適切なコンストラクタで初期化できるので前者の方がよろしいな。</span></span>
<span class="line"><span style="color: #E1E4E8">後者だとデフォルトコンストラクタが0で初期化しないようにしたくなるし、</span></span>
<span class="line"><span style="color: #E1E4E8">いろいろよろしくない。</span></span>
<span class="line"><span style="color: #E1E4E8">RVOできないようにする</span></span>
<span class="line"><span style="color: #E1E4E8">先ほどの関数をRVOが無効になるように改造してみる。</span></span>
<span class="line"><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">createNoRVO</span><span style="color: #E1E4E8">()</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    RightKun r;</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> r;</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">使う</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    RightKun r</span><span style="color: #F97583">=</span><span style="color: #B392F0">createNoRVO</span><span style="color: #E1E4E8">();</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">結果</span></span>
<span class="line"><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FDFB</span><span style="color: #E1E4E8">:</span><span style="color: #F97583">default</span><span style="color: #E1E4E8"> constructor</span></span>
<span class="line"><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FE31</span><span style="color: #E1E4E8">:move constructor: right value operator</span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FDFB</span></span>
<span class="line"><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FDFB</span><span style="color: #E1E4E8">:destructor</span></span>
<span class="line"><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FE31</span><span style="color: #E1E4E8">:destructor</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">期せずしてムーブコンストラクタ呼び出しが発生した。</span></span>
<span class="line"><span style="color: #E1E4E8">どういう条件で切り替わるんだこれは。</span></span>
<span class="line"><span style="color: #E1E4E8">調べてみるとムーブコンストラクタはRVOが効かない時に使われる、という記述を見つけた。</span></span>
<span class="line"><span style="color: #E1E4E8">http:</span><span style="color: #6A737D">//msdn.microsoft.com/ja-jp/library/vstudio/dd293668.aspx</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">コンパイラが戻り値の最適化 (RVO) または名前付き戻り値の最適化 (NRVO)</span></span>
<span class="line"><span style="color: #E1E4E8">を使用できない場合に、移動セマンティクスが役立ちます。</span></span>
<span class="line"><span style="color: #E1E4E8">このような場合、型が移動コンストラクターを定義していれば、コンパイラはその移動コンストラクターを呼び出します</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">ほぅ。</span></span>
<span class="line"><span style="color: #E1E4E8">NRVOというのはRVOの進化型で戻り値が変数に代入(名前付き)されていても有効になるものらしい。上記の例だと単純なのでNRVOできそうな気もするがコンパイルオプションとかですかね。</span></span>
<span class="line"><span style="color: #E1E4E8">コンパイラが代入の右側を破棄してもよいと判断した場合にムーブコンストラクタが定義されていれば自動的にそっちを使うという暗黙的な仕組みのようだ。</span></span>
<span class="line"><span style="color: #E1E4E8">g</span><span style="color: #F97583">++</span><span style="color: #E1E4E8">(</span><span style="color: #79B8FF">4.6</span><span style="color: #E1E4E8">)ではNRVOされた</span></span>
<span class="line"><span style="color: #E1E4E8">右側を破棄できないようにしてみよう</span></span>
<span class="line"><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">createCanNotMove</span><span style="color: #E1E4E8">(</span><span style="color: #F97583">const</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x26;</span><span style="color: #FFAB70">src</span><span style="color: #E1E4E8">, </span><span style="color: #F97583">bool</span><span style="color: #E1E4E8"> </span><span style="color: #FFAB70">hoge</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">if</span><span style="color: #E1E4E8">(hoge){</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> src;</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8">();</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">使う</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    RightKun r</span><span style="color: #F97583">=</span><span style="color: #B392F0">createCanNotMove</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8">(), </span><span style="color: #79B8FF">true</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">結果</span></span>
<span class="line"><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FE2C</span><span style="color: #E1E4E8">:</span><span style="color: #F97583">default</span><span style="color: #E1E4E8"> constructor</span></span>
<span class="line"><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FE30</span><span style="color: #E1E4E8">:copy constructor: left value operator</span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FE2C</span></span>
<span class="line"><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FE2C</span><span style="color: #E1E4E8">:destructor</span></span>
<span class="line"><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FE30</span><span style="color: #E1E4E8">:destructor</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">予定通りコピーコンストラクタ呼び出し。問題ない。</span></span>
<span class="line"><span style="color: #E1E4E8">引数をRightKun</span><span style="color: #F97583">&#x26;&#x26;</span><span style="color: #E1E4E8">にしてみる</span></span>
<span class="line"><span style="color: #E1E4E8">ここでsrcの型をRightKun</span><span style="color: #F97583">&#x26;&#x26;</span><span style="color: #E1E4E8">にすればムーブコンストラクタ呼び出しできるのではないか。</span></span>
<span class="line"><span style="color: #F97583">static</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">rightValueArg</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x26;&#x26;</span><span style="color: #FFAB70">src</span><span style="color: #E1E4E8">, </span><span style="color: #F97583">bool</span><span style="color: #E1E4E8"> </span><span style="color: #FFAB70">hoge</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">if</span><span style="color: #E1E4E8">(hoge){</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> src;</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8">();</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">使う</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    RightKun r</span><span style="color: #F97583">=</span><span style="color: #B392F0">rightValueArg</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8">(), </span><span style="color: #79B8FF">true</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">結果</span></span>
<span class="line"><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FE2C</span><span style="color: #E1E4E8">:</span><span style="color: #F97583">default</span><span style="color: #E1E4E8"> constructor</span></span>
<span class="line"><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FE30</span><span style="color: #E1E4E8">:copy constructor: left value operator</span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FE2C</span></span>
<span class="line"><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FE2C</span><span style="color: #E1E4E8">:destructor</span></span>
<span class="line"><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FE30</span><span style="color: #E1E4E8">:destructor</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">ところがぎっちょん、コピーの方。何故かというとrightValueArg内ではsrcはただの変数、左辺値として</span></span>
<span class="line"><span style="color: #E1E4E8">扱われるのだ。RightKun</span><span style="color: #F97583">&#x26;&#x26;</span><span style="color: #E1E4E8">は実引数の制限だ。</span></span>
<span class="line"><span style="color: #E1E4E8">試しに以下のように呼び出すとエラーになる。</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">  RightKun leftvalue;</span></span>
<span class="line"><span style="color: #E1E4E8">  RightKun r</span><span style="color: #F97583">=</span><span style="color: #B392F0">rightValueArg</span><span style="color: #E1E4E8">(leftvalue, </span><span style="color: #79B8FF">true</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">エラー</span></span>
<span class="line"><span style="color: #E1E4E8">error C2664: </span><span style="color: #9ECBFF">'rightValueArg'</span><span style="color: #E1E4E8"> : </span><span style="color: #79B8FF">1</span><span style="color: #E1E4E8"> 番目の引数を </span><span style="color: #9ECBFF">'RightKun'</span><span style="color: #E1E4E8"> から </span><span style="color: #9ECBFF">'RightKun &#x26;&#x26;'</span><span style="color: #E1E4E8"> に変換できません。</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">srcが右辺値であることを明示する</span></span>
<span class="line"><span style="color: #E1E4E8">プログラマはsrcが右辺値であることを明示できる。</span></span>
<span class="line"><span style="color: #F97583">static</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">moveExplicit</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x26;&#x26;</span><span style="color: #FFAB70">src</span><span style="color: #E1E4E8">, </span><span style="color: #F97583">bool</span><span style="color: #E1E4E8"> </span><span style="color: #FFAB70">hoge</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">if</span><span style="color: #E1E4E8">(hoge){</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">static_cast&#x3C;</span><span style="color: #E1E4E8">RightKun</span><span style="color: #F97583">&#x26;&#x26;></span><span style="color: #E1E4E8">(src);</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8">();</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">使う</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    RightKun r</span><span style="color: #F97583">=</span><span style="color: #B392F0">moveExplicit</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8">(), </span><span style="color: #79B8FF">true</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">結果</span></span>
<span class="line"><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FE2B</span><span style="color: #E1E4E8">:</span><span style="color: #F97583">default</span><span style="color: #E1E4E8"> constructor</span></span>
<span class="line"><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FE2F</span><span style="color: #E1E4E8">:move constructor: right value operator</span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FE2B</span></span>
<span class="line"><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FE2B</span><span style="color: #E1E4E8">:destructor</span></span>
<span class="line"><span style="color: #F97583">0</span><span style="color: #79B8FF">025</span><span style="color: #F97583">FE2F</span><span style="color: #E1E4E8">:destructor</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">意図通りにムーブコンストラクタが呼ばれた。</span></span>
<span class="line"><span style="color: #E1E4E8">で、このキャストをラップするのがstd::moveですよと。</span></span>
<span class="line"><span style="color: #E1E4E8">ただし、</span><span style="color: #B392F0">std</span><span style="color: #E1E4E8">::moveした変数をその後で使わないのはプログラマの責任と。</span></span>
<span class="line"><span style="color: #E1E4E8">ということで右辺値とムーブコンストラクタのなんたるかがなんとなく分かった。</span></span>
<span class="line"><span style="color: #E1E4E8">ムーブコンストラクタを呼ぶかどうかはコンパイラが判断するので</span></span>
<span class="line"><span style="color: #E1E4E8">使うほうは気にしなくても、知らないうちにムーブコンストラクタが呼ばれてパフォーマンス上の恩恵を受けることができるということですな。</span></span>
<span class="line"><span style="color: #E1E4E8">知っていればstd::moveによりムーブコンストラクタの呼び出しを増やせるかもしれない。</span></span>
<span class="line"><span style="color: #E1E4E8">unique_ptrでstd::moveを要求されるのはコピーコンストラクタを無効にしつつ、</span></span>
<span class="line"><span style="color: #E1E4E8">ムーブコンストラクタを定義している故と類推できた。</span></span>
<span class="line"><span style="color: #E1E4E8">だいたい分かった結果、</span></span>
<span class="line"><span style="color: #E1E4E8">自分でムーブコンストラクタを定義するクラスを書くことはあまり無さそうな気がした。</span></span>
<span class="line"><span style="color: #E1E4E8">だめな書き方</span></span>
<span class="line"><span style="color: #E1E4E8">最後に右辺値を返す関数を書こうとして最初にはまった、だめなバージョンを書いておく</span></span>
<span class="line"><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x26;&#x26;</span><span style="color: #B392F0">moveFail</span><span style="color: #E1E4E8">()</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">RightKun</span><span style="color: #E1E4E8">();</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">使う</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    RightKun r</span><span style="color: #F97583">=</span><span style="color: #B392F0">moveFail</span><span style="color: #E1E4E8">();</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre>
<p>結果
0025FE07:default constructor
0025FE07:destructor
0025FE2D:move constructor: right value operator= 0025FE07
0025FE2D:destructor</p>
<p>destructor が動いた後のポインタで、ムーブコンストラクタが呼び出される
大変危険なコードになった。 なんじゃこりゃー。
gcc でやってみたらわかりやすいエラーメッセージが出た。
警告: 一時オブジェクトへの参照を返そうとしています [デフォルトで有効]</p>
<p>関数返り値の宣言に&#x26;&#x26;を使ってはいけないということか</p>

				</div>
			</article>
		</main>
		<footer class="footer astro-SZ7XMLTE">
    <nav class="nav astro-SZ7XMLTE">
        <div class="astro-SZ7XMLTE">2021  &copy; Copyright notice |  <a href="https://github.com/one-aalam/astro-ink" title="三次元日誌(astro)'s Github URL'" class="astro-SZ7XMLTE">三次元日誌(astro)</a>
        <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><astro-island uid="1QEdto" component-url="/_astro/ModeLabel.e3ff75e7.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-SZ7XMLTE&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;ModeLabel&quot;,&quot;value&quot;:true}" await-children=""><span slot="dark" data-svelte-h="svelte-14ov3lc">(dark)</span></astro-island> theme on <a href="https://astro.build/" class="astro-SZ7XMLTE">Astro</a></div>
        <astro-island uid="1I86to" component-url="/_astro/NetlifyIdentity.94b8edb0.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-SZ7XMLTE&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;NetlifyIdentity&quot;,&quot;value&quot;:true}"></astro-island>
    </nav>
</footer>
	</body></html>