<!DOCTYPE html>
<html lang="en" class="astro-BVZIHDZO">
	<head>
		<!-- Use Google Fonts, if you don't wanna prefer a self-hosted version --><!-- <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap" rel="stylesheet"> --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>cmakeを使ってみる(Windowsかつコマンドラインで)</title>
<meta name="title" content="cmakeを使ってみる(Windowsかつコマンドラインで)">


<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="shortcut icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- Open Graph Tags (Facebook) -->
<meta property="og:type" content="website">
<meta property="og:title" content="cmakeを使ってみる(Windowsかつコマンドラインで)">




<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:title" content="cmakeを使ってみる(Windowsかつコマンドラインで)">





<script>
  const theme = (() => {
    if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
      return localStorage.getItem("theme");
    }
    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      return "dark";
    }
    return "light";
  })();

  if (theme === "light") {
    document.documentElement.classList.remove("dark");
  } else {
    document.documentElement.classList.add("dark");
  }
</script>
		
	<link rel="stylesheet" href="/_astro/about.6111bb3a.css" />
<link rel="stylesheet" href="/_astro/about.657f8f57.css" />
<link rel="stylesheet" href="/_astro/about.ee60a110.css" />
<link rel="stylesheet" href="/_astro/about.dcb84f3d.css" /><script type="module" src="/_astro/hoisted.e6960f2c.js"></script></head>

	<body class="astro-BVZIHDZO">
		<header class="header astro-3EF6KSR2">
    <div class="header__logo astro-3EF6KSR2">
        <a href="/" class="avatar astro-3EF6KSR2">
            <img class="header__logo-img astro-3EF6KSR2" src="/assets/logo.svg" alt="Astro logo">
        </a>
    </div>
    <div class="header__meta flex-1 astro-3EF6KSR2">
        <h3 class="header__title dark:text-theme-dark-secondary astro-3EF6KSR2">
            <a href="" class="astro-3EF6KSR2">三次元日誌(astro)</a>
        </h3>
        <div class="header__meta-more flex astro-3EF6KSR2">
            <p class="header__desc astro-3EF6KSR2">
                Crisp, minimal, personal blog theme for Astro
            </p>
            <nav class="header__nav flex astro-3EF6KSR2">
                <ul class="header__ref-list astro-3EF6KSR2">
                    <li class="astro-3EF6KSR2">
                        <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var r=(i,c,n)=>{let s=async()=>{await(await i())()},t=new IntersectionObserver(e=>{for(let o of e)if(o.isIntersecting){t.disconnect(),s();break}});for(let e of n.children)t.observe(e)};(self.Astro||(self.Astro={})).visible=r;window.dispatchEvent(new Event("astro:visible"));})();;(()=>{var d;{let p={0:t=>u(t),1:t=>l(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(l(t)),5:t=>new Set(l(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},h=t=>{let[e,n]=t;return e in p?p[e](n):void 0},l=t=>t.map(h),u=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([e,n])=>[e,h(n)]));customElements.get("astro-island")||customElements.define("astro-island",(d=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=async()=>{var i;if(!this.hydrator||!this.isConnected)return;let e=(i=this.parentElement)==null?void 0:i.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let n=this.querySelectorAll("astro-slot"),o={},a=this.querySelectorAll("template[data-astro-template]");for(let r of a){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(o[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of n){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(o[r.getAttribute("name")||"default"]=r.innerHTML)}let c;try{c=this.hasAttribute("props")?u(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",y=this.getAttribute("component-export");throw y&&(s+=` (export ${y})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}await this.hydrator(this)(this.Component,c,o,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))}}connectedCallback(){!this.hasAttribute("await-children")||this.firstChild?this.childrenConnectedCallback():new MutationObserver((e,n)=>{n.disconnect(),setTimeout(()=>this.childrenConnectedCallback(),0)}).observe(this,{childList:!0})}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}start(){let e=JSON.parse(this.getAttribute("opts")),n=this.getAttribute("client");if(Astro[n]===void 0){window.addEventListener(`astro:${n}`,()=>this.start(),{once:!0});return}Astro[n](async()=>{let o=this.getAttribute("renderer-url"),[a,{default:c}]=await Promise.all([import(this.getAttribute("component-url")),o?import(o):()=>()=>{}]),i=this.getAttribute("component-export")||"default";if(!i.includes("."))this.Component=a[i];else{this.Component=a;for(let r of i.split("."))this.Component=this.Component[r]}return this.hydrator=c,this.hydrate},e,this)}attributeChangedCallback(){this.hydrate()}},d.observedAttributes=["props"],d))}})();</script><astro-island uid="2iKzVC" component-url="/_astro/SearchBtn.984510f3.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-3EF6KSR2&quot;]}" ssr="" client="visible" opts="{&quot;name&quot;:&quot;SearchBtn&quot;,&quot;value&quot;:true}" await-children=""><button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <path fill-rule="evenodd" clip-rule="evenodd" d="M16.2071 4.89344C19.0923 7.77862 19.3131 12.3193 16.8693 15.4578C16.8846 15.4713 16.8996 15.4854 16.9143 15.5L21.1569 19.7427C21.5474 20.1332 21.5474 20.7664 21.1569 21.1569C20.7664 21.5474 20.1332 21.5474 19.7427 21.1569L15.5 16.9143C15.4854 16.8996 15.4713 16.8846 15.4578 16.8693C12.3193 19.3131 7.77862 19.0923 4.89344 16.2071C1.76924 13.083 1.76924 8.01763 4.89344 4.89344C8.01763 1.76924 13.083 1.76924 16.2071 4.89344ZM14.7929 14.7929C17.1361 12.4498 17.1361 8.6508 14.7929 6.30765C12.4498 3.96451 8.6508 3.96451 6.30765 6.30765C3.96451 8.6508 3.96451 12.4498 6.30765 14.7929C8.6508 17.1361 12.4498 17.1361 14.7929 14.7929Z" fill="currentColor"></path></svg></button></astro-island>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <a href="https://github.com/one-aalam/astro-ink" title="三次元日誌(astro)'s Github URL'" class="astro-3EF6KSR2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    
                                <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" class="astro-3EF6KSR2"></path>
                            
</svg>
                        </a>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <a href="/rss.xml" title="RSS" class="astro-3EF6KSR2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    
                                <path d="M4 11a9 9 0 0 1 9 9" class="astro-3EF6KSR2"></path>
                                <path d="M4 4a16 16 0 0 1 16 16" class="astro-3EF6KSR2"></path>
                                <circle cx="5" cy="19" r="1" class="astro-3EF6KSR2"></circle>
                            
</svg>
                        </a>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <astro-island uid="h8S6z" component-url="/_astro/ModeSwitcherBtn.0ddc5d6d.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-3EF6KSR2&quot;]}" ssr="" client="visible" opts="{&quot;name&quot;:&quot;ModeSwitcherBtn&quot;,&quot;value&quot;:true}" await-children=""><button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle> <line x1="12" y1="1" x2="12" y2="3"></line> <line x1="12" y1="21" x2="12" y2="23"></line> <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line> <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line> <line x1="1" y1="12" x2="3" y2="12"></line> <line x1="21" y1="12" x2="23" y2="12"></line> <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line> <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></button></astro-island>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</header>
		<main class="astro-BVZIHDZO">
			<article class="astro-BVZIHDZO">
				<div class="hero-image astro-BVZIHDZO">
					
				</div>
				<div class="prose astro-BVZIHDZO">
					<div class="title astro-BVZIHDZO">
						<div class="date astro-BVZIHDZO">
							<time datetime="2013-12-08T00:00:00.000Z">
	Dec 8, 2013
</time>
							
						</div>
						<h1 class="astro-BVZIHDZO">cmakeを使ってみる(Windowsかつコマンドラインで)</h1>
						<hr class="astro-BVZIHDZO">
					</div>
					
	<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">ArUcoを使おうとしたら、msvcpdのvc10版を要求されてvc12でデバッグビルドが動かなかった。</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">最新版のOpenCV-2.4.7をゲットしてきたところvc10とvc11は含まれて居るのだが、vc12ビルドは含まれていなかった(vc2013は早すぎたかw)。</span></span>
<span class="line"><span style="color: #e1e4e8">仕方ないので自前ビルドすることにした。</span></span>
<span class="line"><span style="color: #e1e4e8">ということでcmakeの使い方を調べてみる。</span></span>
<span class="line"><span style="color: #e1e4e8">ついでに、cmakeでビルドしたライブラリを特定のディレクトリを基準にインストールする方法を調べてみる。</span></span>
<span class="line"><span style="color: #e1e4e8">練習にzlibをビルドしてインストールしてみる</span></span>
<span class="line"><span style="color: #e1e4e8">以下のようなディレクトリ構成で運用してみることを目標に作業開始。</span></span>
<span class="line"><span style="color: #e1e4e8">local_vc12</span></span>
<span class="line"><span style="color: #e1e4e8"> + bin # dll置き場</span></span>
<span class="line"><span style="color: #e1e4e8"> + include # dllを使うのに必要なheader置き場</span></span>
<span class="line"><span style="color: #e1e4e8"> + lib # dllのimportライブラリ置き場</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">外部依存の無い適当なライブラリで練習してみようということでzlibを選定。</span></span>
<span class="line"><span style="color: #e1e4e8">さっそくcmakeを使ってみようと思ったら、zlib-1.2.8にはCmakeLists.txtが含まれとるで。</span></span>
<span class="line"><span style="color: #e1e4e8">C:\src> cd zlib-1.2.8</span></span>
<span class="line"><span style="color: #e1e4e8">C:\src\zlib-1.2.8> cmake -D CMAKE_INSTALL_PREFIX=C:/local_vc12 .</span></span>
<span class="line"><span style="color: #e1e4e8">C:\src\zlib-1.2.8> msbuild INSTALL.vcxproj</span></span>
<span class="line"><span style="color: #e1e4e8">C:\src\zlib-1.2.8> msbuild INSTALL.vcxproj /p:Configuration=Release</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">以上で下記のようになった。</span></span>
<span class="line"><span style="color: #e1e4e8">C:/local_vc12</span></span>
<span class="line"><span style="color: #e1e4e8">C:/local_vc12/bin</span></span>
<span class="line"><span style="color: #e1e4e8">C:/local_vc12/bin/zlib.dll</span></span>
<span class="line"><span style="color: #e1e4e8">C:/local_vc12/bin/zlibd.dll</span></span>
<span class="line"><span style="color: #e1e4e8">C:/local_vc12/include</span></span>
<span class="line"><span style="color: #e1e4e8">C:/local_vc12/include/zconf.h</span></span>
<span class="line"><span style="color: #e1e4e8">C:/local_vc12/include/zlib.h</span></span>
<span class="line"><span style="color: #e1e4e8">C:/local_vc12/lib</span></span>
<span class="line"><span style="color: #e1e4e8">C:/local_vc12/lib/zlib.lib</span></span>
<span class="line"><span style="color: #e1e4e8">C:/local_vc12/lib/zlibd.lib</span></span>
<span class="line"><span style="color: #e1e4e8">C:/local_vc12/lib/zlibstatic.lib</span></span>
<span class="line"><span style="color: #e1e4e8">C:/local_vc12/lib/zlibstaticd.lib</span></span>
<span class="line"><span style="color: #e1e4e8">C:/local_vc12/share</span></span>
<span class="line"><span style="color: #e1e4e8">C:/local_vc12/share/man</span></span>
<span class="line"><span style="color: #e1e4e8">C:/local_vc12/share/man/man3</span></span>
<span class="line"><span style="color: #e1e4e8">C:/local_vc12/share/man/man3/zlib.3</span></span>
<span class="line"><span style="color: #e1e4e8">C:/local_vc12/share/pkgconfig</span></span>
<span class="line"><span style="color: #e1e4e8">C:/local_vc12/share/pkgconfig/zlib.pc</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">素晴らしい。</span></span>
<span class="line"><span style="color: #e1e4e8">OpenCV-2.4.7でやってみる</span></span>
<span class="line"><span style="color: #e1e4e8">C:\src> cd opencv-2.4.7</span></span>
<span class="line"><span style="color: #e1e4e8">C:\src\opencv-2.4.7> cmake -D CMAKE_INSTALL_PREFIX=C:/local_vc12 .</span></span>
<span class="line"><span style="color: #e1e4e8">C:\src\opencv-2.4.7> msbuild ALL_BUILD.vcxproj</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">失敗する。</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">https://github.com/SpecLad/opencv/commit/7973594a01228107dcb9d2d1f10eb64498b91aac</span></span>
<span class="line"><span style="color: #e1e4e8">http://stackoverflow.com/questions/17409956/cannot-compile-opencv-2-4-5-with-vs-2013-rtm</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">あとIlmxxxでmin, maxのエラーが出るので”#include</span></span>
<span class="line"><span style="color: #e1e4e8">&#x3C;algorithm>“する。std::min,</span></span>
<span class="line"><span style="color: #e1e4e8">maxはalgorithmに入っとる。ALL_BUILDが成功したらINSTALLする。</span></span>
<span class="line"><span style="color: #e1e4e8">C:\src\opencv-2.4.7> msbuild INSTALL.vcxproj</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">これで”local_vc12”にopencvも入った。</span></span>
<span class="line"><span style="color: #e1e4e8">cmakeはいままで敬遠していたのだがライブラリのinstallまで面倒見てくれるのはいいですな。</span></span>
<span class="line"><span style="color: #e1e4e8">同じく敬遠していた自前dllを使う開発が捗りそうな感じだ。</span></span>
<span class="line"><span style="color: #e1e4e8">ArUcoをビルド</span></span>
<span class="line"><span style="color: #e1e4e8">cmakeを使ったアプリ(ライブラリを使う方)のビルド。</span></span>
<span class="line"><span style="color: #e1e4e8">C:\src> cd aruco-1.2.4</span></span>
<span class="line"><span style="color: #e1e4e8">C:\src\aruco-1.2.4> cmake -D CMAKE_INSTALL_PREFIX=C:/local_vc12 .</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">ここでエラーが出る。</span></span>
<span class="line"><span style="color: #e1e4e8">OpenCVが正式ビルドと違うディレクトリにインストールされたために検知に失敗する。</span></span>
<span class="line"><span style="color: #e1e4e8">“C:/local_vc12/OpenCVConfig.cmake”を直接修正した。</span></span>
<span class="line"><span style="color: #e1e4e8">get_filename_component(OpenCV_CONFIG_PATH "${CMAKE_CURRENT_LIST_FILE}" PATH CACHE)</span></span>
<span class="line"><span style="color: #e1e4e8">#if(OpenCV_RUNTIME AND OpenCV_ARCH)</span></span>
<span class="line"><span style="color: #e1e4e8">#  if(OpenCV_STATIC AND EXISTS "${OpenCV_CONFIG_PATH}/${OpenCV_ARCH}/${OpenCV_RUNTIME}/staticlib/OpenCVConfig.cmake")</span></span>
<span class="line"><span style="color: #e1e4e8">#    if(OpenCV_CUDA AND EXISTS "${OpenCV_CONFIG_PATH}/gpu/${OpenCV_ARCH}/${OpenCV_RUNTIME}/staticlib/OpenCVConfig.cmake")</span></span>
<span class="line"><span style="color: #e1e4e8">#      set(OpenCV_LIB_PATH "${OpenCV_CONFIG_PATH}/gpu/${OpenCV_ARCH}/${OpenCV_RUNTIME}/staticlib")</span></span>
<span class="line"><span style="color: #e1e4e8">#    else()</span></span>
<span class="line"><span style="color: #e1e4e8">#      set(OpenCV_LIB_PATH "${OpenCV_CONFIG_PATH}/${OpenCV_ARCH}/${OpenCV_RUNTIME}/staticlib")</span></span>
<span class="line"><span style="color: #e1e4e8">#    endif()</span></span>
<span class="line"><span style="color: #e1e4e8">#  elseif(EXISTS "${OpenCV_CONFIG_PATH}/${OpenCV_ARCH}/${OpenCV_RUNTIME}/lib/OpenCVConfig.cmake")</span></span>
<span class="line"><span style="color: #e1e4e8">#    if(OpenCV_CUDA AND EXISTS "${OpenCV_CONFIG_PATH}/gpu/${OpenCV_ARCH}/${OpenCV_RUNTIME}/lib/OpenCVConfig.cmake")</span></span>
<span class="line"><span style="color: #e1e4e8">#      set(OpenCV_LIB_PATH "${OpenCV_CONFIG_PATH}/gpu/${OpenCV_ARCH}/${OpenCV_RUNTIME}/lib")</span></span>
<span class="line"><span style="color: #e1e4e8">#    else()</span></span>
<span class="line"><span style="color: #e1e4e8">#      set(OpenCV_LIB_PATH "${OpenCV_CONFIG_PATH}/${OpenCV_ARCH}/${OpenCV_RUNTIME}/lib")</span></span>
<span class="line"><span style="color: #e1e4e8">#    endif()</span></span>
<span class="line"><span style="color: #e1e4e8">#  endif()</span></span>
<span class="line"><span style="color: #e1e4e8">#endif()</span></span>
<span class="line"><span style="color: #e1e4e8">set(OpenCV_LIB_PATH "${OpenCV_CONFIG_PATH}/lib")</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">これでビルドできた。</span></span>
<span class="line"><span style="color: #e1e4e8">C:\src\aruco-1.2.4> cmake -D CMAKE_INSTALL_PREFIX=C:/local_vc12 .</span></span>
<span class="line"><span style="color: #e1e4e8">C:\src\opencv-2.4.7> msbuild ALL_BUILD.vcxproj</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">しかし、OpenGLを使ったサンプルがビルドされぬ。</span></span>
<span class="line"><span style="color: #e1e4e8">どうやらglutが見つからないらいしい。せっかくなのでFreeGlutを入れてみますか。</span></span>
<span class="line"><span style="color: #e1e4e8">FreeGlut</span></span>
<span class="line"><span style="color: #e1e4e8">http://freeglut.sourceforge.net/</span></span>
<span class="line"><span style="color: #e1e4e8">C:\src\freeglut-2.8.1> cmake -D CMAKE_INSTALL_PREFIX=C:/local_vc12 .</span></span>
<span class="line"><span style="color: #e1e4e8">CMake Error: The source directory "C:/src/freeglut-2.8.1" does not appear to contain CMakeLists.txt.</span></span>
<span class="line"><span style="color: #e1e4e8">Specify --help for usage, or press the help button on the CMake GUI.</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">CMakeLists.txtが無い。作ってみる。</span></span>
<span class="line"><span style="color: #e1e4e8">project (freeglut)</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">file(GLOB SOURCES "src/*.c")</span></span>
<span class="line"><span style="color: #e1e4e8">ADD_LIBRARY(freeglut SHARED ${SOURCES})</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">include_directories(include)</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">ADD_DEFINITIONS(-DFREEGLUT_EXPORTS)</span></span>
<span class="line"><span style="color: #e1e4e8">ADD_DEFINITIONS(-D_USRDLL)</span></span>
<span class="line"><span style="color: #e1e4e8">ADD_DEFINITIONS(-D_WINDOWS)</span></span>
<span class="line"><span style="color: #e1e4e8">ADD_DEFINITIONS(-DWIN32)</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">C:\src\freeglut-2.8.1> cmake -D CMAKE_INSTALL_PREFIX=C:/local_vc12 .</span></span>
<span class="line"><span style="color: #e1e4e8">C:\src\opencv-2.4.7> msbuild ALL_BUILD.vcxproj</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">ビルドできた。INSTALL.vcxprojが見当たらないのでCMakeLists.txtに追記する必要がありそう。</span></span>
<span class="line"><span style="color: #e1e4e8">インストールに関する追記。</span></span>
<span class="line"><span style="color: #e1e4e8"># dll</span></span>
<span class="line"><span style="color: #e1e4e8">INSTALL(TARGETS freeglut RUNTIME</span></span>
<span class="line"><span style="color: #e1e4e8">    DESTINATION bin)</span></span>
<span class="line"><span style="color: #e1e4e8"># lib</span></span>
<span class="line"><span style="color: #e1e4e8">INSTALL(TARGETS freeglut ARCHIVE</span></span>
<span class="line"><span style="color: #e1e4e8">    DESTINATION lib)</span></span>
<span class="line"><span style="color: #e1e4e8"># headers</span></span>
<span class="line"><span style="color: #e1e4e8">INSTALL(DIRECTORY include/</span></span>
<span class="line"><span style="color: #e1e4e8">    DESTINATION include</span></span>
<span class="line"><span style="color: #e1e4e8">    PATTERN "Makefile.*" EXCLUDE</span></span>
<span class="line"><span style="color: #e1e4e8">)</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">インストールしてみる。</span></span>
<span class="line"><span style="color: #e1e4e8">C:\src\freeglut-2.8.1> cmake -D CMAKE_INSTALL_PREFIX=C:/local_vc12 .</span></span>
<span class="line"><span style="color: #e1e4e8">C:\src\opencv-2.4.7> msbuild INSTALL.vcxproj</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8"> -- Install configuration: "Debug"</span></span>
<span class="line"><span style="color: #e1e4e8"> -- Installing: C:/local_vc12/bin/freeglut.dll</span></span>
<span class="line"><span style="color: #e1e4e8"> -- Installing: C:/local_vc12/lib/freeglut.lib</span></span>
<span class="line"><span style="color: #e1e4e8"> -- Installing: C:/local_vc12/include</span></span>
<span class="line"><span style="color: #e1e4e8"> -- Installing: C:/local_vc12/include/GL</span></span>
<span class="line"><span style="color: #e1e4e8"> -- Up-to-date: C:/local_vc12/include/GL/freeglut.h</span></span>
<span class="line"><span style="color: #e1e4e8"> -- Up-to-date: C:/local_vc12/include/GL/freeglut_ext.h</span></span>
<span class="line"><span style="color: #e1e4e8"> -- Up-to-date: C:/local_vc12/include/GL/freeglut_std.h</span></span>
<span class="line"><span style="color: #e1e4e8"> -- Up-to-date: C:/local_vc12/include/GL/glut.h</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">インストール成功。</span></span>
<span class="line"><span style="color: #e1e4e8">再度ArUco</span></span>
<span class="line"><span style="color: #e1e4e8">C:\src\freeglut-2.8.1> cmake -D CMAKE_INSTALL_PREFIX=C:/local_vc12 .</span></span>
<span class="line"><span style="color: #e1e4e8"> -- FOUND OPENGL=YES    LIBS=opengl32;glu32;C:/local_vc12/lib/freeglut.lib</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">glutが発見されたようだ。</span></span>
<span class="line"><span style="color: #e1e4e8">どうやらcmakeはCMAKE_INSTALL_PREFIXにライブラリを探しに行くようですな。</span></span>
<span class="line"><span style="color: #e1e4e8">C:\src\opencv-2.4.7> msbuild ALL_BUILD.vcxproj</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">gl.hの前に”#include &#x3C;windows.h>“してやってビルドできた。</span></span>
<span class="line"><span style="color: #e1e4e8">Debug版の後ろに”d”をつける</span></span>
<span class="line"><span style="color: #e1e4e8">FreeGlutのCmakeLists.txtにzlibの”CmakeLists.txt”から頂いてきた。</span></span>
<span class="line"><span style="color: #e1e4e8">set(CMAKE_DEBUG_POSTFIX "d")</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">記述順の影響があるようで前の方(ADD_LIBRARYより前？)に書く必要があるっぽい。</span></span>
<span class="line"><span style="color: #e1e4e8">Debug版の後ろに”d”がついたライブラリを使う</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">http://stackoverflow.com/questions/2209929/linking-different-libraries-for-debug-and-release-builds-in-cmake-on-windows</span></span>
<span class="line"><span style="color: #e1e4e8">http://stackoverflow.com/questions/5497348/debug-and-release-library-linking-with-cmake-visual-studio</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">こういう書き方でできた。</span></span>
<span class="line"><span style="color: #e1e4e8">set (OPENGL_LIBS  general ${OPENGL_gl_LIBRARY} ${OPENGL_glu_LIBRARY} optimized ${GLUT_glut_LIBRARY} debug ${GLUT_glut_DEBUG_LIBRARY})</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">CMAKE_DEBUG_POSTFIXに関連は使われる方と使う方の双方で合わせる必要があるので変更する場合は自分で両方の面倒を見なければならない。</span></span>
<span class="line"><span style="color: #e1e4e8">一応、cmakeのひととおりの使い方が分かってきた。</span></span>
<span class="line"><span style="color: #e1e4e8">vcがmsbuildを使うようになってビルドが制御可能になっている感じ。</span></span>
<span class="line"><span style="color: #e1e4e8">makeの各ターゲットに対するmsbuildの実行方法は以下の通り。</span></span>
<span class="line"><span style="color: #e1e4e8">"target", "make", "msbuild"</span></span>
<span class="line"><span style="color: #e1e4e8">"build", "make all", "msbuild ALL_BUILD.vcxproj /t:Build"</span></span>
<span class="line"><span style="color: #e1e4e8">"release build", "?", "msbuild ALL_BUILD.vcxproj /t:Build /p:Configuration=Release"</span></span>
<span class="line"><span style="color: #e1e4e8">"debug build", "?", "msbuild ALL_BUILD.vcxproj /t:Build /p:Configuration=Debug"</span></span>
<span class="line"><span style="color: #e1e4e8">"clean", "make clean", "msbuild ALL_BUILD.vcxproj /t:Clean"</span></span>
<span class="line"><span style="color: #e1e4e8">"install", "make install", "msbuild INSTALL.vcxproj"</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">ちょっといろいろビルドしてみる。</span></span></code></pre>

				</div>
			</article>
		</main>
		<footer class="footer astro-SZ7XMLTE">
    <nav class="nav astro-SZ7XMLTE">
        <div class="astro-SZ7XMLTE">2021  &copy; Copyright notice |  <a href="https://github.com/one-aalam/astro-ink" title="三次元日誌(astro)'s Github URL'" class="astro-SZ7XMLTE">三次元日誌(astro)</a>
        <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><astro-island uid="1QEdto" component-url="/_astro/ModeLabel.e3ff75e7.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-SZ7XMLTE&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;ModeLabel&quot;,&quot;value&quot;:true}" await-children=""><span slot="dark" data-svelte-h="svelte-14ov3lc">(dark)</span></astro-island> theme on <a href="https://astro.build/" class="astro-SZ7XMLTE">Astro</a></div>
        <astro-island uid="1I86to" component-url="/_astro/NetlifyIdentity.94b8edb0.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-SZ7XMLTE&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;NetlifyIdentity&quot;,&quot;value&quot;:true}"></astro-island>
    </nav>
</footer>
	</body></html>