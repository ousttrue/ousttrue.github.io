<!DOCTYPE html>
<html lang="en" class="astro-BVZIHDZO">
	<head>
		<!-- Use Google Fonts, if you don't wanna prefer a self-hosted version --><!-- <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap" rel="stylesheet"> --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Gstreamerを始めてみた</title>
<meta name="title" content="Gstreamerを始めてみた">


<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="shortcut icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- Open Graph Tags (Facebook) -->
<meta property="og:type" content="website">
<meta property="og:title" content="Gstreamerを始めてみた">




<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:title" content="Gstreamerを始めてみた">





<script>
  const theme = (() => {
    if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
      return localStorage.getItem("theme");
    }
    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      return "dark";
    }
    return "light";
  })();

  if (theme === "light") {
    document.documentElement.classList.remove("dark");
  } else {
    document.documentElement.classList.add("dark");
  }
</script>
		
	<link rel="stylesheet" href="/_astro/about.6111bb3a.css" />
<link rel="stylesheet" href="/_astro/about.657f8f57.css" />
<link rel="stylesheet" href="/_astro/about.ee60a110.css" />
<link rel="stylesheet" href="/_astro/about.dcb84f3d.css" /><script type="module" src="/_astro/hoisted.e6960f2c.js"></script></head>

	<body class="astro-BVZIHDZO">
		<header class="header astro-3EF6KSR2">
    <div class="header__logo astro-3EF6KSR2">
        <a href="/" class="avatar astro-3EF6KSR2">
            <img class="header__logo-img astro-3EF6KSR2" src="/assets/logo.svg" alt="Astro logo">
        </a>
    </div>
    <div class="header__meta flex-1 astro-3EF6KSR2">
        <h3 class="header__title dark:text-theme-dark-secondary astro-3EF6KSR2">
            <a href="" class="astro-3EF6KSR2">三次元日誌(astro)</a>
        </h3>
        <div class="header__meta-more flex astro-3EF6KSR2">
            <p class="header__desc astro-3EF6KSR2">
                Crisp, minimal, personal blog theme for Astro
            </p>
            <nav class="header__nav flex astro-3EF6KSR2">
                <ul class="header__ref-list astro-3EF6KSR2">
                    <li class="astro-3EF6KSR2">
                        <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var r=(i,c,n)=>{let s=async()=>{await(await i())()},t=new IntersectionObserver(e=>{for(let o of e)if(o.isIntersecting){t.disconnect(),s();break}});for(let e of n.children)t.observe(e)};(self.Astro||(self.Astro={})).visible=r;window.dispatchEvent(new Event("astro:visible"));})();;(()=>{var d;{let p={0:t=>u(t),1:t=>l(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(l(t)),5:t=>new Set(l(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},h=t=>{let[e,n]=t;return e in p?p[e](n):void 0},l=t=>t.map(h),u=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([e,n])=>[e,h(n)]));customElements.get("astro-island")||customElements.define("astro-island",(d=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=async()=>{var i;if(!this.hydrator||!this.isConnected)return;let e=(i=this.parentElement)==null?void 0:i.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let n=this.querySelectorAll("astro-slot"),o={},a=this.querySelectorAll("template[data-astro-template]");for(let r of a){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(o[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of n){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(o[r.getAttribute("name")||"default"]=r.innerHTML)}let c;try{c=this.hasAttribute("props")?u(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",y=this.getAttribute("component-export");throw y&&(s+=` (export ${y})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}await this.hydrator(this)(this.Component,c,o,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))}}connectedCallback(){!this.hasAttribute("await-children")||this.firstChild?this.childrenConnectedCallback():new MutationObserver((e,n)=>{n.disconnect(),setTimeout(()=>this.childrenConnectedCallback(),0)}).observe(this,{childList:!0})}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}start(){let e=JSON.parse(this.getAttribute("opts")),n=this.getAttribute("client");if(Astro[n]===void 0){window.addEventListener(`astro:${n}`,()=>this.start(),{once:!0});return}Astro[n](async()=>{let o=this.getAttribute("renderer-url"),[a,{default:c}]=await Promise.all([import(this.getAttribute("component-url")),o?import(o):()=>()=>{}]),i=this.getAttribute("component-export")||"default";if(!i.includes("."))this.Component=a[i];else{this.Component=a;for(let r of i.split("."))this.Component=this.Component[r]}return this.hydrator=c,this.hydrate},e,this)}attributeChangedCallback(){this.hydrate()}},d.observedAttributes=["props"],d))}})();</script><astro-island uid="2iKzVC" component-url="/_astro/SearchBtn.984510f3.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-3EF6KSR2&quot;]}" ssr="" client="visible" opts="{&quot;name&quot;:&quot;SearchBtn&quot;,&quot;value&quot;:true}" await-children=""><button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <path fill-rule="evenodd" clip-rule="evenodd" d="M16.2071 4.89344C19.0923 7.77862 19.3131 12.3193 16.8693 15.4578C16.8846 15.4713 16.8996 15.4854 16.9143 15.5L21.1569 19.7427C21.5474 20.1332 21.5474 20.7664 21.1569 21.1569C20.7664 21.5474 20.1332 21.5474 19.7427 21.1569L15.5 16.9143C15.4854 16.8996 15.4713 16.8846 15.4578 16.8693C12.3193 19.3131 7.77862 19.0923 4.89344 16.2071C1.76924 13.083 1.76924 8.01763 4.89344 4.89344C8.01763 1.76924 13.083 1.76924 16.2071 4.89344ZM14.7929 14.7929C17.1361 12.4498 17.1361 8.6508 14.7929 6.30765C12.4498 3.96451 8.6508 3.96451 6.30765 6.30765C3.96451 8.6508 3.96451 12.4498 6.30765 14.7929C8.6508 17.1361 12.4498 17.1361 14.7929 14.7929Z" fill="currentColor"></path></svg></button></astro-island>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <a href="https://github.com/one-aalam/astro-ink" title="三次元日誌(astro)'s Github URL'" class="astro-3EF6KSR2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    
                                <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" class="astro-3EF6KSR2"></path>
                            
</svg>
                        </a>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <a href="/rss.xml" title="RSS" class="astro-3EF6KSR2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    
                                <path d="M4 11a9 9 0 0 1 9 9" class="astro-3EF6KSR2"></path>
                                <path d="M4 4a16 16 0 0 1 16 16" class="astro-3EF6KSR2"></path>
                                <circle cx="5" cy="19" r="1" class="astro-3EF6KSR2"></circle>
                            
</svg>
                        </a>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <astro-island uid="h8S6z" component-url="/_astro/ModeSwitcherBtn.0ddc5d6d.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-3EF6KSR2&quot;]}" ssr="" client="visible" opts="{&quot;name&quot;:&quot;ModeSwitcherBtn&quot;,&quot;value&quot;:true}" await-children=""><button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle> <line x1="12" y1="1" x2="12" y2="3"></line> <line x1="12" y1="21" x2="12" y2="23"></line> <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line> <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line> <line x1="1" y1="12" x2="3" y2="12"></line> <line x1="21" y1="12" x2="23" y2="12"></line> <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line> <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></button></astro-island>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</header>
		<main class="astro-BVZIHDZO">
			<article class="astro-BVZIHDZO">
				<div class="hero-image astro-BVZIHDZO">
					
				</div>
				<div class="prose astro-BVZIHDZO">
					<div class="title astro-BVZIHDZO">
						<div class="date astro-BVZIHDZO">
							<time datetime="2013-06-11T00:00:00.000Z">
	Jun 11, 2013
</time>
							
						</div>
						<h1 class="astro-BVZIHDZO">Gstreamerを始めてみた</h1>
						<hr class="astro-BVZIHDZO">
					</div>
					
	<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">動画プログラムでもしてみようということでGstreamerをはじめた。</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">#Hello world</span></span>
<span class="line"><span style="color: #e1e4e8">まず注意しないといけないのがgstreamerのバージョンに0.10系と1.0系があって、ほとんどの情報が0.10系のものらしいということだ。python2とpython3、ruby18とruby19のような違いがありそうなのでひとまず0.10系を使うことにする。</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">Basic</span></span>
<span class="line"><span style="color: #e1e4e8">tutorials http://docs.gstreamer.com/display/GstSDK/Basic+tutorials をやってみる</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">最初のコードをc++に改造しやすいようにちょっと変更。</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">::</span></span>
<span class="line"><span style="color: #e1e4e8">#include &#x3C;gst/gst.h></span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">int main(int argc, char *argv[])</span></span>
<span class="line"><span style="color: #e1e4e8">{</span></span>
<span class="line"><span style="color: #e1e4e8">    gst_init (&#x26;argc, &#x26;argv);</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    {</span></span>
<span class="line"><span style="color: #e1e4e8">        GstElement *pipeline = gst_parse_launch (</span></span>
<span class="line"><span style="color: #e1e4e8">                "playbin2 uri=http://docs.gstreamer.com/media/sintel_trailer-480p.webm",</span></span>
<span class="line"><span style="color: #e1e4e8">                NULL);</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">        gst_element_set_state (pipeline, GST_STATE_PLAYING);</span></span>
<span class="line"><span style="color: #e1e4e8">        {</span></span>
<span class="line"><span style="color: #e1e4e8">            GstBus *bus = gst_element_get_bus (pipeline);</span></span>
<span class="line"><span style="color: #e1e4e8">            {</span></span>
<span class="line"><span style="color: #e1e4e8">                GstMessage *msg = gst_bus_timed_pop_filtered (bus, GST_CLOCK_TIME_NONE,</span></span>
<span class="line"><span style="color: #e1e4e8">                        static_cast&#x3C;GstMessageType>(GST_MESSAGE_ERROR | GST_MESSAGE_EOS));</span></span>
<span class="line"><span style="color: #e1e4e8">                if (msg != NULL){</span></span>
<span class="line"><span style="color: #e1e4e8">                    gst_message_unref (msg);</span></span>
<span class="line"><span style="color: #e1e4e8">                }</span></span>
<span class="line"><span style="color: #e1e4e8">            }</span></span>
<span class="line"><span style="color: #e1e4e8">            gst_object_unref (bus);</span></span>
<span class="line"><span style="color: #e1e4e8">        }</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">        gst_element_set_state (pipeline, GST_STATE_NULL);</span></span>
<span class="line"><span style="color: #e1e4e8">        gst_object_unref (pipeline);</span></span>
<span class="line"><span style="color: #e1e4e8">    }</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    return 0;</span></span>
<span class="line"><span style="color: #e1e4e8">}</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">build $ gcc 'pkg-config gstreamer-0.10 --cflags --libs' main.c</span></span>
<span class="line"><span style="color: #e1e4e8">動いた。</span></span>
<span class="line"><span style="color: #e1e4e8">gstreamermmでやってみる</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">https://developer.gnome.org/gstreamermm/0.10/</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">::</span></span>
<span class="line"><span style="color: #e1e4e8">#include &#x3C;gstreamermm.h></span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">int main(int argc, char *argv[])</span></span>
<span class="line"><span style="color: #e1e4e8">{</span></span>
<span class="line"><span style="color: #e1e4e8">    Gst::init();</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    {</span></span>
<span class="line"><span style="color: #e1e4e8">        auto pipeline = Gst::Parse::launch (</span></span>
<span class="line"><span style="color: #e1e4e8">                "playbin2 uri=http://docs.gstreamer.com/media/sintel_trailer-480p.webm");</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">        pipeline->set_state(Gst::STATE_PLAYING);</span></span>
<span class="line"><span style="color: #e1e4e8">        {</span></span>
<span class="line"><span style="color: #e1e4e8">            auto bus = pipeline->get_bus();</span></span>
<span class="line"><span style="color: #e1e4e8">            auto msg = bus->pop(Gst::CLOCK_TIME_NONE,</span></span>
<span class="line"><span style="color: #e1e4e8">                    static_cast&#x3C;Gst::MessageType>(</span></span>
<span class="line"><span style="color: #e1e4e8">                        Gst::MESSAGE_ERROR</span></span>
<span class="line"><span style="color: #e1e4e8">                        | Gst::MESSAGE_EOS));</span></span>
<span class="line"><span style="color: #e1e4e8">        }</span></span>
<span class="line"><span style="color: #e1e4e8">        pipeline->set_state(Gst::STATE_NULL);</span></span>
<span class="line"><span style="color: #e1e4e8">    }</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    return 0;</span></span>
<span class="line"><span style="color: #e1e4e8">}</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">build</span></span>
<span class="line"><span style="color: #e1e4e8">$ g++ -std=c++0x 'pkg-config gstreamermm-0.10 --cflags --libs' main.cpp</span></span>
<span class="line"><span style="color: #e1e4e8">unrefが省略できるのと、method呼び出しの記述方法がかわるのでコードがシンプルになる。</span></span>
<span class="line"><span style="color: #e1e4e8">C版から翻訳するのに少し手間がかかるが、ほぼ機械的に変更するだけなのでこちらでいってみる。</span></span>
<span class="line"><span style="color: #e1e4e8">2</span></span>
<span class="line"><span style="color: #e1e4e8">::</span></span>
<span class="line"><span style="color: #e1e4e8">#include &#x3C;gstreamermm.h></span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">int main(int argc, char *argv[])</span></span>
<span class="line"><span style="color: #e1e4e8">{</span></span>
<span class="line"><span style="color: #e1e4e8">    Gst::init();</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    auto source = Gst::ElementFactory::create_element("videotestsrc", "source");</span></span>
<span class="line"><span style="color: #e1e4e8">    auto sink = Gst::ElementFactory::create_element("autovideosink", "sink");</span></span>
<span class="line"><span style="color: #e1e4e8">    auto pipeline = Gst::Pipeline::create("test-pipeline");</span></span>
<span class="line"><span style="color: #e1e4e8">    if (!pipeline || !source || !sink) {</span></span>
<span class="line"><span style="color: #e1e4e8">        g_printerr ("Not all elements could be created.\n");</span></span>
<span class="line"><span style="color: #e1e4e8">        return -1;</span></span>
<span class="line"><span style="color: #e1e4e8">    }</span></span>
<span class="line"><span style="color: #e1e4e8">    auto filter=Gst::ElementFactory::create_element("vertigotv", "vertigotv_filter");</span></span>
<span class="line"><span style="color: #e1e4e8">    if(!filter){</span></span>
<span class="line"><span style="color: #e1e4e8">        return -1;</span></span>
<span class="line"><span style="color: #e1e4e8">    }</span></span>
<span class="line"><span style="color: #e1e4e8">    auto filter2=Gst::ElementFactory::create_element("ffmpegcolorspace", "color_filter");</span></span>
<span class="line"><span style="color: #e1e4e8">    if(!filter2){</span></span>
<span class="line"><span style="color: #e1e4e8">        return -1;</span></span>
<span class="line"><span style="color: #e1e4e8">    }</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    /* Build the pipeline */</span></span>
<span class="line"><span style="color: #e1e4e8">    pipeline->add(source);</span></span>
<span class="line"><span style="color: #e1e4e8">    pipeline->add(sink);</span></span>
<span class="line"><span style="color: #e1e4e8">    pipeline->add(filter);</span></span>
<span class="line"><span style="color: #e1e4e8">    pipeline->add(filter2);</span></span>
<span class="line"><span style="color: #e1e4e8">    if(!source->link(filter)){</span></span>
<span class="line"><span style="color: #e1e4e8">        g_printerr ("Elements could not be linked.\n");</span></span>
<span class="line"><span style="color: #e1e4e8">        return -1;</span></span>
<span class="line"><span style="color: #e1e4e8">    }</span></span>
<span class="line"><span style="color: #e1e4e8">    if(!filter->link(filter2)){</span></span>
<span class="line"><span style="color: #e1e4e8">        g_printerr ("Elements could not be linked.\n");</span></span>
<span class="line"><span style="color: #e1e4e8">        return -1;</span></span>
<span class="line"><span style="color: #e1e4e8">    }</span></span>
<span class="line"><span style="color: #e1e4e8">    if(!filter2->link(sink)){</span></span>
<span class="line"><span style="color: #e1e4e8">        g_printerr ("Elements could not be linked.\n");</span></span>
<span class="line"><span style="color: #e1e4e8">        return -1;</span></span>
<span class="line"><span style="color: #e1e4e8">    }</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    /* Modify the source's properties */</span></span>
<span class="line"><span style="color: #e1e4e8">    source->set_property("pattern", 0);</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    /* Start playing */</span></span>
<span class="line"><span style="color: #e1e4e8">    if (!pipeline->set_state(Gst::STATE_PLAYING)) {</span></span>
<span class="line"><span style="color: #e1e4e8">        g_printerr ("Unable to set the pipeline to the playing state.\n");</span></span>
<span class="line"><span style="color: #e1e4e8">        return -1;</span></span>
<span class="line"><span style="color: #e1e4e8">    }</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    /* Wait until error or EOS */</span></span>
<span class="line"><span style="color: #e1e4e8">    auto bus = pipeline->get_bus ();</span></span>
<span class="line"><span style="color: #e1e4e8">    auto msg = bus->pop(Gst::CLOCK_TIME_NONE,</span></span>
<span class="line"><span style="color: #e1e4e8">            Gst::MESSAGE_ERROR | Gst::MESSAGE_EOS);</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    /* Parse message */</span></span>
<span class="line"><span style="color: #e1e4e8">    if (msg) {</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">        switch (msg->get_message_type()) {</span></span>
<span class="line"><span style="color: #e1e4e8">            case Gst::MESSAGE_ERROR:</span></span>
<span class="line"><span style="color: #e1e4e8">                {</span></span>
<span class="line"><span style="color: #e1e4e8">                    Glib::Error err;</span></span>
<span class="line"><span style="color: #e1e4e8">                    std::string debug_info;</span></span>
<span class="line"><span style="color: #e1e4e8">                    Gst::MessageError(msg->gobj_copy()).parse(err, debug_info);</span></span>
<span class="line"><span style="color: #e1e4e8">                    g_printerr ("Error received from element %s: %s\n",</span></span>
<span class="line"><span style="color: #e1e4e8">                            msg->get_source()->get_name().c_str(),</span></span>
<span class="line"><span style="color: #e1e4e8">                            err.what().c_str());</span></span>
<span class="line"><span style="color: #e1e4e8">                    g_printerr ("Debugging information: %s\n", debug_info.c_str());</span></span>
<span class="line"><span style="color: #e1e4e8">                }</span></span>
<span class="line"><span style="color: #e1e4e8">                break;</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">            case Gst::MESSAGE_EOS:</span></span>
<span class="line"><span style="color: #e1e4e8">                g_print ("End-Of-Stream reached.\n");</span></span>
<span class="line"><span style="color: #e1e4e8">                break;</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">            default:</span></span>
<span class="line"><span style="color: #e1e4e8">                /* We should not reach here because we only asked for ERRORs and EOS */</span></span>
<span class="line"><span style="color: #e1e4e8">                g_printerr ("Unexpected message received.\n");</span></span>
<span class="line"><span style="color: #e1e4e8">                break;</span></span>
<span class="line"><span style="color: #e1e4e8">        }</span></span>
<span class="line"><span style="color: #e1e4e8">    }</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    pipeline->set_state(Gst::STATE_NULL);</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    return 0;</span></span>
<span class="line"><span style="color: #e1e4e8">}</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">3</span></span>
<span class="line"><span style="color: #e1e4e8">::</span></span>
<span class="line"><span style="color: #e1e4e8">#include &#x3C;gstreamermm.h></span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">struct CustomData</span></span>
<span class="line"><span style="color: #e1e4e8">{</span></span>
<span class="line"><span style="color: #e1e4e8">    Glib::RefPtr&#x3C; Gst::Pipeline > pipeline;</span></span>
<span class="line"><span style="color: #e1e4e8">    Glib::RefPtr&#x3C; Gst::Element > source;</span></span>
<span class="line"><span style="color: #e1e4e8">    Glib::RefPtr&#x3C; Gst::Element > convert;</span></span>
<span class="line"><span style="color: #e1e4e8">    Glib::RefPtr&#x3C; Gst::Element > sink;</span></span>
<span class="line"><span style="color: #e1e4e8">};</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">// Handler for the pad-added signal</span></span>
<span class="line"><span style="color: #e1e4e8">static void pad_added_handler (</span></span>
<span class="line"><span style="color: #e1e4e8">        const Glib::RefPtr&#x3C;Gst::Pad> &#x26;new_pad,</span></span>
<span class="line"><span style="color: #e1e4e8">        CustomData *data)</span></span>
<span class="line"><span style="color: #e1e4e8">{</span></span>
<span class="line"><span style="color: #e1e4e8">    auto sink_pad = data->convert->get_static_pad("sink");</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    g_print ("Received new pad '%s'\n",</span></span>
<span class="line"><span style="color: #e1e4e8">            new_pad->get_name().c_str());</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    /* If our converter is already linked, we have nothing to do here */</span></span>
<span class="line"><span style="color: #e1e4e8">    if (sink_pad->is_linked ()) {</span></span>
<span class="line"><span style="color: #e1e4e8">        g_print ("  We are already linked. Ignoring.\n");</span></span>
<span class="line"><span style="color: #e1e4e8">        return;</span></span>
<span class="line"><span style="color: #e1e4e8">    }</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    /* Check the new pad's type */</span></span>
<span class="line"><span style="color: #e1e4e8">    auto new_pad_caps = new_pad->get_caps ();</span></span>
<span class="line"><span style="color: #e1e4e8">    auto new_pad_struct = new_pad_caps->get_structure (0);</span></span>
<span class="line"><span style="color: #e1e4e8">    std::string new_pad_type = new_pad_struct.get_name();</span></span>
<span class="line"><span style="color: #e1e4e8">    if (new_pad_type.find("audio/x-raw")==std::string::npos) {</span></span>
<span class="line"><span style="color: #e1e4e8">        g_print ("  It has type '%s' which is not raw audio. Ignoring.\n",</span></span>
<span class="line"><span style="color: #e1e4e8">                new_pad_type.c_str());</span></span>
<span class="line"><span style="color: #e1e4e8">        return;</span></span>
<span class="line"><span style="color: #e1e4e8">    }</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    /* Attempt the link */</span></span>
<span class="line"><span style="color: #e1e4e8">    if (!new_pad->link(sink_pad)) {</span></span>
<span class="line"><span style="color: #e1e4e8">        g_print ("  Type is '%s' but link failed.\n", new_pad_type.c_str());</span></span>
<span class="line"><span style="color: #e1e4e8">    }</span></span>
<span class="line"><span style="color: #e1e4e8">    else {</span></span>
<span class="line"><span style="color: #e1e4e8">        g_print ("  Link succeeded (type '%s').\n", new_pad_type.c_str());</span></span>
<span class="line"><span style="color: #e1e4e8">    }</span></span>
<span class="line"><span style="color: #e1e4e8">}</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">int main(int argc, char *argv[])</span></span>
<span class="line"><span style="color: #e1e4e8">{</span></span>
<span class="line"><span style="color: #e1e4e8">    Gst::init();</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    CustomData data;</span></span>
<span class="line"><span style="color: #e1e4e8">    data.source = Gst::ElementFactory::create_element ("uridecodebin", "source");</span></span>
<span class="line"><span style="color: #e1e4e8">    data.convert = Gst::ElementFactory::create_element ("audioconvert", "convert");</span></span>
<span class="line"><span style="color: #e1e4e8">    data.sink = Gst::ElementFactory::create_element ("autoaudiosink", "sink");</span></span>
<span class="line"><span style="color: #e1e4e8">    data.pipeline = Gst::Pipeline::create ("test-pipeline");</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    if (!data.pipeline || !data.source || !data.convert || !data.sink) {</span></span>
<span class="line"><span style="color: #e1e4e8">        g_printerr ("Not all elements could be created.\n");</span></span>
<span class="line"><span style="color: #e1e4e8">        return -1;</span></span>
<span class="line"><span style="color: #e1e4e8">    }</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    /* Build the pipeline. Note that we are NOT linking the source at this</span></span>
<span class="line"><span style="color: #e1e4e8">     *    * point. We will do it later. */</span></span>
<span class="line"><span style="color: #e1e4e8">    data.pipeline->add(data.source);</span></span>
<span class="line"><span style="color: #e1e4e8">    data.pipeline->add(data.convert);</span></span>
<span class="line"><span style="color: #e1e4e8">    data.pipeline->add(data.sink);</span></span>
<span class="line"><span style="color: #e1e4e8">    if (!data.convert->link(data.sink)) {</span></span>
<span class="line"><span style="color: #e1e4e8">        g_printerr ("Elements could not be linked.\n");</span></span>
<span class="line"><span style="color: #e1e4e8">        return -1;</span></span>
<span class="line"><span style="color: #e1e4e8">    }</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    /* Set the URI to play */</span></span>
<span class="line"><span style="color: #e1e4e8">    data.source->set_property(</span></span>
<span class="line"><span style="color: #e1e4e8">            "uri",</span></span>
<span class="line"><span style="color: #e1e4e8">            Glib::ustring("http://docs.gstreamer.com/media/sintel_trailer-480p.webm")</span></span>
<span class="line"><span style="color: #e1e4e8">            );</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    /* Connect to the pad-added signal */</span></span>
<span class="line"><span style="color: #e1e4e8">    data.source->signal_pad_added().connect([&#x26;data](</span></span>
<span class="line"><span style="color: #e1e4e8">                const Glib::RefPtr&#x3C;Gst::Pad> &#x26;pad)</span></span>
<span class="line"><span style="color: #e1e4e8">            {</span></span>
<span class="line"><span style="color: #e1e4e8">            pad_added_handler(pad, &#x26;data);</span></span>
<span class="line"><span style="color: #e1e4e8">            });</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    /* Start playing */</span></span>
<span class="line"><span style="color: #e1e4e8">    if (!data.pipeline->set_state(Gst::STATE_PLAYING)) {</span></span>
<span class="line"><span style="color: #e1e4e8">        g_printerr ("Unable to set the pipeline to the playing state.\n");</span></span>
<span class="line"><span style="color: #e1e4e8">        return -1;</span></span>
<span class="line"><span style="color: #e1e4e8">    }</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    /* Listen to the bus */</span></span>
<span class="line"><span style="color: #e1e4e8">    auto bus = data.pipeline->get_bus();</span></span>
<span class="line"><span style="color: #e1e4e8">    gboolean terminate = FALSE;</span></span>
<span class="line"><span style="color: #e1e4e8">    do {</span></span>
<span class="line"><span style="color: #e1e4e8">        auto msg = bus->pop(Gst::CLOCK_TIME_NONE,</span></span>
<span class="line"><span style="color: #e1e4e8">                Gst::MESSAGE_STATE_CHANGED | Gst::MESSAGE_ERROR | Gst::MESSAGE_EOS);</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">        /* Parse message */</span></span>
<span class="line"><span style="color: #e1e4e8">        if (msg) {</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">            switch (msg->get_message_type()) {</span></span>
<span class="line"><span style="color: #e1e4e8">                case Gst::MESSAGE_ERROR:</span></span>
<span class="line"><span style="color: #e1e4e8">                    {</span></span>
<span class="line"><span style="color: #e1e4e8">                        Glib::Error err;</span></span>
<span class="line"><span style="color: #e1e4e8">                        std::string debug_info;</span></span>
<span class="line"><span style="color: #e1e4e8">                        Gst::MessageError(msg->gobj_copy()).parse(err, debug_info);</span></span>
<span class="line"><span style="color: #e1e4e8">                        g_printerr ("Error received from element %s: %s\n",</span></span>
<span class="line"><span style="color: #e1e4e8">                                msg->get_source()->get_name().c_str(),</span></span>
<span class="line"><span style="color: #e1e4e8">                                err.what().c_str());</span></span>
<span class="line"><span style="color: #e1e4e8">                        g_printerr ("Debugging information: %s\n", debug_info.c_str());</span></span>
<span class="line"><span style="color: #e1e4e8">                        terminate = TRUE;</span></span>
<span class="line"><span style="color: #e1e4e8">                    }</span></span>
<span class="line"><span style="color: #e1e4e8">                    break;</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">                case Gst::MESSAGE_EOS:</span></span>
<span class="line"><span style="color: #e1e4e8">                    g_print ("End-Of-Stream reached.\n");</span></span>
<span class="line"><span style="color: #e1e4e8">                    terminate = TRUE;</span></span>
<span class="line"><span style="color: #e1e4e8">                    break;</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">                case Gst::MESSAGE_STATE_CHANGED:</span></span>
<span class="line"><span style="color: #e1e4e8">                    /* We are only interested in state-changed messages from the pipeline */</span></span>
<span class="line"><span style="color: #e1e4e8">                    if (msg->get_source() == data.pipeline) {</span></span>
<span class="line"><span style="color: #e1e4e8">                        Gst::State old_state;</span></span>
<span class="line"><span style="color: #e1e4e8">                        Gst::State new_state;</span></span>
<span class="line"><span style="color: #e1e4e8">                        Gst::State pending_state;</span></span>
<span class="line"><span style="color: #e1e4e8">                        Gst::MessageStateChanged(msg->gobj_copy()).parse(</span></span>
<span class="line"><span style="color: #e1e4e8">                                old_state, new_state, pending_state);</span></span>
<span class="line"><span style="color: #e1e4e8">                        g_print ("Pipeline state changed from %s to %s:\n",</span></span>
<span class="line"><span style="color: #e1e4e8">                                typeid(old_state).name(),</span></span>
<span class="line"><span style="color: #e1e4e8">                                typeid(new_state).name());</span></span>
<span class="line"><span style="color: #e1e4e8">                    }</span></span>
<span class="line"><span style="color: #e1e4e8">                    break;</span></span>
<span class="line"><span style="color: #e1e4e8">                default:</span></span>
<span class="line"><span style="color: #e1e4e8">                    /* We should not reach here */</span></span>
<span class="line"><span style="color: #e1e4e8">                    g_printerr ("Unexpected message received.\n");</span></span>
<span class="line"><span style="color: #e1e4e8">                    break;</span></span>
<span class="line"><span style="color: #e1e4e8">            }</span></span>
<span class="line"><span style="color: #e1e4e8">        }</span></span>
<span class="line"><span style="color: #e1e4e8">    } while (!terminate);</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">    /* Free resources */</span></span>
<span class="line"><span style="color: #e1e4e8">    data.pipeline->set_state(Gst::STATE_NULL);</span></span>
<span class="line"><span style="color: #e1e4e8">    return 0;</span></span>
<span class="line"><span style="color: #e1e4e8">}</span></span>
<span class="line"><span style="color: #e1e4e8"></span></span>
<span class="line"><span style="color: #e1e4e8">.. categories:: programming</span></span>
<span class="line"><span style="color: #e1e4e8">.. taxonomies: {tags: : cpp, gstreamer}</span></span></code></pre>

				</div>
			</article>
		</main>
		<footer class="footer astro-SZ7XMLTE">
    <nav class="nav astro-SZ7XMLTE">
        <div class="astro-SZ7XMLTE">2021  &copy; Copyright notice |  <a href="https://github.com/one-aalam/astro-ink" title="三次元日誌(astro)'s Github URL'" class="astro-SZ7XMLTE">三次元日誌(astro)</a>
        <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><astro-island uid="1QEdto" component-url="/_astro/ModeLabel.e3ff75e7.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-SZ7XMLTE&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;ModeLabel&quot;,&quot;value&quot;:true}" await-children=""><span slot="dark" data-svelte-h="svelte-14ov3lc">(dark)</span></astro-island> theme on <a href="https://astro.build/" class="astro-SZ7XMLTE">Astro</a></div>
        <astro-island uid="1I86to" component-url="/_astro/NetlifyIdentity.94b8edb0.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-SZ7XMLTE&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;NetlifyIdentity&quot;,&quot;value&quot;:true}"></astro-island>
    </nav>
</footer>
	</body></html>