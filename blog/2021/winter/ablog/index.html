<!DOCTYPE html>
<html lang="en" class="astro-BVZIHDZO">
	<head>
		<!-- Use Google Fonts, if you don't wanna prefer a self-hosted version --><!-- <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap" rel="stylesheet"> --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>SSGをABlogに変更</title>
<meta name="title" content="SSGをABlogに変更">


<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="shortcut icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- Open Graph Tags (Facebook) -->
<meta property="og:type" content="website">
<meta property="og:title" content="SSGをABlogに変更">




<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:title" content="SSGをABlogに変更">





<script>
  const theme = (() => {
    if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
      return localStorage.getItem("theme");
    }
    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      return "dark";
    }
    return "light";
  })();

  if (theme === "light") {
    document.documentElement.classList.remove("dark");
  } else {
    document.documentElement.classList.add("dark");
  }
</script>
		
	<link rel="stylesheet" href="/_astro/about.6111bb3a.css" />
<link rel="stylesheet" href="/_astro/about.657f8f57.css" />
<link rel="stylesheet" href="/_astro/about.ee60a110.css" />
<link rel="stylesheet" href="/_astro/about.dcb84f3d.css" /><script type="module" src="/_astro/hoisted.e6960f2c.js"></script></head>

	<body class="astro-BVZIHDZO">
		<header class="header astro-3EF6KSR2">
    <div class="header__logo astro-3EF6KSR2">
        <a href="/" class="avatar astro-3EF6KSR2">
            <img class="header__logo-img astro-3EF6KSR2" src="/assets/logo.svg" alt="Astro logo">
        </a>
    </div>
    <div class="header__meta flex-1 astro-3EF6KSR2">
        <h3 class="header__title dark:text-theme-dark-secondary astro-3EF6KSR2">
            <a href="" class="astro-3EF6KSR2">三次元日誌(astro)</a>
        </h3>
        <div class="header__meta-more flex astro-3EF6KSR2">
            <p class="header__desc astro-3EF6KSR2">
                Crisp, minimal, personal blog theme for Astro
            </p>
            <nav class="header__nav flex astro-3EF6KSR2">
                <ul class="header__ref-list astro-3EF6KSR2">
                    <li class="astro-3EF6KSR2">
                        <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var r=(i,c,n)=>{let s=async()=>{await(await i())()},t=new IntersectionObserver(e=>{for(let o of e)if(o.isIntersecting){t.disconnect(),s();break}});for(let e of n.children)t.observe(e)};(self.Astro||(self.Astro={})).visible=r;window.dispatchEvent(new Event("astro:visible"));})();;(()=>{var d;{let p={0:t=>u(t),1:t=>l(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(l(t)),5:t=>new Set(l(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},h=t=>{let[e,n]=t;return e in p?p[e](n):void 0},l=t=>t.map(h),u=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([e,n])=>[e,h(n)]));customElements.get("astro-island")||customElements.define("astro-island",(d=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=async()=>{var i;if(!this.hydrator||!this.isConnected)return;let e=(i=this.parentElement)==null?void 0:i.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let n=this.querySelectorAll("astro-slot"),o={},a=this.querySelectorAll("template[data-astro-template]");for(let r of a){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(o[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of n){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(o[r.getAttribute("name")||"default"]=r.innerHTML)}let c;try{c=this.hasAttribute("props")?u(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",y=this.getAttribute("component-export");throw y&&(s+=` (export ${y})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}await this.hydrator(this)(this.Component,c,o,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))}}connectedCallback(){!this.hasAttribute("await-children")||this.firstChild?this.childrenConnectedCallback():new MutationObserver((e,n)=>{n.disconnect(),setTimeout(()=>this.childrenConnectedCallback(),0)}).observe(this,{childList:!0})}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}start(){let e=JSON.parse(this.getAttribute("opts")),n=this.getAttribute("client");if(Astro[n]===void 0){window.addEventListener(`astro:${n}`,()=>this.start(),{once:!0});return}Astro[n](async()=>{let o=this.getAttribute("renderer-url"),[a,{default:c}]=await Promise.all([import(this.getAttribute("component-url")),o?import(o):()=>()=>{}]),i=this.getAttribute("component-export")||"default";if(!i.includes("."))this.Component=a[i];else{this.Component=a;for(let r of i.split("."))this.Component=this.Component[r]}return this.hydrator=c,this.hydrate},e,this)}attributeChangedCallback(){this.hydrate()}},d.observedAttributes=["props"],d))}})();</script><astro-island uid="2iKzVC" component-url="/_astro/SearchBtn.984510f3.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-3EF6KSR2&quot;]}" ssr="" client="visible" opts="{&quot;name&quot;:&quot;SearchBtn&quot;,&quot;value&quot;:true}" await-children=""><button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <path fill-rule="evenodd" clip-rule="evenodd" d="M16.2071 4.89344C19.0923 7.77862 19.3131 12.3193 16.8693 15.4578C16.8846 15.4713 16.8996 15.4854 16.9143 15.5L21.1569 19.7427C21.5474 20.1332 21.5474 20.7664 21.1569 21.1569C20.7664 21.5474 20.1332 21.5474 19.7427 21.1569L15.5 16.9143C15.4854 16.8996 15.4713 16.8846 15.4578 16.8693C12.3193 19.3131 7.77862 19.0923 4.89344 16.2071C1.76924 13.083 1.76924 8.01763 4.89344 4.89344C8.01763 1.76924 13.083 1.76924 16.2071 4.89344ZM14.7929 14.7929C17.1361 12.4498 17.1361 8.6508 14.7929 6.30765C12.4498 3.96451 8.6508 3.96451 6.30765 6.30765C3.96451 8.6508 3.96451 12.4498 6.30765 14.7929C8.6508 17.1361 12.4498 17.1361 14.7929 14.7929Z" fill="currentColor"></path></svg></button></astro-island>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <a href="https://github.com/one-aalam/astro-ink" title="三次元日誌(astro)'s Github URL'" class="astro-3EF6KSR2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    
                                <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" class="astro-3EF6KSR2"></path>
                            
</svg>
                        </a>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <a href="/rss.xml" title="RSS" class="astro-3EF6KSR2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    
                                <path d="M4 11a9 9 0 0 1 9 9" class="astro-3EF6KSR2"></path>
                                <path d="M4 4a16 16 0 0 1 16 16" class="astro-3EF6KSR2"></path>
                                <circle cx="5" cy="19" r="1" class="astro-3EF6KSR2"></circle>
                            
</svg>
                        </a>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <astro-island uid="h8S6z" component-url="/_astro/ModeSwitcherBtn.0ddc5d6d.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-3EF6KSR2&quot;]}" ssr="" client="visible" opts="{&quot;name&quot;:&quot;ModeSwitcherBtn&quot;,&quot;value&quot;:true}" await-children=""><button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle> <line x1="12" y1="1" x2="12" y2="3"></line> <line x1="12" y1="21" x2="12" y2="23"></line> <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line> <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line> <line x1="1" y1="12" x2="3" y2="12"></line> <line x1="21" y1="12" x2="23" y2="12"></line> <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line> <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></button></astro-island>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</header>
		<main class="astro-BVZIHDZO">
			<article class="astro-BVZIHDZO">
				<div class="hero-image astro-BVZIHDZO">
					
				</div>
				<div class="prose astro-BVZIHDZO">
					<div class="title astro-BVZIHDZO">
						<div class="date astro-BVZIHDZO">
							<time datetime="2021-12-20T00:00:00.000Z">
	Dec 20, 2021
</time>
							
						</div>
						<h1 class="astro-BVZIHDZO">SSGをABlogに変更</h1>
						<hr class="astro-BVZIHDZO">
					</div>
					
	<h1 id="ablog-にシステムを変更">ABlog にシステムを変更</h1>
<p><a href="https://getnikola.com/">nikola</a> は使いこなせなくて短命に終わってしまった。
<a href="https://pydoit.org/">doit</a> は面白いと思うのだが。</p>
<p>ということで、 <code>sphinx</code> プラグインの <a href="https://ablog.readthedocs.io/en/latest/">ABlog</a> です。</p>
<h2 id="はまり1-sphinx-のキャッシュ">はまり1: Sphinx のキャッシュ</h2>
<p><code>python -m sphinx content build</code> にデバッガをアタッチして試行錯誤するのだけど、
キャッシュされて処理されなかった。</p>
<p><code>python -m sphinx content build -E -v</code> とする。</p>
<ul>
<li>-E: 全処理(キャッシュを使わない)</li>
<li>-v: 詳細メッセージ</li>
</ul>
<h2 id="はまり2-ablog-が-timezone-の有無で日付の比較に失敗する">はまり2: ablog が timezone の有無で日付の比較に失敗する</h2>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">can't compare offset-naive and offset-aware datetimes</span></span></code></pre>
<p>これは、既存記事の <code>frontmatter</code> の日付に <code>timezone</code> が付いていると
日付の比較に失敗する。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #6A737D"># site-packages/ablog/blog.py:382</span></span>
<span class="line"><span style="color: #79B8FF">self</span><span style="color: #E1E4E8">.date </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> date </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> info[</span><span style="color: #9ECBFF">"date"</span><span style="color: #E1E4E8">].replace(</span><span style="color: #FFAB70">tzinfo</span><span style="color: #F97583">=</span><span style="color: #79B8FF">None</span><span style="color: #E1E4E8">)</span></span></code></pre>
<p>と対処した。</p>
<h2 id="はまり3-myst-parser-の-toml-frontmatter-対応">はまり3: myst-parser の toml frontmatter 対応</h2>
<p><code>myst-parser</code> が <code>---</code> による <code>yaml</code> 形式の <code>frontmatter</code> にしか対応していない様子。
<a href="https://gohugo.io/content-management/front-matter/">hugo の frontmatter</a> にある <code>toml</code> 様式に対応するべく改造したい。</p>
<h3 id="切り出し">切り出し</h3>
<p>どこで処理しているのか探索が難航した。</p>
<p><code>site-packages/mdit_py_plugins/front_matter/index.py</code>
で処理している。</p>
<h3 id="parse">Parse</h3>
<p><code>site-packages/myst_parser/docutils_renderer.py</code></p>
<p><code>render_front_matter</code> で切り出した文字列を <code>yaml</code> でパースしている。
<code>except</code> 節で <code>toml</code> にリトライさせたら動いた。</p>
<h2 id="モンキーパッチ">モンキーパッチ</h2>
<p>とりあえず <code>conf.py</code> にて直接修正する。</p>
<p><a href="https://github.com/ousttrue/ousttrue.github.io/blob/ablog/content/patch.py">https://github.com/ousttrue/ousttrue.github.io/blob/ablog/content/patch.py</a></p>
<p>後で PR 送ったりできるかな。</p>
<h2 id="ablog-は何をしているのか">ABlog は何をしているのか</h2>
<h3 id="toctree無しのpost記事">toctree無しのpost記事</h3>
<p>特定の条件で、記事をブログ記事と見做して <code>toctree</code> 無しで辿れるようにする。
記事は、日付やタグでグループ化してくれる。</p>
<p><a href="https://ablog.readthedocs.io/en/latest/manual/posting-and-listing/#posting-with-page-front-matter">https://ablog.readthedocs.io/en/latest/manual/posting-and-listing/#posting-with-page-front-matter</a></p>
<p>パス指定。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #E1E4E8">blog_post_pattern </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"posts/**/*.md"</span></span></code></pre>
<p>条件。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #6A737D"># .venv/lib/python3.9/site-packages/ablog/post.py</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">if</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"blogpost"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">not</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">in</span><span style="color: #E1E4E8"> metadata </span><span style="color: #F97583">and</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">self</span><span style="color: #E1E4E8">.env.docname </span><span style="color: #F97583">not</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">in</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">self</span><span style="color: #E1E4E8">.config.matched_blog_posts:</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">None</span></span></code></pre>
<p><code>frontmatter</code> 等から最低限、日付の情報がとれないとトップページから辿る方法が無い状態になる。</p>
<p>あと <code>sphinx</code> なのでトップレベルの表題が本文側に必要かも。
<code>frontmatter</code> の <code>title</code> を反映できると便利そう。</p>
<h3 id="event-doctree-read">event: ‘doctree-read’</h3>
<p>doctree から <code>PostNode</code> を集める。</p>
<p><code>alog/post#process_posts(app, doctree)</code></p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">def</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">process_posts</span><span style="color: #E1E4E8">(app, doctree):</span></span>
<span class="line"><span style="color: #E1E4E8">    post_nodes </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">list</span><span style="color: #E1E4E8">(doctree.traverse(PostNode))</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">if</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">not</span><span style="color: #E1E4E8"> post_nodes:</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #6A737D"># PostNode が必要</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">return</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #6A737D"># 省略</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    postinfo </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">"docname"</span><span style="color: #E1E4E8">: docname,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">"section"</span><span style="color: #E1E4E8">: section_name,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">"order"</span><span style="color: #E1E4E8">: order,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">"date"</span><span style="color: #E1E4E8">: date,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">"update"</span><span style="color: #E1E4E8">: </span><span style="color: #79B8FF">max</span><span style="color: #E1E4E8">(update_dates </span><span style="color: #F97583">+</span><span style="color: #E1E4E8"> [date]),</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">"title"</span><span style="color: #E1E4E8">: title,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">"excerpt"</span><span style="color: #E1E4E8">: excerpt,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">"tags"</span><span style="color: #E1E4E8">: node[</span><span style="color: #9ECBFF">"tags"</span><span style="color: #E1E4E8">],</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">"author"</span><span style="color: #E1E4E8">: node[</span><span style="color: #9ECBFF">"author"</span><span style="color: #E1E4E8">],</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">"category"</span><span style="color: #E1E4E8">: node[</span><span style="color: #9ECBFF">"category"</span><span style="color: #E1E4E8">],</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">"location"</span><span style="color: #E1E4E8">: node[</span><span style="color: #9ECBFF">"location"</span><span style="color: #E1E4E8">],</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">"language"</span><span style="color: #E1E4E8">: node[</span><span style="color: #9ECBFF">"language"</span><span style="color: #E1E4E8">],</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">"redirect"</span><span style="color: #E1E4E8">: node[</span><span style="color: #9ECBFF">"redirect"</span><span style="color: #E1E4E8">],</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">"nocomments"</span><span style="color: #E1E4E8">: node[</span><span style="color: #9ECBFF">"nocomments"</span><span style="color: #E1E4E8">],</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">"image"</span><span style="color: #E1E4E8">: node[</span><span style="color: #9ECBFF">"image"</span><span style="color: #E1E4E8">],</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">"exclude"</span><span style="color: #E1E4E8">: node[</span><span style="color: #9ECBFF">"exclude"</span><span style="color: #E1E4E8">],</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">"doctree"</span><span style="color: #E1E4E8">: section_copy,</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">if</span><span style="color: #E1E4E8"> docname </span><span style="color: #F97583">not</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">in</span><span style="color: #E1E4E8"> env.ablog_posts:</span></span>
<span class="line"><span style="color: #E1E4E8">        env.ablog_posts[docname] </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> []</span></span>
<span class="line"><span style="color: #E1E4E8">    env.ablog_posts[docname].append(postinfo)</span></span></code></pre>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">class</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">CheckFrontMatter</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">SphinxTransform</span><span style="color: #E1E4E8">):</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">def</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">apply</span><span style="color: #E1E4E8">():</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">pass</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">def</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">setup</span><span style="color: #E1E4E8">(app):</span></span>
<span class="line"><span style="color: #E1E4E8">    app.add_transform(CheckFrontMatter)    </span></span></code></pre>
<h3 id="追加のページ生成">追加のページ生成</h3>
<p><code>ablog/templates</code> に格納されている。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #6A737D"># -- ABlog Sidebars -------------------------------------------------------</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># There are seven sidebars you can include in your HTML output.</span></span>
<span class="line"><span style="color: #6A737D"># postcard.html provides information regarding the current post.</span></span>
<span class="line"><span style="color: #6A737D"># recentposts.html lists most recent five posts. Others provide</span></span>
<span class="line"><span style="color: #6A737D"># a link to a archive pages generated for each tag, category, and year.</span></span>
<span class="line"><span style="color: #6A737D"># In addition, there are authors.html, languages.html, and locations.html</span></span>
<span class="line"><span style="color: #6A737D"># sidebars that link to author and location archive pages.</span></span>
<span class="line"><span style="color: #E1E4E8">html_sidebars </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #9ECBFF">'**'</span><span style="color: #E1E4E8">: [</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">'about.html'</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">'postcard.html'</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">'navigation.html'</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">'recentposts.html'</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">'tagcloud.html'</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">'categories.html'</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">'archives.html'</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">'searchbox.html'</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    ],</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre>
<p>これらに対して追加のページ生成を行っている。
<code>genindex.html</code> などのように。</p>
<h2 id="todo">ToDo</h2>
<h3 id="-タグが変">✅ タグが変</h3>
<p>toml 由来の tag の処理に失敗している。</p>
<p><code>["python", "ssg", "sphinx"]</code></p>
<p>が、</p>
<ul>
<li><code>["python"</code></li>
<li><code>"ssg"</code></li>
<li><code>"sphinx"]</code></li>
</ul>
<p>になっちゃってる。</p>
<p><a href="https://github.com/sunpy/ablog/pull/119">https://github.com/sunpy/ablog/pull/119</a></p>
<p>送ってみた。</p>
<p><code>v0.10.22</code> で修正。👍</p>
<h3 id="-日付のフォーマット">✅ 日付のフォーマット</h3>
<p><code>conf.py</code></p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #E1E4E8">post_date_format </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">r</span><span style="color: #9ECBFF">'</span><span style="color: #DBEDFF">%Y/%m/%d</span><span style="color: #9ECBFF">'</span></span>
<span class="line"><span style="color: #E1E4E8">post_date_format_short </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">r</span><span style="color: #9ECBFF">'</span><span style="color: #DBEDFF">%Y/%m</span><span style="color: #9ECBFF">'</span></span></code></pre>
<h3 id="-記事のurl">✅ 記事のURL</h3>
<ul>
<li><a href="https://zenn.dev/attakei/articles/sphinx-make-dirhtml">https://zenn.dev/attakei/articles/sphinx-make-dirhtml</a></li>
</ul>
<h3 id="-記事タイトルは最初の見出しではなくfrontmatter-の-title-にしたい">✅ 記事タイトルは最初の見出しではなく、frontmatter の title にしたい</h3>
<p><code>MystParser</code> を改造した。
わりと Sphinx わかってきた。
<code>python</code> でデバッガがアタッチできるとなんでもできる(慣れ)。</p>
<h3 id="--tagの表記振れ">[ ] tagの表記振れ</h3>
<p><code>c++</code> と <code>C++</code>、<code>c#</code> と <code>csharp</code> などをたばねる。</p>
<h2 id="参考">参考</h2>
<ul>
<li><a href="https://water2litter.net/pisco/doc/ablog.html">Sphinxでブログをしてみよう</a></li>
</ul>

				</div>
			</article>
		</main>
		<footer class="footer astro-SZ7XMLTE">
    <nav class="nav astro-SZ7XMLTE">
        <div class="astro-SZ7XMLTE">2021  &copy; Copyright notice |  <a href="https://github.com/one-aalam/astro-ink" title="三次元日誌(astro)'s Github URL'" class="astro-SZ7XMLTE">三次元日誌(astro)</a>
        <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><astro-island uid="1QEdto" component-url="/_astro/ModeLabel.e3ff75e7.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-SZ7XMLTE&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;ModeLabel&quot;,&quot;value&quot;:true}" await-children=""><span slot="dark" data-svelte-h="svelte-14ov3lc">(dark)</span></astro-island> theme on <a href="https://astro.build/" class="astro-SZ7XMLTE">Astro</a></div>
        <astro-island uid="1I86to" component-url="/_astro/NetlifyIdentity.94b8edb0.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-SZ7XMLTE&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;NetlifyIdentity&quot;,&quot;value&quot;:true}"></astro-island>
    </nav>
</footer>
	</body></html>