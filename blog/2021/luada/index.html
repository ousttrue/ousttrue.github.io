<!DOCTYPE html>
<html lang="en" class="astro-BVZIHDZO">
	<head>
		<!-- Use Google Fonts, if you don't wanna prefer a self-hosted version --><!-- <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap" rel="stylesheet"> --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>LuaDA</title>
<meta name="title" content="LuaDA">


<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="shortcut icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- Open Graph Tags (Facebook) -->
<meta property="og:type" content="website">
<meta property="og:title" content="LuaDA">




<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:title" content="LuaDA">





<script>
  const theme = (() => {
    if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
      return localStorage.getItem("theme");
    }
    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      return "dark";
    }
    return "light";
  })();

  if (theme === "light") {
    document.documentElement.classList.remove("dark");
  } else {
    document.documentElement.classList.add("dark");
  }
</script>
		
	<link rel="stylesheet" href="/_astro/about.6111bb3a.css" />
<link rel="stylesheet" href="/_astro/about.657f8f57.css" />
<link rel="stylesheet" href="/_astro/about.ee60a110.css" />
<link rel="stylesheet" href="/_astro/about.dcb84f3d.css" /><script type="module" src="/_astro/hoisted.e6960f2c.js"></script></head>

	<body class="astro-BVZIHDZO">
		<header class="header astro-3EF6KSR2">
    <div class="header__logo astro-3EF6KSR2">
        <a href="/" class="avatar astro-3EF6KSR2">
            <img class="header__logo-img astro-3EF6KSR2" src="/assets/logo.svg" alt="Astro logo">
        </a>
    </div>
    <div class="header__meta flex-1 astro-3EF6KSR2">
        <h3 class="header__title dark:text-theme-dark-secondary astro-3EF6KSR2">
            <a href="" class="astro-3EF6KSR2">三次元日誌(astro)</a>
        </h3>
        <div class="header__meta-more flex astro-3EF6KSR2">
            <p class="header__desc astro-3EF6KSR2">
                Crisp, minimal, personal blog theme for Astro
            </p>
            <nav class="header__nav flex astro-3EF6KSR2">
                <ul class="header__ref-list astro-3EF6KSR2">
                    <li class="astro-3EF6KSR2">
                        <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var r=(i,c,n)=>{let s=async()=>{await(await i())()},t=new IntersectionObserver(e=>{for(let o of e)if(o.isIntersecting){t.disconnect(),s();break}});for(let e of n.children)t.observe(e)};(self.Astro||(self.Astro={})).visible=r;window.dispatchEvent(new Event("astro:visible"));})();;(()=>{var d;{let p={0:t=>u(t),1:t=>l(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(l(t)),5:t=>new Set(l(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},h=t=>{let[e,n]=t;return e in p?p[e](n):void 0},l=t=>t.map(h),u=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([e,n])=>[e,h(n)]));customElements.get("astro-island")||customElements.define("astro-island",(d=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=async()=>{var i;if(!this.hydrator||!this.isConnected)return;let e=(i=this.parentElement)==null?void 0:i.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let n=this.querySelectorAll("astro-slot"),o={},a=this.querySelectorAll("template[data-astro-template]");for(let r of a){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(o[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of n){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(o[r.getAttribute("name")||"default"]=r.innerHTML)}let c;try{c=this.hasAttribute("props")?u(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",y=this.getAttribute("component-export");throw y&&(s+=` (export ${y})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}await this.hydrator(this)(this.Component,c,o,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))}}connectedCallback(){!this.hasAttribute("await-children")||this.firstChild?this.childrenConnectedCallback():new MutationObserver((e,n)=>{n.disconnect(),setTimeout(()=>this.childrenConnectedCallback(),0)}).observe(this,{childList:!0})}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}start(){let e=JSON.parse(this.getAttribute("opts")),n=this.getAttribute("client");if(Astro[n]===void 0){window.addEventListener(`astro:${n}`,()=>this.start(),{once:!0});return}Astro[n](async()=>{let o=this.getAttribute("renderer-url"),[a,{default:c}]=await Promise.all([import(this.getAttribute("component-url")),o?import(o):()=>()=>{}]),i=this.getAttribute("component-export")||"default";if(!i.includes("."))this.Component=a[i];else{this.Component=a;for(let r of i.split("."))this.Component=this.Component[r]}return this.hydrator=c,this.hydrate},e,this)}attributeChangedCallback(){this.hydrate()}},d.observedAttributes=["props"],d))}})();</script><astro-island uid="2iKzVC" component-url="/_astro/SearchBtn.984510f3.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-3EF6KSR2&quot;]}" ssr="" client="visible" opts="{&quot;name&quot;:&quot;SearchBtn&quot;,&quot;value&quot;:true}" await-children=""><button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <path fill-rule="evenodd" clip-rule="evenodd" d="M16.2071 4.89344C19.0923 7.77862 19.3131 12.3193 16.8693 15.4578C16.8846 15.4713 16.8996 15.4854 16.9143 15.5L21.1569 19.7427C21.5474 20.1332 21.5474 20.7664 21.1569 21.1569C20.7664 21.5474 20.1332 21.5474 19.7427 21.1569L15.5 16.9143C15.4854 16.8996 15.4713 16.8846 15.4578 16.8693C12.3193 19.3131 7.77862 19.0923 4.89344 16.2071C1.76924 13.083 1.76924 8.01763 4.89344 4.89344C8.01763 1.76924 13.083 1.76924 16.2071 4.89344ZM14.7929 14.7929C17.1361 12.4498 17.1361 8.6508 14.7929 6.30765C12.4498 3.96451 8.6508 3.96451 6.30765 6.30765C3.96451 8.6508 3.96451 12.4498 6.30765 14.7929C8.6508 17.1361 12.4498 17.1361 14.7929 14.7929Z" fill="currentColor"></path></svg></button></astro-island>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <a href="https://github.com/one-aalam/astro-ink" title="三次元日誌(astro)'s Github URL'" class="astro-3EF6KSR2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    
                                <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" class="astro-3EF6KSR2"></path>
                            
</svg>
                        </a>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <a href="/rss.xml" title="RSS" class="astro-3EF6KSR2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    
                                <path d="M4 11a9 9 0 0 1 9 9" class="astro-3EF6KSR2"></path>
                                <path d="M4 4a16 16 0 0 1 16 16" class="astro-3EF6KSR2"></path>
                                <circle cx="5" cy="19" r="1" class="astro-3EF6KSR2"></circle>
                            
</svg>
                        </a>
                    </li>
                    <li class="astro-3EF6KSR2">
                        <astro-island uid="h8S6z" component-url="/_astro/ModeSwitcherBtn.0ddc5d6d.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-3EF6KSR2&quot;]}" ssr="" client="visible" opts="{&quot;name&quot;:&quot;ModeSwitcherBtn&quot;,&quot;value&quot;:true}" await-children=""><button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle> <line x1="12" y1="1" x2="12" y2="3"></line> <line x1="12" y1="21" x2="12" y2="23"></line> <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line> <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line> <line x1="1" y1="12" x2="3" y2="12"></line> <line x1="21" y1="12" x2="23" y2="12"></line> <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line> <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></button></astro-island>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</header>
		<main class="astro-BVZIHDZO">
			<article class="astro-BVZIHDZO">
				<div class="hero-image astro-BVZIHDZO">
					
				</div>
				<div class="prose astro-BVZIHDZO">
					<div class="title astro-BVZIHDZO">
						<div class="date astro-BVZIHDZO">
							<time datetime="2021-07-31T00:00:00.000Z">
	Jul 31, 2021
</time>
							
						</div>
						<h1 class="astro-BVZIHDZO">LuaDA</h1>
						<hr class="astro-BVZIHDZO">
					</div>
					
	<p>vscode の lua デバッガーに</p>
<p><a href="https://marketplace.visualstudio.com/items?itemName=tomblind.local-lua-debugger-vscode">https://marketplace.visualstudio.com/items?itemName=tomblind.local-lua-debugger-vscode</a> を使っていたのだが、</p>
<p><code>launch.json</code> の <code>args</code> に <code>\\</code> が入るとエラーで起動できない。
Windows で作業しているので、稀によくファイルパスの指定に <code>\\</code> が入る。</p>
<h1 id="debugadapter-を作っていたら直し方がわかった">DebugAdapter を作っていたら、直し方がわかった</h1>
<p><a href="https://github.com/ousttrue/local-lua-debugger-vscode/commit/0f3974b73964b2e34f90a21de9757a57d6746eb4">https://github.com/ousttrue/local-lua-debugger-vscode/commit/0f3974b73964b2e34f90a21de9757a57d6746eb4</a></p>
<h2 id="pr">PR</h2>
<p><a href="https://github.com/tomblind/local-lua-debugger-vscode/pull/37">https://github.com/tomblind/local-lua-debugger-vscode/pull/37</a></p>
<p>Linux では動かんかったらしく、別の方法で修正してくれた。</p>
<p>👍 <code>0.2.2</code> <a href="https://github.com/tomblind/local-lua-debugger-vscode/blob/master/CHANGELOG.md">https://github.com/tomblind/local-lua-debugger-vscode/blob/master/CHANGELOG.md</a></p>
<h1 id="自前で-debugadapter-作ってみることにした">自前で <code>DebugAdapter</code> 作ってみることにした。</h1>
<p><a href="https://github.com/ousttrue/luada">https://github.com/ousttrue/luada</a></p>
<p>途中まで実装したのだが、</p>
<ul>
<li>luajit.exe + luada.lua</li>
</ul>
<p>という構成よりは、</p>
<ul>
<li>luada.exe</li>
</ul>
<p>の方が取り回しがよくて、それなら lua 成分をもっと減らして JSON-RPC 制御も <code>c++</code> なり <code>rust</code> なりにして
lua 埋め込み型の exe が作りやすそう。
元々、 スタンドアロンの lua インタプリタと組み合わせて使う lua スクリプトという方向性で実装していたのだが、
<code>luajit-2.1.0-beta3</code> 一辺倒になりつつあるので気分が変わってきたのであった。
これに関しては、今の構成でできるところまでやってみよう。</p>
<h1 id="vscode-の-extension-を作る">VSCode の Extension を作る</h1>
<ul>
<li><a href="https://code.visualstudio.com/api/get-started/your-first-extension">https://code.visualstudio.com/api/get-started/your-first-extension</a></li>
</ul>
<p>手順通りに初期化した。npm は最新版に更新したほうがよいぽい。</p>
<h1 id="mockdebug">MockDebug</h1>
<ul>
<li><a href="https://code.visualstudio.com/api/extension-guides/debugger-extension">https://code.visualstudio.com/api/extension-guides/debugger-extension</a></li>
</ul>
<p>を読む。</p>
<ul>
<li><a href="https://github.com/microsoft/vscode-mock-debug">https://github.com/microsoft/vscode-mock-debug</a></li>
</ul>
<p>というサンプルがある。</p>
<p>いくつかの機能をまとめて提供する必要がありそう。</p>
<ul>
<li>launch.json の設定</li>
<li>DebugAdapter 本体</li>
<li>DebugAdapter を起動する</li>
</ul>
<h1 id="実装してみる">実装してみる</h1>
<h2 id="extension-の-activate">Extension の activate</h2>
<p>適当にイベントを登録して</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #E1E4E8">    </span><span style="color: #6A737D">// package.json</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #9ECBFF">"activationEvents"</span><span style="color: #E1E4E8">: [</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">"onDebug"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">"onDebugInitialConfigurations"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">"onDebugDynamicConfigurations"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">"onDebugResolve:lua"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #9ECBFF">"onLanguage:lua"</span></span>
<span class="line"><span style="color: #E1E4E8">    ],</span></span></code></pre>
<p><code>activate</code> されることを確認</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #6A737D">// src/extension.ts</span></span>
<span class="line"><span style="color: #F97583">export</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">activate</span><span style="color: #E1E4E8">(</span><span style="color: #FFAB70">context</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">vscode</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">ExtensionContext</span><span style="color: #E1E4E8">) {</span></span>
<span class="line"><span style="color: #E1E4E8">    console.</span><span style="color: #B392F0">log</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">'activate luada'</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre>
<h2 id="launch">Launch</h2>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #E1E4E8">    </span><span style="color: #9ECBFF">"contributes"</span><span style="color: #E1E4E8">: {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">"breakpoints"</span><span style="color: #E1E4E8">: [</span></span>
<span class="line"><span style="color: #E1E4E8">            {</span></span>
<span class="line"><span style="color: #E1E4E8">                </span><span style="color: #79B8FF">"language"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"lua"</span></span>
<span class="line"><span style="color: #E1E4E8">            }</span></span>
<span class="line"><span style="color: #E1E4E8">        ],</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">"debuggers"</span><span style="color: #E1E4E8">: [</span></span>
<span class="line"><span style="color: #E1E4E8">            {</span></span>
<span class="line"><span style="color: #E1E4E8">                </span><span style="color: #79B8FF">"type"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"luada"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">                </span><span style="color: #79B8FF">"label"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"LuaDA"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">                </span><span style="color: #79B8FF">"languages"</span><span style="color: #E1E4E8">: [</span></span>
<span class="line"><span style="color: #E1E4E8">                    </span><span style="color: #9ECBFF">"lua"</span></span>
<span class="line"><span style="color: #E1E4E8">                ],</span></span>
<span class="line"><span style="color: #E1E4E8">                </span><span style="color: #6A737D">// launch.json のテンプレート</span></span>
<span class="line"><span style="color: #E1E4E8">                </span><span style="color: #79B8FF">"initialConfigurations"</span><span style="color: #E1E4E8">: [</span></span>
<span class="line"><span style="color: #E1E4E8">                    {</span></span>
<span class="line"><span style="color: #E1E4E8">                        </span><span style="color: #79B8FF">"type"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"luada"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">                        </span><span style="color: #79B8FF">"name"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"launch luada"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">                        </span><span style="color: #79B8FF">"request"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"launch"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">                        </span><span style="color: #79B8FF">"program"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"${workspaceFolder}/main.lua"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">                        </span><span style="color: #79B8FF">"args"</span><span style="color: #E1E4E8">: []</span></span>
<span class="line"><span style="color: #E1E4E8">                    }</span></span>
<span class="line"><span style="color: #E1E4E8">                ],</span></span>
<span class="line"><span style="color: #E1E4E8">                </span><span style="color: #6A737D">// request: launch に対して可能な property の定義</span></span>
<span class="line"><span style="color: #E1E4E8">                </span><span style="color: #79B8FF">"configurationAttributes"</span><span style="color: #E1E4E8">: {</span></span>
<span class="line"><span style="color: #E1E4E8">                    </span><span style="color: #79B8FF">"launch"</span><span style="color: #E1E4E8">: {</span></span>
<span class="line"><span style="color: #E1E4E8">                        </span><span style="color: #79B8FF">"properties"</span><span style="color: #E1E4E8">: {</span></span>
<span class="line"><span style="color: #E1E4E8">                            </span><span style="color: #79B8FF">"program"</span><span style="color: #E1E4E8">: {</span></span>
<span class="line"><span style="color: #E1E4E8">                                </span><span style="color: #79B8FF">"type"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"string"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">                                </span><span style="color: #79B8FF">"markdownDescription"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"Lua program to debug - set this to the path of the script"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">                                </span><span style="color: #79B8FF">"default"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"${workspaceFolder}/main.lua"</span></span>
<span class="line"><span style="color: #E1E4E8">                            },                            </span></span>
<span class="line"><span style="color: #E1E4E8">                            </span><span style="color: #79B8FF">"arg"</span><span style="color: #E1E4E8">: {</span></span>
<span class="line"><span style="color: #E1E4E8">                                </span><span style="color: #79B8FF">"type"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"array"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">                                </span><span style="color: #79B8FF">"markdownDescription"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"Command line argument, arg[1] ... arg[n]"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">                                </span><span style="color: #79B8FF">"default"</span><span style="color: #E1E4E8">: []</span></span>
<span class="line"><span style="color: #E1E4E8">                            }                            </span></span>
<span class="line"><span style="color: #E1E4E8">                        }</span></span>
<span class="line"><span style="color: #E1E4E8">                    }</span></span>
<span class="line"><span style="color: #E1E4E8">                }</span></span>
<span class="line"><span style="color: #E1E4E8">            }</span></span>
<span class="line"><span style="color: #E1E4E8">        ]</span></span>
<span class="line"><span style="color: #E1E4E8">    },</span></span></code></pre>
<ul>
<li>activate で DebugAdapterDescriptorFactory を登録</li>
<li>launch で createDebugAdapterDescriptor を実行する</li>
</ul>
<p><code>src/extensions.ts</code></p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">*</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">as</span><span style="color: #E1E4E8"> vscode </span><span style="color: #F97583">from</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'vscode'</span><span style="color: #E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">createDebugAdapterDescriptorFactory</span><span style="color: #E1E4E8">(</span><span style="color: #FFAB70">context</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">vscode</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">ExtensionContext</span><span style="color: #E1E4E8">)</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">vscode</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">DebugAdapterDescriptorFactory</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #B392F0">createDebugAdapterDescriptor</span><span style="color: #E1E4E8">(</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #FFAB70">session</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">vscode</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">DebugSession</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #FFAB70">executable</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">vscode</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">DebugAdapterExecutable</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">|</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">undefined</span></span>
<span class="line"><span style="color: #E1E4E8">        )</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">vscode</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">ProviderResult</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">vscode</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">DebugAdapterDescriptor</span><span style="color: #E1E4E8">> {</span></span>
<span class="line"><span style="color: #E1E4E8">            console.</span><span style="color: #B392F0">log</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">'launch luada'</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #F97583">const</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">runtime</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"exe"</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #F97583">const</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">runtimeArgs</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">string</span><span style="color: #E1E4E8">[] </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> [];</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #6A737D">//</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #6A737D">// デバッグアダプターを起動する</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #6A737D">// 起動したアダプターと vscode は、標準入出力で JSON-RPC により DebugAdapterProtocol で通信する。</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #6A737D">//</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">new</span><span style="color: #E1E4E8"> vscode.</span><span style="color: #B392F0">DebugAdapterExecutable</span><span style="color: #E1E4E8">(runtime, runtimeArgs);</span></span>
<span class="line"><span style="color: #E1E4E8">        }</span></span>
<span class="line"><span style="color: #E1E4E8">    };</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">export</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">activate</span><span style="color: #E1E4E8">(</span><span style="color: #FFAB70">context</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">vscode</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">ExtensionContext</span><span style="color: #E1E4E8">) {</span></span>
<span class="line"><span style="color: #E1E4E8">    console.</span><span style="color: #B392F0">log</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">'activate luada'</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #E1E4E8">    context.subscriptions.</span><span style="color: #B392F0">push</span><span style="color: #E1E4E8">(vscode.debug.</span><span style="color: #B392F0">registerDebugAdapterDescriptorFactory</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">'luada'</span><span style="color: #E1E4E8">, </span><span style="color: #B392F0">createDebugAdapterDescriptorFactory</span><span style="color: #E1E4E8">(context)));</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">export</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">deactivate</span><span style="color: #E1E4E8">() { }</span></span></code></pre>
<h2 id="debug-adapter-の実装">Debug Adapter の実装</h2>
<p><a href="https://microsoft.github.io/debug-adapter-protocol/specification">https://microsoft.github.io/debug-adapter-protocol/specification</a></p>
<p>を見て粛々と実装する。</p>
<h3 id="output-event"><a href="https://microsoft.github.io/debug-adapter-protocol/specification#Events_Output">Output Event</a></h3>
<p>vscode の DebugConsole に出力されるので早期に作ると print debug の助けになる。</p>
<h3 id="logger">Logger</h3>
<ul>
<li>DebugAdapterProtocol のやりとりすべてを記録する機能をアダプター側で作るべし。無いとデバッグ困難に。</li>
</ul>
<p>例</p>
<p><a href="https://github.com/Microsoft/vscode-debugadapter-node/blob/main/adapter/src/loggingDebugSession.ts">https://github.com/Microsoft/vscode-debugadapter-node/blob/main/adapter/src/loggingDebugSession.ts</a></p>
<h2 id="vsix-に出力">VSIX に出力</h2>
<p><a href="https://code.visualstudio.com/api/working-with-extensions/publishing-extension">https://code.visualstudio.com/api/working-with-extensions/publishing-extension</a></p>
<p>vsce を使う。</p>
<p>package.json に追加。</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #E1E4E8">    </span><span style="color: #9ECBFF">"publisher"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"ousttrue"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #9ECBFF">"repository"</span><span style="color: #E1E4E8">: {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">"type"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"git"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">"url"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"https://github.com/ousttrue/luada.git"</span></span>
<span class="line"><span style="color: #E1E4E8">    },</span></span></code></pre>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #e1e4e8">$ npx vsce package</span></span></code></pre>
<h1 id="参考">参考</h1>
<h2 id="httpsgithubcomactboy168lua-debug"><a href="https://github.com/actboy168/lua-debug">https://github.com/actboy168/lua-debug</a></h2>
<ul>
<li>vscode.DebugAdapterExecutable</li>
</ul>
<h2 id="httpsgithubcomtomblindlocal-lua-debugger-vscode"><a href="https://github.com/tomblind/local-lua-debugger-vscode">https://github.com/tomblind/local-lua-debugger-vscode</a></h2>
<ul>
<li>vscode.DebugAdapterServer</li>
<li>TypeScript で vscode.DebugAdapterServer を new</li>
<li>vscode と DebugAdapterServer が DAP で通信</li>
<li>DebugAdapterServer が lua を spawn もしている</li>
</ul>

				</div>
			</article>
		</main>
		<footer class="footer astro-SZ7XMLTE">
    <nav class="nav astro-SZ7XMLTE">
        <div class="astro-SZ7XMLTE">2021  &copy; Copyright notice |  <a href="https://github.com/one-aalam/astro-ink" title="三次元日誌(astro)'s Github URL'" class="astro-SZ7XMLTE">三次元日誌(astro)</a>
        <script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><astro-island uid="1QEdto" component-url="/_astro/ModeLabel.e3ff75e7.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-SZ7XMLTE&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;ModeLabel&quot;,&quot;value&quot;:true}" await-children=""><span slot="dark" data-svelte-h="svelte-14ov3lc">(dark)</span></astro-island> theme on <a href="https://astro.build/" class="astro-SZ7XMLTE">Astro</a></div>
        <astro-island uid="1I86to" component-url="/_astro/NetlifyIdentity.94b8edb0.js" component-export="default" renderer-url="/_astro/client.cb726945.js" props="{&quot;class&quot;:[0,&quot;astro-SZ7XMLTE&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;NetlifyIdentity&quot;,&quot;value&quot;:true}"></astro-island>
    </nav>
</footer>
	</body></html>