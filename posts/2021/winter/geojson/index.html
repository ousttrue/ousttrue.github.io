<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="generator" content="Nikola (getnikola.com)">
<meta name="viewport" content="width=device-width">
<script src="../../../../assets/js/all-nocdn.js"></script><title>geojson | 三次元日誌</title>
<link href="../../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
</head>
<body>
    <h1 id="brand">
        <a href="../../../../" title="三次元日誌" rel="home">
            <span id="blog-title">三次元日誌</span>
        </a>
    </h1>

    <nav id="menu"><ul>
<li><a href="../../../../archive.html">Archives</a></li>
<li><a href="../../../../categories/index.html">Tags</a></li>
<li><a href="../../../../rss.xml">RSS feed</a></li>
<li><a href="../../../../about">About</a></li>
<li><a href="../../../../books">MemoBooks</a></li>

            
            
            
        </ul></nav><hr>
<main id="content"><h1 class="p-name entry-title" itemprop="headline name">
    <h1 class="p-name entry-title" itemprop="headline name">
    <a href="." class="u-url">geojson
    </a>
</h1>
<ul itemprop="keywords" class="tags">
<li>
        <time datetime="2021-12-29T00:00:00+09:00" title="2021-12-29">2021-12-29</time>
</li>
    <li><a class="tag p-category" href="../../../../categories/gis/" rel="tag">gis</a></li>
    <li><a class="tag p-category" href="../../../../categories/python/" rel="tag">python</a></li>
</ul>
</h1>

<h2>geojson</h2>
<p>既存のライブラリが重厚長大なものが多いのだけど、
OpenGL や SVG のような二次元のベクター描画で簡単に済ませたい。
その方向で調査。</p>
<h3>format</h3>
<ul>
<li><a href="https://datatracker.ietf.org/doc/html/rfc7946">https://datatracker.ietf.org/doc/html/rfc7946</a></li>
<li>
<a href="https://ja.wikipedia.org/wiki/GeoJSON">https://ja.wikipedia.org/wiki/GeoJSON</a><ul>
<li><a href="https://en.wikipedia.org/wiki/GeoJSON">https://en.wikipedia.org/wiki/GeoJSON</a></li>
</ul>
</li>
</ul>
<blockquote>
<p>GeoJSON is a geospatial data</p>
</blockquote>
<p>以下のような様式。
<code>Feature</code> の中に <code>Geometry</code> が入っている。</p>
<div class="code"><pre class="code literal-block"><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"FeatureCollection"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">"features"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Feature"</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w"></span>
<span class="w">            </span><span class="nt">"geometry"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>

<table>
<thead><tr>
<th>Geometry Object</th>
</tr></thead>
<tbody>
<tr>
<td>Point</td>
</tr>
<tr>
<td>MultiPoint</td>
</tr>
<tr>
<td>LineString</td>
</tr>
<tr>
<td>MultiLineString</td>
</tr>
<tr>
<td>Polygon</td>
</tr>
<tr>
<td>MultiPolygon</td>
</tr>
<tr>
<td>GeometryCollection</td>
</tr>
</tbody>
</table>
<h4>Point</h4>
<div class="code"><pre class="code literal-block"><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Point"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">"coordinates"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">100.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>

<h4>Polygon</h4>
<p>穴が空いている場合は、複数の頂点リストを保持する。</p>
<div class="code"><pre class="code literal-block"><span class="c1">// No holes:</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Polygon"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">"coordinates"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="w"></span>
<span class="w">            </span><span class="p">[</span><span class="mf">100.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">],</span><span class="w"></span>
<span class="w">            </span><span class="p">[</span><span class="mf">101.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">],</span><span class="w"></span>
<span class="w">            </span><span class="p">[</span><span class="mf">101.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">],</span><span class="w"></span>
<span class="w">            </span><span class="p">[</span><span class="mf">100.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">],</span><span class="w"></span>
<span class="w">            </span><span class="p">[</span><span class="mf">100.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">]</span><span class="w"></span>
<span class="w">        </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// with holes:</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Polygon"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">"coordinates"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="w"></span>
<span class="w">            </span><span class="p">[</span><span class="mf">100.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">],</span><span class="w"></span>
<span class="w">            </span><span class="p">[</span><span class="mf">101.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">],</span><span class="w"></span>
<span class="w">            </span><span class="p">[</span><span class="mf">101.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">],</span><span class="w"></span>
<span class="w">            </span><span class="p">[</span><span class="mf">100.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">],</span><span class="w"></span>
<span class="w">            </span><span class="p">[</span><span class="mf">100.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">]</span><span class="w"></span>
<span class="w">        </span><span class="p">],</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="w"></span>
<span class="w">            </span><span class="p">[</span><span class="mf">100.8</span><span class="p">,</span><span class="w"> </span><span class="mf">0.8</span><span class="p">],</span><span class="w"></span>
<span class="w">            </span><span class="p">[</span><span class="mf">100.8</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2</span><span class="p">],</span><span class="w"></span>
<span class="w">            </span><span class="p">[</span><span class="mf">100.2</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2</span><span class="p">],</span><span class="w"></span>
<span class="w">            </span><span class="p">[</span><span class="mf">100.2</span><span class="p">,</span><span class="w"> </span><span class="mf">0.8</span><span class="p">],</span><span class="w"></span>
<span class="w">            </span><span class="p">[</span><span class="mf">100.8</span><span class="p">,</span><span class="w"> </span><span class="mf">0.8</span><span class="p">]</span><span class="w"></span>
<span class="w">        </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>

<h3>read</h3>
<p>python で素直に読んでみた。</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">json</span>


<span class="k">def</span> <span class="nf">process_geometry</span><span class="p">(</span><span class="n">geometry</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="k">match</span> <span class="n">geometry</span><span class="p">:</span>
        <span class="k">case</span> <span class="p">{</span><span class="s2">"type"</span><span class="p">:</span> <span class="s2">"MultiPolygon"</span><span class="p">,</span> <span class="s2">"coordinates"</span><span class="p">:</span> <span class="n">coordinates</span><span class="p">}:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span><span class="si">}</span><span class="s1"> polygon'</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coordinates</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'  </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span><span class="si">}</span><span class="s1"> rings'</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">coord</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'    </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="si">}</span><span class="s1"> points'</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">process_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="k">match</span> <span class="n">feature</span><span class="p">:</span>
        <span class="k">case</span> <span class="p">{</span><span class="s2">"type"</span><span class="p">:</span> <span class="s2">"Feature"</span><span class="p">,</span> <span class="s2">"properties"</span><span class="p">:</span> <span class="n">props</span><span class="p">,</span> <span class="s2">"geometry"</span><span class="p">:</span> <span class="n">geometry</span><span class="p">}:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">props</span><span class="p">)</span>
            <span class="n">process_geometry</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>

        <span class="k">case</span> <span class="k">_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">())</span>
    <span class="k">match</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">case</span> <span class="p">{</span><span class="s2">"type"</span><span class="p">:</span> <span class="s2">"FeatureCollection"</span><span class="p">,</span> <span class="s2">"features"</span><span class="p">:</span> <span class="n">features</span><span class="p">}:</span>
            <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
                <span class="n">process_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s1">'japan.geo.json'</span><span class="p">))</span>
</pre></div>

<p><code>jpan.geo.json</code> は、 <a href="https://github.com/dataofjapan/land">https://github.com/dataofjapan/land</a> です。
実行結果。</p>
<div class="code"><pre class="code literal-block">{'nam': 'Kyoto Fu', 'nam_ja': '京都府', 'id': 26}
4 polygon
  1 rings
    1235 points
  1 rings
    6 points
  1 rings
    8 points
  1 rings
    6 points
</pre></div>

<p>なるほど。</p>
<h3>GL_LINE_LOOP</h3>
<p>単純に <code>GL_LINE_LOOP</code> で描画できそうとわかった。</p>
<div class="code"><pre class="code literal-block"><span class="k">def</span> <span class="nf">process_geometry</span><span class="p">(</span><span class="n">geometry</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Polygon</span><span class="p">:</span>
    <span class="k">match</span> <span class="n">geometry</span><span class="p">:</span>
        <span class="k">case</span> <span class="p">{</span><span class="s2">"type"</span><span class="p">:</span> <span class="s2">"Polygon"</span><span class="p">,</span> <span class="s2">"coordinates"</span><span class="p">:</span> <span class="n">polygon</span><span class="p">}:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="n">array</span> <span class="o">=</span> <span class="p">(</span><span class="n">float2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">polygon</span><span class="p">[</span><span class="mi">0</span><span class="p">]))()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">polygon</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">float2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="p">[</span><span class="n">SubMesh</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">))])</span>

        <span class="k">case</span> <span class="p">{</span><span class="s2">"type"</span><span class="p">:</span> <span class="s2">"MultiPolygon"</span><span class="p">,</span> <span class="s2">"coordinates"</span><span class="p">:</span> <span class="n">polygons</span><span class="p">}:</span>
            <span class="n">array</span> <span class="o">=</span> <span class="p">(</span><span class="n">float2</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">polygon</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">polygon</span> <span class="ow">in</span> <span class="n">polygons</span><span class="p">))()</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">submeshes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">polygon</span> <span class="ow">in</span> <span class="n">polygons</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="n">submeshes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SubMesh</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">polygon</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="n">polygon</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">float2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">submeshes</span><span class="p">)</span>

        <span class="k">case</span> <span class="k">_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</pre></div>

<p><code>orthogonal</code> の方で適当にビューポートを <code>(140, 35)</code> というような適当な経度緯度に調整してやればよさそう。</p>
<h3>data</h3>
<ul>
<li><a href="https://github.com/dataofjapan/land">https://github.com/dataofjapan/land</a></li>
<li><a href="http://geojson.io/">http://geojson.io/</a></li>
</ul>
<h3>参考</h3>
<ul>
<li><a href="https://qiita.com/kkdd/items/416b955fb2d3e1327edc">GeoJSON (RFC7946) 仕様の注意点など</a></li>
<li><a href="https://github.com/jeremyfromearth/cinder-geojson-experiments">https://github.com/jeremyfromearth/cinder-geojson-experiments</a></li>
<li><a href="https://github.com/soolmaz-mk/Atlasi">https://github.com/soolmaz-mk/Atlasi</a></li>
</ul>
<hr>
<ul class="pager hidden-print">
<li class="previous">
        <a href="../python_geo/" rel="prev" title="python で地理情報を扱う">
            python で地理情報を扱う 👈
        </a>
    </li>
    <li style="flex-grow: 1">
    <li class="next">
        <a href="../../../2022/0101-rawtypes/" rel="next" title="rawtypes 作ってみる">
            👉 rawtypes 作ってみる
        </a>
    </li>
</ul></main><footer id="footer"><p>
            Powered by
            <a href="https://getnikola.com" rel="nofollow">Nikola</a>
        </p>
    </footer>
</body>
</html>
