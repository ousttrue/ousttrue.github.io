<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="generator" content="Nikola (getnikola.com)">
<meta name="viewport" content="width=device-width">
<script src="../../../../assets/js/all-nocdn.js"></script><title>SSGã‚’ABlogã«å¤‰æ›´ | ä¸‰æ¬¡å…ƒæ—¥èªŒ</title>
<link href="../../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
</head>
<body>
    <h1 id="brand">
        <a href="../../../../" title="ä¸‰æ¬¡å…ƒæ—¥èªŒ" rel="home">
            <span id="blog-title">ä¸‰æ¬¡å…ƒæ—¥èªŒ</span>
        </a>
    </h1>

    <nav id="menu"><ul>
<li><a href="../../../../archive.html">Archives</a></li>
<li><a href="../../../../categories/index.html">Tags</a></li>
<li><a href="../../../../rss.xml">RSS feed</a></li>
<li><a href="../../../../about">About</a></li>
<li><a href="../../../../books">MemoBooks</a></li>

            
            
            
        </ul></nav><hr>
<main id="content"><h1 class="p-name entry-title" itemprop="headline name">
    <h1 class="p-name entry-title" itemprop="headline name">
    <a href="." class="u-url">SSGã‚’ABlogã«å¤‰æ›´
    </a>
</h1>
<ul itemprop="keywords" class="tags">
<li>
        <time datetime="2021-12-20T00:00:00+09:00" title="2021-12-20">2021-12-20</time>
</li>
    <li><a class="tag p-category" href="../../../../categories/python/" rel="tag">python</a></li>
    <li><a class="tag p-category" href="../../../../categories/sphinx/" rel="tag">sphinx</a></li>
    <li><a class="tag p-category" href="../../../../categories/ssg/" rel="tag">ssg</a></li>
</ul>
</h1>

<h2>ABlog ã«ã‚·ã‚¹ãƒ†ãƒ ã‚’å¤‰æ›´</h2>
<p><a href="https://getnikola.com/">nikola</a> ã¯ä½¿ã„ã“ãªã›ãªãã¦çŸ­å‘½ã«çµ‚ã‚ã£ã¦ã—ã¾ã£ãŸã€‚
<a href="https://pydoit.org/">doit</a> ã¯é¢ç™½ã„ã¨æ€ã†ã®ã ãŒã€‚</p>
<p>ã¨ã„ã†ã“ã¨ã§ã€ <code>sphinx</code> ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã® <a href="https://ablog.readthedocs.io/en/latest/">ABlog</a> ã§ã™ã€‚</p>
<h3>ã¯ã¾ã‚Š1: Sphinx ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥</h3>
<p><code>python -m sphinx content build</code> ã«ãƒ‡ãƒãƒƒã‚¬ã‚’ã‚¢ã‚¿ãƒƒãƒã—ã¦è©¦è¡ŒéŒ¯èª¤ã™ã‚‹ã®ã ã‘ã©ã€
ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã¦å‡¦ç†ã•ã‚Œãªã‹ã£ãŸã€‚</p>
<p><code>python -m sphinx content build -E -v</code> ã¨ã™ã‚‹ã€‚</p>
<ul>
<li>-E: å…¨å‡¦ç†(ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ã‚ãªã„)</li>
<li>-v: è©³ç´°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</li>
</ul>
<h3>ã¯ã¾ã‚Š2: ablog ãŒ timezone ã®æœ‰ç„¡ã§æ—¥ä»˜ã®æ¯”è¼ƒã«å¤±æ•—ã™ã‚‹</h3>
<div class="code"><pre class="code literal-block">can't compare offset-naive and offset-aware datetimes
</pre></div>

<p>ã“ã‚Œã¯ã€æ—¢å­˜è¨˜äº‹ã® <code>frontmatter</code> ã®æ—¥ä»˜ã« <code>timezone</code> ãŒä»˜ã„ã¦ã„ã‚‹ã¨
æ—¥ä»˜ã®æ¯”è¼ƒã«å¤±æ•—ã™ã‚‹ã€‚</p>
<div class="code"><pre class="code literal-block"><span class="c1"># site-packages/ablog/blog.py:382</span>
<span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">date</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s2">"date"</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>

<p>ã¨å¯¾å‡¦ã—ãŸã€‚</p>
<h3>ã¯ã¾ã‚Š3: myst-parser ã® toml frontmatter å¯¾å¿œ</h3>
<p><code>myst-parser</code> ãŒ <code>---</code> ã«ã‚ˆã‚‹ <code>yaml</code> å½¢å¼ã® <code>frontmatter</code> ã«ã—ã‹å¯¾å¿œã—ã¦ã„ãªã„æ§˜å­ã€‚
<a href="https://gohugo.io/content-management/front-matter/">hugo ã® frontmatter</a> ã«ã‚ã‚‹ <code>toml</code> æ§˜å¼ã«å¯¾å¿œã™ã‚‹ã¹ãæ”¹é€ ã—ãŸã„ã€‚</p>
<h4>åˆ‡ã‚Šå‡ºã—</h4>
<p>ã©ã“ã§å‡¦ç†ã—ã¦ã„ã‚‹ã®ã‹æ¢ç´¢ãŒé›£èˆªã—ãŸã€‚</p>
<p><code>site-packages/mdit_py_plugins/front_matter/index.py</code>
ã§å‡¦ç†ã—ã¦ã„ã‚‹ã€‚</p>
<h4>Parse</h4>
<p><code>site-packages/myst_parser/docutils_renderer.py</code></p>
<p><code>render_front_matter</code> ã§åˆ‡ã‚Šå‡ºã—ãŸæ–‡å­—åˆ—ã‚’ <code>yaml</code> ã§ãƒ‘ãƒ¼ã‚¹ã—ã¦ã„ã‚‹ã€‚
<code>except</code> ç¯€ã§ <code>toml</code> ã«ãƒªãƒˆãƒ©ã‚¤ã•ã›ãŸã‚‰å‹•ã„ãŸã€‚</p>
<h3>ãƒ¢ãƒ³ã‚­ãƒ¼ãƒ‘ãƒƒãƒ</h3>
<p>ã¨ã‚Šã‚ãˆãš <code>conf.py</code> ã«ã¦ç›´æ¥ä¿®æ­£ã™ã‚‹ã€‚</p>
<p><a href="https://github.com/ousttrue/ousttrue.github.io/blob/ablog/content/patch.py">https://github.com/ousttrue/ousttrue.github.io/blob/ablog/content/patch.py</a></p>
<p>å¾Œã§ PR é€ã£ãŸã‚Šã§ãã‚‹ã‹ãªã€‚</p>
<h3>ABlog ã¯ä½•ã‚’ã—ã¦ã„ã‚‹ã®ã‹</h3>
<h4>toctreeç„¡ã—ã®postè¨˜äº‹</h4>
<p>ç‰¹å®šã®æ¡ä»¶ã§ã€è¨˜äº‹ã‚’ãƒ–ãƒ­ã‚°è¨˜äº‹ã¨è¦‹åšã—ã¦ <code>toctree</code> ç„¡ã—ã§è¾¿ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚
è¨˜äº‹ã¯ã€æ—¥ä»˜ã‚„ã‚¿ã‚°ã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦ãã‚Œã‚‹ã€‚</p>
<p><a href="https://ablog.readthedocs.io/en/latest/manual/posting-and-listing/#posting-with-page-front-matter">https://ablog.readthedocs.io/en/latest/manual/posting-and-listing/#posting-with-page-front-matter</a></p>
<p>ãƒ‘ã‚¹æŒ‡å®šã€‚</p>
<div class="code"><pre class="code literal-block"><span class="n">blog_post_pattern</span> <span class="o">=</span> <span class="s2">"posts/**/*.md"</span>
</pre></div>

<p>æ¡ä»¶ã€‚</p>
<div class="code"><pre class="code literal-block"><span class="c1"># .venv/lib/python3.9/site-packages/ablog/post.py</span>
        <span class="k">if</span> <span class="s2">"blogpost"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metadata</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">docname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">matched_blog_posts</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
</pre></div>

<p><code>frontmatter</code> ç­‰ã‹ã‚‰æœ€ä½é™ã€æ—¥ä»˜ã®æƒ…å ±ãŒã¨ã‚Œãªã„ã¨ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã‹ã‚‰è¾¿ã‚‹æ–¹æ³•ãŒç„¡ã„çŠ¶æ…‹ã«ãªã‚‹ã€‚</p>
<p>ã‚ã¨ <code>sphinx</code> ãªã®ã§ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã®è¡¨é¡ŒãŒæœ¬æ–‡å´ã«å¿…è¦ã‹ã‚‚ã€‚
<code>frontmatter</code> ã® <code>title</code> ã‚’åæ˜ ã§ãã‚‹ã¨ä¾¿åˆ©ãã†ã€‚</p>
<h4>event: 'doctree-read'</h4>
<p>doctree ã‹ã‚‰ <code>PostNode</code> ã‚’é›†ã‚ã‚‹ã€‚</p>
<p><code>alog/post#process_posts(app, doctree)</code></p>
<div class="code"><pre class="code literal-block"><span class="k">def</span> <span class="nf">process_posts</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">doctree</span><span class="p">):</span>
    <span class="n">post_nodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">doctree</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="n">PostNode</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">post_nodes</span><span class="p">:</span>
        <span class="c1"># PostNode ãŒå¿…è¦</span>
        <span class="k">return</span>

    <span class="c1"># çœç•¥</span>

    <span class="n">postinfo</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"docname"</span><span class="p">:</span> <span class="n">docname</span><span class="p">,</span>
        <span class="s2">"section"</span><span class="p">:</span> <span class="n">section_name</span><span class="p">,</span>
        <span class="s2">"order"</span><span class="p">:</span> <span class="n">order</span><span class="p">,</span>
        <span class="s2">"date"</span><span class="p">:</span> <span class="n">date</span><span class="p">,</span>
        <span class="s2">"update"</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">update_dates</span> <span class="o">+</span> <span class="p">[</span><span class="n">date</span><span class="p">]),</span>
        <span class="s2">"title"</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s2">"excerpt"</span><span class="p">:</span> <span class="n">excerpt</span><span class="p">,</span>
        <span class="s2">"tags"</span><span class="p">:</span> <span class="n">node</span><span class="p">[</span><span class="s2">"tags"</span><span class="p">],</span>
        <span class="s2">"author"</span><span class="p">:</span> <span class="n">node</span><span class="p">[</span><span class="s2">"author"</span><span class="p">],</span>
        <span class="s2">"category"</span><span class="p">:</span> <span class="n">node</span><span class="p">[</span><span class="s2">"category"</span><span class="p">],</span>
        <span class="s2">"location"</span><span class="p">:</span> <span class="n">node</span><span class="p">[</span><span class="s2">"location"</span><span class="p">],</span>
        <span class="s2">"language"</span><span class="p">:</span> <span class="n">node</span><span class="p">[</span><span class="s2">"language"</span><span class="p">],</span>
        <span class="s2">"redirect"</span><span class="p">:</span> <span class="n">node</span><span class="p">[</span><span class="s2">"redirect"</span><span class="p">],</span>
        <span class="s2">"nocomments"</span><span class="p">:</span> <span class="n">node</span><span class="p">[</span><span class="s2">"nocomments"</span><span class="p">],</span>
        <span class="s2">"image"</span><span class="p">:</span> <span class="n">node</span><span class="p">[</span><span class="s2">"image"</span><span class="p">],</span>
        <span class="s2">"exclude"</span><span class="p">:</span> <span class="n">node</span><span class="p">[</span><span class="s2">"exclude"</span><span class="p">],</span>
        <span class="s2">"doctree"</span><span class="p">:</span> <span class="n">section_copy</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">docname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">ablog_posts</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">ablog_posts</span><span class="p">[</span><span class="n">docname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">env</span><span class="o">.</span><span class="n">ablog_posts</span><span class="p">[</span><span class="n">docname</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">postinfo</span><span class="p">)</span>
</pre></div>

<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="nc">CheckFrontMatter</span><span class="p">(</span><span class="n">SphinxTransform</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">():</span>
        <span class="k">pass</span>

<span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="n">app</span><span class="o">.</span><span class="n">add_transform</span><span class="p">(</span><span class="n">CheckFrontMatter</span><span class="p">)</span>    
</pre></div>

<h4>è¿½åŠ ã®ãƒšãƒ¼ã‚¸ç”Ÿæˆ</h4>
<p><code>ablog/templates</code> ã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã€‚</p>
<div class="code"><pre class="code literal-block"><span class="c1"># -- ABlog Sidebars -------------------------------------------------------</span>

<span class="c1"># There are seven sidebars you can include in your HTML output.</span>
<span class="c1"># postcard.html provides information regarding the current post.</span>
<span class="c1"># recentposts.html lists most recent five posts. Others provide</span>
<span class="c1"># a link to a archive pages generated for each tag, category, and year.</span>
<span class="c1"># In addition, there are authors.html, languages.html, and locations.html</span>
<span class="c1"># sidebars that link to author and location archive pages.</span>
<span class="n">html_sidebars</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'**'</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">'about.html'</span><span class="p">,</span>
        <span class="s1">'postcard.html'</span><span class="p">,</span>
        <span class="s1">'navigation.html'</span><span class="p">,</span>
        <span class="s1">'recentposts.html'</span><span class="p">,</span>
        <span class="s1">'tagcloud.html'</span><span class="p">,</span>
        <span class="s1">'categories.html'</span><span class="p">,</span>
        <span class="s1">'archives.html'</span><span class="p">,</span>
        <span class="s1">'searchbox.html'</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">}</span>
</pre></div>

<p>ã“ã‚Œã‚‰ã«å¯¾ã—ã¦è¿½åŠ ã®ãƒšãƒ¼ã‚¸ç”Ÿæˆã‚’è¡Œã£ã¦ã„ã‚‹ã€‚
<code>genindex.html</code> ãªã©ã®ã‚ˆã†ã«ã€‚</p>
<h3>ToDo</h3>
<h4>âœ… ã‚¿ã‚°ãŒå¤‰</h4>
<p>toml ç”±æ¥ã® tag ã®å‡¦ç†ã«å¤±æ•—ã—ã¦ã„ã‚‹ã€‚</p>
<p><code>["python", "ssg", "sphinx"]</code></p>
<p>ãŒã€</p>
<ul>
<li><code>["python"</code></li>
<li><code>"ssg"</code></li>
<li><code>"sphinx"]</code></li>
</ul>
<p>ã«ãªã£ã¡ã‚ƒã£ã¦ã‚‹ã€‚</p>
<p>https://github.com/sunpy/ablog/pull/119</p>
<p>é€ã£ã¦ã¿ãŸã€‚</p>
<p><code>v0.10.22</code> ã§ä¿®æ­£ã€‚ğŸ‘</p>
<h4>âœ… æ—¥ä»˜ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</h4>
<p><code>conf.py</code></p>
<div class="code"><pre class="code literal-block"><span class="n">post_date_format</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'%Y/%m/</span><span class="si">%d</span><span class="s1">'</span>
<span class="n">post_date_format_short</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'%Y/%m'</span>
</pre></div>

<h4>âœ… è¨˜äº‹ã®URL</h4>
<ul>
<li><a href="https://zenn.dev/attakei/articles/sphinx-make-dirhtml">https://zenn.dev/attakei/articles/sphinx-make-dirhtml</a></li>
</ul>
<h4>âœ… è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«ã¯æœ€åˆã®è¦‹å‡ºã—ã§ã¯ãªãã€frontmatter ã® title ã«ã—ãŸã„</h4>
<p><code>MystParser</code> ã‚’æ”¹é€ ã—ãŸã€‚
ã‚ã‚Šã¨ Sphinx ã‚ã‹ã£ã¦ããŸã€‚
<code>python</code> ã§ãƒ‡ãƒãƒƒã‚¬ãŒã‚¢ã‚¿ãƒƒãƒã§ãã‚‹ã¨ãªã‚“ã§ã‚‚ã§ãã‚‹(æ…£ã‚Œ)ã€‚</p>
<h4>[ ] tagã®è¡¨è¨˜æŒ¯ã‚Œ</h4>
<p><code>c++</code> ã¨ <code>C++</code>ã€<code>c#</code> ã¨ <code>csharp</code> ãªã©ã‚’ãŸã°ã­ã‚‹ã€‚</p>
<h3>å‚è€ƒ</h3>
<ul>
<li><a href="https://water2litter.net/pisco/doc/ablog.html">Sphinxã§ãƒ–ãƒ­ã‚°ã‚’ã—ã¦ã¿ã‚ˆã†</a></li>
</ul>
<hr>
<ul class="pager hidden-print">
<li class="previous">
        <a href="../python_imgui/" rel="prev" title="imgui ã® python ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚’ã¾ãŸä½œã‚‹">
            imgui ã® python ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚’ã¾ãŸä½œã‚‹ ğŸ‘ˆ
        </a>
    </li>
    <li style="flex-grow: 1">
    <li class="next">
        <a href="../python_geo/" rel="next" title="python ã§åœ°ç†æƒ…å ±ã‚’æ‰±ã†">
            ğŸ‘‰ python ã§åœ°ç†æƒ…å ±ã‚’æ‰±ã†
        </a>
    </li>
</ul></main><footer id="footer"><p>
            Powered by
            <a href="https://getnikola.com" rel="nofollow">Nikola</a>
        </p>
    </footer>
</body>
</html>
