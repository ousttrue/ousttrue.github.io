<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>三次元日誌</title>

    

  <script src="https://ousttrue.github.io/plugins/elasticlunr.min.js" defer></script>
  <script src="https://ousttrue.github.io/search_index.en.js" defer></script>
  <script src="https://ousttrue.github.io/js/search.js" defer></script>

    

     
    <link rel="stylesheet" href="https://ousttrue.github.io/main.css">
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css"
      />
    
  </head>

  <body class="container">
    <a class="site_title" href="https:&#x2F;&#x2F;ousttrue.github.io&#x2F;">
      <div>三次元日誌</div>
    </a>

    <nav class="nav">
      <a class="item" href="/tags/">tags</a>
      <a class="item" href="https://github.com/ousttrue" aria-label="github">
        <i class="fab fa-github fa-lg"></i>
      </a>
      

        
            <form class="navbar-form">
                <input id="userinput" class="form-control is-search" type="search" placeholder="Search docs..."
                    aria-label="Search docs..." autocomplete="off">
                <div id="suggestions" class="shadow bg-white rounded"></div>
            </form>
        
    </nav>

    <main class="main">
<div class="page">
<div class="content">
  <div class="headline">
  
  

  
  <a class="headline_title" href="https:&#x2F;&#x2F;ousttrue.github.io&#x2F;posts&#x2F;2021&#x2F;lua-info&#x2F;"> luaメモ 
  

  
  
  
  
  
    
  <div class="image_box"><img src="https:&#x2F;&#x2F;ousttrue.github.io&#x2F;processed_images&#x2F;c3457da09b47073900.png"></div>
  
  </a>

  

  <div>
    <ul class="tags">
      <li class="headline_date">
        <div class="year">2021</div>
        <div class="md">0727</div>
      </li>
      
      <li class="headline_date updated">
        <div class="year">2021</div>
        <div class="md">0815</div>
      </li>
      
      


    <li class="tag"><a href="https:&#x2F;&#x2F;ousttrue.github.io&#x2F;tags&#x2F;lua&#x2F;">lua</a></li>

    <li class="tag"><a href="https:&#x2F;&#x2F;ousttrue.github.io&#x2F;tags&#x2F;luajit&#x2F;">luajit</a></li>

    <li class="tag"><a href="https:&#x2F;&#x2F;ousttrue.github.io&#x2F;tags&#x2F;lsp&#x2F;">lsp</a></li>

    <li class="tag"><a href="https:&#x2F;&#x2F;ousttrue.github.io&#x2F;tags&#x2F;dap&#x2F;">dap</a></li>




    </ul>
  </div>
</div>
 <p><a href="https://www.lua.org/docs.html">https://www.lua.org/docs.html</a></p>
<h1 id="interpreter">Interpreter</h1>
<p>とりあえず <code>luajit-2.1.0-beta3</code> 推し。</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">+---+    +---+    +---+    +---+</span><span style="color:#c0c5ce;">
|5.1| -&gt; |5.2| -&gt; |5.3| -&gt; |5.4|</span><span style="color:#c0c5ce;">
+---+    +---+    +---+    +---+</span><span style="color:#c0c5ce;">
  |        |        |</span><span style="color:#c0c5ce;">
  |        |        +- ravi</span><span style="color:#c0c5ce;">
  |        |</span><span style="color:#c0c5ce;">
  |        +- moonsharp</span><span style="color:#c0c5ce;">
  |</span><span style="color:#c0c5ce;">
  +- luajit(5.1 base)</span><span style="color:#c0c5ce;">
  |   +- moonjit</span><span style="color:#c0c5ce;">
  +- luau(5.1 base)</span><span style="color:#c0c5ce;">
</span></code></pre>
<p><code>lua-5.1</code> をベースに分岐したものが多い？</p>
<p><a href="https://www.lua.org/versions.html">https://www.lua.org/versions.html</a></p>
<table><thead><tr><th></th><th>url</th><th>memo</th></tr></thead><tbody>
<tr><td>Lua5.1</td><td></td><td>2012。これより古いものを使う理由は無さそう。</td></tr>
<tr><td>Lu15.2</td><td><a href="https://www.lua.org/manual/5.2/readme.html#changes">since Lua5.1</a></td><td>2015。finalizer. 関数の <code>_ENV</code> 仕様変更</td></tr>
<tr><td>Lua5.3</td><td><a href="https://www.lua.org/manual/5.3/readme.html#changes">since Lua5.2</a></td><td>2020。integers</td></tr>
<tr><td>Lua5.4</td><td><a href="https://www.lua.org/manual/5.4/readme.html#changes">since Lua5.3</a></td><td>2021。const, to-be-closed</td></tr>
<tr><td>LuaJIT</td><td><a href="https://luajit.org/">https://luajit.org/</a></td><td>Lua5.1base。最終版は <code>2.1.0-beta3</code>。neovimもこれ。<code>FFI</code> も強力。</td></tr>
<tr><td>Luau</td><td><a href="https://luau-lang.org/">https://luau-lang.org/</a></td><td>Lua5.1 の superset。Roblox専用。オープンソースではない。</td></tr>
<tr><td>Ravi</td><td><a href="http://ravilang.github.io/">http://ravilang.github.io/</a></td><td>Lua5.3base？。limited optional static typing and MIR based JIT compiler</td></tr>
</tbody></table>
<h2 id="bian-warizhong">変わり種</h2>
<p><code>headeronly</code>. include するだけで使える。</p>
<ul>
<li><a href="https://github.com/edubart/minilua">https://github.com/edubart/minilua</a></li>
</ul>
<p>LUA に更に埋め込む</p>
<ul>
<li><a href="https://terralang.org/">https://terralang.org/</a></li>
</ul>
<h1 id="translator">Translator</h1>
<h2 id="moonscript"><a href="https://moonscript.org/">MoonScript</a></h2>
<h2 id="typescripttolua"><a href="https://typescripttolua.github.io/">TypescriptToLua</a></h2>
<ul>
<li>後で出てくる、<code>local-lua-debugger</code> はこれで実装されているぽい。</li>
</ul>
<h2 id="lunescript"><a href="https://ifritjp.github.io/documents/lunescript/">LuneScript/</a></h2>
<h2 id="teal"><a href="https://github.com/teal-language/tl">Teal</a></h2>
<h1 id="language-server">Language server</h1>
<h2 id="emmylua"><a href="https://github.com/EmmyLua/EmmyLua-LanguageServer">EmmyLua</a></h2>
<ul>
<li>Java製</li>
<li><a href="https://emmylua.github.io/annotation.html">EmmyLua Annotation</a> に対応。これにより、組み込み型のインテリセンスを動作させることができて使い勝手が向上する</li>
</ul>
<h2 id="lua-language-server"><a href="https://github.com/sumneko/lua-language-server">lua-language-server</a></h2>
<ul>
<li>⭐ <a href="https://emmylua.github.io/annotation.html">EmmyLua Annotation</a> に対応。これにより、組み込み型のインテリセンスを動作させることができて使い勝手が向上する</li>
</ul>
<p>設定例</p>
<pre style="background-color:#2b303b;">
<code class="language-json" data-lang="json"><span style="color:#c0c5ce;">    &quot;</span><span style="color:#a3be8c;">Lua.runtime.version</span><span style="color:#c0c5ce;">&quot;: &quot;</span><span style="color:#a3be8c;">LuaJIT</span><span style="color:#c0c5ce;">&quot;,</span><span style="color:#c0c5ce;">
    &quot;</span><span style="color:#a3be8c;">Lua.workspace.preloadFileSize</span><span style="color:#c0c5ce;">&quot;: </span><span style="color:#d08770;">10000</span><span style="color:#c0c5ce;">,</span><span style="color:#c0c5ce;">
    &quot;</span><span style="color:#a3be8c;">Lua.runtime.path</span><span style="color:#c0c5ce;">&quot;: [</span><span style="color:#c0c5ce;">
        &quot;</span><span style="color:#a3be8c;">?.lua</span><span style="color:#c0c5ce;">&quot;,</span><span style="color:#c0c5ce;">
        &quot;</span><span style="color:#a3be8c;">?/init.lua</span><span style="color:#c0c5ce;">&quot;,</span><span style="color:#c0c5ce;">
        &quot;</span><span style="color:#a3be8c;">?/?.lua</span><span style="color:#c0c5ce;">&quot;,</span><span style="color:#c0c5ce;">
    ],</span><span style="color:#c0c5ce;">
</span></code></pre><h2 id="lua-lsp"><a href="https://github.com/Alloyed/lua-lsp">lua-lsp</a></h2>
<h1 id="debug-adapter">Debug adapter</h1>
<h2 id="local-lua-debugger-vscode"><a href="https://github.com/tomblind/local-lua-debugger-vscode">local-lua-debugger-vscode</a></h2>
<ul>
<li>Debugされるスクリプト側に仕込み不要</li>
<li>⭐ luajit 対応</li>
<li>__tostring でエラーが発生すると固まるので、__tostring の実装で例外が起きないように注意</li>
<li>起動時の引数に <code>\\</code> が含まれているとエラーになる =&gt; <code>0.2.2</code> で修正</li>
</ul>
<h2 id="lua-debug"><a href="https://github.com/actboy168/lua-debug">lua-debug</a></h2>
<ul>
<li>Debugされるスクリプト側に仕込み不要</li>
<li>hook が拡張してある。途中で止めたりとかできるぽい</li>
<li>残念ながら luajit では動作しない</li>
</ul>
<h1 id="formatter">Formatter</h1>
<h2 id="stylua"><a href="https://github.com/johnnymorganz/stylua">stylua</a></h2>
<ul>
<li>⭐ rust 製でインストールしやすい</li>
</ul>
<p>stylua.toml</p>
<pre style="background-color:#2b303b;">
<code class="language-toml" data-lang="toml"><span style="color:#bf616a;">column_width </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">120</span><span style="color:#c0c5ce;">
</span><span style="color:#bf616a;">line_endings </span><span style="color:#c0c5ce;">= &quot;</span><span style="color:#a3be8c;">Unix</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#c0c5ce;">
</span><span style="color:#bf616a;">indent_type </span><span style="color:#c0c5ce;">= &quot;</span><span style="color:#a3be8c;">Spaces</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#c0c5ce;">
</span><span style="color:#bf616a;">indent_width </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">4</span><span style="color:#c0c5ce;">
</span><span style="color:#bf616a;">quote_style </span><span style="color:#c0c5ce;">= &quot;</span><span style="color:#a3be8c;">AutoPreferDouble</span><span style="color:#c0c5ce;">&quot;</span><span style="color:#c0c5ce;">
</span><span style="color:#bf616a;">no_call_parentheses </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">true</span><span style="color:#c0c5ce;">
</span></code></pre><h1 id="c-api">C-API</h1>
<pre style="background-color:#2b303b;">
<code class="language-c" data-lang="c"><span style="color:#c0c5ce;"> </span><span style="color:#65737e;">// parse</span><span style="color:#65737e;">
 </span><span style="color:#bf616a;">luaL_loadstring</span><span style="color:#c0c5ce;">(L, script);</span><span style="color:#c0c5ce;">
 </span><span style="color:#65737e;">// run</span><span style="color:#65737e;">
 </span><span style="color:#bf616a;">lua_pcall</span><span style="color:#c0c5ce;">(L, </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, LUA_MULTRET, </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">);</span><span style="color:#c0c5ce;">
</span></code></pre>
<ul>
<li><a href="https://www.cnblogs.com/zxh1210603696/p/4479945.html">lua执行字节码的过程介绍</a></li>
<li><a href="http://airtrack.me/posts/2012/07/19/Lua%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%EF%BC%88%E4%B8%80%EF%BC%89/">Lua源码剖析（一）</a></li>
</ul>
<h1 id="sosudu-mi">ソース読み</h1>
<ul>
<li><a href="https://www.cs.tufts.edu/comp/250RTS/archive/roberto-ierusalimschy/lua-hopl-iii.pdf">The Evolution of Lua</a></li>
<li><a href="http://www.lua.org/doc/jucs05.pdf">The Implementation of Lua 5.0</a></li>
<li><a href="https://sites.google.com/site/aotokage52/home/lua/luasosu-dumimemo1">Luaソース読みメモ1</a></li>
<li><a href="https://blog.masu-mi.me/post/2013/08/31/practice_lua/">Luaソースコード読みはじめる</a></li>
<li><a href="https://hzkr.hatenablog.com/entries/1900/01/03">ひとり勉強会 LUA 目次</a></li>
<li><a href="https://the-ravi-programming-language.readthedocs.io/en/latest/lua-parser.html">https://the-ravi-programming-language.readthedocs.io/en/latest/lua-parser.html</a></li>
</ul>
<h2 id="luavm-opcode-operand">LuaVM, OpCode, Operand</h2>
<ul>
<li><a href="https://www.slideshare.net/Isoparametric/12-luavm">12 分くらいで知るLuaVM</a></li>
<li><a href="https://sites.google.com/site/safxdev/lua_codegen">Luaのコード生成</a></li>
</ul>

</div>

<nav class="toc">

<div class="toc_fix">
<ul>
    
        <li>
            <a href="https://ousttrue.github.io/posts/2021/lua-info/#interpreter">Interpreter</a>
            
                <ul>
                    
                        <li>
                            <a href="https://ousttrue.github.io/posts/2021/lua-info/#bian-warizhong">変わり種</a>
                        </li>
                    
                </ul>
            
        </li>
    
        <li>
            <a href="https://ousttrue.github.io/posts/2021/lua-info/#translator">Translator</a>
            
                <ul>
                    
                        <li>
                            <a href="https://ousttrue.github.io/posts/2021/lua-info/#moonscript">MoonScript</a>
                        </li>
                    
                        <li>
                            <a href="https://ousttrue.github.io/posts/2021/lua-info/#typescripttolua">TypescriptToLua</a>
                        </li>
                    
                        <li>
                            <a href="https://ousttrue.github.io/posts/2021/lua-info/#lunescript">LuneScript&#x2F;</a>
                        </li>
                    
                        <li>
                            <a href="https://ousttrue.github.io/posts/2021/lua-info/#teal">Teal</a>
                        </li>
                    
                </ul>
            
        </li>
    
        <li>
            <a href="https://ousttrue.github.io/posts/2021/lua-info/#language-server">Language server</a>
            
                <ul>
                    
                        <li>
                            <a href="https://ousttrue.github.io/posts/2021/lua-info/#emmylua">EmmyLua</a>
                        </li>
                    
                        <li>
                            <a href="https://ousttrue.github.io/posts/2021/lua-info/#lua-language-server">lua-language-server</a>
                        </li>
                    
                        <li>
                            <a href="https://ousttrue.github.io/posts/2021/lua-info/#lua-lsp">lua-lsp</a>
                        </li>
                    
                </ul>
            
        </li>
    
        <li>
            <a href="https://ousttrue.github.io/posts/2021/lua-info/#debug-adapter">Debug adapter</a>
            
                <ul>
                    
                        <li>
                            <a href="https://ousttrue.github.io/posts/2021/lua-info/#local-lua-debugger-vscode">local-lua-debugger-vscode</a>
                        </li>
                    
                        <li>
                            <a href="https://ousttrue.github.io/posts/2021/lua-info/#lua-debug">lua-debug</a>
                        </li>
                    
                </ul>
            
        </li>
    
        <li>
            <a href="https://ousttrue.github.io/posts/2021/lua-info/#formatter">Formatter</a>
            
                <ul>
                    
                        <li>
                            <a href="https://ousttrue.github.io/posts/2021/lua-info/#stylua">stylua</a>
                        </li>
                    
                </ul>
            
        </li>
    
        <li>
            <a href="https://ousttrue.github.io/posts/2021/lua-info/#c-api">C-API</a>
            
        </li>
    
        <li>
            <a href="https://ousttrue.github.io/posts/2021/lua-info/#sosudu-mi">ソース読み</a>
            
                <ul>
                    
                        <li>
                            <a href="https://ousttrue.github.io/posts/2021/lua-info/#luavm-opcode-operand">LuaVM, OpCode, Operand</a>
                        </li>
                    
                </ul>
            
        </li>
    
</ul>
</div>


</nav>
</div>
</main>

    <footer class="footer">Powered by <a href="https://www.getzola.org/">Zola</a> <a href="https://github.com/ousttrue/zola/tree/custom">custom</a></footer>

  </body>
</html>
