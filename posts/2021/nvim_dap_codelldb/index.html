<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="generator" content="Nikola (getnikola.com)">
<meta name="viewport" content="width=device-width">
<script src="../../../assets/js/all-nocdn.js"></script><title>nvim-dap ã§ coldelldb å‹•ã„ãŸ | ä¸‰æ¬¡å…ƒæ—¥èªŒ</title>
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
</head>
<body>
    <h1 id="brand">
        <a href="../../../" title="ä¸‰æ¬¡å…ƒæ—¥èªŒ" rel="home">
            <span id="blog-title">ä¸‰æ¬¡å…ƒæ—¥èªŒ</span>
        </a>
    </h1>

    <nav id="menu"><ul>
<li><a href="../../../archive.html">Archives</a></li>
<li><a href="../../../categories/index.html">Tags</a></li>
<li><a href="../../../rss.xml">RSS feed</a></li>
<li><a href="../../../about">About</a></li>
<li><a href="../../../books">MemoBooks</a></li>

            
            
            
        </ul></nav><hr>
<main id="content"><h1 class="p-name entry-title" itemprop="headline name">
    <h1 class="p-name entry-title" itemprop="headline name">
    <a href="." class="u-url">nvim-dap ã§ coldelldb å‹•ã„ãŸ
    </a>
</h1>
<ul itemprop="keywords" class="tags">
<li>
        <time datetime="2021-06-27T00:00:00+09:00" title="2021-06-27">2021-06-27</time>
</li>
    <li><a class="tag p-category" href="../../../categories/dap/" rel="tag">dap</a></li>
    <li><a class="tag p-category" href="../../../categories/nvim/" rel="tag">nvim</a></li>
</ul>
</h1>

<div>
<p><a href="https://github.com/mfussenegger/nvim-dap">nvim-dap</a> ã§ rust ã‚’ãƒ‡ãƒãƒƒã‚°ã™ã‚‹ã¹ãæ‚ªæˆ¦è‹¦é—˜ä¸­ã€‚
nvim-dap ã¨ã„ã†ã®ã¯ã€æ¥ãŸã‚‹ nvim-0.5 ã§å‹•ãã‚ˆã†ã«ãªã‚‹ã€ <code>vscode</code> ã®ãƒ‡ãƒãƒƒã‚°ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã‚’å‹•ä½œã•ã›ã‚‹æ©Ÿèƒ½ã€‚</p>
<p>rust(Windows) ã¯ native debugger ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚Œã°ã„ã„ã®ã§ã€ã„ãã¤ã‹é¸æŠè‚¢ãŒã‚ã£ã¦</p>
<ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools">https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=lanza.lldb-vscode">https://marketplace.visualstudio.com/items?itemName=lanza.lldb-vscode</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb">https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb</a></li>
</ul>
<p>æœ€å¾Œã®ã€<code>vscode-lldb(codelldb)</code> <a href="https://github.com/vadimcn/vscode-lldb">https://github.com/vadimcn/vscode-lldb</a> ãŒä½¿ã„ãŸã„ã€‚</p>
<h3>codelldb ã®èµ·å‹•</h3>
<p>nvim-dap ã‹ã‚‰ <code>codelldb.exe</code> ãƒ—ãƒ­ã‚»ã‚¹ã¯èµ·å‹•ã—ã¦ã„ã‚‹æ§˜å­ã€‚é€šä¿¡ãŒã†ã¾ãã„ã£ã¦ãªã„ã‚ˆã†ã«è¦‹ãˆã‚‹ã€‚</p>
<pre class="code literal-block"><span></span>&gt; .\.cache\dein\repos\github.com\puremourning\vimspector\gadgets\windows\CodeLLDB\adapter\codelldb.exe
Listening on port 55201
</pre>

<p>æ¨™æº–å…¥å‡ºåŠ›ã‚’ä½¿ã†ãƒ¢ãƒ¼ãƒ‰ã«ãªã£ã¦ã„ãªã„ã®ã§ã¯ï¼Ÿ</p>
<p><code>adapter/src/lib.rs</code></p>
<pre class="code literal-block"><span></span><span class="n">async</span><span class="w"> </span><span class="k">fn</span> <span class="nf">run_debug_server</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">addr</span>: <span class="nc">net</span>::<span class="n">SocketAddr</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">adapter_settings</span>: <span class="nc">debug_protocol</span>::<span class="n">AdapterSettings</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">multi_session</span>: <span class="kt">bool</span><span class="p">,</span><span class="w"></span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">listener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TcpListener</span>::<span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">addr</span><span class="p">).</span><span class="n">await</span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">"Listening on port {}"</span><span class="p">,</span><span class="w"> </span><span class="n">listener</span><span class="p">.</span><span class="n">local_addr</span><span class="p">().</span><span class="n">unwrap</span><span class="p">().</span><span class="n">port</span><span class="p">());</span><span class="w"></span>
</pre>

<p>é¡ã‚‹ã€‚ <code>main -&gt; debug_server -&gt; entry -&gt; run_debug_server</code></p>
<pre class="code literal-block"><span></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">env_logger</span>::<span class="n">Builder</span>::<span class="n">from_default_env</span><span class="p">().</span><span class="n">init</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">matches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">App</span>::<span class="n">new</span><span class="p">(</span><span class="s">"codelldb"</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="n">Arg</span>::<span class="n">with_name</span><span class="p">(</span><span class="s">"port"</span><span class="p">).</span><span class="n">long</span><span class="p">(</span><span class="s">"port"</span><span class="p">).</span><span class="n">takes_value</span><span class="p">(</span><span class="kc">true</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="n">Arg</span>::<span class="n">with_name</span><span class="p">(</span><span class="s">"multi-session"</span><span class="p">).</span><span class="n">long</span><span class="p">(</span><span class="s">"multi-session"</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="n">Arg</span>::<span class="n">with_name</span><span class="p">(</span><span class="s">"preload"</span><span class="p">).</span><span class="n">long</span><span class="p">(</span><span class="s">"preload"</span><span class="p">).</span><span class="n">multiple</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="n">takes_value</span><span class="p">(</span><span class="kc">true</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="n">Arg</span>::<span class="n">with_name</span><span class="p">(</span><span class="s">"liblldb"</span><span class="p">).</span><span class="n">long</span><span class="p">(</span><span class="s">"liblldb"</span><span class="p">).</span><span class="n">takes_value</span><span class="p">(</span><span class="kc">true</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="n">Arg</span>::<span class="n">with_name</span><span class="p">(</span><span class="s">"params"</span><span class="p">).</span><span class="n">long</span><span class="p">(</span><span class="s">"params"</span><span class="p">).</span><span class="n">takes_value</span><span class="p">(</span><span class="kc">true</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">subcommand</span><span class="p">(</span><span class="n">SubCommand</span>::<span class="n">with_name</span><span class="p">(</span><span class="s">"terminal-agent"</span><span class="p">).</span><span class="n">arg</span><span class="p">(</span><span class="n">Arg</span>::<span class="n">with_name</span><span class="p">(</span><span class="s">"port"</span><span class="p">).</span><span class="n">long</span><span class="p">(</span><span class="s">"port"</span><span class="p">).</span><span class="n">takes_value</span><span class="p">(</span><span class="kc">true</span><span class="p">)))</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">get_matches</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matches</span><span class="p">.</span><span class="n">subcommand_matches</span><span class="p">(</span><span class="s">"terminal-agent"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">terminal_agent</span>::<span class="n">terminal_agent</span><span class="p">(</span><span class="o">&amp;</span><span class="n">matches</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">debug_server</span><span class="p">(</span><span class="o">&amp;</span><span class="n">matches</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre>

<p>ã©ã†ã‚„ã‚‰ã€ <code>executable</code> ã‹ã¤ <code>stdio ã§ã¯ãªã tcp</code> é€šä¿¡ã¨ã„ã†ã‚¿ã‚¤ãƒ—ã§ nvim-dap ã§ã¯æœªå¯¾å¿œã¨ã„ã†ã“ã¨ã§ã‚ˆã•ãã†ã€‚ï¼Ÿ</p>
<ul>
<li>èµ·å‹•</li>
<li>
<code>Listening on port XXXXX</code> ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰ port ã‚’å¾—ã‚‹</li>
<li>ãã®ãƒãƒ¼ãƒˆã«å¯¾ã—ã¦ TCP æ¥ç¶šã¨ã„ã†æ‰‹é †ãŒå¿…è¦</li>
</ul>
<p><a href="https://code.visualstudio.com/api/extension-guides/debugger-extension#alternative-approach-to-develop-a-debugger-extension">https://code.visualstudio.com/api/extension-guides/debugger-extension#alternative-approach-to-develop-a-debugger-extension</a></p>
<p>ã® <code>DebugAdapterServer</code> ã‚¿ã‚¤ãƒ—ã«ã‚ãŸã‚‹ã€‚</p>
<h3>nvim-dap ã®æ”¹é€ ã‚’è©¦ã¿ã‚‹</h3>
<p>adapter.type <code>executable</code>, <code>server</code> ã«åŠ ãˆã¦ã€ç¬¬3ã® <code>executable_server</code> ã‚’ä½œã‚Œã‚‹ã‹ã€‚</p>
<pre class="code literal-block"><span></span><span class="kd">local</span> <span class="kr">function</span> <span class="nf">run_adapter</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">configuration</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">configuration</span><span class="p">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">'[no name]'</span>
  <span class="kd">local</span> <span class="n">options</span> <span class="o">=</span> <span class="n">adapter</span><span class="p">.</span><span class="n">options</span> <span class="ow">or</span> <span class="p">{}</span>
  <span class="n">opts</span> <span class="o">=</span> <span class="n">vim</span><span class="p">.</span><span class="n">tbl_extend</span><span class="p">(</span><span class="s1">'keep'</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="p">{</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="n">cwd</span><span class="p">,</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="n">env</span>
  <span class="p">})</span>
  <span class="kr">if</span> <span class="n">adapter</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">'executable'</span> <span class="kr">then</span>
    <span class="n">lazy</span><span class="p">.</span><span class="n">progress</span><span class="p">.</span><span class="n">report</span><span class="p">(</span><span class="s1">'Running: '</span> <span class="o">..</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">M</span><span class="p">.</span><span class="n">launch</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">configuration</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
  <span class="kr">elseif</span> <span class="n">adapter</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">'server'</span> <span class="kr">then</span>
    <span class="n">lazy</span><span class="p">.</span><span class="n">progress</span><span class="p">.</span><span class="n">report</span><span class="p">(</span><span class="s1">'Running: '</span> <span class="o">..</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">M</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">adapter</span><span class="p">.</span><span class="n">host</span><span class="p">,</span> <span class="n">adapter</span><span class="p">.</span><span class="n">port</span><span class="p">,</span> <span class="n">configuration</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
  <span class="kr">elseif</span> <span class="n">adapter</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">'executable_server'</span> <span class="kr">then</span> <span class="c1">-- ğŸ‘ˆã“ã‚Œã‚’è¿½åŠ ã—ãŸ</span>
    <span class="n">lazy</span><span class="p">.</span><span class="n">progress</span><span class="p">.</span><span class="n">report</span><span class="p">(</span><span class="s1">'Running: '</span> <span class="o">..</span> <span class="n">name</span><span class="p">)</span>
    <span class="c1">-- local session = M.launch(adapter, configuration, opts)</span>
    <span class="kd">local</span> <span class="n">stdin</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">executable_server</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
    <span class="c1">-- `Error executing luv callback: vimL function must not be called in a lua loop callback`</span>
    <span class="n">vim</span><span class="p">.</span><span class="n">loop</span><span class="p">.</span><span class="n">read_start</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="n">vim</span><span class="p">.</span><span class="n">schedule_wrap</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
      <span class="c1">-- codelldb ã®å‡ºåŠ›ã‹ã‚‰ port ã‚’å¾—ã‚‹</span>
      <span class="c1">-- Lisening on port xxxxx</span>
      <span class="kd">local</span> <span class="n">port</span> <span class="o">=</span> <span class="nb">string.match</span><span class="p">(</span><span class="n">data</span> <span class="p">,</span> <span class="s2">"Listening on port (%d+)"</span> <span class="p">)</span>
      <span class="n">M</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="kc">nil</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">configuration</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">))</span>
  <span class="kr">else</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s1">'Invalid adapter type %s, expected `executable` or `server`'</span><span class="p">,</span> <span class="n">adapter</span><span class="p">.</span><span class="n">type</span><span class="p">))</span>
  <span class="kr">end</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">executable_server</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">vim</span><span class="p">.</span><span class="n">loop</span>
  <span class="kd">local</span> <span class="n">stdin</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">new_pipe</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">stdout</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">new_pipe</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">new_pipe</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">handle</span>
  <span class="kd">local</span> <span class="kr">function</span> <span class="nf">onexit</span><span class="p">()</span>
    <span class="n">stdin</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>
    <span class="n">stdout</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>
    <span class="n">stderr</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>
    <span class="n">handle</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>
  <span class="kr">end</span>
  <span class="kd">local</span> <span class="n">options</span> <span class="o">=</span> <span class="n">adapter</span><span class="p">.</span><span class="n">options</span> <span class="ow">or</span> <span class="p">{}</span>
  <span class="kd">local</span> <span class="n">pid_or_err</span>
  <span class="n">handle</span><span class="p">,</span> <span class="n">pid_or_err</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">spawn</span><span class="p">(</span><span class="n">adapter</span><span class="p">.</span><span class="n">command</span><span class="p">,</span> <span class="p">{</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">adapter</span><span class="p">.</span><span class="n">args</span><span class="p">;</span>
    <span class="n">stdio</span> <span class="o">=</span> <span class="p">{</span><span class="n">stdin</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">};</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="n">cwd</span><span class="p">;</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="n">env</span><span class="p">;</span>
    <span class="n">detached</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">},</span> <span class="n">onexit</span><span class="p">)</span>
  <span class="nb">assert</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s1">'Error running '</span> <span class="o">..</span> <span class="n">adapter</span><span class="p">.</span><span class="n">command</span> <span class="o">..</span> <span class="s1">': '</span> <span class="o">..</span> <span class="n">pid_or_err</span><span class="p">)</span>

  <span class="kr">return</span> <span class="n">stdin</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">attach</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
  <span class="kr">if</span> <span class="n">session</span> <span class="kr">then</span>
    <span class="n">session</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>
  <span class="kr">end</span>
  <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">request</span> <span class="kr">then</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'config needs the `request` property which must be one of `attach` or `launch`'</span><span class="p">)</span>
    <span class="kr">return</span>
  <span class="kr">end</span>
  <span class="c1">-- initialize ãŒæ—©ã™ãã‚‹ã®ã§ config ã‚’ connect å¼•æ•°ã«</span>
  <span class="n">session</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">'dap.session'</span><span class="p">):</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
  <span class="kr">return</span> <span class="n">session</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nc">Session</span><span class="p">:</span><span class="nf">connect</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">session</span> <span class="o">=</span> <span class="n">session_defaults</span><span class="p">(</span><span class="n">opts</span> <span class="ow">or</span> <span class="p">{})</span>
  <span class="nb">setmetatable</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">self</span><span class="p">)</span>
  <span class="n">self</span><span class="p">.</span><span class="n">__index</span> <span class="o">=</span> <span class="n">self</span>

  <span class="kd">local</span> <span class="n">client</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">new_tcp</span><span class="p">()</span>
  <span class="n">session</span><span class="p">.</span><span class="n">client</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">write</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> 
        <span class="n">client</span><span class="p">:</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> 
    <span class="kr">end</span><span class="p">;</span>
    <span class="n">close</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>
      <span class="n">client</span><span class="p">:</span><span class="n">shutdown</span><span class="p">()</span>
      <span class="n">client</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>
    <span class="kr">end</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">client</span><span class="p">:</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span> <span class="ow">or</span> <span class="s1">'127.0.0.1'</span><span class="p">,</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">port</span><span class="p">),</span> <span class="kr">function</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="kr">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="kr">then</span> <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="kr">end</span>
    <span class="n">client</span><span class="p">:</span><span class="n">read_start</span><span class="p">(</span><span class="n">rpc</span><span class="p">.</span><span class="n">create_read_loop</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
      <span class="n">session</span><span class="p">:</span><span class="n">handle_body</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">))</span>

    <span class="c1">-- connect ãŒæˆç«‹ã—ã¦ã‹ã‚‰ initialize ã‚’é€ã‚‹</span>
    <span class="n">session</span><span class="p">:</span><span class="n">initialize</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

  <span class="kr">end</span><span class="p">)</span>
  <span class="kr">return</span> <span class="n">session</span>
<span class="kr">end</span>
</pre>

<p>å‹•ã„ãŸã€‚ PR ä½œã‚ã†ã€‚</p>
</div>

<hr>
<ul class="pager hidden-print">
<li class="previous">
        <a href="../../../github/vim_memo/" rel="prev" title="vim_memo">
            vim_memo ğŸ‘ˆ
        </a>
    </li>
    <li style="flex-grow: 1">
    <li class="next">
        <a href="../../../github/my_nvim/" rel="next" title="my_nvim">
            ğŸ‘‰ my_nvim
        </a>
    </li>
</ul></main><footer id="footer"><p>
            Powered by
            <a href="https://getnikola.com" rel="nofollow">Nikola</a>
        </p>
    </footer>
</body>
</html>
