<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>WebPackやってみる | 三次元日誌</title>
<link href="../../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="ja" href="../../../../../rss.xml">
<link rel="canonical" href="https://ousttrue.github.io/posts/2016/01/23/webpack/">
<!--[if lt IE 9]><script src="../../../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="ousttrue">
<link rel="prev" href="../../12/unity_toon/" title="UnityでToon" type="text/html">
<link rel="next" href="../../27/unity_serializedobject/" title="UnityのSerializedObject" type="text/html">
<meta property="og:site_name" content="三次元日誌">
<meta property="og:title" content="WebPackやってみる">
<meta property="og:url" content="https://ousttrue.github.io/posts/2016/01/23/webpack/">
<meta property="og:description" content="gulpだけでいっぱいいっぱいだったので敬遠していたwebpackをやってみる。
ことはじめ
http://webpack.github.io/docs/
http://webpack.github.io/docs/tutorials/getting-started/
webpackをインストールして

npm install webpack -g

サンプルファイルを用意して
entry.js
">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2016-01-23T00:00:00+09:00">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">本文を読み飛ばす</a>

<!-- Header and menu bar -->
<div class="container">
      <header class="blog-header py-3"><div class="row nbb-header align-items-center">
          <div class="col-md-3 col-xs-2 col-sm-2" style="width: auto;">
            <button class="navbar-toggler navbar-light bg-light nbb-navbar-toggler" type="button" data-toggle="collapse" data-target=".bs-nav-collapsible" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse bs-nav-collapsible bootblog4-search-form-holder">
                
            </div>
        </div>
          <div class="col-md-6 col-xs-10 col-sm-10 bootblog4-brand" style="width: auto;">
            <a class="navbar-brand blog-header-logo text-dark" href="../../../../../">

            <span id="blog-title">三次元日誌</span>
        </a>
          </div>
            <div class="col-md-3 justify-content-end align-items-center bs-nav-collapsible collapse flex-collapse bootblog4-right-nav">
            <nav class="navbar navbar-light bg-white"><ul class="navbar-nav bootblog4-right-nav">
<li class="nav-item">
    <a href="index.md" id="sourcelink" class="nav-link">ソース</a>
    </li>


                    
            </ul></nav>
</div>
    </div>
</header><nav class="navbar navbar-expand-md navbar-light bg-white static-top"><div class="collapse navbar-collapse bs-nav-collapsible" id="bs-navbar">
            <ul class="navbar-nav nav-fill d-flex w-100">
<li class="nav-item">
<a href="../../../../../books" class="nav-link">MemoBooks</a>
                </li>
<li class="nav-item">
<a href="../../../../../archive.html" class="nav-link">Archives</a>
                </li>
<li class="nav-item">
<a href="../../../../../categories/index.html" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../../../../rss.xml" class="nav-link">RSS feed</a>
                </li>
<li class="nav-item">
<a href="../../../../../about" class="nav-link">About</a>

                
            </li>
</ul>
</div>
<!-- /.navbar-collapse -->
</nav>
</div>

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">WebPackやってみる</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    ousttrue
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2016-01-23T00:00:00+09:00" itemprop="datePublished" title="2016-01-23 00:00">2016-01-23 00:00</time></a>
            </p>
            
        <p class="sourceline"><a href="index.md" class="sourcelink">ソース</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>gulpだけでいっぱいいっぱいだったので敬遠していたwebpackをやってみる。</p>
<h2>ことはじめ</h2>
<p>http://webpack.github.io/docs/</p>
<p>http://webpack.github.io/docs/tutorials/getting-started/</p>
<p>webpackをインストールして</p>
<blockquote>
<p>npm install webpack -g</p>
</blockquote>
<p>サンプルファイルを用意して
entry.js
document.write("It works.");</p>
<p>webpack実行。</p>
<blockquote>
<p>webpack ./entry.js bundle.js
Hash: ca188ee5789bb780fcec
Version: webpack 1.12.12
Time: 52ms
    Asset     Size  Chunks             Chunk Names
bundle.js  1.42 kB       0  [emitted]  main
   [0] ./entry.js 28 bytes {0} [built]</p>
</blockquote>
<p>entry.jsを入力し、bundle.jsが出力される。
bundle.js
/<strong><em>*</em>*/ (function(modules) { // webpackBootstrap
/</strong><strong><em>*/    // The module cache
/</em></strong>***/    var installedModules = {};</p>
<p>/<strong><em>*</em>*/    // The require function
/</strong>****/    function <strong>webpack_require</strong>(moduleId) {</p>
<p>/<strong><em>*</em>*/        // Check if module is in cache
/</strong><strong><em>*/        if(installedModules[moduleId])
/</em></strong>***/            return installedModules[moduleId].exports;</p>
<p>/<strong><em>*</em>*/        // Create a new module (and put it into the cache)
/</strong><strong><em>*/        var module = installedModules[moduleId] = {
/</em></strong><strong><em>/            exports: {},
/</em></strong><strong><em>/            id: moduleId,
/</em></strong><strong><em>/            loaded: false
/</em></strong>***/        };</p>
<p>/<strong><em>*</em>*/        // Execute the module function
/</strong>****/        modules[moduleId].call(module.exports, module, module.exports, <strong>webpack_require</strong>);</p>
<p>/<strong><em>*</em>*/        // Flag the module as loaded
/</strong>****/        module.loaded = true;</p>
<p>/<strong><em>*</em>*/        // Return the exports of the module
/</strong><strong><em>*/        return module.exports;
/</em></strong>***/    }</p>
<p>/<strong><em>*</em>*/    // expose the modules object (<strong>webpack_modules</strong>)
/</strong>****/    <strong>webpack_require</strong>.m = modules;</p>
<p>/<strong><em>*</em>*/    // expose the module cache
/</strong>****/    <strong>webpack_require</strong>.c = installedModules;</p>
<p>/<strong><em>*</em>*/    // <strong>webpack_public_path</strong>
/</strong>****/    <strong>webpack_require</strong>.p = "";</p>
<p>/<strong><em>*</em>*/    // Load entry module and return exports
/</strong><strong><em>*/    return <strong>webpack_require</strong>(0);
/</em></strong><strong><em>/ })
/</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em>*/
/</strong><strong><em>*/ ([
/</em> 0 */
/</strong>*/ function(module, exports) {</p>
<pre class="code literal-block"><span></span>document.write("It works.");
</pre>

<p>/<strong><em>/ }
/</em></strong>***/ ]);</p>
<p>ユーティリティと合体したコードが出力された。
使う方は、bundle.jsをscriptタグで読み込むと。</p>
<script type="text/javascript" src="bundle.js" charset="utf-8"></script><p>複数ファイルのマージとrequire
複数ファイルの参照にrequire関数が導入される。
module.exports = "It works from content.js.";</p>
<p>document.write(require("./content.js"));</p>
<p>webpackする。</p>
<blockquote>
<p>webpack ./entry.js bundle.js
Hash: 71eea1fe067e73397ebe
Version: webpack 1.12.12
Time: 64ms
    Asset     Size  Chunks             Chunk Names
bundle.js  1.55 kB       0  [emitted]  main
   [0] ./entry.js 40 bytes {0} [built]
   [1] ./content.js 45 bytes {0} [built]</p>
</blockquote>
<p>bundle.jsが出力される。
bundle.jsの概要
(function(modules) { // webpackBootstrap</p>
<p>// 省略</p>
<pre class="code literal-block"><span></span>// Load entry module and return exports
return __webpack_require__(0);
</pre>

<p>})
/<strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><em><em>/
( /</em> 無名関数を即実行 </em>/
[
/<em> 0 </em>/
function(module, exports, <strong>webpack_require</strong>) {</p>
<pre class="code literal-block"><span></span>document.write(__webpack_require__(1));
</pre>

<p>},
/<em> 1 </em>/
function(module, exports) {</p>
<pre class="code literal-block"><span></span>// content.jsはここに
module.exports = "It works from content.js.";
</pre>

<p>}
]);</p>
<p>なるほど。自身がmodule[0]になって、requireされたファイルがmodule[1]になるのか。
css対応
WebPackは素ではjavascriptしか対応していない。cssに対応するためにloaderを導入する。</p>
<blockquote>
<p>npm install css-loader style-loader</p>
</blockquote>
<p>cssを追加して、
style.css
body {
    background: yellow;
}</p>
<p>requireする。
loader経由でrequireするには、特殊な記法を用いるらしい。
entry.js
require("!style!css!./style.css");
document.write(require("./content.js"));</p>
<p>webpack実行</p>
<blockquote>
<p>webpack ./entry.js bundle.js
Hash: c8494a414a3a1d5c8c29
Version: webpack 1.12.12
Time: 716ms
    Asset     Size  Chunks             Chunk Names
bundle.js  11.8 kB       0  [emitted]  main
   [0] ./entry.js 76 bytes {0} [built]
   [5] ./content.js 45 bytes {0} [built]
    + 4 hidden modules</p>
</blockquote>
<p>6つモジュールができたと書いてあります。
確かに、最初の無名関数への引数が6要素の配列になっている。
modules[2]にさっきのcssがjavascript化されて入っている。
/<strong><em>/ },
/</em> 2 */
/</strong>*/ function(module, exports, <strong>webpack_require</strong>) {</p>
<pre class="code literal-block"><span></span><span class="nt">exports</span> <span class="o">=</span> <span class="nt">module</span><span class="p">.</span><span class="nc">exports</span> <span class="o">=</span> <span class="nt">__webpack_require__</span><span class="o">(</span><span class="nt">3</span><span class="o">)();</span>
<span class="o">//</span> <span class="nt">imports</span>


<span class="o">//</span> <span class="nt">module</span>
<span class="nt">exports</span><span class="p">.</span><span class="nc">push</span><span class="o">(</span><span class="cp">[</span><span class="nx">module.id</span><span class="p">,</span> <span class="s2">"body {</span><span class="se">\r\n</span><span class="s2">    background: yellow;</span><span class="se">\r\n</span><span class="s2">}"</span><span class="p">,</span> <span class="s2">""</span><span class="cp">]</span><span class="o">);</span>

<span class="o">//</span> <span class="nt">exports</span>
</pre>

<p>/***/ },</p>
<p>webpackは何もかもをjavascript化してrequireするシステムなのか！？
configfile
コマンドライン引数を設定に移動。
webpack.config.js
module.exports = {
    entry: "./entry.js",
    output: {
        path: __dirname,
        filename: "bundle.js"
    },
    module: {
        loaders: [
            { test: /.css$/, loader: "style!css" }
        ]
    }
};</p>
<p>引数無しで実行できる。</p>
<blockquote>
<p>webpack
Hash: 1141db5208a3ce352fb6
Version: webpack 1.12.12
Time: 669ms
    Asset     Size  Chunks             Chunk Names
bundle.js  11.8 kB       0  [emitted]  main
   [0] ./entry.js 67 bytes {0} [built]
   [5] ./content.js 45 bytes {0} [built]
    + 4 hidden modules</p>
</blockquote>
<p>Watchモードとか開発サーバーもあるで
watchモード。</p>
<blockquote>
<p>webpack --progress --colors --watch</p>
</blockquote>
<p>dev-serverをインストール。</p>
<blockquote>
<p>npm install webpack-dev-server -g</p>
<p>webpack-dev-server --progress --colors</p>
</blockquote>
<p>http://localhost:8080 で静的なコンパイル結果を表示
http://localhost:8080/webpack-dev-server/bundle で自動リロード付き</p>
<p>gulpでがんばってwatchからbrowser-syncを構築していたのをさくっとできるね。
これはよさげ。
機能的にはブラウザ側(いわゆるフロントエンド)に特化しているぽいな。
サーバーサイドとの連携方法を探る必要がある。
browsery-syncとnodemonの連携みたいにproxyを駆使するのか。
参考</p>
<p>webpack で Node サーバー用のコードを bundle する
https://webpack.github.io/docs/webpack-dev-server.html#proxy
http://stackoverflow.com/questions/26203725/how-to-allow-for-webpack-dev-server-to-allow-entry-points-from-react-router</p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../../12/unity_toon/" rel="prev" title="UnityでToon">一つ前の記事</a>
            </li>
            <li class="next">
                <a href="../../27/unity_serializedobject/" rel="next" title="UnityのSerializedObject">次の記事</a>
            </li>
        </ul></nav></aside></article><!--End of body content--><footer id="footer">
            Contents © 2021         <a href="mailto:ousttrue@gmail.com">ousttrue</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
            
        </footer>
</div>
</div>


        <script src="../../../../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
