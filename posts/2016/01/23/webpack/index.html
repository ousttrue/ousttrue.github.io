<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="generator" content="Nikola (getnikola.com)">
<meta name="viewport" content="width=device-width">
<script src="../../../../../assets/js/all-nocdn.js"></script><title>WebPackやってみる | 三次元日誌</title>
<link href="../../../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
</head>
<body>
    <h1 id="brand">
        <a href="../../../../../" title="三次元日誌" rel="home">
            <span id="blog-title">三次元日誌</span>
        </a>
    </h1>

    <nav id="menu"><ul>
<li><a href="../../../../../archive.html">Archives</a></li>
<li><a href="../../../../../categories/index.html">Tags</a></li>
<li><a href="../../../../../rss.xml">RSS feed</a></li>
<li><a href="../../../../../about">About</a></li>
<li><a href="../../../../../books">MemoBooks</a></li>

            
            
            
        </ul></nav><hr>
<main id="content"><h1 class="p-name entry-title" itemprop="headline name">
    <a href="." class="u-url">WebPackやってみる</a>
</h1>
<div>
<p>gulpだけでいっぱいいっぱいだったので敬遠していたwebpackをやってみる。</p>
<h2>ことはじめ</h2>
<p>http://webpack.github.io/docs/</p>
<p>http://webpack.github.io/docs/tutorials/getting-started/</p>
<p>webpackをインストールして</p>
<blockquote>
<p>npm install webpack -g</p>
</blockquote>
<p>サンプルファイルを用意して
entry.js
document.write("It works.");</p>
<p>webpack実行。</p>
<blockquote>
<p>webpack ./entry.js bundle.js
Hash: ca188ee5789bb780fcec
Version: webpack 1.12.12
Time: 52ms
    Asset     Size  Chunks             Chunk Names
bundle.js  1.42 kB       0  [emitted]  main
   [0] ./entry.js 28 bytes {0} [built]</p>
</blockquote>
<p>entry.jsを入力し、bundle.jsが出力される。
bundle.js
/<strong><em>*</em>*/ (function(modules) { // webpackBootstrap
/</strong><strong><em>*/    // The module cache
/</em></strong>***/    var installedModules = {};</p>
<p>/<strong><em>*</em>*/    // The require function
/</strong>****/    function <strong>webpack_require</strong>(moduleId) {</p>
<p>/<strong><em>*</em>*/        // Check if module is in cache
/</strong><strong><em>*/        if(installedModules[moduleId])
/</em></strong>***/            return installedModules[moduleId].exports;</p>
<p>/<strong><em>*</em>*/        // Create a new module (and put it into the cache)
/</strong><strong><em>*/        var module = installedModules[moduleId] = {
/</em></strong><strong><em>/            exports: {},
/</em></strong><strong><em>/            id: moduleId,
/</em></strong><strong><em>/            loaded: false
/</em></strong>***/        };</p>
<p>/<strong><em>*</em>*/        // Execute the module function
/</strong>****/        modules[moduleId].call(module.exports, module, module.exports, <strong>webpack_require</strong>);</p>
<p>/<strong><em>*</em>*/        // Flag the module as loaded
/</strong>****/        module.loaded = true;</p>
<p>/<strong><em>*</em>*/        // Return the exports of the module
/</strong><strong><em>*/        return module.exports;
/</em></strong>***/    }</p>
<p>/<strong><em>*</em>*/    // expose the modules object (<strong>webpack_modules</strong>)
/</strong>****/    <strong>webpack_require</strong>.m = modules;</p>
<p>/<strong><em>*</em>*/    // expose the module cache
/</strong>****/    <strong>webpack_require</strong>.c = installedModules;</p>
<p>/<strong><em>*</em>*/    // <strong>webpack_public_path</strong>
/</strong>****/    <strong>webpack_require</strong>.p = "";</p>
<p>/<strong><em>*</em>*/    // Load entry module and return exports
/</strong><strong><em>*/    return <strong>webpack_require</strong>(0);
/</em></strong><strong><em>/ })
/</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em>*/
/</strong><strong><em>*/ ([
/</em> 0 */
/</strong>*/ function(module, exports) {</p>
<pre class="code literal-block"><span></span>document.write("It works.");
</pre>

<p>/<strong><em>/ }
/</em></strong>***/ ]);</p>
<p>ユーティリティと合体したコードが出力された。
使う方は、bundle.jsをscriptタグで読み込むと。</p>
<script type="text/javascript" src="bundle.js" charset="utf-8"></script><p>複数ファイルのマージとrequire
複数ファイルの参照にrequire関数が導入される。
module.exports = "It works from content.js.";</p>
<p>document.write(require("./content.js"));</p>
<p>webpackする。</p>
<blockquote>
<p>webpack ./entry.js bundle.js
Hash: 71eea1fe067e73397ebe
Version: webpack 1.12.12
Time: 64ms
    Asset     Size  Chunks             Chunk Names
bundle.js  1.55 kB       0  [emitted]  main
   [0] ./entry.js 40 bytes {0} [built]
   [1] ./content.js 45 bytes {0} [built]</p>
</blockquote>
<p>bundle.jsが出力される。
bundle.jsの概要
(function(modules) { // webpackBootstrap</p>
<p>// 省略</p>
<pre class="code literal-block"><span></span>// Load entry module and return exports
return __webpack_require__(0);
</pre>

<p>})
/<strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><em><em>/
( /</em> 無名関数を即実行 </em>/
[
/<em> 0 </em>/
function(module, exports, <strong>webpack_require</strong>) {</p>
<pre class="code literal-block"><span></span>document.write(__webpack_require__(1));
</pre>

<p>},
/<em> 1 </em>/
function(module, exports) {</p>
<pre class="code literal-block"><span></span>// content.jsはここに
module.exports = "It works from content.js.";
</pre>

<p>}
]);</p>
<p>なるほど。自身がmodule[0]になって、requireされたファイルがmodule[1]になるのか。
css対応
WebPackは素ではjavascriptしか対応していない。cssに対応するためにloaderを導入する。</p>
<blockquote>
<p>npm install css-loader style-loader</p>
</blockquote>
<p>cssを追加して、
style.css
body {
    background: yellow;
}</p>
<p>requireする。
loader経由でrequireするには、特殊な記法を用いるらしい。
entry.js
require("!style!css!./style.css");
document.write(require("./content.js"));</p>
<p>webpack実行</p>
<blockquote>
<p>webpack ./entry.js bundle.js
Hash: c8494a414a3a1d5c8c29
Version: webpack 1.12.12
Time: 716ms
    Asset     Size  Chunks             Chunk Names
bundle.js  11.8 kB       0  [emitted]  main
   [0] ./entry.js 76 bytes {0} [built]
   [5] ./content.js 45 bytes {0} [built]
    + 4 hidden modules</p>
</blockquote>
<p>6つモジュールができたと書いてあります。
確かに、最初の無名関数への引数が6要素の配列になっている。
modules[2]にさっきのcssがjavascript化されて入っている。
/<strong><em>/ },
/</em> 2 */
/</strong>*/ function(module, exports, <strong>webpack_require</strong>) {</p>
<pre class="code literal-block"><span></span><span class="nt">exports</span> <span class="o">=</span> <span class="nt">module</span><span class="p">.</span><span class="nc">exports</span> <span class="o">=</span> <span class="nt">__webpack_require__</span><span class="o">(</span><span class="nt">3</span><span class="o">)();</span>
<span class="o">//</span> <span class="nt">imports</span>


<span class="o">//</span> <span class="nt">module</span>
<span class="nt">exports</span><span class="p">.</span><span class="nc">push</span><span class="o">(</span><span class="cp">[</span><span class="nx">module.id</span><span class="p">,</span> <span class="s2">"body {</span><span class="se">\r\n</span><span class="s2">    background: yellow;</span><span class="se">\r\n</span><span class="s2">}"</span><span class="p">,</span> <span class="s2">""</span><span class="cp">]</span><span class="o">);</span>

<span class="o">//</span> <span class="nt">exports</span>
</pre>

<p>/***/ },</p>
<p>webpackは何もかもをjavascript化してrequireするシステムなのか！？
configfile
コマンドライン引数を設定に移動。
webpack.config.js
module.exports = {
    entry: "./entry.js",
    output: {
        path: __dirname,
        filename: "bundle.js"
    },
    module: {
        loaders: [
            { test: /.css$/, loader: "style!css" }
        ]
    }
};</p>
<p>引数無しで実行できる。</p>
<blockquote>
<p>webpack
Hash: 1141db5208a3ce352fb6
Version: webpack 1.12.12
Time: 669ms
    Asset     Size  Chunks             Chunk Names
bundle.js  11.8 kB       0  [emitted]  main
   [0] ./entry.js 67 bytes {0} [built]
   [5] ./content.js 45 bytes {0} [built]
    + 4 hidden modules</p>
</blockquote>
<p>Watchモードとか開発サーバーもあるで
watchモード。</p>
<blockquote>
<p>webpack --progress --colors --watch</p>
</blockquote>
<p>dev-serverをインストール。</p>
<blockquote>
<p>npm install webpack-dev-server -g</p>
<p>webpack-dev-server --progress --colors</p>
</blockquote>
<p>http://localhost:8080 で静的なコンパイル結果を表示
http://localhost:8080/webpack-dev-server/bundle で自動リロード付き</p>
<p>gulpでがんばってwatchからbrowser-syncを構築していたのをさくっとできるね。
これはよさげ。
機能的にはブラウザ側(いわゆるフロントエンド)に特化しているぽいな。
サーバーサイドとの連携方法を探る必要がある。
browsery-syncとnodemonの連携みたいにproxyを駆使するのか。
参考</p>
<p>webpack で Node サーバー用のコードを bundle する
https://webpack.github.io/docs/webpack-dev-server.html#proxy
http://stackoverflow.com/questions/26203725/how-to-allow-for-webpack-dev-server-to-allow-entry-points-from-react-router</p>
</div>
    </main><footer id="footer"><p>
            Powered by
            <a href="https://getnikola.com" rel="nofollow">Nikola</a>
        </p>
    </footer>
</body>
</html>
