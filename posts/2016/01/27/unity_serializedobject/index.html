<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="generator" content="Nikola (getnikola.com)">
<meta name="viewport" content="width=device-width">
<script src="../../../../../assets/js/all-nocdn.js"></script><title>UnityのSerializedObject | 三次元日誌</title>
<link href="../../../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
</head>
<body>
    <h1 id="brand">
        <a href="../../../../../" title="三次元日誌" rel="home">
            <span id="blog-title">三次元日誌</span>
        </a>
    </h1>

    <nav id="menu"><ul>
<li><a href="../../../../../archive.html">Archives</a></li>
<li><a href="../../../../../categories/index.html">Tags</a></li>
<li><a href="../../../../../rss.xml">RSS feed</a></li>
<li><a href="../../../../../about">About</a></li>
<li><a href="../../../../../books">MemoBooks</a></li>

            
            
            
        </ul></nav><hr>
<main id="content"><h1 class="p-name entry-title" itemprop="headline name">
    <h1 class="p-name entry-title" itemprop="headline name">
    <a href="." class="u-url">UnityのSerializedObject
    </a>
</h1>
<ul itemprop="keywords" class="tags">
<li>
        <time datetime="2016-01-27T00:00:00+09:00" title="2016-01-27">2016-01-27</time>
</li>
    <li><a class="tag p-category" href="../../../../../categories/unity/" rel="tag">unity</a></li>
</ul>
</h1>

<p>UnityのSerializedObjectのメモ。</p>
<p>PropertyDrawers have two uses:
- Customize the GUI of every instance of a Serializable class.
- Customize the GUI of script members with custom PropertyAttributes.</p>
<p>できることは２つ。
Serializeable classのPropertyDrawerを定義する。
PropertyAttributeを定義して既存のSerializable classのPropertyDrawerを差し替える。
Not Serializableなclassに対してPropertyDrawerを定義することはできぬ(TimeSpanとかね)。
PropertyDrawerを定義してみる
using UnityEngine;</p>
<h2>if UNITY_EDITOR</h2>
<p>using UnityEditor;</p>
<h2>endif</h2>
<p>public class SampleAttribute : PropertyAttribute
{
}</p>
<h2>if UNITY_EDITOR</h2>
<p>[CustomPropertyDrawer(typeof(SampleAttribute))]
public class SampleDrawer : PropertyDrawer
{
    public override void OnGUI(Rect position, SerializedProperty property, GUIContent label)
    {
        var sampleAttribute = (SampleAttribute)attribute;
        Debug.Log(property);
        EditorGUI.PropertyField(position, property, new GUIContent("Hoge"));
    }
}</p>
<h2>endif</h2>
<p>public class SampleBehaviour : MonoBehaviour
{
    [Sample]
    public int Value;
}</p>
<p>property.Path
(x:14.00, y:154.00, width:266.00, height:16.00) path: Value</p>
<p>OnGUIでデバッグプリント
        Debug.LogFormat("{0} path: {1}", position, property.propertyPath);</p>
<p>なるほど。次のプロパティではどうか。
    [Sample]
    public List<int> ValueArray;</int></p>
<div class="code"><pre class="code literal-block"><span class="k">[Sample]</span><span class="w"></span>
<span class="na">public List&lt;int&gt; ValueList;</span><span class="w"></span>
</pre></div>

<p>OnGUIが呼ばれぬ。プリミティブ型以外はだめなのか？
かと思いきや中身に対して呼ばれることが分かった。
配列、Listの中身に対してPropertyDrawerが呼ばれる。
(x:14.00, y:208.00, width:258.00, height:16.00) path: ValueArray.Array.data[0]
(x:14.00, y:262.00, width:258.00, height:16.00) path: ValueList.Array.data[0]</p>
<p>Serializable class
public enum IngredientUnit { Spoon, Cup, Bowl, Piece }</p>
<p>// Custom serializable class
[Serializable]
public class Ingredient
{
    [Sample]
    public string name;</p>
<div class="code"><pre class="code literal-block"><span class="k">[Sample]</span><span class="w"></span>
<span class="na">public int amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1;</span><span class="w"></span>

<span class="k">[Sample]</span><span class="w"></span>
<span class="na">public IngredientUnit unit;</span><span class="w"></span>
</pre></div>

<p>}</p>
<div class="code"><pre class="code literal-block">public Ingredient ingredient;

public List&lt;Ingredient&gt; ingredientList;
</pre></div>

<p>(x:14.00, y:298.00, width:258.00, height:16.00) path: ingredient.name
(x:14.00, y:406.00, width:258.00, height:16.00) path: ingredientList.Array.data[0].name</p>
<p>CustomEditor
デフォルトと同じ挙動。DrawDefaultInspector()の前後にボタンを追加したりできる。
[CustomEditor(typeof(SampleBehaviour))]
public class ObjectGeneratorEditor : Editor
{
    public override void OnInspectorGUI()
    {
        DrawDefaultInspector();
    }
}</p>
<p>SerializedObjectのPropertyを列挙してみる
    public override void OnInspectorGUI()
    {
        serializedObject.Update();</p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">serializedObject</span><span class="o">.</span><span class="n">GetIterator</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="nb nb-Type">bool</span><span class="w"> </span><span class="n">hasNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it</span><span class="o">.</span><span class="n">NextVisible</span><span class="p">(</span><span class="bp">true</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="n">hasNext</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">//</span><span class="n">Debug</span><span class="o">.</span><span class="n">Log</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">propertyPath</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">expand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EditorGUILayout</span><span class="o">.</span><span class="n">PropertyField</span><span class="p">(</span><span class="n">it</span><span class="p">,</span><span class="w"> </span><span class="bp">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">hasNext</span><span class="o">=</span><span class="n">it</span><span class="o">.</span><span class="n">NextVisible</span><span class="p">(</span><span class="n">expand</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">serializedObject</span><span class="o">.</span><span class="n">ApplyModifiedProperties</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>

<p>EditorGUIの関数はpositionが必要
EditorGUILayoutはposition無用。</p>

<hr>
<ul class="pager hidden-print">
<li class="previous">
        <a href="../../23/webpack/" rel="prev" title="WebPackやってみる">
            WebPackやってみる 👈
        </a>
    </li>
    <li style="flex-grow: 1">
    <li class="next">
        <a href="../../../../../github/ffmpeg_texture/" rel="next" title="FFMPEG_Texture">
            👉 FFMPEG_Texture
        </a>
    </li>
</ul></main><footer id="footer"><p>
            Powered by
            <a href="https://getnikola.com" rel="nofollow">Nikola</a>
        </p>
    </footer>
</body>
</html>
