<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="generator" content="Nikola (getnikola.com)">
<meta name="viewport" content="width=device-width">
<script src="../../../assets/js/all-nocdn.js"></script><title>pythonのmoduleとpackage周り | 三次元日誌</title>
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
</head>
<body>
    <h1 id="brand">
        <a href="../../../" title="三次元日誌" rel="home">
            <span id="blog-title">三次元日誌</span>
        </a>
    </h1>

    <nav id="menu"><ul>
<li><a href="../../../archive.html">Archives</a></li>
<li><a href="../../../categories/index.html">Tags</a></li>
<li><a href="../../../rss.xml">RSS feed</a></li>
<li><a href="../../../about">About</a></li>
<li><a href="../../../books">MemoBooks</a></li>

            
            
            
        </ul></nav><hr>
<main id="content"><h1 class="p-name entry-title" itemprop="headline name">
    <h1 class="p-name entry-title" itemprop="headline name">
    <a href="." class="u-url">pythonのmoduleとpackage周り
    </a>
</h1>
<ul itemprop="keywords" class="tags">
<li>
        <time datetime="2019-04-30T15:47:39+09:00" title="2019-04-30">2019-04-30</time>
</li>
    <li><a class="tag p-category" href="../../../categories/python/" rel="tag">python</a></li>
</ul>
</h1>

<div>
<p><code>ImportError: attempted relative import with no known parent package</code></p>
<h3>相対Importの制限</h3>
<ul>
<li><a href="https://qiita.com/ysk24ok/items/2711295d83218c699276">[Python] importの躓きどころ</a></li>
</ul>
<p>わいのやりたいことは実現不可能なのだな。
packageの内部でちょっとしたテストをするコードを、</p>
<pre class="code literal-block"><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">sample</span><span class="p">()</span>
</pre>

<p>という風に書いて実行しようとしていたのだが、
同階層のファイルを、</p>
<pre class="code literal-block"><span></span><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">my_module</span>
</pre>

<pre class="code literal-block"><span></span><span class="ne">ImportError</span><span class="p">:</span> <span class="n">attempted</span> <span class="n">relative</span> <span class="kn">import</span> <span class="nn">with</span> <span class="nn">no</span> <span class="nn">known</span> <span class="nn">parent</span> <span class="nn">package</span>
</pre>

<p>で阻まれてしまう。
エントリポイントが、</p>
<pre class="code literal-block"><span></span>__package__ == None
__name__ == '__main__'
</pre>

<p>となるので、<code>ImportError</code> となるのである。
こんちくしょう。</p>
<h4>無理やり誤魔化すなら・・・</h4>
<p>もう一つ外のソースから <code>import</code> したかのように偽装する。</p>
<pre class="code literal-block"><span></span><span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s1">'import my_package; my_package.sample()'</span>
</pre>

<p>💩過ぎる。
ライブラリにユーティリティが付属している場合にめちゃくちゃ作りづらい。
前からPytnonのもっとも💩なところだと思っていた。
ライブラリの開発時に部分的に実行する時に邪魔でしかない。</p>
<h3>package</h3>
<p>複数のモジュールを束ねたもの。
import したときに <code>__package__</code> が <code>None</code> 以外になった <code>module</code> は <code>package</code> に属している。</p>
<h4>エントリポイントは <code>__package__ = None</code>
</h4>
<p>以下のファイル構成で実験してみた。</p>
<pre class="code literal-block"><span></span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="c1"># import mod</span>
<span class="n">mod</span><span class="o">.</span><span class="n">py</span> <span class="c1"># import mod2</span>
<span class="n">mod2</span><span class="o">.</span><span class="n">py</span> <span class="c1"># import mod3</span>
<span class="n">mod3</span>
    <span class="o">+</span> <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span> <span class="c1"># from . import mod4</span>
    <span class="o">+</span> <span class="n">mod4</span><span class="o">.</span><span class="n">py</span>

<span class="c1"># それぞれ以下を記述</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">'"{__name__}" in "{__package__}"'</span><span class="p">)</span>

<span class="n">python</span> <span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="err">として実行</span>
</pre>

<p><code>__package__</code> が、</p>
<ul>
<li>main.py <strong>packag</strong> = None</li>
<li>mod.py <strong>packag</strong> = ""</li>
<li>mod2.py <strong>packag</strong> = ""</li>
<li>mod3/<strong>init</strong>.py <strong>packag</strong> = "mod3"</li>
<li>mod3/mod4.py <strong>packag</strong> = "mod3"</li>
</ul>
<p>で</p>
<ul>
<li>mod3/<strong>init</strong>.py. <strong>packag</strong> = "mod3"</li>
<li>mod3/mod4.py. <strong>packag</strong> = "mod3"</li>
</ul>
<p>のみが <code>from . import mod4</code> 等の相対インポートが可能だった。
他は、</p>
<pre class="code literal-block"><span></span><span class="ne">ImportError</span><span class="p">:</span> <span class="n">attempted</span> <span class="n">relative</span> <span class="kn">import</span> <span class="nn">with</span> <span class="nn">no</span> <span class="nn">known</span> <span class="nn">parent</span> <span class="nn">package</span>
</pre>

<p>が出る。
つまり、<code>__packag__</code> が None(エントリポイント) もしくは ""(エントリポイントと同じ階層) であると相対インポートができない。</p>
<p><code>python mod3/__init__.py</code> とすると、</p>
<ul>
<li>mod3/<strong>init</strong>.py. <strong>packag</strong> = None</li>
<li>mod3/mod4.py. <strong>packag</strong> = ""</li>
</ul>
<p>と変化して、相対 import ができない。</p>
<p>💩仕様。</p>
</div>

<hr>
<ul class="pager hidden-print">
<li class="previous">
        <a href="../logging/" rel="prev" title="python の logger">
            python の logger 👈
        </a>
    </li>
    <li style="flex-grow: 1">
    <li class="next">
        <a href="../decorator/" rel="next" title="pythonのdecorator">
            👉 pythonのdecorator
        </a>
    </li>
</ul></main><footer id="footer"><p>
            Powered by
            <a href="https://getnikola.com" rel="nofollow">Nikola</a>
        </p>
    </footer>
</body>
</html>
