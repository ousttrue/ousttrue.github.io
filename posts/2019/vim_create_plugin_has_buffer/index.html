<!DOCTYPE html><html lang="ja"><head><link rel="icon" type="image/svg+xml" href="/favicon.svg"><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Astro v3.4.3"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://ousttrue.github.io/posts/2019/vim_create_plugin_has_buffer/"><!-- Primary Meta Tags --><title></title><meta name="title"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://ousttrue.github.io/posts/2019/vim_create_plugin_has_buffer/"><meta property="og:title"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://ousttrue.github.io/posts/2019/vim_create_plugin_has_buffer/"><meta property="twitter:title"><style>:root{--accent: #2337ff;--accent-dark: #000d8a;--black: 15, 18, 25;--gray: 96, 115, 159;--gray-light: 229, 233, 240;--gray-dark: 34, 41, 57;--gray-gradient: rgba(var(--gray-light), 50%), #fff;--box-shadow: 0 2px 6px rgba(var(--gray), 25%), 0 8px 24px rgba(var(--gray), 33%), 0 16px 32px rgba(var(--gray), 33%)}@font-face{font-family:Atkinson;src:url(/fonts/atkinson-regular.woff) format("woff");font-weight:400;font-style:normal;font-display:swap}@font-face{font-family:Atkinson;src:url(/fonts/atkinson-bold.woff) format("woff");font-weight:700;font-style:normal;font-display:swap}body{font-family:Atkinson,sans-serif;margin:0;padding:0;text-align:left;background:linear-gradient(var(--gray-gradient)) no-repeat;background-size:100% 600px;word-wrap:break-word;overflow-wrap:break-word;color:rgb(var(--gray-dark));font-size:20px;line-height:1.7}main{width:720px;max-width:calc(100% - 2em);margin:auto;padding:3em 1em}h1,h2,h3,h4,h5,h6{margin:0 0 .5rem;color:rgb(var(--black));line-height:1.2}h1{font-size:3.052em}h2{font-size:2.441em}h3{font-size:1.953em}h4{font-size:1.563em}h5{font-size:1.25em}strong,b{font-weight:700}a,a:hover{color:var(--accent)}p{margin-bottom:1em}.prose p{margin-bottom:2em}textarea{width:100%;font-size:16px}input{font-size:16px}table{width:100%}img{max-width:100%;height:auto;border-radius:8px}code{padding:2px 5px;background-color:rgb(var(--gray-light));border-radius:2px}pre{padding:1.5em;border-radius:8px}pre>code{all:unset}blockquote{border-left:4px solid var(--accent);padding:0 0 0 20px;margin:0;font-size:1.333em}hr{border:none;border-top:1px solid rgb(var(--gray-light))}@media (max-width: 720px){body{font-size:18px}main{padding:1em}}.sr-only{border:0;padding:0;margin:0;position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);clip-path:inset(50%);white-space:nowrap}.date{margin-bottom:.5em;color:rgb(var(--gray))}.tags{display:flex;flex-wrap:wrap}.tag{margin:.25em;border:dotted 1px #a1a1a1;border-radius:.5em;padding:.5em 1em;font-size:1.15em;background-color:#f8fcfd}a[data-astro-cid-eimmu3lg]{display:inline-block;text-decoration:none}a[data-astro-cid-eimmu3lg].active{font-weight:bolder;text-decoration:underline}header[data-astro-cid-3ef6ksr2]{margin:0;padding:0 1em;background:white;box-shadow:0 2px 8px rgba(var(--black),5%)}h2[data-astro-cid-3ef6ksr2]{margin:0;font-size:1em}h2[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2],h2[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2].active{text-decoration:none}nav[data-astro-cid-3ef6ksr2]{display:flex;align-items:center;justify-content:space-between}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{padding:1em .5em;color:var(--black);border-bottom:4px solid transparent;text-decoration:none}nav[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2].active{text-decoration:none;border-bottom-color:var(--accent)}.social-links[data-astro-cid-3ef6ksr2],.social-links[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{display:flex}@media (max-width: 720px){.social-links[data-astro-cid-3ef6ksr2]{display:none}}footer[data-astro-cid-sz7xmlte]{padding:2em 1em 6em;background:linear-gradient(var(--gray-gradient)) no-repeat;color:rgb(var(--gray));text-align:center}.social-links[data-astro-cid-sz7xmlte]{display:flex;justify-content:center;gap:1em;margin-top:1em}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]{text-decoration:none;color:rgb(var(--gray))}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]:hover{color:rgb(var(--gray-dark))}
</style></head><body><header data-astro-cid-3ef6ksr2><nav data-astro-cid-3ef6ksr2><h2 data-astro-cid-3ef6ksr2><a href="/" data-astro-cid-3ef6ksr2>三次元日誌(Astro)</a></h2><div class="internal-links" data-astro-cid-3ef6ksr2><a href="/tags/" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg>Tags</a><a href="/about" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg>About</a></div><div class="social-links" data-astro-cid-3ef6ksr2><a href="https://github.com/ousttrue/" target="_blank" data-astro-cid-3ef6ksr2><span class="sr-only" data-astro-cid-3ef6ksr2>Go to Astro's GitHub repo</span><svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-3ef6ksr2></path></svg></a></div></nav></header><main><article><div class="prose"><div class="title"><div class="date"><time datetime="2019-04-22T15:13:09.000Z">2019
-04
-22</time></div><a href="/posts/2019/vim_create_plugin_has_buffer"><h1>buffer を持つ vim plugin を作る</h1></a><div class="tags"><p class="tag"><a href="/tags/vim">vim</a></p></div></div></div><p>独自のバッファを持つpluginを作りたい</p>
<h2 id="bufferlist読んでみる">BufferList読んでみる</h2>
<ul>
<li><a href="https://github.com/vim-scripts/bufferlist.vim/blob/master/plugin/bufferlist.vim">https://github.com/vim-scripts/bufferlist.vim/blob/master/plugin/bufferlist.vim</a></li>
</ul>
<p>273行</p>
<p>この量なら読める。</p>
<h3 id="インクルードガード">インクルードガード</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" lang="vim"><code><span class="line"><span style="color:#F97583">if</span><span style="color:#B392F0"> exists</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'g:BufferListLoaded'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">  finish</span></span>
<span class="line"><span style="color:#F97583">endif</span></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> g:BufferListLoaded </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span></span></code></pre>
<h3 id="初期値決め">初期値決め</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" lang="vim"><code><span class="line"><span style="color:#6A737D">" vimrcで先に値を決められるようにしている？</span></span>
<span class="line"><span style="color:#6A737D">" vimrc より plugin の方が後に実行されるからか？</span></span>
<span class="line"><span style="color:#F97583">if</span><span style="color:#F97583"> !</span><span style="color:#B392F0">exists</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'g:BufferListWidth'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">  let</span><span style="color:#E1E4E8"> g:BufferListWidth </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 20</span></span>
<span class="line"><span style="color:#F97583">endif</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">if</span><span style="color:#F97583"> !</span><span style="color:#B392F0">exists</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'g:BufferListMaxWidth'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">  let</span><span style="color:#E1E4E8"> g:BufferListMaxWidth </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 40</span></span>
<span class="line"><span style="color:#F97583">endif</span></span></code></pre>
<h3 id="bufferlist関数">BufferList関数</h3>
<p><code>__BUFFERLIST__</code> という Buffer を専用のバッファとして扱う。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" lang="vim"><code><span class="line"><span style="color:#6A737D">" toggled the buffer list on/off</span></span>
<span class="line"><span style="color:#F97583">function!</span><span style="color:#B392F0"> BufferList</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#6A737D">  " if we get called and the list is open --> close it</span></span>
<span class="line"><span style="color:#F97583">  if</span><span style="color:#B392F0"> bufexists</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">bufnr</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"__BUFFERLIST__"</span><span style="color:#E1E4E8">))</span></span>
<span class="line"><span style="color:#6A737D">    " 既に開いていたら閉じる</span></span>
<span class="line"><span style="color:#E1E4E8">    exec </span><span style="color:#9ECBFF">':'</span><span style="color:#F97583"> . </span><span style="color:#B392F0">bufnr</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"__BUFFERLIST__"</span><span style="color:#E1E4E8">)</span><span style="color:#F97583"> . </span><span style="color:#9ECBFF">'bwipeout'</span></span>
<span class="line"><span style="color:#F97583">    return</span></span>
<span class="line"><span style="color:#F97583">  endif</span></span></code></pre>
<p><code>bufnr</code> でバッファ名からバッファ番号を得て、<code>bufexists</code> で存在を確認する。
<code>bufnr</code> には特別な名前を指定出来て以下のような効果があるようだ。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" lang="vim"><code><span class="line"><span style="color:#F97583">  let</span><span style="color:#E1E4E8"> l:bufcount </span><span style="color:#F97583">=</span><span style="color:#B392F0"> bufnr</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'$'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">  let</span><span style="color:#E1E4E8"> l:activebuf </span><span style="color:#F97583">=</span><span style="color:#B392F0"> bufnr</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">''</span><span style="color:#E1E4E8">)</span></span></code></pre>
<h4 id="バッファを作る">バッファを作る</h4>
<p>作ったバッファがアクティブになり、以降の操作対象になる。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" lang="vim"><code><span class="line"><span style="color:#6A737D">  " now, create the buffer &#x26; set it up</span></span>
<span class="line"><span style="color:#E1E4E8">  exec </span><span style="color:#9ECBFF">'silent! '</span><span style="color:#F97583"> . </span><span style="color:#E1E4E8">l:width</span><span style="color:#F97583"> . </span><span style="color:#9ECBFF">'vne __BUFFERLIST__'</span></span></code></pre>
<h4 id="色決め">色決め</h4>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" lang="vim"><code><span class="line"><span style="color:#6A737D">  " set up syntax highlighting</span></span>
<span class="line"><span style="color:#F97583">  if</span><span style="color:#B392F0"> has</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"syntax"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    syn clear</span></span>
<span class="line"><span style="color:#F97583">    syn</span><span style="color:#79B8FF"> match</span><span style="color:#E1E4E8"> BufferNormal </span><span style="color:#DBEDFF">/  .*/</span></span>
<span class="line"><span style="color:#F97583">    syn</span><span style="color:#79B8FF"> match</span><span style="color:#E1E4E8"> BufferSelected </span><span style="color:#DBEDFF">/> .*/</span><span style="color:#E1E4E8">hs</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">s</span><span style="color:#F97583">+</span><span style="color:#79B8FF">1</span></span>
<span class="line"><span style="color:#79B8FF">    hi</span><span style="color:#79B8FF"> def</span><span style="color:#E1E4E8"> BufferNormal ctermfg</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">black ctermbg</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">white</span></span>
<span class="line"><span style="color:#79B8FF">    hi</span><span style="color:#79B8FF"> def</span><span style="color:#E1E4E8"> BufferSelected ctermfg</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">white ctermbg</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">black</span></span>
<span class="line"><span style="color:#F97583">  endif</span></span></code></pre>
<h4 id="buffer構築">Buffer構築</h4>
<p><code>setlocal nomodifiable</code> で編集不可に</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" lang="vim"><code><span class="line"><span style="color:#F97583">  setlocal</span><span style="color:#79B8FF"> modifiable</span></span>
<span class="line"><span style="color:#F97583">  if</span><span style="color:#E1E4E8"> l:displayedbufs</span><span style="color:#F97583"> > </span><span style="color:#79B8FF">0</span></span>
<span class="line"><span style="color:#6A737D">    " input the buffer list, delete the trailing newline, &#x26; fill with blank lines</span></span>
<span class="line"><span style="color:#E1E4E8">    put</span><span style="color:#F97583">!</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8">l:buflist</span></span>
<span class="line"><span style="color:#6A737D">    " is there any way to NOT delete into a register? bummer...</span></span>
<span class="line"><span style="color:#6A737D">    "norm Gdd$</span></span>
<span class="line"><span style="color:#E1E4E8">    norm GkJ</span></span>
<span class="line"><span style="color:#F97583">    while</span><span style="color:#B392F0"> winheight</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span><span style="color:#F97583"> > </span><span style="color:#B392F0">line</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"."</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">      put </span><span style="color:#F97583">=</span><span style="color:#E1E4E8">l:fill</span></span>
<span class="line"><span style="color:#F97583">    endwhile</span></span>
<span class="line"><span style="color:#F97583">  else</span></span>
<span class="line"><span style="color:#F97583">    let</span><span style="color:#E1E4E8"> l:i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8"> | </span><span style="color:#F97583">while</span><span style="color:#E1E4E8"> l:i</span><span style="color:#F97583"> &#x3C; </span><span style="color:#B392F0">winheight</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">) | </span><span style="color:#F97583">let</span><span style="color:#E1E4E8"> l:i </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> l:i </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#E1E4E8">      put</span><span style="color:#F97583">!</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8">l:fill</span></span>
<span class="line"><span style="color:#F97583">    endwhile</span></span>
<span class="line"><span style="color:#E1E4E8">    norm </span><span style="color:#79B8FF">0</span></span>
<span class="line"><span style="color:#F97583">  endif</span></span>
<span class="line"><span style="color:#F97583">  setlocal</span><span style="color:#79B8FF"> nomodifiable</span></span></code></pre>
<h4 id="操作を設定">操作を設定</h4>
<p>バッファローカルに <code>map</code> を設定する。
<code>map</code> がキーボード・マウス入力へのコールバック設定になっているのか。なるほど。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" lang="vim"><code><span class="line"><span style="color:#6A737D">  " set up the keymap</span></span>
<span class="line"><span style="color:#F97583">  noremap</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#79B8FF">silent</span><span style="color:#E1E4E8">> &#x3C;</span><span style="color:#79B8FF">buffer</span><span style="color:#E1E4E8">> &#x3C;</span><span style="color:#79B8FF">CR</span><span style="color:#E1E4E8">> :</span><span style="color:#F97583">call</span><span style="color:#B392F0"> LoadBuffer</span><span style="color:#E1E4E8">()&#x3C;</span><span style="color:#79B8FF">CR</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">  map</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#79B8FF">silent</span><span style="color:#E1E4E8">> &#x3C;</span><span style="color:#79B8FF">buffer</span><span style="color:#E1E4E8">> q :bwipeout&#x3C;</span><span style="color:#79B8FF">CR</span><span style="color:#E1E4E8">> </span></span>
<span class="line"><span style="color:#F97583">  map</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#79B8FF">silent</span><span style="color:#E1E4E8">> &#x3C;</span><span style="color:#79B8FF">buffer</span><span style="color:#E1E4E8">> j :</span><span style="color:#F97583">call</span><span style="color:#B392F0"> BufferListMove</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"down"</span><span style="color:#E1E4E8">)&#x3C;</span><span style="color:#79B8FF">CR</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">  map</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#79B8FF">silent</span><span style="color:#E1E4E8">> &#x3C;</span><span style="color:#79B8FF">buffer</span><span style="color:#E1E4E8">> k :</span><span style="color:#F97583">call</span><span style="color:#B392F0"> BufferListMove</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"up"</span><span style="color:#E1E4E8">)&#x3C;</span><span style="color:#79B8FF">CR</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">  map</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#79B8FF">silent</span><span style="color:#E1E4E8">> &#x3C;</span><span style="color:#79B8FF">buffer</span><span style="color:#E1E4E8">> d :</span><span style="color:#F97583">call</span><span style="color:#B392F0"> BufferListDeleteBuffer</span><span style="color:#E1E4E8">()&#x3C;</span><span style="color:#79B8FF">CR</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">  map</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#79B8FF">silent</span><span style="color:#E1E4E8">> &#x3C;</span><span style="color:#79B8FF">buffer</span><span style="color:#E1E4E8">> &#x3C;Mouse</span><span style="color:#79B8FF">Down</span><span style="color:#E1E4E8">> :</span><span style="color:#F97583">call</span><span style="color:#B392F0"> BufferListMove</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"up"</span><span style="color:#E1E4E8">)&#x3C;</span><span style="color:#79B8FF">CR</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">  map</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#79B8FF">silent</span><span style="color:#E1E4E8">> &#x3C;</span><span style="color:#79B8FF">buffer</span><span style="color:#E1E4E8">> &#x3C;Mouse</span><span style="color:#79B8FF">Up</span><span style="color:#E1E4E8">> :</span><span style="color:#F97583">call</span><span style="color:#B392F0"> BufferListMove</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"down"</span><span style="color:#E1E4E8">)&#x3C;</span><span style="color:#79B8FF">CR</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">  map</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#79B8FF">silent</span><span style="color:#E1E4E8">> &#x3C;</span><span style="color:#79B8FF">buffer</span><span style="color:#E1E4E8">> &#x3C;</span><span style="color:#79B8FF">Left</span><span style="color:#E1E4E8">Drag> &#x3C;</span><span style="color:#79B8FF">Nop</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">  map</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#79B8FF">silent</span><span style="color:#E1E4E8">> &#x3C;</span><span style="color:#79B8FF">buffer</span><span style="color:#E1E4E8">> &#x3C;</span><span style="color:#79B8FF">Left</span><span style="color:#E1E4E8">Release> :</span><span style="color:#F97583">call</span><span style="color:#B392F0"> BufferListMove</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"mouse"</span><span style="color:#E1E4E8">)&#x3C;</span><span style="color:#79B8FF">CR</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">  map</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#79B8FF">silent</span><span style="color:#E1E4E8">> &#x3C;</span><span style="color:#79B8FF">buffer</span><span style="color:#E1E4E8">> &#x3C;2-</span><span style="color:#79B8FF">Left</span><span style="color:#E1E4E8">Mouse> :</span><span style="color:#F97583">call</span><span style="color:#B392F0"> BufferListMove</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"mouse"</span><span style="color:#E1E4E8">)&#x3C;</span><span style="color:#79B8FF">CR</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">    \</span><span style="color:#E1E4E8">:</span><span style="color:#F97583">call</span><span style="color:#B392F0"> LoadBuffer</span><span style="color:#E1E4E8">()&#x3C;</span><span style="color:#79B8FF">CR</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">  map</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#79B8FF">silent</span><span style="color:#E1E4E8">> &#x3C;</span><span style="color:#79B8FF">buffer</span><span style="color:#E1E4E8">> &#x3C;</span><span style="color:#79B8FF">Down</span><span style="color:#E1E4E8">> j</span></span>
<span class="line"><span style="color:#F97583">  map</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#79B8FF">silent</span><span style="color:#E1E4E8">> &#x3C;</span><span style="color:#79B8FF">buffer</span><span style="color:#E1E4E8">> &#x3C;</span><span style="color:#79B8FF">Up</span><span style="color:#E1E4E8">> k</span></span></code></pre>
<p>左右への動きを封じてある</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" lang="vim"><code><span class="line"><span style="color:#F97583">  map</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#79B8FF">buffer</span><span style="color:#E1E4E8">> h &#x3C;</span><span style="color:#79B8FF">Nop</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">  map</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#79B8FF">buffer</span><span style="color:#E1E4E8">> l &#x3C;</span><span style="color:#79B8FF">Nop</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">  map</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#79B8FF">buffer</span><span style="color:#E1E4E8">> &#x3C;</span><span style="color:#79B8FF">Left</span><span style="color:#E1E4E8">> &#x3C;</span><span style="color:#79B8FF">Nop</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">  map</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#79B8FF">buffer</span><span style="color:#E1E4E8">> &#x3C;</span><span style="color:#79B8FF">Right</span><span style="color:#E1E4E8">> &#x3C;</span><span style="color:#79B8FF">Nop</span><span style="color:#E1E4E8">></span></span></code></pre>
<p>その他編集系の機能を封じる</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" lang="vim"><code><span class="line"><span style="color:#F97583">  map</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#79B8FF">buffer</span><span style="color:#E1E4E8">> i &#x3C;</span><span style="color:#79B8FF">Nop</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">  map</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#79B8FF">buffer</span><span style="color:#E1E4E8">> a &#x3C;</span><span style="color:#79B8FF">Nop</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">  map</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#79B8FF">buffer</span><span style="color:#E1E4E8">> I &#x3C;</span><span style="color:#79B8FF">Nop</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">  map</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#79B8FF">buffer</span><span style="color:#E1E4E8">> A &#x3C;</span><span style="color:#79B8FF">Nop</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">  map</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#79B8FF">buffer</span><span style="color:#E1E4E8">> o &#x3C;</span><span style="color:#79B8FF">Nop</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">  map</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#79B8FF">buffer</span><span style="color:#E1E4E8">> O &#x3C;</span><span style="color:#79B8FF">Nop</span><span style="color:#E1E4E8">></span></span></code></pre>
<p>移動</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" lang="plaintext"><code><span class="line"><span>  map &#x3C;silent> &#x3C;buffer> &#x3C;Home> :call BufferListMove(1)&#x3C;CR></span></span>
<span class="line"><span>  map &#x3C;silent> &#x3C;buffer> &#x3C;End> :call BufferListMove(line("$"))&#x3C;CR></span></span></code></pre>
<h2 id="情報収集">情報収集</h2>
<p><code>:set nomodifiable</code> で調べてみた</p>
<ul>
<li><a href="http://tyru.hatenablog.com/entry/20101107/modifiable_and_readonly">http://tyru.hatenablog.com/entry/20101107/modifiable_and_readonly</a></li>
<li><a href="https://vimconf.org/2018/slides/Effective_Modern_Vim_scripting_at_vimconf2018_for_PDF.pdf">https://vimconf.org/2018/slides/Effective_Modern_Vim_scripting_at_vimconf2018_for_PDF.pdf</a></li>
<li><a href="https://vi.stackexchange.com/questions/17140/how-to-create-a-buffer-like-a-fugitive-temporary-buffer">https://vi.stackexchange.com/questions/17140/how-to-create-a-buffer-like-a-fugitive-temporary-buffer</a></li>
</ul>
<p><code>:set buftype=nofile</code> が出てきた</p>
<ul>
<li><a href="http://leafcage.hateblo.jp/entry/2013/11/21/083830">‘nobuflisted’ なバッファの作り方</a></li>
<li><a href="https://vi.stackexchange.com/questions/14832/how-to-create-a-buffer-with-customized-behavior-how-to-create-a-buffer-that-a">https://vi.stackexchange.com/questions/14832/how-to-create-a-buffer-with-customized-behavior-how-to-create-a-buffer-that-a</a></li>
<li><a href="http://learnvimscriptthehardway.stevelosh.com/">http://learnvimscriptthehardway.stevelosh.com/</a></li>
</ul>
<h2 id="nerdtree解読">NERDTree解読</h2>
<h3 id="左側にどうやって-split-して開くのか">左側にどうやって <code>split</code> して開くのか</h3>
<h3 id="ファイルを選択して開くとき開き先をどうやって決めるのか">ファイルを選択して開くとき開き先をどうやって決めるのか</h3>
<h2 id="pythonに移植できんやろか">pythonに移植できんやろか</h2>
<p>つまり、Pythonでvimから見える関数を定義できれば勝つるのでは。</p>
<ul>
<li><a href="http://candidtim.github.io/vim/2017/08/11/write-vim-plugin-in-python.html">http://candidtim.github.io/vim/2017/08/11/write-vim-plugin-in-python.html</a></li>
</ul>
<p><code>vim.eval</code> とかあるな・・・。いけるのでは？</p>
<p>慣れたら全部 <code>vim script</code> で書くようになりそうだけど、練習に移植してみよか。</p>
<p>nvimで、</p>
<p><code>:py3 import sys; print(sys.version)</code></p>
<p>としたら</p>
<p><code>3.6.8 (tags/v3.6.8:3c6b436a57, Dec 23 2018, 23:31:17) [MSC v.1916 32 bit (Intel)]</code></p>
<p>と返ってきた。なるほど。</p>
<ul>
<li>[Pythonでvim pluginを書く <a href="https://qiita.com/zakuro9715/items/98449dd4c6b9e1d61ef5">https://qiita.com/zakuro9715/items/98449dd4c6b9e1d61ef5</a>]</li>
</ul></article></main><footer data-astro-cid-sz7xmlte>
&copy; 2023 ousttrue. All rights reserved.
<div class="social-links" data-astro-cid-sz7xmlte><a href="https://github.com/ousttrue/" target="_blank" data-astro-cid-sz7xmlte><svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/github" data-astro-cid-sz7xmlte><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-sz7xmlte></path></svg></a></div></footer></body></html>