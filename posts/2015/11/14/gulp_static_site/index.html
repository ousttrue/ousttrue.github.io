<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="generator" content="Nikola (getnikola.com)">
<meta name="viewport" content="width=device-width">
<script src="../../../../../assets/js/all-nocdn.js"></script><title>gulpã§é™çš„ã‚µã‚¤ãƒˆç”Ÿæˆãã®ï¼’ | ä¸‰æ¬¡å…ƒæ—¥èªŒ</title>
<link href="../../../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
</head>
<body>
    <h1 id="brand">
        <a href="../../../../../" title="ä¸‰æ¬¡å…ƒæ—¥èªŒ" rel="home">
            <span id="blog-title">ä¸‰æ¬¡å…ƒæ—¥èªŒ</span>
        </a>
    </h1>

    <nav id="menu"><ul>
<li><a href="../../../../../archive.html">Archives</a></li>
<li><a href="../../../../../categories/index.html">Tags</a></li>
<li><a href="../../../../../rss.xml">RSS feed</a></li>
<li><a href="../../../../../about">About</a></li>
<li><a href="../../../../../books">MemoBooks</a></li>

            
            
            
        </ul></nav><hr>
<main id="content"><h1 class="p-name entry-title" itemprop="headline name">
    <h1 class="p-name entry-title" itemprop="headline name">
    <a href="." class="u-url">gulpã§é™çš„ã‚µã‚¤ãƒˆç”Ÿæˆãã®ï¼’
    </a>
</h1>
<ul itemprop="keywords" class="tags">
<li>
        <time datetime="2015-11-14T00:00:00+09:00" title="2015-11-14">2015-11-14</time>
</li>
</ul>
</h1>

<div>
<p>gulpã§é™çš„ã‚µã‚¤ãƒˆç”Ÿæˆãã®ï¼’
å¼•ãç¶šãã€ã‚µã‚¤ãƒˆç”Ÿæˆä½œæ¥­ã‚’ç¶šè¡Œä¸­ã€‚è¦‹ãŸç›®ã¯ç½®ã„ã¦ãŠã„ã¦(bootstrapå…¥ã‚ŒãŸã‘ã©)æ©Ÿèƒ½ã‚’å„ªå…ˆã—ã¦ä½œã‚ã†ã€‚
ã€Œæ¬¡ã¸ã€ã¨ã€Œå‰ã¸ã€ã®ãƒªãƒ³ã‚¯ã‚’ä½œã‚Œã°å†…éƒ¨ãƒªãƒ³ã‚¯ã¯æƒã†ã€‚
gulpã¯è‡ªç”±åº¦ãŒé«˜ã„ã®ã§ãªã‚“ã¨ã§ã‚‚ãªã‚‹ãªã€‚
å¼·ã¾ã£ãŸmakeã®ã‚ˆã†ã§éå¸¸ã«ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã‚’æ„Ÿã˜ã‚‹ã€‚
ä¸­æœŸçš„ãªã‚‚ç›®æ¨™ã¨ã—ã¦ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚‚ã—ãã¯LANå†…ã®node.jsãŒãƒ›ã‚¹ãƒˆã¨ãªã‚‹GUIã‚’ã•ãã£ã¨ä½œã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã¨ã„ã†ã‚‚ã®ãŒã‚ã‚‹ã®ã ãŒã€
é–¢é€£é …ç›®ãŒå¤šã™ãã¦ã²ãŸã™ã‚‰æ‹¡ãŒã£ã¦ã„ãã®ãŒå±é™ºã ã€‚
ç‰¹ã«ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã§èª¿ã¹ãªãŒã‚‰ã ã¨åæŸã›ãšã«ã²ãŸã™ã‚‰æ‹¡æ•£ã™ã‚‹å‚¾å‘ãŒã‚ã‚‹ã€‚
anglar, backboneã¯é¿ã‘ã‚ˆã†ã¨æ€ã£ãŸã®ã ãŒmithrilã¯æ°—ã«ãªã£ã¦ã„ã‚‹ã—ã€electronã‚‚æ°—ã«ãªã£ã¦ã„ã‚‹ã€‚
ã‚ã¨ã€typescriptã‚‚ã¯ã‚„ã‚ã«ä½¿ã„ã“ãªã—ãŸã„ã€‚
ã ã„ã¶gulpãŒã‚ã‹ã£ã¦ããŸ
ã€Œå‰ã¸ã€ã¨ã€Œæ¬¡ã¸ã€ã¯å…¨éƒ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªã‚¹ãƒˆã«æŠ•å…¥ã—ã¦ã‚½ãƒ¼ãƒˆã—ã¦éš£é€šã—ã®ãƒ‘ã‚¹ã‚’å¾—ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
ä¸€åº¦ãƒªã‚¹ãƒˆã«æŠ•å…¥ã—ã¦ã‹ã‚‰å‰ã¸ã¨æ¬¡ã¸ã‚’å‡¦ç†ã—ãŸå¾Œã§ã€å†åº¦ãƒªã‚¹ãƒˆã®ä¸­èº«ã‚’ä¸€å€‹ãšã¤å¾Œã‚ã«æ¸¡ã›ã°ã„ã„ã˜ã‚ƒãªã„ã€‚
ã¨ã„ã†ã“ã¨ã§ã‚„ã£ã¦ã¿ãŸã‚‰ã‚ã£ã•ã‚Šã§ããŸã€‚
é‡è‰¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ä½œã‚Šæ–¹ãŒåˆ†ã‹ã‚‹ã¨gulpé¢ç™½ã„ãªã€‚
make-toc.js
var through = require('through2');
var gutil = require('gulp-util');
var path = require('path');</p>
<p>module.exports = function (outputFileName, options) {</p>
<pre class="code literal-block"><span></span><span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
<span class="kd">var</span> <span class="nx">dest</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">dest</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">filelist</span> <span class="o">=</span> <span class="p">[];</span>

<span class="kd">function</span> <span class="nx">transform</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é›†ã‚ã‚‹</span>
    <span class="nx">filelist</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>

    <span class="c1">// callback()ã¯å¿…ãšå®Ÿè¡Œ</span>
    <span class="nx">callback</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">flush</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">filelist</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// sortã™ã‚‹ã“ã¨ã§æ—¥ä»˜é †ã«ä¸¦ã¶</span>
        <span class="nx">filelist</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span> <span class="nx">compareNumbers</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">path</span> <span class="o">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="kd">var</span> <span class="nx">file</span> <span class="o">=</span> <span class="nx">filelist</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

        <span class="c1">// ç›®æ¬¡</span>
        <span class="kd">var</span> <span class="nx">output_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">cwd</span>: <span class="kt">file.cwd</span><span class="p">,</span>
            <span class="nx">base</span>: <span class="kt">file.base</span><span class="p">,</span>
            <span class="nx">path</span>: <span class="kt">file.base</span> <span class="o">+</span> <span class="nx">outputFileName</span><span class="p">,</span>
        <span class="p">};</span>
       <span class="c1">// console.log(output_map);</span>
        <span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">gutil</span><span class="p">.</span><span class="nx">File</span><span class="p">(</span><span class="nx">output_map</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="s1">'&lt;ul&gt;\n'</span><span class="p">;</span>
        <span class="c1">//console.log(filelist.length);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">filelist</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">filelist</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
            <span class="kd">var</span> <span class="nx">rel</span> <span class="o">=</span> <span class="nx">dest</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">f</span><span class="p">.</span><span class="nx">path</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">base</span><span class="p">.</span><span class="nx">length</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\/g</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">);</span>
            <span class="c1">//console.log(rel);              </span>
            <span class="nx">html</span> <span class="o">+=</span> <span class="s1">'&lt;li&gt;&lt;a href="'</span> <span class="o">+</span> <span class="nx">rel</span> <span class="o">+</span> <span class="s1">'"&gt;'</span> <span class="o">+</span> <span class="nx">f</span><span class="p">.</span><span class="nx">frontMatter</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s1">'&lt;/a&gt;&lt;/li&gt;\n'</span><span class="p">;</span>

            <span class="c1">// å„ã‚¢ã‚¤ãƒ†ãƒ ã®frontMatterã«nextã¨prevã‚’ä»˜ã‘ã‚‹</span>
            <span class="c1">// é™é †ã«ä¸¦ã‚“ã§ã„ã‚‹</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// å…ˆé ­</span>
                <span class="nx">f</span><span class="p">.</span><span class="nx">frontMatter</span><span class="p">.</span><span class="nx">next</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
                <span class="nx">f</span><span class="p">.</span><span class="nx">frontMatter</span><span class="p">.</span><span class="nx">prev</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">relative</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">path</span><span class="p">),</span> <span class="nx">filelist</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="nx">path</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\/g</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">===</span> <span class="nx">filelist</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// çµ‚ç«¯</span>
                <span class="nx">f</span><span class="p">.</span><span class="nx">frontMatter</span><span class="p">.</span><span class="nx">next</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">relative</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">path</span><span class="p">),</span> <span class="nx">filelist</span><span class="p">[</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="nx">path</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\/g</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">);</span>
                <span class="nx">f</span><span class="p">.</span><span class="nx">frontMatter</span><span class="p">.</span><span class="nx">prev</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="nx">f</span><span class="p">.</span><span class="nx">frontMatter</span><span class="p">.</span><span class="nx">next</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">relative</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">path</span><span class="p">),</span> <span class="nx">filelist</span><span class="p">[</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="nx">path</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\/g</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">);</span>
                <span class="nx">f</span><span class="p">.</span><span class="nx">frontMatter</span><span class="p">.</span><span class="nx">prev</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">relative</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">path</span><span class="p">),</span> <span class="nx">filelist</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="nx">path</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\/g</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nx">html</span> <span class="o">+=</span> <span class="s1">'&lt;/ul&gt;\n'</span><span class="p">;</span>
        <span class="nx">output</span><span class="p">.</span><span class="nx">contents</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>

        <span class="c1">// filelistã‚’outputã«ãã£ã¤ã‘ã‚‹</span>
        <span class="nx">output</span><span class="p">.</span><span class="nx">filelist</span> <span class="o">=</span> <span class="nx">filelist</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">output</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// callback()ã¯å¿…ãšå®Ÿè¡Œ</span>
    <span class="nx">callback</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">return</span> <span class="nx">through</span><span class="p">.</span><span class="nx">obj</span><span class="p">(</span><span class="nx">transform</span><span class="p">,</span> <span class="nx">flush</span><span class="p">);</span>
</pre>

<p>};</p>
<p>resplit.js
var through = require('through2');
var gutil = require('gulp-util');
var path = require('path');</p>
<p>module.exports = function () {</p>
<pre class="code literal-block"><span></span><span class="kd">function</span> <span class="nx">transform</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// ãƒ•ã‚¡ã‚¤ãƒ«ãŒnullã®å ´åˆ</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">isNull</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">// æ¬¡ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«å‡¦ç†ã‚’æ¸¡ã™ãŸã‚ã«this.push(file)ã—ã¦ãŠã</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
        <span class="c1">// callback()ã¯å¿…ãšå®Ÿè¡Œ</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// ãƒ•ã‚¡ã‚¤ãƒ«ãŒstreamã®å ´åˆï¼ˆã“ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯streamã«å¯¾å¿œã—ãªã„ï¼‰</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">isStream</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">// emit('error')ã‚’ä½¿ã£ã¦ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å‘¼ã³å‡ºã—å´ã«'error'ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç”Ÿã•ã›ã‚‹</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="k">new</span> <span class="nx">gutil</span><span class="p">.</span><span class="nx">PluginError</span><span class="p">(</span><span class="s1">'gulp-diff'</span><span class="p">,</span> <span class="s1">'Streaming not supported'</span><span class="p">));</span>
        <span class="c1">// callback()ã¯å¿…ãšå®Ÿè¡Œ</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// do something</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">file</span><span class="p">.</span><span class="nx">filelist</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">output</span><span class="o">=</span><span class="nx">file</span><span class="p">.</span><span class="nx">filelist</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">output</span><span class="p">);</span>           
    <span class="p">}</span>

    <span class="c1">// callback()ã¯å¿…ãšå®Ÿè¡Œ</span>
    <span class="nx">callback</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">return</span> <span class="nx">through</span><span class="p">.</span><span class="nx">obj</span><span class="p">(</span><span class="nx">transform</span><span class="p">);</span>
</pre>

<p>};</p>
<p>gulfile.js
gulp.task('posts', function () {
    gulp.src(config.posts)
    // frontMatterå‡¦ç†ã—ã¦htmlåŒ–ã™ã‚‹
        .pipe($.frontMatter({ remove: true }))
        .pipe(myFrontmatter())
        .pipe($.markdown())
    // ã¾ã¨ã‚ã¦sortã—ã¦ãƒ¡ã‚¿æƒ…å ±ã‚’ä»˜ä¸ã—ã¦ç›®æ¬¡ã‚’å‡ºåŠ›ã™ã‚‹
        .pipe(makeToc('index.html', { dest: 'posts' }))
        .pipe(gulp.dest('build'))
    // å†ã³åˆ†è§£ã™ã‚‹
        .pipe(resplit())
    // ä»¥é™é€šå¸¸
        .pipe($.debug({ title: 'files:' }))
    // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é©ç”¨ã—ã¦
        .pipe(ejsApplyer({ filename: 'templates/page.ejs' }, { root_path: '../../../../' }))
    // å‡ºåŠ›
        .pipe(gulp.dest('build/posts'))
    ;
});</p>
</div>

<ul class="pager hidden-print">
<li class="previous">
        <a href="../../12/static_site_generator_by_gulp/" rel="prev" title="gulpã§é™çš„ã‚µã‚¤ãƒˆç”Ÿæˆ">
            gulpã§é™çš„ã‚µã‚¤ãƒˆç”Ÿæˆ ğŸ‘ˆ
        </a>
    </li>
    <li style="flex-grow: 1">
    <li class="next">
        <a href="../../15/websocket_upgrade/" rel="next" title="BrowserSyncã®wsè¨­å®šã‚’çŸ¥ã‚‰ãªã‹ã£ãŸã›ã„ã§WebSocketã®UpgradeãŒã†ã¾ãã„ã‹ãªãã¦ã¯ã¾ã‚‹">
            ğŸ‘‰ BrowserSyncã®wsè¨­å®šã‚’çŸ¥ã‚‰ãªã‹ã£ãŸã›ã„ã§WebSocketã®UpgradeãŒã†ã¾ãã„ã‹ãªãã¦ã¯ã¾ã‚‹
        </a>
    </li>
</ul></main><footer id="footer"><p>
            Powered by
            <a href="https://getnikola.com" rel="nofollow">Nikola</a>
        </p>
    </footer>
</body>
</html>
