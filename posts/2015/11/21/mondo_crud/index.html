<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MongoDBでCRUD | 三次元日誌</title>
<link href="../../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="ja" href="../../../../../rss.xml">
<link rel="canonical" href="https://ousttrue.github.io/posts/2015/11/21/mondo_crud/">
<!--[if lt IE 9]><script src="../../../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="ousttrue">
<link rel="prev" href="../../20/starting_jade/" title="Jadeを入れてみる" type="text/html">
<link rel="next" href="../../../../../qiita/typescripthuan-jing-nofen-karinikuitokoro/" title="TypeScript環境の分かりにくいところ" type="text/html">
<meta property="og:site_name" content="三次元日誌">
<meta property="og:title" content="MongoDBでCRUD">
<meta property="og:url" content="https://ousttrue.github.io/posts/2015/11/21/mondo_crud/">
<meta property="og:description" content="“シングルページWebアプリケーション”に説明されている
mongodbをバックエンドに、node.js + expressをフロントエンドにする構成のおさらい。
MongoDB &lt;-&gt; node.js Express &lt;-&gt; Browser
グローバルなnpmパッケージ

npm install -g gulp typescript tsd bower

Windowsの場合、
%USERPRO">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2015-11-21T00:00:00+09:00">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">本文を読み飛ばす</a>

<!-- Header and menu bar -->
<div class="container">
      <header class="blog-header py-3"><div class="row nbb-header align-items-center">
          <div class="col-md-3 col-xs-2 col-sm-2" style="width: auto;">
            <button class="navbar-toggler navbar-light bg-light nbb-navbar-toggler" type="button" data-toggle="collapse" data-target=".bs-nav-collapsible" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse bs-nav-collapsible bootblog4-search-form-holder">
                
            </div>
        </div>
          <div class="col-md-6 col-xs-10 col-sm-10 bootblog4-brand" style="width: auto;">
            <a class="navbar-brand blog-header-logo text-dark" href="../../../../../">

            <span id="blog-title">三次元日誌</span>
        </a>
          </div>
            <div class="col-md-3 justify-content-end align-items-center bs-nav-collapsible collapse flex-collapse bootblog4-right-nav">
            <nav class="navbar navbar-light bg-white"><ul class="navbar-nav bootblog4-right-nav">
<li class="nav-item">
    <a href="index.md" id="sourcelink" class="nav-link">ソース</a>
    </li>


                    
            </ul></nav>
</div>
    </div>
</header><nav class="navbar navbar-expand-md navbar-light bg-white static-top"><div class="collapse navbar-collapse bs-nav-collapsible" id="bs-navbar">
            <ul class="navbar-nav nav-fill d-flex w-100">
<li class="nav-item">
<a href="../../../../../books" class="nav-link">MemoBooks</a>
                </li>
<li class="nav-item">
<a href="../../../../../archive.html" class="nav-link">Archives</a>
                </li>
<li class="nav-item">
<a href="../../../../../categories/index.html" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../../../../rss.xml" class="nav-link">RSS feed</a>
                </li>
<li class="nav-item">
<a href="../../../../../about" class="nav-link">About</a>

                
            </li>
</ul>
</div>
<!-- /.navbar-collapse -->
</nav>
</div>

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">MongoDBでCRUD</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    ousttrue
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2015-11-21T00:00:00+09:00" itemprop="datePublished" title="2015-11-21 00:00">2015-11-21 00:00</time></a>
            </p>
            
        <p class="sourceline"><a href="index.md" class="sourcelink">ソース</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>“シングルページWebアプリケーション”に説明されている
mongodbをバックエンドに、node.js + expressをフロントエンドにする構成のおさらい。
MongoDB &lt;-&gt; node.js Express &lt;-&gt; Browser</p>
<p>グローバルなnpmパッケージ</p>
<blockquote>
<p>npm install -g gulp typescript tsd bower</p>
</blockquote>
<p>Windowsの場合、
%USERPROFILE%\AppData\Roaming\npm</p>
<p>にインストールされるのでパスを通しておく。
Expressの準備
app.js</p>
<blockquote>
<p>mkdir mongocrud
cd mongocrud
mongocrud&gt; npm init -y
mongocrud&gt; npm install express --save</p>
</blockquote>
<p>// app.js
var http=require('http');
var express=require('express');</p>
<p>var port=process.env.port || 3000;
var app=express();
var server=http.createServer(app);</p>
<p>app.get('/', function(request, response){
    response.send('Hello Express');
});</p>
<p>server.listen(port);</p>
<p>起動</p>
<blockquote>
<p>node app.js</p>
</blockquote>
<p>http://localhost:3000
で動作を確認する。
loggerや静的ファイル提供などのミドルウェアを追加
mongocrud&gt; npm install body-parser method-override connect-logger errorhandler serve-static --save</p>
<p>// app.js
// app.getの前
var bodyparser=require('body-parser');
var methodoverride = require('method-override');
var logger = require('connect-logger');
var errorhandler = require('errorhandler');
var servestatic = require('serve-static');
var serve_dir=__dirname + "/client";
console.log("serve %s", serve_dir);
app
.use(bodyparser())
.use(methodoverride())
.use(logger())
.use(errorhandler({
    dumpExceptioons: true,
    showStack: true
}));
.use(servestatic(serve_dir))</p>
<p>gulpで静的なファイルを’./build/client’下にコピーするタスクを定義する</p>
<h2>gulpfile.coffeeにタスクを追加</h2>
<h2></h2>
<h2>client</h2>
<h2></h2>
<p>gulp.task 'client', -&gt;
    gulp.src config.src_client
        .pipe gulp.dest config.dst_client
        .pipe browserSync.stream()</p>
<h2>tasks</h2>
<p>gulp.task 'watch', -&gt;
    gulp.watch config.src_ts, ['ts']
    gulp.watch config.src_client, ['client']</p>
<p>gulpでサーバー起動とブラウザの自動オープンタスクを定義する
いろいろ入用になるのでgulpを準備する。
まずは、nodemonとbrowser-syncを導入して
app.js起動と起動したアプリをブラウザで自動で開くタスクを定義する。
mongocrud&gt; npm install gulp gulp-load-plugins gulp-nodemon browser-sync -D</p>
<p>// gulpfile.js
var gulp = require('gulp');
var $ = require("gulp-load-plugins")();
var browserSync = require("browser-sync").create();
var port = 5000;</p>
<p>gulp.task('serve', function () {
    $.nodemon({
        script: 'app.js',
        exp: 'js',
        ignore: [],
        env: {
            port: port
        }
    })
    .on('restart', function () { browserSync.reload(); });
});</p>
<p>gulp.task('browser-sync', ['serve'], function () {
    browserSync.init({
        proxy: "localhost:" + port
    });
});</p>
<p>gulp.task('default', ['browser-sync']);</p>
<p>BrowserSyncのReloadが動くには出力がhtmlである必要がある(bodyタグの中に細工をするため)。
// app.jsの修正
app.get('/', function(request, response){
    response.setHeader('content-type', 'text/html');
    response.send('</p>Hello html');
});
<p>mongocrud&gt; gulp</p>
<p>でnodemonが起動してブラウザが自動で開始される。
app.jsの内容を変えるとブラウザがリロードされる。
が、リロードが速すぎて内容が更新されないことが判明。
リロードを遅延させる策を講じる。
// app.jsの最後尾に追加
console.log('start %d', port);</p>
<p>app.jsからのコンソール出力を監視する。
// gulpfile.jsの修正</p>
<pre class="code literal-block"><span></span><span class="o">$</span><span class="nf">.nodemon</span><span class="p">({</span>
    <span class="n">script</span><span class="o">:</span> <span class="n">config.app_entry</span><span class="p">,</span>
    <span class="n">exp</span><span class="o">:</span> <span class="s">'js'</span><span class="p">,</span>
    <span class="n">ignore</span><span class="o">:</span> <span class="n">[]</span><span class="p">,</span>
    <span class="n">env</span><span class="o">:</span> <span class="p">{</span>
        <span class="n">port</span><span class="o">:</span> <span class="n">config.app_port</span>
    <span class="p">},</span>
    <span class="n">stdout</span><span class="o">:</span> <span class="n">false</span> <span class="o">//</span> <span class="o">&lt;-</span> 必要
<span class="p">})</span>
<span class="o">//</span><span class="nf">.on</span><span class="p">(</span><span class="s">'restart'</span><span class="p">,</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span> <span class="nf">browserSync.reload</span><span class="p">();</span> <span class="p">});</span>
<span class="nf">.on</span><span class="p">(</span><span class="s">'readable'</span><span class="p">,</span> <span class="nf">function</span><span class="p">(){</span>
    <span class="nf">this.stdout.on</span><span class="p">(</span><span class="s">'data'</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">chunk</span><span class="p">){</span>
        <span class="nf">if </span><span class="p">(</span><span class="o">/</span><span class="n">^start</span> <span class="o">/</span><span class="nf">.test</span><span class="p">(</span><span class="n">chunk</span><span class="p">)){</span>
            <span class="nf">console.log</span><span class="p">(</span><span class="s">'reloading...'</span><span class="p">);</span>
            <span class="nf">browserSync.reload</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="nf">process.stdout.write</span><span class="p">(</span><span class="n">chunk</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre>

<p>gulpfile.jsをgulpfile.coffeeにする
gulpcrud&gt; npm install coffee-script -D</p>
<p>gulpfile.jsを書き換える。gulp-3.9.0では既にcoffee script対応が成されているようで、
gulpfile.jsの拡張子を変えてgulpfile.coffeeとリネームして中身を書き換えてから
mongocrud&gt; gulp</p>
<p>としたら特にオプション等を指定することなくgulpはgulpfile.coffeeを見つけてくれて動いた。</p>
<h2>gulpfile.coffee</h2>
<p>gulp = require('gulp');
$ = require("gulp-load-plugins")();
browserSync = require("browser-sync").create();
port = 5000;</p>
<p>gulp.task 'serve', -&gt;
    $.nodemon({
        script: 'app.js',
        exp: 'js',
        ignore: [],
        env: {
            port: port
        }
    })
    .on 'readable', -&gt;
        this.stdout.on 'data', (chunk) -&gt;
            if (/^start /.test(chunk))
                console.log('reloading...')
                browserSync.reload()
            process.stdout.write(chunk);</p>
<p>gulp.task 'browser-sync', ['serve'], -&gt;
    browserSync.init({
        proxy: "localhost:" + port
    })</p>
<p>gulp.task('default', ['browser-sync']);</p>
<p>TypeScriptにする
app.jsをsrc/app.tsに移動する。
// src/app.ts
declare function require(name: string):any;
declare var process;</p>
<p>var http=require('http');
var express=require('express');</p>
<p>var port=process.env.port || 3000;
var app=express();
var server=http.createServer(app);</p>
<p>app.get('/', function(request, response){
    response.setHeader('content-type', 'text/html');
    response.send('</p>Hello');
});
<p>server.listen(port);
console.log('start %d', port);</p>
<p>コンパイルが通るようにアンビエント宣言を追加した。
gulpにコンパイルタスクを定義する。
serveタスクの前にtsタスクを実行し、
tsファイルの更新をwatchしてtsタスクを起動するように調整した。</p>
<h2>gulpfile.coffee</h2>
<p>gulp = require('gulp');
$ = require("gulp-load-plugins")();
browserSync = require("browser-sync").create();</p>
<p>config = {
    src_ts: './src/<strong>/*.ts', <br>
    dst_js_dir: './build/js',
    dst_watch: './build/</strong>/*.js',
    app_entry: './build/js/app.js',
    app_port: 5000
}</p>
<h2></h2>
<h2>compile typescript</h2>
<h2></h2>
<p>gulp.task 'ts', -&gt;
  gulp.src config.src_ts
    .pipe $.typescript({
      target: 'ES6'
      removeComments: true
    }).js
    .pipe gulp.dest config.dst_js_dir</p>
<h2></h2>
<h2>start js app</h2>
<h2></h2>
<p>gulp.task 'serve', ['ts'], -&gt;
    $.nodemon({
        script: config.app_entry,
        exp: 'js',
        ignore: [],
        env: {
            port: config.app_port
        },
        stdout: false
    })
    #.on 'restart', -&gt;
    #    browserSync.reload();
    .on 'readable', -&gt;
        this.stdout.on 'data', (chunk) -&gt;
            if (/^start /.test(chunk))
                console.log('reloading...')
                browserSync.reload()
            process.stdout.write(chunk);</p>
<h2></h2>
<h2>start browser-sync</h2>
<h2></h2>
<p>gulp.task 'browser-sync', ['serve'], -&gt;
    browserSync.init({
        proxy: "http://localhost:" + config.app_port
    })</p>
<h2>tasks</h2>
<p>gulp.task 'watch', -&gt;
    gulp.watch config.src_ts, ['ts']</p>
<p>gulp.task('default', ['watch', 'browser-sync']);</p>
<p>typescriptを型安全にする
コンパイラオプションを定義するtsconfig.jsonを生成する(要tsc-1.6以上)。
mongocrud&gt; tsc --init</p>
<p>手で作ってもよし
tsconfig.json
{
    "compilerOptions": {
        "module": "commonjs",
        "target": "es5",
        "noImplicitAny": true,
        "outDir": "build",
        "rootDir": ".",
        "sourceMap": false
    },
    "filesGlob": [
        "./typings/<strong>/*.d.ts",
        "./src/</strong>/*.ts"
    ]
}</p>
<p>VSCodeの場合、tsconfig.jsonを変えたらVSCodeを再起動するべし。
filesGlobは必要で、無いとインテリセンスが遅くなる(Loading…)。
tsタスクがtsconfig.jsonを使うようにする。</p>
<h2>gulpfile.coffee</h2>
<p>gulp.task 'ts', -&gt;
  tsconfig = require('tsconfig.json')<br>
  gulp.src config.src_ts
    .pipe $.typescript(tsconfig.compilerOptions).js
    .pipe gulp.dest config.dst_js_dir</p>
<p>tsdを初期化して、node.jsとexpressのtypescript定義を取得する。
mongocrud&gt; tsd init
mongocrud&gt; tsd query node express -rosa install</p>
<p>src/app.ts
/// <reference path="../typings/tsd.d.ts"></reference>
import http = require('http');
import express=require('express');</p>
<p>var port=process.env.port || 3000;
var app=express();
var server=http.createServer(app);</p>
<p>app.get('/', (request, response) =&gt; {
    response.setHeader('content-type', 'text/html');
    response.send('</p>Hello ts');
});
<p>server.listen(port);
console.log('start %d', port);</p>
<p>MongoDBのCRUDを定義する
mongodbをインストールする。
Windowsの場合、MongoDBがデフォルトの”Program Files”にインストールされるとパスにスペースが入って
gulpからの起動時にエスケープと戦う必要が生じるので、
C:\MongoDB</p>
<p>にインストールした。
gulpでmongodbを起動する
mongocrud&gt; npm i sprintf-js -D</p>
<h2>gulpfile.coffee</h2>
<p>MONGO_EXE = 'C:/MongoDB/bin/mongod.exe';</p>
<h2></h2>
<h2>Running mongo</h2>
<h2></h2>
<h2>http://stackoverflow.com/a/28048696/46810</h2>
<p>sprintf = require('sprintf-js').sprintf;
fs = require('fs');
exec = require('child_process').exec;
gulp.task 'mongodb:start', (cb)-&gt;
    command=sprintf('%s --dbpath %s'
        , MONGO_EXE, config.mongo_data);
    if(!fs.existsSync(config.mongo_data))
        fs.mkdirSync(config.mongo_data);
    exec command, (err, stdout, stderr) -&gt;
        console.log(stdout);
        console.log(stderr);
    cb();</p>
<p>app.tsからmongodbにアクセスする
mongocrud&gt; npm install mongodb --save
mongocrud&gt; tsd query mongodb -rosa install</p>
<p>src/app.ts
/// <reference path="../typings/tsd.d.ts"></reference></p>
<p>// mongodb
import mongodb = require('mongodb');
let mongoServer = new mongodb.Server(
    'localhost', 27017
);
let dbHandle = new mongodb.Db(
    'crud', mongoServer, {w: 1}
);
dbHandle.open(()=&gt;{
   console.log("connected to mongoDB"); 
});</p>
<p>// http
import http = require('http');
import express = require('express');
let port = process.env.port || 3000;
let app = express();
let server = http.createServer(app);
app.get('/', (request, response) =&gt; {
    response.setHeader('content-type', 'text/html');
    response.send('</p>Hello ts');
});
<p>server.listen(port);
console.log('start %d', port);</p>
<p>CRUDを定義する
Creating a REST API using Node.js, Express, and MongoDB
を参考に実装。
src/app.tsのデータにアクセスする部分をsrc/mongodb.tsに分離した。
src/app.ts
/// <reference path="../typings/tsd.d.ts"></reference>
import mongocrud = require('./mongocrud');</p>
<p>//
// Express
//
import http = require('http');
import express = require('express');</p>
<p>let port = process.env.port || 3000;
let app = express();
let server = http.createServer(app);</p>
<p>let bodyparser=require('body-parser');
let methodoverride = require('method-override');
let logger = require('connect-logger');
let errorhandler = require('errorhandler');
app
.use(bodyparser())
.use(methodoverride())
.use(logger())
.use(errorhandler({
    dumpExceptioons: true,
    showStack: true
}));</p>
<p>app.get('/', (request, response) =&gt; {
    response.setHeader('content-type', 'text/html');
    response.send('</p>Hello ts');
});
server.listen(port);
<p>// restful
app.all('/api/:obj_type/*', (req, res, next)=&gt;{
   res.contentType('json');
   next(); 
});
app.get('/api/:obj_type', mongocrud.findAll);
app.get('/api/:obj_type/:id', mongocrud.findById);
app.post('/api/:obj_type', mongocrud.add);
app.put('/api/:obj_type/:id', mongocrud.update);
app.delete('/api/:obj_type/:id', mongocrud.del);</p>
<p>// launchded
console.log('start %d', port);</p>
<p>src/mongocrud.ts
/// <reference path="../typings/tsd.d.ts"></reference>
//
// MongoDB
//
import mongodb = require('mongodb');
let mongoServer = new mongodb.Server(
    'localhost', 27017
);
let db = new mongodb.Db(
    'crud', mongoServer, { w: 1 }
);
db.open(() =&gt; {
    console.log("connected to mongoDB");
    populateDB();  <br>
});</p>
<p>//
// CRUD
//
import express = require('express');
export var findById = (req: express.Request, res: express.Response) =&gt; {
    let obj_type = req.params.obj_type;
    let id = req.params.id;
    console.log('Retrieving %s: %s', obj_type, id);
    db.collection(obj_type, (err, collection) =&gt; {
        collection.findOne({ '_id': new mongodb.ObjectID(id) }, (err, item) =&gt; {
            res.send(item);
        });
    });
};</p>
<p>export var findAll = (req: express.Request, res: express.Response) =&gt; {
    let obj_type = req.params.obj_type;
    db.collection(obj_type, (err, collection) =&gt; {
        collection.find().toArray((err, items) =&gt; {
            res.send(items);
        });
    });
};</p>
<p>export var add = (req: express.Request, res: express.Response) =&gt; {
    let obj_type = req.params.obj_type;
    let body = req.body;
    console.log('Adding %s: %s', obj_type, JSON.stringify(body));
    db.collection(obj_type, (err, collection) =&gt; {
        collection.insert(body, { safe: true }, (err, result) =&gt; {
            if (err) {
                res.send({ 'error': 'An error has occurred' });
            } else {
                console.log('Success: ' + JSON.stringify(result[0]));
                res.send(result[0]);
            }
        });
    });
}</p>
<p>export var update = (req: express.Request, res: express.Response) =&gt; {
    let obj_type = req.params.obj_type;
    let id = req.params.id;
    let body = req.body;
    console.log('Updating %s: %s', obj_type, id);
    console.log(JSON.stringify(body));
    db.collection('wines', (err, collection) =&gt; {
        collection.update({ '_id': new mongodb.ObjectID(id) },
            body, { safe: true }, (err, result) =&gt; {
                if (err) {
                    console.log('Error updating wine: ' + err);
                    res.send({ 'error': 'An error has occurred' });
                } else {
                    console.log('%s document(s) updated', result);
                    res.send(body);
                }
            });
    });
}</p>
<p>export function del(req: express.Request, res: express.Response){
    let obj_type = req.params.obj_type;
    var id = req.params.id;
    console.log('Deleting %s: %s', obj_type, id);
    db.collection(obj_type, (err, collection) =&gt; {
        collection.remove({ '_id': new mongodb.ObjectID(id) },
            { safe: true }, (err, result) =&gt; {
                if (err) {
                    res.send({ 'error': 'An error has occurred - ' + err });
                } else {
                    console.log('%s document(s) deleted', result);
                    res.send(req.body);
                }
            });
    });
}</p>
<p>// Populate database with sample data -- Only used once: the first time the application is started.
// You'd typically not find this code in a real-life app, since the database would already exist.
function populateDB() {
    console.log('populateDB...');</p>
<pre class="code literal-block"><span></span><span class="nt">var</span> <span class="nt">wines</span> <span class="o">=</span> <span class="cp">[</span>
    <span class="p">{</span>
        <span class="nx">name</span><span class="p">:</span> <span class="s2">"CHATEAU DE SAINT COSME"</span><span class="p">,</span>
        <span class="nx">year</span><span class="p">:</span> <span class="s2">"2009"</span><span class="p">,</span>
        <span class="nx">grapes</span><span class="p">:</span> <span class="s2">"Grenache / Syrah"</span><span class="p">,</span>
        <span class="nx">country</span><span class="p">:</span> <span class="s2">"France"</span><span class="p">,</span>
        <span class="nx">region</span><span class="p">:</span> <span class="s2">"Southern Rhone"</span><span class="p">,</span>
        <span class="nx">description</span><span class="p">:</span> <span class="s2">"The aromas of fruit and spice..."</span><span class="p">,</span>
        <span class="nx">picture</span><span class="p">:</span> <span class="s2">"saint_cosme.jpg"</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="nx">name</span><span class="p">:</span> <span class="s2">"LAN RIOJA CRIANZA"</span><span class="p">,</span>
        <span class="nx">year</span><span class="p">:</span> <span class="s2">"2006"</span><span class="p">,</span>
        <span class="nx">grapes</span><span class="p">:</span> <span class="s2">"Tempranillo"</span><span class="p">,</span>
        <span class="nx">country</span><span class="p">:</span> <span class="s2">"Spain"</span><span class="p">,</span>
        <span class="nx">region</span><span class="p">:</span> <span class="s2">"Rioja"</span><span class="p">,</span>
        <span class="nx">description</span><span class="p">:</span> <span class="s2">"A resurgence of interest in boutique vineyards..."</span><span class="p">,</span>
        <span class="nx">picture</span><span class="p">:</span> <span class="s2">"lan_rioja.jpg"</span>
    <span class="p">}</span><span class="cp">]</span><span class="o">;</span>

<span class="nt">db</span><span class="p">.</span><span class="nc">collection</span><span class="o">(</span><span class="s1">'wines'</span><span class="o">,</span> <span class="o">(</span><span class="nt">err</span><span class="o">,</span> <span class="nt">collection</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="err">collection.find().toArray((err,</span> <span class="err">items)</span> <span class="err">=&gt;</span> <span class="err">{</span>
        <span class="err">if(items.length==0){</span>
            <span class="err">//</span> <span class="err">if</span> <span class="err">empty</span>
            <span class="err">console.log('insert</span> <span class="n">wines</span><span class="p">:</span> <span class="s1">' + JSON.stringify(wines));</span>
<span class="s1">            db.collection('</span><span class="n">wines</span><span class="err">'</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span> <span class="err">{</span>
                <span class="n">collection</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">wines</span><span class="p">,</span> <span class="err">{</span> <span class="n">safe</span><span class="err">:</span> <span class="n">true</span> <span class="err">}</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="err">{</span> <span class="err">}</span><span class="p">);</span>
            <span class="p">}</span><span class="o">);</span>
        <span class="err">}</span>
    <span class="err">}</span><span class="o">);</span>
<span class="err">}</span><span class="o">);</span>
</pre>

<p>};</p>
<p>ブラウザ向けのGUIを作る
ざっくりレイアウト</p>

<p>
</p>
    <meta charset="UTF-8">
<title>Document</title>
<link rel="stylesheet" href="css/style.css">
<script src="js/client.js"></script><div class="header">
    <form action="select">
        <span class="label">collection name</span>
        <input type="text"><button>Select</button>
    </form>
</div>
<div class="body">
    <div class="left">
        <div class="list">

        </div>
        <form action="add">
            <button>Add</button>
        </form>
    </div>
    <div class="right">
        <form>
            <textarea name="detail"></textarea><button>Load</button>
            <button>Save</button>
        </form>
    </div>
</div>
<div class="footer">
    <ul class="log"></ul>
</div>

<p></p>
<ul>
<li>{
margin: 0;
padding: 0;
}</li>
</ul>
<p>html{
    font-size: 62.5%;
}</p>
<p><em>, </em>::before, *::after {
    box-sizing: border-box;
}</p>
<p>.header{
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 64px;
    background-color: #faa;
}
.body{
    position: absolute;
    top: 64px;
    left: 0;
    right: 0;
    bottom: 128px;
    background-color: #afa;
}
.body .left {
    position: absolute;
    left: 0;
    width: 200px;
    top: 0;
    bottom: 0;
    background-color: #282;
}
.body .right {
    position: absolute;
    left: 200px;
    right: 0;
    top: 0;
    bottom: 0;
    background-color: #828; <br>
}
.footer{
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
    height: 128px;
    background-color: #aaf;
}</p>
<p>alert('hello');</p>
<p>jqueryを追加
mongocrud&gt; cd client
mongocrud/client&gt; bower init
mongocrud/client&gt; bower install jquery --save</p>
<p>まとまりが無くなってきた。
別のページに整理しなおそう。
あとから、coffee-scriptやtypescritpを導入すると手順としては冗長になりすぎるな。
最初から、NoDemon, Express, BrowserSyync, gulpfile.coffee, typescript, scssの構成にしよう。</p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../../20/starting_jade/" rel="prev" title="Jadeを入れてみる">一つ前の記事</a>
            </li>
            <li class="next">
                <a href="../../../../../qiita/typescripthuan-jing-nofen-karinikuitokoro/" rel="next" title="TypeScript環境の分かりにくいところ">次の記事</a>
            </li>
        </ul></nav></aside></article><!--End of body content--><footer id="footer">
            Contents © 2021         <a href="mailto:ousttrue@gmail.com">ousttrue</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
            
        </footer>
</div>
</div>


        <script src="../../../../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
