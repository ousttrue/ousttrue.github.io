<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="generator" content="Nikola (getnikola.com)">
<meta name="viewport" content="width=device-width">
<script src="../../../../../assets/js/all-nocdn.js"></script><title>Three.jsã®Build | ä¸‰æ¬¡å…ƒæ—¥èªŒ</title>
<link href="../../../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
</head>
<body>
    <h1 id="brand">
        <a href="../../../../../" title="ä¸‰æ¬¡å…ƒæ—¥èªŒ" rel="home">
            <span id="blog-title">ä¸‰æ¬¡å…ƒæ—¥èªŒ</span>
        </a>
    </h1>

    <nav id="menu"><ul>
<li><a href="../../../../../archive.html">Archives</a></li>
<li><a href="../../../../../categories/index.html">Tags</a></li>
<li><a href="../../../../../rss.xml">RSS feed</a></li>
<li><a href="../../../../../about">About</a></li>
<li><a href="../../../../../books">MemoBooks</a></li>

            
            
            
        </ul></nav><hr>
<main id="content"><h1 class="p-name entry-title" itemprop="headline name">
    <h1 class="p-name entry-title" itemprop="headline name">
    <a href="." class="u-url">Three.jsã®Build
    </a>
</h1>
<ul itemprop="keywords" class="tags">
<li>
        <time datetime="2015-12-08T00:00:00+09:00" title="2015-12-08">2015-12-08</time>
</li>
</ul>
</h1>

<div>
<p>éª¨å…¥ã‚Šãƒ¢ãƒ‡ãƒ«ã¨ã‹ã‚„ã£ã¦ã¿ã‚ˆã†ã‹ã¨æ€ã£ãŸã®ã ã‘ã©ã€ãã®å‰ã«Three.jsã®ã‚½ãƒ¼ã‚¹ã‚’è¦‹ã‚„ã™ã„çŠ¶æ…‹ã§ä½œæ¥­ã—ãŸã„ã€‚
çµåˆå‰ã®Three.jsã‚’è‡ªå‰ãƒ“ãƒ«ãƒ‰ã—ãªãŒã‚‰é‹ç”¨ã™ã‚‹æ–¹æ³•ã‚’èª¿ã¹ã¦ã¿ã‚‹ã€‚
build.py, or how to generate a compressed three.js file
ã¨æœ¬å®¶ã«æ›¸ã„ã¦ã‚ã‚‹ã€‚pythonä½¿ã†ã‚“ã‹ã€‚gulpã§ã‚„ã‚Šã¦ã‡ãªã€‚
å…¨éƒ¨concatã—ã¦uglifyã—ãŸã‚‰ã„ã„ã‚“ã˜ã‚ƒãªã„ã‹ã€‚
ã‚„ã£ã¦ã¿ã‚ˆã†ã€‚
ã¨ã‚Šã‚ãˆãšbowerã§å°å…¥ã—ãŸthree.jsé–¢é€£ã‚’å‰Šé™¤ã€‚
threejs.srcãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œã£ã¦three.jsã‚½ãƒ¼ã‚¹ã®srcãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä¸­èº«ã‚’å±•é–‹ã—ãŸã€‚
gulp.task('bowerjs', function () {</p>
<pre class="code literal-block"><span></span><span class="x">var files = [</span>
<span class="x">    './bower_components/jquery/dist/jquery.js',</span>
<span class="x">    './bower_components/highlightjs/highlight.pack.js',</span>
<span class="x">    './bower_components/stats.js/build/stats.min.js',</span>
<span class="x">    './lib/**/*.js', // &lt;-- ä¸­ã«three.jsã®srcã‚’ã‚³ãƒ”ãƒ¼ã—ãŸ</span>
<span class="x">];</span>
<span class="x">gulp.src(files)</span>
<span class="x">    .pipe($.plumber({ errorHandler: $.notify.onError('</span><span class="cp">&lt;%=</span> <span class="n">error</span><span class="o">.</span><span class="n">message</span> <span class="cp">%&gt;</span><span class="x">') }))</span>
<span class="x">    .pipe($.debug({ title: 'bowerjs files:' }))</span>
<span class="x">    .pipe($.sourcemaps.init())</span>
<span class="x">    //.pipe($.uglify())</span>
<span class="x">    .pipe($.concat('all.min.js'))</span>
<span class="x">    .pipe($.sourcemaps.write('./', {</span>
<span class="x">        sourceMappingURL: function (file) {</span>
<span class="x">            return file.relative + '.map';</span>
<span class="x">        }</span>
<span class="x">    }))</span>
<span class="x">    .pipe(gulp.dest('build/js'))</span>
<span class="x">    .pipe(browser.reload({ stream: true }))</span>
<span class="x">;</span>
</pre>

<p>});</p>
<p>ã“ã‚Œã§ä½œã£ãŸall.min.jsã§ã¯ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã ã‚ã§ã™ã­ã€‚
å˜ã«srcã‚’concatã™ã‚‹ã ã‘ã§ã¯ã ã‚ã ã€‚æœ¬å®¶ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿å§‹ã‚ã‚‹ã€‚
/three.js/utils/build/</p>
<p>ã§ãƒ“ãƒ«ãƒ‰ã§ãã‚‹ã‚ˆã£ã¦æ›¸ã„ã¦ã‚ã‚Šã¾ã™ã€‚pythoné–¢ä¿‚ãªã„ã¿ãŸã„ã ã€‚</p>
<blockquote>
<p>npm install
node build.js --include common --include extras</p>
</blockquote>
<p>ãªã‚‹ã»ã©build.jsã‚’è¦‹ã¦ã¿ã‚ˆã†ã€‚
includeã£ã¦ãªã‚“ã ã‚ã†ã¨èª¿ã¹ã¦ã¿ã‚‹ã¨
/three.js/utils/build/includes</p>
<p>ã«jsonãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šä¸­ã«jsãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒªã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹ã€‚
ãªã‚‹ã»ã©ã€‚srcä¸‹ã‚’å…¨éƒ¨concatã™ã‚‹ã®ã§ã¯ãªãã“ã“ã«æ›¸ã„ã¦ã‚ã‚‹ã‚‚ã®ã‚’ã€æ›¸ã„ã¦ã‚ã‚‹é †ã§concatã™ã‚Œã°ã„ã„ã‚“ã§ãªã„ã‹ã€‚
// 
gulp.task('threejs:build', function(){
    var common=JSON.parse(fs.readFileSync('three.js/includes/common.json')).map(function(v, i){ return 'three.js/'+v; });
    gulp.src(common)
        .pipe($.concat('three.js'))
        .pipe(gulp.dest('./lib'))
        ;
});</p>
<p>gulp.task('bowerjs', ['threejs:build'], function () {
    // å‰ã¨åŒã˜
}
````</p>
<p>ã“ã‚Œã§å®Ÿè¡Œã™ã‚‹ã¨ãã‚Œã£ã½ã„three.jsãŒå‡ºã¦ãã‚‹ãŒã€ã¾ã ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã€‚
ã§ã‚¨ãƒ©ãƒ¼è¡Œã«é£›ã¶ã¨ifdefãŒã‚ã‚‹ã€‚ãªã‚“ã ã“ã‚Œã¯ã€‚</p>
<p>```glsl</p>
<h2>ifdef USE_ALPHAMAP</h2>
<pre class="code literal-block"><span></span>diffuseColor.a *= texture2D( alphaMap, vUv ).g;
</pre>

<h2>endif</h2>
<p>glslã ãƒ»ãƒ»ãƒ»ã€‚
ç¢ºã‹ã«ã€build.jså†…ã§æ‹¡å¼µå­ãŒglslã®ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘åˆ¥å‡¦ç†ã«ãªã£ã¦ã„ã‚‹ã€‚
if( file.indexOf( '.glsl') &gt;= 0 ) {</p>
<pre class="code literal-block"><span></span>contents = 'THREE.ShaderChunk[ \'' +
    path.basename( file, '.glsl' ) + '\' ] =' +
    JSON.stringify( contents ) + ';\n';
</pre>

<p>}</p>
<p>ã¡ã‚‡ã£ã¨gulpã®ãƒ•ã‚£ãƒ«ã‚¿ã‚’ä½œã‚Šã¾ã™ã‹ã€‚
three.shaderchunk.js
var through = require('through2');
var gutil = require('gulp-util');
var fs = require('fs');
var path = require('path');</p>
<p>module.exports = function () {</p>
<pre class="code literal-block"><span></span>return through.obj(function (file, enc, cb) {

    if (file.isStream()) {
        cb(new gutil.PluginError('three.shadechunk', 'Streaming not supported'));
        return;
    }

    if (path.extname(file.path).toLowerCase() == '.glsl') {
        var contents = 'THREE.ShaderChunk[ \'' +
            path.basename(file.path, '.glsl') + '\' ] =' +
            JSON.stringify(file.contents.toString()) + ';\n';
        file.contents = new Buffer(contents);
        file.path = file.path + ".js";
    }

    this.push(file);

    cb();
});
</pre>

<p>}</p>
<p>gulpãƒ•ã‚¡ã‚¤ãƒ«ã®å‘¼ã³å‡ºã—ã®æ–¹ã€‚ã“ã‚Œã§three.js/srcã‹ã‚‰three.jsã‚’ä½œæˆã§ããŸã€‚
ã‚ã¨ã¯ã€sourcemapãŒä»˜ãã‚ˆã†ã«ã—ãŸã€‚
gulpfile.js
gulp.task('threejs:build', function(){
    var common=JSON.parse(fs.readFileSync('three.js/includes/common.json'))
    .map(function(v, i){ return 'three.js/'+v; });
    var extras=JSON.parse(fs.readFileSync('three.js/includes/extras.json'))
    .map(function(v, i){ return 'three.js/'+v; });
    gulp.src(common.concat(extras))
        .pipe(threeShaderchunk())
        .pipe($.concat('three.js'))
        .pipe(gulp.dest('./lib'))
        ;
});</p>
<p>FireFoxã§ãƒ–ãƒ¬ã‚¤ã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’ä»•æ›ã‘ã¦ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œã§ããŸã€‚
ã“ã‚Œã§ã€Loaderã®è‡ªä½œã¨ã‹ãŒæ—ã‚‹ãã€‚</p>
</div>

<hr>
<ul class="pager hidden-print">
<li class="previous">
        <a href="../../07/threejs_04/" rel="prev" title="Three.jsã®JSONãƒ¢ãƒ‡ãƒ«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ">
            Three.jsã®JSONãƒ¢ãƒ‡ãƒ«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ ğŸ‘ˆ
        </a>
    </li>
    <li style="flex-grow: 1">
    <li class="next">
        <a href="../../09/threejs_editor/" rel="next" title="Three.jsã®Editor">
            ğŸ‘‰ Three.jsã®Editor
        </a>
    </li>
</ul></main><footer id="footer"><p>
            Powered by
            <a href="https://getnikola.com" rel="nofollow">Nikola</a>
        </p>
    </footer>
</body>
</html>
