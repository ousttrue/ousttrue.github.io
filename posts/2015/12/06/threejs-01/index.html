<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>三次元日誌</title>

    

  <script src="https://ousttrue.github.io/plugins/elasticlunr.min.js" defer></script>
  <script src="https://ousttrue.github.io/search_index.en.js" defer></script>
  <script src="https://ousttrue.github.io/js/search.js" defer></script>

    

     
    <link rel="stylesheet" href="https://ousttrue.github.io/main.css">
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css"
      />
    
  </head>

  <body class="container">
    <a class="site_title" href="https:&#x2F;&#x2F;ousttrue.github.io&#x2F;">
      <div>三次元日誌</div>
    </a>

    <nav class="nav">
      <a class="item" href="/tags/">tags</a>
      <a class="item" href="https://github.com/ousttrue" aria-label="github">
        <i class="fab fa-github fa-lg"></i>
      </a>
      

        
            <form class="navbar-form">
                <input id="userinput" class="form-control is-search" type="search" placeholder="Search docs..."
                    aria-label="Search docs..." autocomplete="off">
                <div id="suggestions" class="shadow bg-white rounded"></div>
            </form>
        
    </nav>

    <main class="main">
<div class="page">
<div class="content">
  <div class="headline">
  
  

  
  <a class="headline_title" href="https:&#x2F;&#x2F;ousttrue.github.io&#x2F;posts&#x2F;2015&#x2F;12&#x2F;06&#x2F;threejs-01&#x2F;"> TypeScriptでThree.jsことはじめ 
  

  
  </a>

  

  <div>
    <ul class="tags">
      <li class="headline_date">
        <div class="year">2015</div>
        <div class="md">1206</div>
      </li>
      
      

    </ul>
  </div>
</div>
 <p>source
TypeScriptを学び始めた目的のひとつであるThree.jsをようやくはじめた。
「Node.jsとSocket.IOで連結してリアルタイムにシーンをアニメーションするっ」とか
遠大な構想だったのだが小さいところから始めよう。
hello world的な
本家のgetting started
htmlにスクリプトを追加。</p>
<script src="threejs_01.js"></script>
<p>threejs_01.js
var scene = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(75
, window.innerWidth / window.innerHeight
, 0.1, 1000);</p>
<p>var renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);</p>
<p>var geometry = new THREE.BoxGeometry(1, 1, 1);
var material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
var cube = new THREE.Mesh(geometry, material);
scene.add(cube);</p>
<p>camera.position.z = 5;</p>
<p>var render = function() {
requestAnimationFrame(render);</p>
<pre style="background-color:#2b303b;">
<code>cube.rotation.x += 0.1;
cube.rotation.y += 0.1;

renderer.render(scene, camera);
</code></pre>
<p>};</p>
<p>render();</p>
<p>typescript化する。
gulpにタスクを仕込んだので拡張子をtsにして待つのみ。
error TS2304: Cannot find name 'THREE'</p>
<p>three.jsの型定義が無いので追加。</p>
<blockquote>
<p>tsd query three -rosa install</p>
</blockquote>
<p>tsの先頭にtsdの参照を追加
/// <reference path='../../../../typings/tsd.d.ts' /></p>
<p>無事typescript化に成功。
tsconfig.jsonはこんな感じ。
{
&quot;compilerOptions&quot;: {
&quot;module&quot;: &quot;commonjs&quot;,
&quot;target&quot;: &quot;es5&quot;,
&quot;noImplicitAny&quot;: true,
&quot;outDir&quot;: &quot;.&quot;,
&quot;rootDir&quot;: &quot;.&quot;,
&quot;sourceMap&quot;: false
},
&quot;exclude&quot;: [
&quot;node_modules&quot;
]
}</p>
<p>canvasの作成先を変える
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);</p>
<p>を変えよう。
dom操作等にjqueryを使う意向なのでjquery導入。</p>
<blockquote>
<p>tsd query jquery -rosa install</p>
</blockquote>
<p>htmlにdivを追加して</p>
<div id="renderer" style="width:300px;height:200px;"></div>
<p>レンダラのサイズと親を変える。
var $container=$('div#renderer');
renderer.setSize($container.width(), $container.height());
$container.append(renderer.domElement);</p>
<p>カメラのアスペクト比も変える。
var camera = new THREE.PerspectiveCamera(75
, $container.width()/$container.height()
, 0.1, 1000);</p>
<p>TypeScript風に書き換えてみる
せっかくTypeScriptにしているのでフリーダムに書き換えてみる。
/// <reference path='../../../../typings/tsd.d.ts' /></p>
<p>class Renderer {
$container: JQuery;
renderer: THREE.Renderer;</p>
<pre style="background-color:#2b303b;">
<code>scene: THREE.Scene;
camera: THREE.Camera;
mesh: THREE.Mesh;

CreateRenderer($container: JQuery) {
    this.$container = $container;

    this.renderer = new THREE.WebGLRenderer();
    this.renderer.setSize($container.width(), $container.height());
    $container.append(this.renderer.domElement);
}

CreateScene() {
    this.scene = new THREE.Scene();

    var geometry = new THREE.BoxGeometry(1, 1, 1);
    var material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
    this.mesh = new THREE.Mesh(geometry, material);
    this.scene.add(this.mesh);

    this.camera = new THREE.PerspectiveCamera(75
        , this.$container.width() / this.$container.height()
        , 0.1, 1000);
    this.camera.position.z = 5;
}

Render(){
    requestAnimationFrame(this.Render.bind(this));

    // update scene
    this.mesh.rotation.x += 0.1;
    this.mesh.rotation.y += 0.1;

    // render
    this.renderer.render(this.scene, this.camera);
}
</code></pre>
<p>}
var renderer = new Renderer();</p>
<p>$(() =&gt; {
var $container = $('div#renderer');
renderer.CreateRenderer($container);
renderer.CreateScene();</p>
<pre style="background-color:#2b303b;">
<code>renderer.Render();
</code></pre>
<p>});</p>

</div>

<nav class="toc">


</nav>
</div>
</main>

    <footer class="footer">Powered by <a href="https://www.getzola.org/">Zola</a> <a href="https://github.com/ousttrue/zola/tree/custom">custom</a></footer>

  </body>
</html>
