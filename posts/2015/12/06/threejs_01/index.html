<!DOCTYPE html>
<html><body>
    <h1 id="brand">
        <a href="../../../../../" title="三次元日誌" rel="home">
            <span id="blog-title">三次元日誌</span>
        </a>
    </h1>
    <hr>
<main id="content"><h1 class="p-name entry-title" itemprop="headline name">
    <a href="." class="u-url">TypeScriptでThree.jsことはじめ</a>
</h1>
<div>
<p>source
TypeScriptを学び始めた目的のひとつであるThree.jsをようやくはじめた。
「Node.jsとSocket.IOで連結してリアルタイムにシーンをアニメーションするっ」とか
遠大な構想だったのだが小さいところから始めよう。
hello world的な
本家のgetting started
htmlにスクリプトを追加。</p>
<script src="threejs_01.js"></script><p>threejs_01.js
var scene = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(75
    , window.innerWidth / window.innerHeight
    , 0.1, 1000);</p>
<p>var renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);</p>
<p>var geometry = new THREE.BoxGeometry(1, 1, 1);
var material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
var cube = new THREE.Mesh(geometry, material);
scene.add(cube);</p>
<p>camera.position.z = 5;</p>
<p>var render = function() {
    requestAnimationFrame(render);</p>
<pre class="code literal-block"><span></span>cube.rotation.x += 0.1;
cube.rotation.y += 0.1;

renderer.render(scene, camera);
</pre>

<p>};</p>
<p>render();</p>
<p>typescript化する。
gulpにタスクを仕込んだので拡張子をtsにして待つのみ。
error TS2304: Cannot find name 'THREE'</p>
<p>three.jsの型定義が無いので追加。</p>
<blockquote>
<p>tsd query three -rosa install</p>
</blockquote>
<p>tsの先頭にtsdの参照を追加
/// <reference path="../../../../typings/tsd.d.ts"></reference></p>
<p>無事typescript化に成功。
tsconfig.jsonはこんな感じ。
{
    "compilerOptions": {
        "module": "commonjs",
        "target": "es5",
        "noImplicitAny": true,
        "outDir": ".",
        "rootDir": ".",
        "sourceMap": false
    },
    "exclude": [
        "node_modules"
    ]
}</p>
<p>canvasの作成先を変える
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);</p>
<p>を変えよう。
dom操作等にjqueryを使う意向なのでjquery導入。</p>
<blockquote>
<p>tsd query jquery -rosa install</p>
</blockquote>
<p>htmlにdivを追加して</p>
<div id="renderer" style="width:300px;height:200px;"></div>

<p>レンダラのサイズと親を変える。
var $container=$('div#renderer');
renderer.setSize($container.width(), $container.height());
$container.append(renderer.domElement);</p>
<p>カメラのアスペクト比も変える。
var camera = new THREE.PerspectiveCamera(75
    , $container.width()/$container.height()
    , 0.1, 1000);</p>
<p>TypeScript風に書き換えてみる
せっかくTypeScriptにしているのでフリーダムに書き換えてみる。
/// <reference path="../../../../typings/tsd.d.ts"></reference></p>
<p>class Renderer {
    $container: JQuery;
    renderer: THREE.Renderer;</p>
<pre class="code literal-block"><span></span><span class="n">scene</span><span class="o">:</span> <span class="n">THREE</span><span class="o">.</span><span class="na">Scene</span><span class="o">;</span>
<span class="n">camera</span><span class="o">:</span> <span class="n">THREE</span><span class="o">.</span><span class="na">Camera</span><span class="o">;</span>
<span class="n">mesh</span><span class="o">:</span> <span class="n">THREE</span><span class="o">.</span><span class="na">Mesh</span><span class="o">;</span>

<span class="n">CreateRenderer</span><span class="o">(</span><span class="n">$container</span><span class="o">:</span> <span class="n">JQuery</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">$container</span> <span class="o">=</span> <span class="n">$container</span><span class="o">;</span>

    <span class="k">this</span><span class="o">.</span><span class="na">renderer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">THREE</span><span class="o">.</span><span class="na">WebGLRenderer</span><span class="o">();</span>
    <span class="k">this</span><span class="o">.</span><span class="na">renderer</span><span class="o">.</span><span class="na">setSize</span><span class="o">(</span><span class="n">$container</span><span class="o">.</span><span class="na">width</span><span class="o">(),</span> <span class="n">$container</span><span class="o">.</span><span class="na">height</span><span class="o">());</span>
    <span class="n">$container</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">renderer</span><span class="o">.</span><span class="na">domElement</span><span class="o">);</span>
<span class="o">}</span>

<span class="n">CreateScene</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">scene</span> <span class="o">=</span> <span class="k">new</span> <span class="n">THREE</span><span class="o">.</span><span class="na">Scene</span><span class="o">();</span>

    <span class="n">var</span> <span class="n">geometry</span> <span class="o">=</span> <span class="k">new</span> <span class="n">THREE</span><span class="o">.</span><span class="na">BoxGeometry</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
    <span class="n">var</span> <span class="n">material</span> <span class="o">=</span> <span class="k">new</span> <span class="n">THREE</span><span class="o">.</span><span class="na">MeshBasicMaterial</span><span class="o">({</span> <span class="n">color</span><span class="o">:</span> <span class="mh">0x00ff00</span> <span class="o">});</span>
    <span class="k">this</span><span class="o">.</span><span class="na">mesh</span> <span class="o">=</span> <span class="k">new</span> <span class="n">THREE</span><span class="o">.</span><span class="na">Mesh</span><span class="o">(</span><span class="n">geometry</span><span class="o">,</span> <span class="n">material</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">scene</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">mesh</span><span class="o">);</span>

    <span class="k">this</span><span class="o">.</span><span class="na">camera</span> <span class="o">=</span> <span class="k">new</span> <span class="n">THREE</span><span class="o">.</span><span class="na">PerspectiveCamera</span><span class="o">(</span><span class="mi">75</span>
        <span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">$container</span><span class="o">.</span><span class="na">width</span><span class="o">()</span> <span class="o">/</span> <span class="k">this</span><span class="o">.</span><span class="na">$container</span><span class="o">.</span><span class="na">height</span><span class="o">()</span>
        <span class="o">,</span> <span class="mf">0.1</span><span class="o">,</span> <span class="mi">1000</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">camera</span><span class="o">.</span><span class="na">position</span><span class="o">.</span><span class="na">z</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>
<span class="o">}</span>

<span class="n">Render</span><span class="o">(){</span>
    <span class="n">requestAnimationFrame</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">Render</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="k">this</span><span class="o">));</span>

    <span class="c1">// update scene</span>
    <span class="k">this</span><span class="o">.</span><span class="na">mesh</span><span class="o">.</span><span class="na">rotation</span><span class="o">.</span><span class="na">x</span> <span class="o">+=</span> <span class="mf">0.1</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">mesh</span><span class="o">.</span><span class="na">rotation</span><span class="o">.</span><span class="na">y</span> <span class="o">+=</span> <span class="mf">0.1</span><span class="o">;</span>

    <span class="c1">// render</span>
    <span class="k">this</span><span class="o">.</span><span class="na">renderer</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">scene</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">camera</span><span class="o">);</span>
<span class="o">}</span>
</pre>

<p>}
var renderer = new Renderer();</p>
<p>$(() =&gt; {
    var $container = $('div#renderer');
    renderer.CreateRenderer($container);
    renderer.CreateScene();</p>
<pre class="code literal-block"><span></span>renderer.Render();
</pre>

<p>});</p>
</div>
    </main>
</body></html>
