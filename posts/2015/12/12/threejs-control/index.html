<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>三次元日誌</title>

    

  <script src="https://ousttrue.github.io/plugins/elasticlunr.min.js" defer></script>
  <script src="https://ousttrue.github.io/search_index.en.js" defer></script>
  <script src="https://ousttrue.github.io/js/search.js" defer></script>

    

     
    <link rel="stylesheet" href="https://ousttrue.github.io/main.css">
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css"
      />
    
  </head>

  <body class="container">
    <a class="site_title" href="https:&#x2F;&#x2F;ousttrue.github.io&#x2F;">
      <div>三次元日誌</div>
    </a>

    <nav class="nav">
      <a class="item" href="/tags/">tags</a>
      <a class="item" href="https://github.com/ousttrue" aria-label="github">
        <i class="fab fa-github fa-lg"></i>
      </a>
      

        
            <form class="navbar-form">
                <input id="userinput" class="form-control is-search" type="search" placeholder="Search docs..."
                    aria-label="Search docs..." autocomplete="off">
                <div id="suggestions" class="shadow bg-white rounded"></div>
            </form>
        
    </nav>

    <main class="main">
<div class="page">
<div class="content">
  <div class="headline">
  
  

  
  <a class="headline_title" href="https:&#x2F;&#x2F;ousttrue.github.io&#x2F;posts&#x2F;2015&#x2F;12&#x2F;12&#x2F;threejs-control&#x2F;"> Three.jsのトランスフォームコントロールでメッシュをマウスで移動 
  

  
  </a>

  

  <div>
    <ul class="tags">
      <li class="headline_date">
        <div class="year">2015</div>
        <div class="md">1212</div>
      </li>
      
      

    </ul>
  </div>
</div>
 <p>&quot;W&quot; translate | &quot;E&quot; rotate | &quot;R&quot; scale | &quot;+&quot; increase size | &quot;-&quot; decrease size
Press &quot;Q&quot; to toggle world/local space, keep &quot;Ctrl&quot; down to snap to grid</p>
<p>source
今回は、本家サイトのサンプル
http://threejs.org/examples/#misc_controls_transform
をやってみよう。
まず、TransformControlsのtypescriptインターフェースを用意する。
というか書きながら作った。
TransformControls.d.ts。モジュールの細かいところがよくわからん・・・
declare module THREE {
export class TransformControls extends THREE.Mesh {
constructor(camera: THREE.Camera, element: Element);
update():void;
addEventListener(event: string, callback: Function): void;
attach(mesh: THREE.Mesh): void;</p>
<pre style="background-color:#2b303b;">
<code>    setSpace(space: string): void;
    setTranslationSnap(snap: number): void;
    setRotationSnap(radians: number): void;
    setMode(mode: string): void;
    setSize(size: number): void;
    
    space: string;
    size: number;
}
</code></pre>
<p>}</p>
<p>TransformControlsを初期化する。カメラとhtmlノードを渡して初期化する
CreateTransformControl(mesh: THREE.Mesh) {
this.transform = new THREE.TransformControls(this.camera, this.renderer.domElement);
this.transform.addEventListener('change', () =&gt; this.Render());
this.transform.attach(mesh);
this.scene.add(this.transform);</p>
<pre style="background-color:#2b303b;">
<code>window.addEventListener('keydown', (event: KeyboardEvent) =&gt; {

    switch (event.keyCode) {

        case 81: // Q
            this.transform.setSpace(this.transform.space === &quot;local&quot; ? &quot;world&quot; : &quot;local&quot;);
            break;

        case 17: // Ctrl
            this.transform.setTranslationSnap(100);
            this.transform.setRotationSnap(THREE.Math.degToRad(15));
            break;

        case 87: // W
            this.transform.setMode(&quot;translate&quot;);
            break;

        case 69: // E
            this.transform.setMode(&quot;rotate&quot;);
            break;

        case 82: // R
            this.transform.setMode(&quot;scale&quot;);
            break;

        case 187:
        case 107: // +, =, num+
            this.transform.setSize(this.transform.size + 0.1);
            break;

        case 189:
        case 109: // -, _, num-
            this.transform.setSize(Math.max(this.transform.size - 0.1, 0.1));
            break;

    }
});

window.addEventListener('keyup', (event: KeyboardEvent) =&gt; {

    switch (event.keyCode) {

        case 17: // Ctrl
            this.transform.setTranslationSnap(null);
            this.transform.setRotationSnap(null);
            break;

    }

});
</code></pre>
<p>}</p>
<p>マウスイベントを監視するHtmlノードと、マウスの動きをどのように解釈するかを知るためにカメラが必要ということですね。</p>

</div>

<nav class="toc">


</nav>
</div>
</main>

    <footer class="footer">Powered by <a href="https://www.getzola.org/">Zola</a> <a href="https://github.com/ousttrue/zola/tree/custom">custom</a></footer>

  </body>
</html>
