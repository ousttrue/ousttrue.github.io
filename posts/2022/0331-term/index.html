<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="generator" content="Nikola (getnikola.com)">
<meta name="viewport" content="width=device-width">
<script src="../../../assets/js/all-nocdn.js"></script><title>0331-term | 三次元日誌</title>
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
</head>
<body>
    <h1 id="brand">
        <a href="../../../" title="三次元日誌" rel="home">
            <span id="blog-title">三次元日誌</span>
        </a>
    </h1>

    <nav id="menu"><ul>
<li><a href="../../../archive.html">Archives</a></li>
<li><a href="../../../categories/index.html">Tags</a></li>
<li><a href="../../../rss.xml">RSS feed</a></li>
<li><a href="../../../about">About</a></li>
<li><a href="../../../books">MemoBooks</a></li>

            
            
            
        </ul></nav><hr>
<main id="content"><h1 class="p-name entry-title" itemprop="headline name">
    <h1 class="p-name entry-title" itemprop="headline name">
    <a href="." class="u-url">0331-term
    </a>
</h1>
<ul itemprop="keywords" class="tags">
<li>
        <time datetime="2022-03-31T00:00:00+09:00" title="2022-03-31">2022-03-31</time>
</li>
    <li><a class="tag p-category" href="../../../categories/term/" rel="tag">term</a></li>
</ul>
</h1>

<h2>term周りの更新</h2>
<h3>terminal emulator を選定・・・</h3>
<p>主に3つの動作環境、<code>Windows</code>, <code>Windows wsl</code>, <code>Ubuntu-20.04</code> があってtoolや設定をある程度共通にしたいということで試行錯誤していた。
他に <code>ssh経由</code>, <code>Windows wslg</code> もあるよ。</p>
<h4>wezterm</h4>
<p><code>wezterm</code> が有望であることがわかった</p>
<table>
<thead><tr>
<th></th>
<th>font fallback</th>
<th>multiplexer</th>
<th>emoji</th>
<th>nerdfnt</th>
<th>graphics escape</th>
</tr></thead>
<tbody>
<tr>
<td>wezterm windows</td>
<td>✅</td>
<td>✅</td>
<td>color</td>
<td>✅</td>
<td>conpty issue</td>
</tr>
<tr>
<td>wezterm wsl</td>
<td>✅</td>
<td>✅</td>
<td>color</td>
<td>✅</td>
<td>conpty issue</td>
</tr>
<tr>
<td>wezterm ssh</td>
<td>✅</td>
<td>✅</td>
<td>color</td>
<td>✅</td>
<td>sixel, kitty, iterm2</td>
</tr>
<tr>
<td>wezterm linux</td>
<td>✅</td>
<td>✅</td>
<td>color</td>
<td>✅</td>
<td>sixel, kitty, iterm2</td>
</tr>
</tbody>
</table>
<p>conpty を通すときに escape sequence が加工されるとかで、<code>sixel</code>, <code>kitty</code>, <code>iterm2</code> いずれのプロトコルもうまくうごかなかった。<code>iterm2</code> は絵はでるのだけど場所がずれるという惜しい挙動・・・。</p>
<p><a href="https://github.com/wez/wezterm/issues/1236">https://github.com/wez/wezterm/issues/1236</a></p>
<p>SSH 経由で WSL することで対処する。</p>
<h4>wslg(xtermなど)</h4>
<p><code>xterm</code> は軽快できれいに表示できるので良かった。フォントのフォールバックができないぽいのが弱点。
<code>urxvt</code> は、<code>NerdFonts</code> がうまくでなかった。
<code>st</code> (simple term) もフォントまわりでつまづきだったかな。</p>
<table>
<thead><tr>
<th></th>
<th>font fallback</th>
<th>multiplexer</th>
<th>emoji</th>
<th>nerdfnt</th>
<th>graphics escape</th>
</tr></thead>
<tbody>
<tr>
<td>xterm wslg</td>
<td></td>
<td></td>
<td>mono</td>
<td>✅</td>
<td>sixel</td>
</tr>
<tr>
<td>mlterm wslg</td>
<td>✅</td>
<td>mlterm-con</td>
<td>color</td>
<td>✅</td>
<td>sixel</td>
</tr>
</tbody>
</table>
<p>mlterm はフォント周りの設定が強力でよかった。
文字セットごとにフォントを個別に指定できるので、フォントを合成せずともばらのままでよい。</p>
<p><code>mlterm-con</code> という multiplexer があり sixel support があるらしい。
自前ビルドが必要そう(apt には含まれていないぽい)。</p>
<p>wslgは、頻繁にキーボードが押しっぱなしになったり不安定なような・・・
<a href="https://github.com/microsoft/wslg/issues/207">https://github.com/microsoft/wslg/issues/207</a>
なおっているけ、リリースに時間がかかりそう？</p>
<h4>libvte</h4>
<p><code>libvte</code> 系のterm。
<code>gnome-terminal</code>, <code>xfce4-term</code> など。</p>
<h4>gpu rendering</h4>
<p>GPUレンダリングで <code>araclitty</code>, <code>kitty</code> そして <code>wezterm</code> がある。
<code>wezterm</code> が <code>Windows</code> をサポートしていて、フォントのレンダリング、タブのサポートと総合的に良い。</p>
<h4>その他</h4>
<ul>
<li>tabby</li>
<li>RLogin</li>
<li>ConEmu</li>
</ul>
<p>など。</p>
<h3>要件</h3>
<h4>日本語、中文、絵文字, NerdFonts を同時にいい感じに表示したい</h4>
<p>となるとすべてを含むひとつのフォントより、主になるフォントを設定してそれにグリフが含まれなかったら、他のフォントにフォールバックする挙動をしてもらう方が便利。
いくつかのフォントを試してみたのだけど、 <code>HackGenNerd Console</code> が良かった。
で、中文の足りない漢字を <code>更紗ゴシックフォント</code> にフォールバックするという組み合わせ。
がんばって完璧な合成フォントを自作すればいいのだけど、よくわからないので、 複数フォントのフォールバック機能が必要。</p>
<p>かつて w3m で表示が乱れることで苦労した <code>ambigous width</code> 問題はあまり気にならなくなっていた。
なんか、表示は２カラム使うが、データ上は1カラムと見なすような扱いになっていて、
<code>X</code> につづいて <code></code> で隙間を開けることで正しく表示できるようだ。
NerdFonts や 絵文字 はそのようになっている？</p>
<h4>エスケープシーケンスで画像を表示したい</h4>
<p><code>sixel</code> とか <code>kitty</code> とか <code>iterm2</code> による画像表示。</p>
<table>
<thead><tr>
<th></th>
<th>graphics</th>
</tr></thead>
<tbody>
<tr>
<td>Windows Native(conpty)</td>
<td></td>
</tr>
<tr>
<td>wsltty</td>
<td>sixel</td>
</tr>
<tr>
<td>xterm wslg</td>
<td>sixel</td>
</tr>
<tr>
<td>wezterm linux</td>
<td>sixel, kityt ,iterm2</td>
</tr>
</tbody>
</table>
<p>という感じになった。<code>wsltty</code> は <code>conpty</code> ではなくて <code>winpty</code> なので例外的に <code>sixel</code> が通過できるらしい。
動く環境でも <code>tmux</code> を挟むと動かなくなる。
代わりに terminal emulator の方で multiplexer(タブ機能) する必要が発生。</p>
<h3>まとめ</h3>
<p>総合力で wezterm が強い。</p>
<ul>
<li>あまり頑張らなくてもフォントがうまく設定できる(cjk, NerdFonts, 絵文字)</li>
<li>multiplexer 機能あり</li>
<li>sixel, kitty, iterm2 プロトコルで画像を表示できる</li>
<li>Windows でも動く</li>
</ul>
<h3>参考</h3>
<ul>
<li><a href="https://zenn.dev/yutakatay/articles/wezterm-intro">alacritty+tmuxもいいけど、weztermがすごい件</a></li>
<li><a href="https://wezfurlong.org/wezterm/">wezterm</a></li>
<li><a href="https://sw.kovidgoyal.net/kitty/graphics-protocol/">https://sw.kovidgoyal.net/kitty/graphics-protocol/</a></li>
<li>OSC1337 <a href="https://iterm2.com/documentation-images.html">https://iterm2.com/documentation-images.html</a>
</li>
<li><a href="https://unrealman.hatenablog.com/entry/tty-mintty-winpty">【Git for Windows】tty/mintty/winptyとは何なのか？【Gitbash】</a></li>
</ul>
<hr>
<ul class="pager hidden-print">
<li class="previous">
        <a href="../0206-sokol/" rel="prev" title="0206-sokol">
            0206-sokol 👈
        </a>
    </li>
    <li style="flex-grow: 1">
    <li class="next">
        <a href="../0404-prompt-toolkit/" rel="next" title="0404-prompt-toolkit">
            👉 0404-prompt-toolkit
        </a>
    </li>
</ul></main><footer id="footer"><p>
            Powered by
            <a href="https://getnikola.com" rel="nofollow">Nikola</a>
        </p>
    </footer>
</body>
</html>
