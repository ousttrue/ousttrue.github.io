<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="generator" content="Nikola (getnikola.com)">
<meta name="viewport" content="width=device-width">
<script src="../../../assets/js/all-nocdn.js"></script><title>0404-prompt-toolkit | 三次元日誌</title>
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
</head>
<body>
    <h1 id="brand">
        <a href="../../../" title="三次元日誌" rel="home">
            <span id="blog-title">三次元日誌</span>
        </a>
    </h1>

    <nav id="menu"><ul>
<li><a href="../../../archive.html">Archives</a></li>
<li><a href="../../../categories/index.html">Tags</a></li>
<li><a href="../../../rss.xml">RSS feed</a></li>
<li><a href="../../../about">About</a></li>
<li><a href="../../../books">MemoBooks</a></li>

            
            
            
        </ul></nav><hr>
<main id="content"><h1 class="p-name entry-title" itemprop="headline name">
    <h1 class="p-name entry-title" itemprop="headline name">
    <a href="." class="u-url">0404-prompt-toolkit
    </a>
</h1>
<ul itemprop="keywords" class="tags">
<li>
        <time datetime="2022-04-04T00:00:00+09:00" title="2022-04-04">2022-04-04</time>
</li>
    <li><a class="tag p-category" href="../../../categories/ptk/" rel="tag">ptk</a></li>
    <li><a class="tag p-category" href="../../../categories/python/" rel="tag">python</a></li>
</ul>
</h1>

<h2>prompt-toolkit の fullscreen アプリケーション</h2>
<h3>Buffer</h3>
<p>しばらく試行錯誤していたのだがやっと使い方が分かってきた。
<code>Window</code> + <code>BufferControl</code> が基本形で edit する場合向け。
<code>Window</code> + <code>FormatedTextControl</code> が readonly の装飾済みのテキストに向いていそう。</p>
<p>Lexer で基本的な装飾を施して、Preprocess でフォーカスやホバーのUI的な装飾をするという使い分けがよさそう。
<code>FormattedTextControl</code> の場合は初期化時にスタイル適用済みのテキストを渡してしまう。</p>
<h3>example</h3>
<p><a href="https://github.com/prompt-toolkit">https://github.com/prompt-toolkit</a> の、</p>
<ul>
<li><a href="https://github.com/prompt-toolkit/pyvim">https://github.com/prompt-toolkit/pyvim</a></li>
<li><a href="https://github.com/prompt-toolkit/pymux">https://github.com/prompt-toolkit/pymux</a></li>
<li><a href="https://github.com/prompt-toolkit/pyterm">https://github.com/prompt-toolkit/pyterm</a></li>
</ul>
<p>が <code>prompt-toolkit2</code> のままになっているのだが、
ちょっと手直しすることで、 <code>prompt-toolkit3</code> で動作させることができた。</p>
<p><code>ptterm</code> の <code>prompt-toolkit3</code> 化に PR を送ってみた。
主に <code>pipe</code> 周りの非同期入力を <code>asyncio</code> に適合させてやることで動く。
<a href="https://github.com/prompt-toolkit/ptterm/pull/9">https://github.com/prompt-toolkit/ptterm/pull/9</a></p>
<p><code>pymux</code> も <code>fork</code> しない <code>standalone</code> 引き数付きならば <code>Windows</code> + <code>prompt-toolkit3</code> でも動かすことができた。</p>
<p>prompt-toolkit3 では積極的に <code>asyncio</code> を活用していくのがよさそう。</p>
<h3>prompt-toolkit で任意のエスケープシーケンスを入れる</h3>
<p>prompt-toolkit で <code>sixel</code> 画像を表示させたい。
UIControl が UIContent を生成していて、このとき styled text のデータ構造に対して特殊なスタイル <code>[ZeroWidthEscape]</code> を指定することでエスケープシーケンスを直接出力できることがわかった。諸々の調整が必要になるが、ここに <code>sixel</code> のシーケンスを入れることで表示できる。
処理順の癖に対応するために、
画像の高さ分の改行を <code>sixel</code> のエスケープシーケンスに先行させる必要があった。
<code>prompt-toolkit</code> + <code>wezterm</code> 固有の問題かもしれない。</p>
<h3>Windows/Linux 共用で console アプリを動かす</h3>
<p><code>prompt-toolkit3</code> でかなりできそう。
フレームワークの構成を理解するまでとっつきが悪いのだが、
<code>pypager</code>, <code>pyvim</code>, <code>ptterm</code>, <code>pymux</code> を研究してやっとわかってきた。</p>
<p><code>nerdfont</code> で賑やかしを入れて、 <code>sixel</code> で画像表示ができるおもちゃを企画している。</p>
<ul>
<li>vim ぽい lsp/dap の実験アプリ</li>
<li>w3m ぽい ブラウザ</li>
<li>tmux ぽいやつ</li>
<li>ranger ぽいやつ</li>
</ul>
<hr>
<ul class="pager hidden-print">
<li class="previous">
        <a href="../0331-term/" rel="prev" title="0331-term">
            0331-term 👈
        </a>
    </li>
    <li style="flex-grow: 1">
    <li class="next">
        <a href="../0419-gentoo/" rel="next" title="0419-gentoo">
            👉 0419-gentoo
        </a>
    </li>
</ul></main><footer id="footer"><p>
            Powered by
            <a href="https://getnikola.com" rel="nofollow">Nikola</a>
        </p>
    </footer>
</body>
</html>
