<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="generator" content="Nikola (getnikola.com)">
<meta name="viewport" content="width=device-width">
<script src="../../../assets/js/all-nocdn.js"></script><title>0419-gentoo | 三次元日誌</title>
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
</head>
<body>
    <h1 id="brand">
        <a href="../../../" title="三次元日誌" rel="home">
            <span id="blog-title">三次元日誌</span>
        </a>
    </h1>

    <nav id="menu"><ul>
<li><a href="../../../archive.html">Archives</a></li>
<li><a href="../../../categories/index.html">Tags</a></li>
<li><a href="../../../rss.xml">RSS feed</a></li>
<li><a href="../../../about">About</a></li>
<li><a href="../../../books">MemoBooks</a></li>

            
            
            
        </ul></nav><hr>
<main id="content"><h1 class="p-name entry-title" itemprop="headline name">
    <h1 class="p-name entry-title" itemprop="headline name">
    <a href="." class="u-url">0419-gentoo
    </a>
</h1>
<ul itemprop="keywords" class="tags">
<li>
        <time datetime="2022-04-20T00:00:00+09:00" title="2022-04-20">2022-04-20</time>
</li>
    <li><a class="tag p-category" href="../../../categories/linux/" rel="tag">linux</a></li>
</ul>
</h1>

<h2>Gentoo 構築</h2>
<p>久しぶりに gentoo の機運が高まったので入れてみた。
先に <code>Ubuntu-20.04</code> を入れておいて、後ろのパーティションに gentoo をインストールする作戦。
Ubuntu と同じ <code>/home</code> をマウントしてみたら <code>dotfiles</code> に互換性が無かったのでやめた。
わりと順調にインストールできた。
ゆくゆくは wsl も gentoo に換装したいところじゃ。</p>
<h3>2022-05-05</h3>
<p>システムを壊してしもた。
作りなおし。ついでに <a href="https://wiki.gentoo.org/wiki/Btrfs">btffs</a> やってみる。</p>
<h3>btrfs</h3>
<p><code>/etc/fstab</code></p>
<div class="code"><pre class="code literal-block">/dev/sdb                /srv            btrfs           compress=zstd:9,relatime,rw     0 0
</pre></div>

<h3>python-3.10</h3>
<p><code>PYTHON_SINGLE_TARGET</code></p>
<p>6月くらいにデフォルトになる予定みたいだ。先にやってみた。</p>
<p>間違い。去年の6月に、 <code>Python-3.9</code> がデフォルトになった。
<code>Python-3.10</code> は今のところ予定に無い。
いろいろインストールできなくなったので、元に戻した。</p>
<h3>make.conf</h3>
<p>ここに貼っておこう。
こいつを育てているようなものだし。</p>
<div class="code"><pre class="code literal-block"><span class="c1"># These settings were set by the catalyst build script that automatically</span><span class="w"></span>
<span class="c1"># built this stage.</span><span class="w"></span>
<span class="c1"># Please consult /usr/share/portage/config/make.conf.example for a more</span><span class="w"></span>
<span class="c1"># detailed example.</span><span class="w"></span>
<span class="n">COMMON_FLAGS</span><span class="o">=</span><span class="s2">"-march=native -O2 -pipe"</span><span class="w"></span>
<span class="n">CFLAGS</span><span class="o">=</span><span class="s2">"${COMMON_FLAGS}"</span><span class="w"></span>
<span class="n">CXXFLAGS</span><span class="o">=</span><span class="s2">"${COMMON_FLAGS}"</span><span class="w"></span>
<span class="n">FCFLAGS</span><span class="o">=</span><span class="s2">"${COMMON_FLAGS}"</span><span class="w"></span>
<span class="n">FFLAGS</span><span class="o">=</span><span class="s2">"${COMMON_FLAGS}"</span><span class="w"></span>

<span class="c1"># NOTE: This stage was built with the bindist Use flag enabled</span><span class="w"></span>
<span class="n">PORTDIR</span><span class="o">=</span><span class="s2">"/var/db/repos/gentoo"</span><span class="w"></span>
<span class="n">DISTDIR</span><span class="o">=</span><span class="s2">"/var/cache/distfiles"</span><span class="w"></span>
<span class="n">PKGDIR</span><span class="o">=</span><span class="s2">"/var/cache/binpkgs"</span><span class="w"></span>

<span class="n">USE</span><span class="o">=</span><span class="s2">"X sixel truetype vim-syntax jpeg png python fontforge cjk alsa </span><span class="se">\</span>
<span class="s2">     pulseaudio mp3 dbus opengl ffmpeg mad mpd elogind gtk"</span><span class="w"></span>
<span class="n">INPUT_DEVICES</span><span class="o">=</span><span class="s2">"evdev libinput synaptics"</span><span class="w"></span>
<span class="c1">#VIDEO_CARDS="nouveau"</span><span class="w"></span>
<span class="n">VIDEO_CARDS</span><span class="o">=</span><span class="s2">"nvidia"</span><span class="w"></span>
<span class="n">ABI_X86</span><span class="o">=</span><span class="s2">"64"</span><span class="w"></span>

<span class="c1"># This sets the language of build output to English.</span><span class="w"></span>
<span class="c1"># Please keep this setting intact when reporting bugs.</span><span class="w"></span>
<span class="n">LC_MESSAGES</span><span class="o">=</span><span class="s2">"C"</span><span class="w"></span>

<span class="n">MAKEOPTS</span><span class="o">=</span><span class="s2">"-j6"</span><span class="w"></span>
</pre></div>

<h3>boot</h3>
<p><code>refind</code> を試してみた。
先に、Ubuntu の方でインストールして <code>gentoo</code> でエントリーだけ増やした。
<code>grub2</code> より設定が簡単だと思った。
情報は少なめ。</p>
<p><code>/boot/efi/EFI/refind/refind.conf</code></p>
<div class="code"><pre class="code literal-block"><span class="c1"># rootの指定が必要 </span><span class="w"></span>
<span class="n">menuentry</span><span class="w"> </span><span class="n">Gentoo</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">icon</span><span class="w"> </span><span class="n">EFI</span><span class="o">/</span><span class="n">refind</span><span class="o">/</span><span class="n">icons</span><span class="o">/</span><span class="n">os_gentoo</span><span class="o">.</span><span class="n">png</span><span class="w"></span>
<span class="w">    </span><span class="n">loader</span><span class="w"> </span><span class="o">/</span><span class="n">EFI</span><span class="o">/</span><span class="n">gentoo</span><span class="o">/</span><span class="n">vmlinuz</span><span class="o">-</span><span class="mf">5.15</span><span class="o">.</span><span class="mi">32</span><span class="o">-</span><span class="n">gentoo</span><span class="o">-</span><span class="n">r1</span><span class="o">-</span><span class="n">x86_64</span><span class="w"></span>
<span class="w">    </span><span class="n">initrd</span><span class="w"> </span><span class="o">/</span><span class="n">EFI</span><span class="o">/</span><span class="n">gentoo</span><span class="o">/</span><span class="n">initramfs</span><span class="o">-</span><span class="mf">5.15</span><span class="o">.</span><span class="mi">32</span><span class="o">-</span><span class="n">gentoo</span><span class="o">-</span><span class="n">r1</span><span class="o">-</span><span class="n">x86_64</span><span class="o">.</span><span class="n">img</span><span class="w"></span>
<span class="w">    </span><span class="n">options</span><span class="w"> </span><span class="s2">"root=/dev/sda4"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>

<p>起動時に自動検索と設定に記述したエントリが出てくるので、<code>-</code> キーで隠すと見ためがすっきりする。</p>
<h3>xorg</h3>
<p>なんとなくできた。</p>
<div class="code"><pre class="code literal-block">$ startx -- vt1
</pre></div>

<p>としないとエラーになる。
<code>/etc/X11</code> は作らなくても動いた。</p>
<p>いつもどおりに <code>openbox</code>, <code>tint2</code>, <code>PCManFM</code>, <code>conky</code> という感じだが、今回は新型の <code>wezterm</code> がある。</p>
<h3>yaft</h3>
<p>nerdfonts 入りの bdffont を作りたいのだが未だ。
mlterm-fb や kmscon も試してみたのだがうまく動かなかった。</p>
<h3>wayland</h3>
<p>TODO:</p>

<hr>
<ul class="pager hidden-print">
<li class="previous">
        <a href="../0404-prompt-toolkit/" rel="prev" title="0404-prompt-toolkit">
            0404-prompt-toolkit 👈
        </a>
    </li>
    <li style="flex-grow: 1">
    <li class="next">
        <a href="../0428-zig2/" rel="next" title="0428-zig2">
            👉 0428-zig2
        </a>
    </li>
</ul></main><footer id="footer"><p>
            Powered by
            <a href="https://getnikola.com" rel="nofollow">Nikola</a>
        </p>
    </footer>
</body>
</html>
