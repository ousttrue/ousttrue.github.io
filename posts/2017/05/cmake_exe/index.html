<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="generator" content="Nikola (getnikola.com)">
<meta name="viewport" content="width=device-width">
<script src="../../../../assets/js/all-nocdn.js"></script><title>msbuildとcmakeの在りか | 三次元日誌</title>
<link href="../../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
</head>
<body>
    <h1 id="brand">
        <a href="../../../../" title="三次元日誌" rel="home">
            <span id="blog-title">三次元日誌</span>
        </a>
    </h1>

    <nav id="menu"><ul>
<li><a href="../../../../archive.html">Archives</a></li>
<li><a href="../../../../categories/index.html">Tags</a></li>
<li><a href="../../../../rss.xml">RSS feed</a></li>
<li><a href="../../../../about">About</a></li>
<li><a href="../../../../books">MemoBooks</a></li>

            
            
            
        </ul></nav><hr>
<main id="content"><h1 class="p-name entry-title" itemprop="headline name">
    <a href="." class="u-url">msbuildとcmakeの在りか</a>
</h1>
<div>
<p>bat作るときにたまに使う
cmake.exeとmsbuild.exeの在りかについて</p>
<p>VisualStudio2017内のcmake.exe
VisualStudio2017に同梱されるようになったcmakeのパスについて。
以下のパスに存在する。
C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\Common7\IDE\CommonExtensions\Microsoft\CMake\CMake\bin\cmake.exe
version確認
PS&gt; &amp;"C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\Common7\IDE\CommonExtensions\Microsoft\CMake\CMake\bin\cmake.exe" --version
cmake version 3.6.20160606-g0391f-MSVC</p>
<p>CMake suite maintained and supported by Kitware (kitware.com/cmake).</p>
<p>レジストリからパスを得る
システムドライブの容量節約のためVSのインストールパスを変更している場合に必要だった。
regコマンドでコマンドラインで値を得る。</p>
<blockquote>
<p>reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\VisualStudio\SxS\VS7" /v "15.0"</p>
</blockquote>
<p>HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\VisualStudio\SxS\VS7
    15.0    REG_SZ    C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\</p>
<p>cmake呼び出しbat
cmake_vs2017.bat
@echo off
FOR /F "TOKENS=1,2,*" %%A IN ('reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\VisualStudio\SxS\VS7" /v "15.0"') DO IF "%%A"=="15.0" SET VSPATH=%%C
@echo on</p>
<p>set CMAKE="%VSPATH%\Common7\IDE\CommonExtensions\Microsoft\CMake\CMake\bin\cmake.exe"
set BUILD_DIR="build_vs2017"</p>
<p>if not exist %BUILD_DIR% mkdir %BUILD_DIR%
pushd %BUILD_DIR%
%CMAKE% -D CMAKE_INSTALL_PREFIX=%VCPKG_DIR%/installed/x64-windows -D OpenCVDir=%VCPKG_DIR%/installed/x64-windows/share/opencv .. -G "Visual Studio 15 2017 Win64"
popd</p>
<p>使用例</p>
<p>https://github.com/ousttrue/msgpackpp/blob/master/cmake_vs2017.bat</p>
<p>VisualStudio2017内のmsbuild
C:/Program Files (x86)/Microsoft Visual Studio/2017/Community/MSBuild/15.0/Bin/msbuild.exe
なので</p>
<blockquote>
<p>reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\VisualStudio\SxS\VS7" /v "15.0"</p>
</blockquote>
<p>HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\VisualStudio\SxS\VS7
    15.0    REG_SZ    C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\</p>
<p>と組み合わせると得られる。
@echo off
FOR /F "TOKENS=1,2,*" %%A IN ('reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\VisualStudio\SxS\VS7" /v "15.0"') DO IF "%%A"=="15.0" SET VSPATH=%%C
@echo on</p>
<p>set MSBUILD="%VSPATH%\MSBuild\15.0\Bin\msbuild.exe"</p>
<p>VisualStudio2015内のmsbuild</p>
<p>https://github.com/Microsoft/HoloToolkit-Unity/blob/master/Assets/HoloToolkit/Build/Editor/BuildDeployTools.cs#L72</p>
<p>レジストリ
HKLM\Software\Microsoft\MSBuild\ToolsVersions\14.0
から得ることができる。
@echo off
FOR /F "TOKENS=1,2,*" %%A IN ('reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSBuild\ToolsVersions" /v "14.0"') DO IF "%%A"=="14.0" SET MSBUILDPATH=%%C
@echo on</p>
<p>set MSBUILD="%MSBUILDPATH%\msbuild.exe"</p>
</div>
    </main><footer id="footer"><p>
            Powered by
            <a href="https://getnikola.com" rel="nofollow">Nikola</a>
        </p>
    </footer>
</body>
</html>
