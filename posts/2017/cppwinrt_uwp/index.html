<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="generator" content="Nikola (getnikola.com)">
<meta name="viewport" content="width=device-width">
<script src="../../../assets/js/all-nocdn.js"></script><title>C++WinRTã§ã¯ã˜ã‚ã‚‹UWP | ä¸‰æ¬¡å…ƒæ—¥èªŒ</title>
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
</head>
<body>
    <h1 id="brand">
        <a href="../../../" title="ä¸‰æ¬¡å…ƒæ—¥èªŒ" rel="home">
            <span id="blog-title">ä¸‰æ¬¡å…ƒæ—¥èªŒ</span>
        </a>
    </h1>

    <nav id="menu"><ul>
<li><a href="../../../archive.html">Archives</a></li>
<li><a href="../../../categories/index.html">Tags</a></li>
<li><a href="../../../rss.xml">RSS feed</a></li>
<li><a href="../../../about">About</a></li>
<li><a href="../../../books">MemoBooks</a></li>

            
            
            
        </ul></nav><hr>
<main id="content"><h1 class="p-name entry-title" itemprop="headline name">
    <h1 class="p-name entry-title" itemprop="headline name">
    <a href="." class="u-url">C++WinRTã§ã¯ã˜ã‚ã‚‹UWP
    </a>
</h1>
<ul itemprop="keywords" class="tags">
<li>
        <time datetime="2017-09-14T00:00:00+09:00" title="2017-09-14">2017-09-14</time>
</li>
    <li><a class="tag p-category" href="../../../categories/cpp/" rel="tag">cpp</a></li>
    <li><a class="tag p-category" href="../../../categories/uwp/" rel="tag">uwp</a></li>
</ul>
</h1>

<p>C++/CXã‚’ç½®ãæ›ãˆã‚‹ã‚ˆã•ã’ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªC++WinRTã‚’ç™ºè¦‹ã—ãŸã€‚</p>
<p>C++/CXã®æ©Ÿèƒ½ã‚’ç´”ç²‹ãªC++(C++17ã¨ã‹æ–°ã—ã‚ã®)ã§å®Ÿè£…ã—ãŸã‚‚ã®ã‚‰ã—ãã€WinRTã®C++ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã®ã‚ˆã†ãªä½ç½®ã€‚
C++/CXã§</p>
<div class="code"><pre class="code literal-block"><span class="n">Windows</span><span class="o">::</span><span class="n">UI</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">CoreWindow</span><span class="w"> </span><span class="o">^</span><span class="n">window</span><span class="p">;</span><span class="w"></span>
</pre></div>

<p>ã®ã‚ˆã†ãªã‚‚ã®ã‚’</p>
<div class="code"><pre class="code literal-block"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;winrt/Windows.UI.Core.h&gt;</span><span class="cp"></span>
<span class="n">winrt</span><span class="o">::</span><span class="n">Windows</span><span class="o">::</span><span class="n">UI</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">Core</span><span class="w"> </span><span class="n">window</span><span class="p">;</span><span class="w"></span>
</pre></div>

<p>ã®ã‚ˆã†ã«ç½®ãæ›ãˆã‚‹ã€‚<code>-&gt;</code>ã˜ã‚ƒãªãã¦ <code>.</code> ã‚’ä½¿ã†ã‚¹ãƒãƒ¼ãƒˆãƒã‚¤ãƒ³ã‚¿ã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã€‚</p>
<ul>
<li>Migrating C++/CX source code to C++/WinRT</li>
</ul>
<p>C++/CXã§async, awaitãªéåŒæœŸã‚’å®Ÿè£…ã™ã‚‹é“å…·ã ã£ãŸPPLã‚‚ã†ã¾ãç½®ãæ›ãˆã¦ã„ã‚‹ã‚ˆã†ã ã€‚</p>
<ul>
<li>Using C++ co-routines with C++/WinRT asynchronous methods</li>
</ul>
<p>ã‚„ã£ã¦ã¿ã‚‹
clone
https://github.com/Microsoft/cppwinrtã‚’cloneã—ã¦includeã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã€‚
C++WinRTã¯ãƒ˜ãƒƒãƒ€ã‚ªãƒ³ãƒªãƒ¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚‹ã€‚
ãƒ“ãƒ«ãƒ‰ç¢ºèª</p>
<p>https://github.com/Microsoft/cppwinrt/tree/master/10.0.15063.0/Samples/CL</p>
<p>ã‚’ãƒ™ãƒ¼ã‚¹ã€‚</p>
<div class="code"><pre class="code literal-block"><span class="c1">// main.cpp</span>
<span class="cp">#pragma comment(lib, "windowsapp") </span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;winrt/base.h&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="kr">__stdcall</span><span class="w"> </span><span class="n">wWinMain</span><span class="p">(</span><span class="n">HINSTANCE</span><span class="p">,</span><span class="w"> </span><span class="n">HINSTANCE</span><span class="p">,</span><span class="w"> </span><span class="n">PWSTR</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">winrt</span><span class="o">::</span><span class="n">init_apartment</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>

<p>ã‚ãˆã¦CMakeã§ã€‚
CMakeLists.txt</p>
<div class="code"><pre class="code literal-block"><span class="nb">CMAKE_MINIMUM_REQUIRED</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.5</span><span class="p">)</span>
<span class="nb">PROJECT</span><span class="p">(</span><span class="s">RendererToolkit</span><span class="p">)</span><span class="w"> </span><span class="c"># .sln</span>

<span class="nb">ADD_DEFINITIONS</span><span class="p">(</span>
<span class="w">    </span><span class="s">-DWIN32=1</span>
<span class="w">    </span><span class="s">-DUNICODE=1</span>
<span class="w">    </span><span class="s">-D_UNICODE=1</span>
<span class="w">    </span><span class="p">)</span>

<span class="nb">SET</span><span class="p">(</span><span class="s">CMAKE_C_FLAGS</span><span class="w"> </span><span class="s2">"/ZW /EHsc /await /std:c++latest"</span><span class="p">)</span>
<span class="nb">SET</span><span class="p">(</span><span class="s">CMAKE_CXX_FLAGS</span><span class="w"> </span><span class="o">${</span><span class="nv">CMAKE_C_FLAGS</span><span class="o">}</span><span class="p">)</span>
<span class="nb">INCLUDE_DIRECTORIES</span><span class="p">(</span>
<span class="w">    </span><span class="c"># é©å½“ã«cloneã—ãŸãƒ‘ã‚¹ã‚’å‚ç…§</span>
<span class="w">    </span><span class="o">${</span><span class="nv">CMAKE_CURRENT_LIST_DIR</span><span class="o">}</span><span class="s">/cppwinrt/10.0.15063.0</span>
<span class="w">    </span><span class="p">)</span>

<span class="c">##############################################################################</span>
<span class="c"># project</span>
<span class="c">##############################################################################</span>
<span class="nb">SET</span><span class="p">(</span><span class="s">PROJECTNAME</span><span class="w"> </span><span class="s">_SampleCoreWindow</span><span class="p">)</span>

<span class="nb">FILE</span><span class="p">(</span><span class="s">GLOB</span><span class="w"> </span><span class="s">SRCS</span><span class="w"> </span><span class="s">*.cpp</span><span class="w"> </span><span class="s">*.h</span><span class="p">)</span>

<span class="nb">ADD_EXECUTABLE</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECTNAME</span><span class="o">}</span><span class="w"> </span><span class="s">WIN32</span><span class="w"> </span><span class="o">${</span><span class="nv">SRCS</span><span class="o">}</span><span class="p">)</span>

<span class="nb">TARGET_INCLUDE_DIRECTORIES</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECTNAME</span><span class="o">}</span><span class="w"> </span><span class="s">PUBLIC</span>
<span class="w">    </span><span class="o">${</span><span class="nv">SUBRENDERER_INCLUDE</span><span class="o">}</span>
<span class="w">    </span><span class="p">)</span>
</pre></div>

<p>UWPã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã€‚</p>
<div class="code"><pre class="code literal-block">&gt; mkdir build
&gt; cd build
build&gt; cmake.exe -DCMAKE_SYSTEM_NAME=WindowsStore -DCMAKE_SYSTEM_VERSION=10.0 -DCMAKE_C_FLAGS=/ZW /EHsc -G "Visual Studio 15 2017 Win64" ..
</pre></div>

<p>ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¨è­¦å‘ŠãŒå‡ºã‚‹ã€‚
warning C4447: ã‚¹ãƒ¬ãƒƒãƒ‰ ãƒ¢ãƒ‡ãƒ«ã®ãªã„ 'main' ã‚·ã‚°ãƒãƒãƒ£ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚'int main(Platform::Array&lt;:string&gt;^ args)' ã®ä½¿ç”¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚</p>
<p>ä»¥ä¸‹ã®ã‚ˆã†ã«å±æ€§ã‚’ã¤ã‘ã‚Œã°å¤–ã›ãŸã€‚
[Platform::MTAThread]
int __stdcall wWinMain(HINSTANCE, HINSTANCE, PWSTR, int)</p>
<p>Debug - X64 - ãƒ­ãƒ¼ã‚«ãƒ«ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ ã§ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ã¦ã€å³çµ‚äº†ã™ã‚‹ã“ã¨ãŒç¢ºèªã§ãã‚Œã°ã‚ˆã—ã€‚
UWPã®ä½œæ³•ã§ç©ºã®Appã‚’ä½œã£ã¦ã¿ã‚‹</p>
<div class="code"><pre class="code literal-block"><span class="cp">#pragma comment(lib, "windowsapp") </span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;winrt/Windows.ApplicationModel.Core.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;winrt/Windows.UI.Core.h&gt;</span><span class="cp"></span>

<span class="c1">//</span>
<span class="c1">// IFrameworkViewSourceã¨IFrameworkViewã‚’ä¸€ä½“åŒ–ã•ã›ã‚‹ã®ã¯å¿…è¦(ã°ã‚‰ã™ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã£ãŸ)</span>
<span class="c1">//</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">App</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">winrt</span><span class="o">::</span><span class="n">implements</span><span class="o">&lt;</span><span class="n">App</span><span class="w"></span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">winrt</span><span class="o">::</span><span class="n">Windows</span><span class="o">::</span><span class="n">ApplicationModel</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">IFrameworkViewSource</span><span class="w"></span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">winrt</span><span class="o">::</span><span class="n">Windows</span><span class="o">::</span><span class="n">ApplicationModel</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">IFrameworkView</span><span class="o">&gt;</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">winrt</span><span class="o">::</span><span class="n">Windows</span><span class="o">::</span><span class="n">ApplicationModel</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">IFrameworkView</span><span class="w"> </span><span class="nf">CreateView</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Initialize</span><span class="p">(</span><span class="n">winrt</span><span class="o">::</span><span class="n">Windows</span><span class="o">::</span><span class="n">ApplicationModel</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">CoreApplicationView</span><span class="w"> </span><span class="k">const</span><span class="o">&amp;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Load</span><span class="p">(</span><span class="n">winrt</span><span class="o">::</span><span class="n">hstring</span><span class="w"> </span><span class="k">const</span><span class="o">&amp;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Uninitialize</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Run</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">winrt</span><span class="o">::</span><span class="n">Windows</span><span class="o">::</span><span class="n">UI</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">CoreWindow</span><span class="o">::</span><span class="n">GetForCurrentThread</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">window</span><span class="p">.</span><span class="n">Activate</span><span class="p">();</span><span class="w"></span>

<span class="w">        </span><span class="c1">//</span>

<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">dispatcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="p">.</span><span class="n">Dispatcher</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">dispatcher</span><span class="p">.</span><span class="n">ProcessEvents</span><span class="p">(</span><span class="n">winrt</span><span class="o">::</span><span class="n">Windows</span><span class="o">::</span><span class="n">UI</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">CoreProcessEventsOption</span><span class="o">::</span><span class="n">ProcessUntilQuit</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetWindow</span><span class="p">(</span><span class="n">winrt</span><span class="o">::</span><span class="n">Windows</span><span class="o">::</span><span class="n">UI</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">CoreWindow</span><span class="w"> </span><span class="k">const</span><span class="o">&amp;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>


<span class="kt">int</span><span class="w"> </span><span class="kr">__stdcall</span><span class="w"> </span><span class="n">wWinMain</span><span class="p">(</span><span class="n">HINSTANCE</span><span class="p">,</span><span class="w"> </span><span class="n">HINSTANCE</span><span class="p">,</span><span class="w"> </span><span class="n">PWSTR</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">winrt</span><span class="o">::</span><span class="n">init_apartment</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="n">winrt</span><span class="o">::</span><span class="n">Windows</span><span class="o">::</span><span class="n">ApplicationModel</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">CoreApplication</span><span class="o">::</span><span class="n">Run</span><span class="p">(</span><span class="n">App</span><span class="p">());</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>

<p>è­¦å‘Šã¨ã¯ç„¡é–¢ä¿‚ã«ã€å®Ÿè¡Œã«
[Platform::MTAThread]ã‹winrt::init_apartment();ã®ã©ã¡ã‚‰ã‹ãŒå¿…è¦ï¼Ÿ
IUnknown*ã‚’å¾—ã‚‹
winrt::get_abi
ãƒ¡ãƒ¢</p>
<p>https://github.com/Kitware/CMake/blob/master/Tests/VSWinStorePhone/CMakeLists.txt</p>
<p>VisualStudio2017ã®C++/CX Universal D3D11ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’C++/WinRTãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æ”¹é€ ã§ããŸã€‚é–“é•ã£ã¦ã‚‚ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãŒé€šã£ã¦å®Ÿè¡Œæ™‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã®ã«é›£å„€ã—ãŸãŒã€C++/CXã‚ˆã‚Šã¯ã ã„ã¶ä½¿ã„å‹æ‰‹ãŒã‚ˆã•ã’ãªæ„Ÿã˜ã€‚</p>

<hr>
<ul class="pager hidden-print">
<li class="previous">
        <a href="../com_wrl/" rel="prev" title="WRLã‚’ä½¿ã£ãŸæœ€è¿‘ã®Comãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°">
            WRLã‚’ä½¿ã£ãŸæœ€è¿‘ã®Comãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚° ğŸ‘ˆ
        </a>
    </li>
    <li style="flex-grow: 1">
    <li class="next">
        <a href="../sphinx_in_hugo/" rel="next" title="hugoã§ä½œã£ãŸã‚µã‚¤ãƒˆã«Sphinxã‚’åŸ‹ã‚ã“ã‚€">
            ğŸ‘‰ hugoã§ä½œã£ãŸã‚µã‚¤ãƒˆã«Sphinxã‚’åŸ‹ã‚ã“ã‚€
        </a>
    </li>
</ul></main><footer id="footer"><p>
            Powered by
            <a href="https://getnikola.com" rel="nofollow">Nikola</a>
        </p>
    </footer>
</body>
</html>
