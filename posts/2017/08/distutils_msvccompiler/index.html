<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="generator" content="Nikola (getnikola.com)">
<meta name="viewport" content="width=device-width">
<script src="../../../../assets/js/all-nocdn.js"></script><title>distutilsã§cl.exeãŒè¦‹ã¤ã‹ã‚‰ãªã„ | ä¸‰æ¬¡å…ƒæ—¥èªŒ</title>
<link href="../../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
</head>
<body>
    <h1 id="brand">
        <a href="../../../../" title="ä¸‰æ¬¡å…ƒæ—¥èªŒ" rel="home">
            <span id="blog-title">ä¸‰æ¬¡å…ƒæ—¥èªŒ</span>
        </a>
    </h1>

    <nav id="menu"><ul>
<li><a href="../../../../archive.html">Archives</a></li>
<li><a href="../../../../categories/index.html">Tags</a></li>
<li><a href="../../../../rss.xml">RSS feed</a></li>
<li><a href="../../../../about">About</a></li>
<li><a href="../../../../books">MemoBooks</a></li>

            
            
            
        </ul></nav><hr>
<main id="content"><h1 class="p-name entry-title" itemprop="headline name">
    <h1 class="p-name entry-title" itemprop="headline name">
    <a href="." class="u-url">distutilsã§cl.exeãŒè¦‹ã¤ã‹ã‚‰ãªã„
    </a>
</h1>
<ul itemprop="keywords" class="tags">
<li>
        <time datetime="2017-08-06T00:00:00+09:00" title="2017-08-06">2017-08-06</time>
</li>
</ul>
</h1>

<div>
<p>Pythonã˜ã‚ƒãªãã¦VisualStudioå´ã®å•é¡Œã®ã‚ˆã†ãªã®ã ã‘ã©ã€setup.pyã§ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¨ãã«é¡•åœ¨åŒ–ã—ãŸã®ã§ã€‚</p>
<p>ã“ã†ã„ã†æ„Ÿã˜ã®ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œã£ãŸã€‚
from distutils.core import setup, Extension</p>
<p>imgui_module = Extension('_swig_imgui',
        sources=[
            #'imgui_wrap.cxx',
            'imgui.i',
            'imgui/imgui.cpp',
            'imgui/imgui_draw.cpp',
            'imgui/imgui_demo.cpp',
            ],
        swig_opts=[
            #'-modern',
            '-c++',
            '-py3',
            ]
        )</p>
<p>setup (name = 'swig_imgui',
        version = '0.1',
        author      = "ousttrue",
        description = """imgui wrapper using swig""",
        ext_modules = [imgui_module],
        py_modules = ["swig_imgui"],
        )</p>
<blockquote>
<p>python setup.py build</p>
</blockquote>
<p>ã¨ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€‚
Windows10(64bit)ä¸Šã®vs2017 + vcbuildtoolsã®çµ„ã¿åˆã‚ã›ã®ç’°å¢ƒã§ã‚ã‚‹ã€‚
cl.exe /c /nologo /Ox /W3 /GL /DNDEBUG /MD -ID:\Anaconda3\include -ID:\Anaconda3\include /EHsc /Tpimgui_wrap.cpp /Fobuild\temp.win-amd64-3.6\Release\imgui_wrap.obj
error: command 'cl.exe' failed: No such file or directory</p>
<p>distutilsãŒcl.exeã‚’æ¢ã™ã®ã«å¤±æ•—ã—ã¦ã„ã‚‹ã‚ˆã†ãªã®ã§ã‚ã‚‹ã€‚
lib/distutilsä¸‹ã‚’èª¿ã¹ã¦ã¿ãŸã€‚
ã©ã†ã‚„ã‚‰lib/distutils/_msvccompiler.pyã§vcvarsall.batã‹ã‚‰ç’°å¢ƒå¤‰æ•°ã‚’å¾—ã‚‹ã“ã¨ã«å¤±æ•—ã—ã¦ã„ã‚‹ã‚‰ã—ã„ã€‚
å®Ÿéš›ã€C:\Program Files (x86)\Microsoft Visual Studio\Shared\14.0\VC\vcvarsall.batã®å‘¼ã³å‡ºã—ãŒå¤±æ•—ã—ã¦ã„ã‚‹ã“ã¨ã‚’çªãæ­¢ã‚ãŸã€‚
Error in script usage. The correct usage is:
    "C:\Program Files (x86)\Microsoft Visual Studio\Shared\14.0\VC\vcvarsall.bat" [option]
  or
    "C:\Program Files (x86)\Microsoft Visual Studio\Shared\14.0\VC\vcvarsall.bat" [option] store
  or
    "C:\Program Files (x86)\Microsoft Visual Studio\Shared\14.0\VC\vcvarsall.bat" [option] [version number]
  or
    "C:\Program Files (x86)\Microsoft Visual Studio\Shared\14.0\VC\vcvarsall.bat" [option] store [version number]
where [option] is: x86 | amd64 | arm | x86_amd64 | x86_arm | amd64_x86 | amd64_arm
where [version number] is either the full Windows 10 SDK version number or "8.1" to use the windows 8.1 SDK
:
The store parameter sets environment variables to support
  store (rather than desktop) development.
:
For example:
    "C:\Program Files (x86)\Microsoft Visual Studio\Shared\14.0\VC\vcvarsall.bat" x86_amd64
    "C:\Program Files (x86)\Microsoft Visual Studio\Shared\14.0\VC\vcvarsall.bat" x86_arm store
    "C:\Program Files (x86)\Microsoft Visual Studio\Shared\14.0\VC\vcvarsall.bat" x86_amd64 10.0.10240.0
    "C:\Program Files (x86)\Microsoft Visual Studio\Shared\14.0\VC\vcvarsall.bat" x86_arm store 10.0.10240.0
    "C:\Program Files (x86)\Microsoft Visual Studio\Shared\14.0\VC\vcvarsall.bat" x64 8.1
    "C:\Program Files (x86)\Microsoft Visual Studio\Shared\14.0\VC\vcvarsall.bat" x64 store 8.1</p>
<p>ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰å®Ÿè¡Œã—ã¦ã‚‚å¤±æ•—ã—ã¦ã„ã¦ã€vcvarsall.batã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹ã®ã ãŒã€
:setup_buildsku
if not exist "%~dp0......\Microsoft Visual C++ Build Tools\vcbuildtools.bat" goto usage
set CurrentDir=%CD%
call "%~dp0......\Microsoft Visual C++ Build Tools\vcbuildtools.bat" %1 %2
cd /d %CurrentDir%
goto :eof</p>
<p>C:\Program Files (x86)\Microsoft Visual Studio\Shared\14.0\VC\vcvarsall.bat
ã‹ã‚‰
C:\Program Files (x86)\Microsoft Visual C++ Build Tools\vcbuildtools.bat"
ã¸ã®ç›¸å¯¾ãƒ‘ã‚¹ã ã¨ä¸€è‡´ã—ãªã„ã‚ˆãªãƒ¼ã¨ã€‚
ã“ã‚ŒãŒåŸå› ã§cl.exeã®ãƒ‘ã‚¹ãŒå–ã‚Œãªã„ã€‚
setup.pyã«ãƒ¢ãƒ³ã‚­ãƒ¼ãƒ‘ãƒƒãƒã‚’å½“ã¦ã¦cl.exeã‚’ç™ºè¦‹ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã¿ãŸã€‚
ä»¥ä¸‹ã‚’setup.pyã®å…ˆé ­ã«è¿½åŠ ã€‚</p>
<h2>monkey patch for _msvccompiler</h2>
<p>import distutils._msvccompiler
import os
import subprocess
def _get_vc_env(plat_spec):
    if os.getenv("DISTUTILS_USE_SDK"):
        return {
            key.lower(): value
            for key, value in os.environ.items()
        }</p>
<pre class="code literal-block"><span></span>vcvarsall, vcruntime = distutils._msvccompiler._find_vcvarsall(plat_spec)
if not vcvarsall:
    raise DistutilsPlatformError("Unable to find vcvarsall.bat")

try:
    out = subprocess.check_output(
        'cmd /u /c "{}" {} &amp;&amp; set'.format(vcvarsall, plat_spec),
        stderr=subprocess.STDOUT,
    ).decode('utf-16le', errors='replace')
    #######################################################################
    if out.startswith("Error in script usage"):
        out = subprocess.check_output(
            'cmd /u /c "{}" {} &amp;&amp; set'.format("C:\\Program Files (x86)\\Microsoft Visual C++ Build Tools\\vcbuildtools.bat", plat_spec),
            stderr=subprocess.STDOUT,
        ).decode('utf-16le', errors='replace')
    #######################################################################
except subprocess.CalledProcessError as exc:
    log.error(exc.output)
    raise DistutilsPlatformError("Error executing {}"
            .format(exc.cmd))

env = {
    key.lower(): value
    for key, _, value in
    (line.partition('=') for line in out.splitlines())
    if key and value
}

if vcruntime:
    env['py_vcruntime_redist'] = vcruntime
return env
</pre>

<p>distutils._msvccompiler._get_vc_env=_get_vc_env</p>
<p>ä»¥å‰ã«ã‚‚ã“ã‚“ãªã“ã¨ã‚„ã£ãŸã“ã¨ã‚ã‚‹ã‚ˆã†ãªæ°—ãŒã™ã‚‹ãƒ»ãƒ»ãƒ»ã€‚</p>
</div>

<hr>
<ul class="pager hidden-print">
<li class="previous">
        <a href="../../../../python/glbufferdata/" rel="prev" title="PyOpenGLã®glBufferDataã«ã¯ã©ã‚“ãªãƒ‡ãƒ¼ã‚¿ãŒæ¸¡ã›ã‚‹ã®ã‹">
            PyOpenGLã®glBufferDataã«ã¯ã©ã‚“ãªãƒ‡ãƒ¼ã‚¿ãŒæ¸¡ã›ã‚‹ã®ã‹ ğŸ‘ˆ
        </a>
    </li>
    <li style="flex-grow: 1">
    <li class="next">
        <a href="../pyalembic/" rel="next" title="Windowsã§PyAlembicã§ãã‚‹ã®ã‹">
            ğŸ‘‰ Windowsã§PyAlembicã§ãã‚‹ã®ã‹
        </a>
    </li>
</ul></main><footer id="footer"><p>
            Powered by
            <a href="https://getnikola.com" rel="nofollow">Nikola</a>
        </p>
    </footer>
</body>
</html>
