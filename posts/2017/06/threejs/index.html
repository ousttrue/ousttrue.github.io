<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>三次元日誌</title>

    

  <script src="https://ousttrue.github.io/plugins/elasticlunr.min.js" defer></script>
  <script src="https://ousttrue.github.io/search_index.en.js" defer></script>
  <script src="https://ousttrue.github.io/js/search.js" defer></script>

    

     
    <link rel="stylesheet" href="https://ousttrue.github.io/main.css">
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css"
      />
    
  </head>

  <body class="container">
    <a class="site_title" href="https:&#x2F;&#x2F;ousttrue.github.io&#x2F;">
      <div>三次元日誌</div>
    </a>

    <nav class="nav">
      <a class="item" href="/tags/">tags</a>
      <a class="item" href="https://github.com/ousttrue" aria-label="github">
        <i class="fab fa-github fa-lg"></i>
      </a>
      

        
            <form class="navbar-form">
                <input id="userinput" class="form-control is-search" type="search" placeholder="Search docs..."
                    aria-label="Search docs..." autocomplete="off">
                <div id="suggestions" class="shadow bg-white rounded"></div>
            </form>
        
    </nav>

    <main class="main">
<div class="page">
<div class="content">
  <div class="headline">
  
  

  
  <a class="headline_title" href="https:&#x2F;&#x2F;ousttrue.github.io&#x2F;posts&#x2F;2017&#x2F;06&#x2F;threejs&#x2F;"> threejs再始動 
  

  
  </a>

  

  <div>
    <ul class="tags">
      <li class="headline_date">
        <div class="year">2017</div>
        <div class="md">0606</div>
      </li>
      
      

    </ul>
  </div>
</div>
 <p>前のサイトはgulpを使ってtypescriptでthreejs.jsしていたのだけど、hugoで生成している今サイトでは素のjavascriptかなぁ。
es6の練習を兼ねて。</p>
<p>hugoのmdファイルの中に直書きしてみた</p>
<div id="threejs"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/85/three.min.js"></script>
<script type="text/javascript" src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
<script>
function createScene()
{
    var scene=new THREE.Scene();
<pre style="background-color:#2b303b;">
<code>var geometry = new THREE.BoxGeometry(1, 1, 1);
var material = new THREE.MeshPhongMaterial({ color: 0x0000ff });
var box = new THREE.Mesh(geometry, material);
box.position.y = 0.5;
scene.add(box);

var light = new THREE.DirectionalLight(0xffffff);
light.position.set(1, 1, 1);
scene.add(light);

var planeGeometry = new THREE.PlaneGeometry( 10, 10, 10, 10 );
var planeMaterial = new THREE.MeshBasicMaterial( { color: 0x533E25, wireframe:true} );
var planeMesh = new THREE.Mesh( planeGeometry, planeMaterial );
var toRad=Math.PI / 180;
planeMesh.rotation.x = 90 * toRad;
scene.add( planeMesh );

var axis = new THREE.AxisHelper(1000);
axis.position.set(0,0,0);
scene.add(axis);

return scene;
</code></pre>
<p>}</p>
<p>window.addEventListener('DOMContentLoaded', function() {</p>
<pre style="background-color:#2b303b;">
<code>var renderer = new THREE.WebGLRenderer();
renderer.setSize(800, 600);
document.getElementById(&quot;threejs&quot;).appendChild(renderer.domElement);

var scene = createScene();

var camera = new THREE.PerspectiveCamera(45, 800 / 600, 1, 1000);
camera.position.set(2, 3, 5);
camera.lookAt({x:0, y:0, z:0 });

var controls = new THREE.OrbitControls(camera);

var render = function () {
    requestAnimationFrame(render);
    //cube.rotation.x += 1 * Math.PI / 180;
    //cube.rotation.y += 1 * Math.PI / 180;
    //cube.rotation.z += 1 * Math.PI / 180;
    controls.update();
    renderer.render(scene, camera);
};
render();
</code></pre>
<p>});
</script></p>
<p>動いた。
なるほど。
ToDo
ちょっとOrbitControlsをカスタマイズしたいね。
メタセコ的なマウスボタンのアサインにしたい</p>
<p>左ドラッグはカメラ操作以外に開けておく
右ドラッグがカメラ回転
中ドラッグがカメラ移動
ホイールがカメラドリー</p>
<p>マウスイベントの取得はWebGLエレメントの上にマウスカーソルがあるときだけ</p>
<p>OrbitControls.jsが原因でテキストボックスに入力できなくなった問題の解決</p>
<pre style="background-color:#2b303b;">
<code>stage.addEventListener('mouseover', function() {
        controls.enabled = true;
        document.body.style.cursor = &quot;pointer&quot;;
        });

stage.addEventListener('mouseout', function() {
        controls.enabled = false;
        document.body.style.cursor = &quot;default&quot;;
        });
</code></pre>
<p>function createScene()
{
var scene=new THREE.Scene();</p>
<pre style="background-color:#2b303b;">
<code>var geometry = new THREE.BoxGeometry(1, 1, 1);
var material = new THREE.MeshPhongMaterial({ color: 0x0000ff });
var box = new THREE.Mesh(geometry, material);
box.position.y = 0.5;
scene.add(box);

var light = new THREE.DirectionalLight(0xffffff);
light.position.set(1, 1, 1);
scene.add(light);

var planeGeometry = new THREE.PlaneGeometry( 10, 10, 10, 10 );
var planeMaterial = new THREE.MeshBasicMaterial( { color: 0x533E25, wireframe:true} );
var planeMesh = new THREE.Mesh( planeGeometry, planeMaterial );
var toRad=Math.PI / 180;
planeMesh.rotation.x = 90 * toRad;
scene.add( planeMesh );

var axis = new THREE.AxisHelper(1000);
axis.position.set(0,0,0);
scene.add(axis);

scene.update=function()
{
    box.rotation.x += 1 * toRad;
    box.rotation.y += 1 * toRad;
    box.rotation.z += 1 * toRad;
};

return scene;
</code></pre>
<p>}</p>
<p>function onLoaded()
{
var stage=document.getElementById(&quot;threejs&quot;);</p>
<pre style="background-color:#2b303b;">
<code>var width=stage.clientWidth;
var height=stage.clientHeight;
console.log(width, height);

var renderer = new THREE.WebGLRenderer();
renderer.setSize(width, height);
stage.appendChild(renderer.domElement);

var scene = createScene();

var camera = new THREE.PerspectiveCamera(45, width / height, 1, 1000);
camera.position.set(2, 3, 5);
camera.lookAt({x:0, y:0, z:0 });

var controls = new THREE.OrbitControls(camera);
controls.enabled = false;

stage.addEventListener('mouseover', function() {
        controls.enabled = true;
        document.body.style.cursor = &quot;pointer&quot;;
        });

stage.addEventListener('mouseout', function() {
        controls.enabled = false;
        document.body.style.cursor = &quot;default&quot;;
        });

var render = function () {
    requestAnimationFrame(render);
    scene.update();
    controls.update();
    renderer.render(scene, camera);
};
render();
</code></pre>
<p>}</p>
<p>window.addEventListener('DOMContentLoaded', onLoaded);</p>

</div>

<nav class="toc">


</nav>
</div>
</main>

    <footer class="footer">Powered by <a href="https://www.getzola.org/">Zola</a> <a href="https://github.com/ousttrue/zola/tree/custom">custom</a></footer>

  </body>
</html>
