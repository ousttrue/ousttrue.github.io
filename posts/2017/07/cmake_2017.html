
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>&lt;no title&gt; &#8212; 三次元日誌  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />
 
<link
  rel="alternate"
  type="application/atom+xml"
  href="../../../blog/atom.xml"
  title="三次元日誌(ablog)"
/>
 
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
             <p>Windowsでcmakeを使う場合に外部ライブラリの解決がわりと困難。</p>
<p>cmakeのfind_packageがうまくうごかないのである。Unix系であれば <code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX(/usr/local)</span></code> にインストールされた依存プロジェクトを発見できるし、足りなければインストールすることもできる。それに、<code class="docutils literal notranslate"><span class="pre">apt-get</span></code> とか <code class="docutils literal notranslate"><span class="pre">pacman</span></code> とかあるので、自分で全部ビルドするということはあまり必要なかったりする今日この頃です。Windowsにはそういうのがなかった(CMAKE_INSTALL_PREFIXはどこなのか)のだけど、最近出てきたvcpkgがそれをやってくれる。</p>
<p>ArUcoをvcpkgとcmakeでビルドする
ということでvcpkgで外部ライブラリを構築し、一部をソースごとプロジェクトにコピーする方法でArUco(OpenCV)のビルドをやってみる。ArUcoのデバッグ版にアタッチしたり改造したりするつもりなので、opencvのモジュール版ArUcoではなく単体の方を使う。環境は、Windows10(64bit)にVisualStudio2017(C++)。
vcpkgを準備</p>
<ul class="simple">
<li><p>https://github.com/Microsoft/vcpkg</p></li>
</ul>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>&gt; git clone https://github.com/Microsoft/vcpkg.git
&gt; <span class="nb">cd</span> vcpkg
vcpkg&gt; .<span class="se">\b</span>ootstrap-vcpkg.bat

vcpkgで64bit版のopencvをインストール
vcpkg&gt; .<span class="se">\v</span>cpkg.exe install opencv:x64-windows

vcpkg/installed/x64-windowsにinclude, lib, bin等がインストールされる。
vcpkgで64bit版のfreeglutをインストール
vcpkg&gt; .<span class="se">\v</span>cpkg.exe install freeglut:x64-windows
</pre></div>
</div>
<p>arucoのソースを入手
OpenCVのモジュール</p>
<p>http://docs.opencv.org/trunk/d9/d6d/tutorial_table_of_content_aruco.html</p>
<p>ではなくてこっち。</p>
<p>http://www.uco.es/investiga/grupos/ava/node/26
https://sourceforge.net/projects/aruco/files/</p>
<p>aruco-2.0.19.zipを手に入れた。
とりあえずビルドしてみる
vcpkgはd:/vcpkgにインストールされている。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>aruco-2.0.19&gt; mkdir build
aruco-2.0.19/build&gt; cmake -D <span class="nv">CMAKE_INSTALL_PREFIX</span><span class="o">=</span>d:/vcpkg/installed/x64-windows -D <span class="nv">OpenCVDir</span><span class="o">=</span>d:/vcpkg/installed/x64-windows/share/opencv -D <span class="nv">BUILD_GLSAMPLES</span><span class="o">=</span><span class="m">1</span> -G <span class="s2">&quot;Visual Studio 15 2017 Win64&quot;</span> ..
</pre></div>
</div>
<p>aruco_test_glとaruco_test_markermap_glのビルドでエラーが出るのでちょっとコードを修正する。
gl.hより先にWindows.hをincludeしてあげる。</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifdef __APPLE__</span>
<span class="cp">#include</span> <span class="cpf">&lt;GLUT/glut.h&gt;</span><span class="cp"></span>

<span class="cp">#elif defined(_MSC_VER)</span>
<span class="cp">#include</span> <span class="cpf">&lt;Windows.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;GL/glut.h&gt;</span><span class="cp"></span>

<span class="cp">#else</span>
<span class="cp">#include</span> <span class="cpf">&lt;GL/gl.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;GL/glut.h&gt;</span><span class="cp"></span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>あとfreeglutのリンクををdebug, release振り分けのために、
CMakeLists.txtをちょっと改造。だいたいこういう感じ。</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">IF</span> <span class="p">(</span><span class="s">GLUT_FOUND</span><span class="p">)</span>
	<span class="nb">STRING</span><span class="p">(</span><span class="s">REPLACE</span> <span class="s">lib/freeglut.lib</span> <span class="s">debug/lib/freeglutd.lib</span> <span class="s">GLUT_glut_DEBUG_LIBRARY</span> <span class="o">${</span><span class="nv">GLUT_glut_LIBRARY</span><span class="o">}</span><span class="p">)</span>
	<span class="nb">MESSAGE</span><span class="p">(</span><span class="s">STATUS</span> <span class="s2">&quot;GLUT_glut_DEBUG_LIBRARY=${GLUT_glut_DEBUG_LIBRARY}&quot;</span><span class="p">)</span>
	<span class="nb">set</span> <span class="p">(</span><span class="s">OPENGL_LIBS</span>  <span class="s">general</span>
		<span class="o">${</span><span class="nv">OPENGL_gl_LIBRARY</span><span class="o">}</span>
		<span class="o">${</span><span class="nv">OPENGL_glu_LIBRARY</span><span class="o">}</span>
		<span class="s">optimized</span> <span class="o">${</span><span class="nv">GLUT_glut_LIBRARY</span><span class="o">}</span>
		<span class="s">debug</span> <span class="o">${</span><span class="nv">GLUT_glut_DEBUG_LIBRARY</span><span class="o">}</span>
		<span class="p">)</span>
<span class="nb">ENDIF</span><span class="p">()</span>
</pre></div>
</div>
<p>この部分と連携する。
TARGET_LINK_LIBRARIES(aruco_test_gl ${OPENGL_LIBS})</p>
<p>これで、CMAKE_INSTALL_PREFIX/binにパスを通せばプログラムは動作する。
arucoのテストデータを入手してwebcamで動作確認
テストデータを入手する。</p>
<p>https://sourceforge.net/projects/aruco/files/</p>
<p>aruco-test-data-2.0.zipを手に入れた。
この中のintrinsics.ymlを引数にして実行する(本来は、カメラキャリブレーションをしてintrinsics.ymlを自分のカメラ用に作成する必要がある)。
aruco_test_gl.exe “live” “path_to_intrinsics.yml” 0.05
aruco_test_glとarucoの入った小さいプロジェクト
ArUcoを改造する予定。</p>
<p>intrinsics.ymlを省略したり簡略化したい(fovyとaspectratioだけにするなど)
左手系(DirectXやUnity)に対応</p>
<p>ということで、arucoのソースを含めている。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>aruco_test

  + CMakeLists.txt

  + aruco_test_gl
    + CMakeLists.txt
    + aruco_test_gl.cpp<span class="o">(</span>aruco-2.0.19/utils_gl/aruco_test_gl.cppをコピー<span class="o">)</span>

  + src<span class="o">(</span>aruco-2.0.19/srcをコピー<span class="o">)</span>
</pre></div>
</div>
<div class="highlight-CMakeLists.txt notranslate"><div class="highlight"><pre><span></span>CMAKE_MINIMUM_REQUIRED(VERSION 2.8)
PROJECT(aruco)

FIND_PACKAGE(OpenCV REQUIRED )
SET (ARUCO_REQUIRED_LIBRARIES ${OpenCV_LIBS})
INCLUDE_DIRECTORIES(${OpenCV_INCLUDE_DIRS})

FIND_PACKAGE(OpenGL REQUIRED)

FIND_PACKAGE(GLUT)
MESSAGE(STATUS &quot;GLUT_glut_LIBRARY=${GLUT_glut_LIBRARY}&quot;)
STRING(REPLACE lib/freeglut.lib debug/lib/freeglutd.lib GLUT_glut_DEBUG_LIBRARY ${GLUT_glut_LIBRARY})
MESSAGE(STATUS &quot;GLUT_glut_DEBUG_LIBRARY=${GLUT_glut_DEBUG_LIBRARY}&quot;)
IF (GLUT_FOUND)
    set (OPENGL_LIBS  general
        ${OPENGL_gl_LIBRARY}
        ${OPENGL_glu_LIBRARY}
        optimized ${GLUT_glut_LIBRARY}
        debug ${GLUT_glut_DEBUG_LIBRARY}
        )
ENDIF()

ADD_DEFINITIONS(-D_SCL_SECURE_NO_WARNINGS)
SET(CMAKE_CXX_FLAGS &quot;/wd4819 /EHsc&quot;)

ADD_SUBDIRECTORY(src)
ADD_SUBDIRECTORY(utils_gl)

aruco_test_gl/CMakeLists.txt
INCLUDE_DIRECTORIES(${PROJECT_SOURCE_DIR}/src ${GNULIBS_INCLUDE_DIR})
LINK_LIBRARIES(${PROJECT_NAME} ${REQUIRED_LIBRARIES} )

IF(OPENGL_LIBS)
    ADD_EXECUTABLE(aruco_test_gl
        aruco_test_gl.cpp
        )
    TARGET_LINK_LIBRARIES(aruco_test_gl ${OPENGL_LIBS})
</pre></div>
</div>
<p>以上で、arucoを例にvcpkgでopencvとfreeglutdを外部管理してcmakeでプロジェクトを取り廻す例を作った。
作業例。</p>
<p>https://github.com/ousttrue/aruco_test</p>

<div class="section">
   
</div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">三次元日誌</a></h1>








<h3>Navigation</h3>


<h3>
  <a href="../../../blog.html">Recent Posts</a>
</h3>
<ul>
   
  <li>
    <a href="../../2021/winter/ablog.html"
      >20 December - SSGをABlogに変更</a
    >
  </li>
  
  <li>
    <a href="../../2021/winter/python_typing_stub.html"
      >12 December - python の型ヒント</a
    >
  </li>
  
  <li>
    <a href="../../2021/winter/cindex.html"
      >04 December - libclang で 言語バインディングを作る</a
    >
  </li>
  
  <li>
    <a href="../../2021/fall/ktx2.html"
      >21 November - ktx2 情報収集</a
    >
  </li>
  
  <li>
    <a href="../../2021/fall/pyside6.html"
      >16 November - pyside6 やってみる</a
    >
  </li>
  
</ul>

<h3><a href="../../../blog/tag.html">Tags</a></h3>
<style type="text/css">
  ul.ablog-cloud {
    list-style: none;
    overflow: auto;
  }
  ul.ablog-cloud li {
    float: left;
    height: 20pt;
    line-height: 18pt;
    margin-right: 5px;
  }
  ul.ablog-cloud a {
    text-decoration: none;
    vertical-align: middle;
  }
  li.ablog-cloud-1 {
    font-size: 80%;
  }
  li.ablog-cloud-2 {
    font-size: 95%;
  }
  li.ablog-cloud-3 {
    font-size: 110%;
  }
  li.ablog-cloud-4 {
    font-size: 125%;
  }
  li.ablog-cloud-5 {
    font-size: 140%;
  }
</style>
<ul class="ablog-cloud">
   
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/opengl.html">"OpenGL"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/asio.html">"asio"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/c.html">"c++"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/com.html">"com"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/cpp.html">"cpp"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/cpp.html">"cpp"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/css.html">"css"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/cython.html">"cython"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-2">
    <a href="../../../blog/tag/dap.html">"dap"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/dlang.html">"dlang"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/ffi.html">"ffi"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/ffi.html">"ffi"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/imgui.html">"imgui"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/imgui.html">"imgui"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/libclang.html">"libclang"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/libclang.html">"libclang"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/lsp.html">"lsp"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/lsp.html">"lsp"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/lua.html">"lua"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/lua.html">"lua"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-2">
    <a href="../../../blog/tag/luajit.html">"luajit"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/msgpack.html">"msgpack"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/nvim.html">"nvim"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/opengl.html">"opengl"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/python.html">"python"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/python.html">"python"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/qt.html">"qt"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/rust.html">"rust"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/sphinx.html">"sphinx"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-2">
    <a href="../../../blog/tag/ssg.html">"ssg"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/vim.html">"vim"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/vscode.html">"vscode"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/wsl.html">"wsl"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/3d.html">["3D"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/opengl.html">["OpenGL"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/blender.html">["blender"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/blender.html">["blender"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/clang.html">["clang"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/cpp.html">["cpp"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/gltf.html">["gltf"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/imgui.html">["imgui"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-3">
    <a href="../../../blog/tag/lua.html">["lua"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/lua.html">["lua"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/luajit.html">["luajit"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/mdbook.html">["mdbook"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/msys2.html">["msys2"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-2">
    <a href="../../../blog/tag/nvim.html">["nvim"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/nvim.html">["nvim"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-3">
    <a href="../../../blog/tag/python.html">["python"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-5">
    <a href="../../../blog/tag/python.html">["python"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/rust.html">["rust"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/sq.html">["sq"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/ssg.html">["ssg"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-2">
    <a href="../../../blog/tag/vim.html">["vim"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-3">
    <a href="../../../blog/tag/vim.html">["vim"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/wayland.html">["wayland"</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/wsl.html">["wsl"]</a>
  </li>
    
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/zola.html">["zola"</a>
  </li>
   
</ul>

<h3>
  <a href="../../../blog/archive.html">Archives</a>
</h3>
<ul>
   
  <li>
    <a href="../../../blog/2021.html">2021 (37)</a>
  </li>
    
  <li>
    <a href="../../../blog/2020.html">2020 (2)</a>
  </li>
    
  <li>
    <a href="../../../blog/2019.html">2019 (24)</a>
  </li>
    
  <li>
    <a href="../../../blog/2017.html">2017 (15)</a>
  </li>
    
  <li>
    <a href="../../../blog/2016.html">2016 (1)</a>
  </li>
    
  <li>
    <a href="../../../blog/2015.html">2015 (2)</a>
  </li>
    
  <li>
    <a href="../../../blog/2013.html">2013 (12)</a>
  </li>
    
  <li>
    <a href="../../../blog/2012.html">2012 (1)</a>
  </li>
   
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, ousttrue.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../_sources/posts/2017/07/cmake_2017.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>