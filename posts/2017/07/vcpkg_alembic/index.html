<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="generator" content="Nikola (getnikola.com)">
<meta name="viewport" content="width=device-width">
<script src="../../../../assets/js/all-nocdn.js"></script><title>vcpkgã®Alembicãƒ‘ãƒƒã‚±ãƒ¼ã‚¸(USE_HDF5)ã‚’ä½œã£ã¦ã¿ã‚‹ | ä¸‰æ¬¡å…ƒæ—¥èªŒ</title>
<link href="../../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
</head>
<body>
    <h1 id="brand">
        <a href="../../../../" title="ä¸‰æ¬¡å…ƒæ—¥èªŒ" rel="home">
            <span id="blog-title">ä¸‰æ¬¡å…ƒæ—¥èªŒ</span>
        </a>
    </h1>

    <nav id="menu"><ul>
<li><a href="../../../../archive.html">Archives</a></li>
<li><a href="../../../../categories/index.html">Tags</a></li>
<li><a href="../../../../rss.xml">RSS feed</a></li>
<li><a href="../../../../about">About</a></li>
<li><a href="../../../../books">MemoBooks</a></li>

            
            
            
        </ul></nav><hr>
<main id="content"><h1 class="p-name entry-title" itemprop="headline name">
    <h1 class="p-name entry-title" itemprop="headline name">

    <a href="." class="u-url">vcpkgã®Alembicãƒ‘ãƒƒã‚±ãƒ¼ã‚¸(USE_HDF5)ã‚’ä½œã£ã¦ã¿ã‚‹</a>
</h1>
<ul itemprop="keywords" class="tags">
<li>
        <time datetime="2017-07-18T00:00:00+09:00" title="2017-07-18">2017-07-18</time>
</li>
</ul>
</h1>

<div>
<p>mmdbridgeã®vcpkgã‚’ä½¿ã£ãŸãƒ“ãƒ«ãƒ‰æ‰‹é †ã‚’ä½œã£ãŸã¤ã„ã§ã«Alembicã®vcpkgå‘ã‘ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½œã£ã¦ã¿ã‚‹ã€‚</p>
<p>æƒ…å ±åé›†</p>
<ul>
<li>https://github.com/Microsoft/vcpkg/blob/master/docs/examples/packaging-zlib.md</li>
</ul>
<p>èª­ã‚“ã ã€‚</p>
<p><code>vcpkg create url</code> ã§é››å½¢ãŒä½œã‚Œã‚‹ã€‚</p>
<p>å®Ÿé¨“</p>
<pre class="code literal-block"><span></span>.<span class="se">\v</span>cpkg.exe create alembic https://github.com/alembic/alembic/archive/1.7.1.tar.gz
CMake Error at scripts/ports.cmake:101 <span class="o">(</span>message<span class="o">)</span>:
  Portfile already exists: <span class="s1">'D:\vcpkg\ports\alembic\portfile.cmake'</span>
</pre>

<p>ã™ã§ã«ã‚ã‚‹ã ã¨ï¼ï¼Ÿ
æœ€è¿‘ã§ããŸã‚‰ã—ã„ã€‚</p>
<ul>
<li>https://github.com/Microsoft/vcpkg/tree/master/ports/alembic</li>
</ul>
<p>ã—ã‹ã—ã€hdféå¯¾å¿œã¿ãŸã„ãªã®ã§ä½œã£ã¦ã¿ã‚‹ã€‚</p>
<pre class="code literal-block"><span></span>.<span class="se">\v</span>cpkg.exe create alembic-hdf https://github.com/alembic/alembic/archive/1.7.1.tar.gz

VCPKG_DIR
    ports
        alembic-hdf
            CONTROL
            portfile.cmake
</pre>

<p>ãŒã§ããŸã€‚
ç°¡å˜ãªCONTROLã‹ã‚‰ã€‚
ã“ã£ã¡ã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æƒ…å ±ã‚’æ±ºã‚ã‚‹ã ã‘ãªã®ã§ã•ãã£ã¨ã€‚</p>
<pre class="code literal-block"><span></span>Source: alembic-hdf
Version: <span class="m">1</span>.7.1
Description: alembic with hdf5
Build-Depends: hdf5
</pre>

<p>æœ¬é¡Œã®portfile.cmakeã€‚
ãã®ã¾ã¾ã ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã®ã€‚æœ€ä½é™ä»¥ä¸‹ãŒå¿…è¦ãªã‚ˆã†ã ã€‚
ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‚’å±•é–‹ãƒ‘ã‚¹ã®æŒ‡å®šã€‚</p>
<pre class="code literal-block"><span></span><span class="nb">set</span><span class="p">(</span><span class="s">SOURCE_PATH</span> <span class="o">${</span><span class="nv">CURRENT_BUILDTREES_DIR</span><span class="o">}</span><span class="s">/src/1.7.1</span><span class="p">)</span>

<span class="c"># â†“ ä¿®æ­£ã™ã‚‹</span>

<span class="nb">set</span><span class="p">(</span><span class="s">SOURCE_PATH</span> <span class="o">${</span><span class="nv">CURRENT_BUILDTREES_DIR</span><span class="o">}</span><span class="s">/src/alembic-1.7.1</span><span class="p">)</span>
</pre>

<p>å®Ÿè¡Œã—ã¦ã¿ã‚‹ã€‚</p>
<pre class="code literal-block"><span></span>&gt; ./vcpkg install alembic-hdf:x64-windows
The following packages will be built and installed:
    alembic-hdf:x64-windows
Building package alembic-hdf:x64-windows...
-- <span class="nv">CURRENT_INSTALLED_DIR</span><span class="o">=</span>D:/vcpkg/installed/x64-windows
-- <span class="nv">DOWNLOADS</span><span class="o">=</span>D:/vcpkg/downloads
-- <span class="nv">CURRENT_PACKAGES_DIR</span><span class="o">=</span>D:/vcpkg/packages/alembic-hdf_x64-windows
-- <span class="nv">CURRENT_BUILDTREES_DIR</span><span class="o">=</span>D:/vcpkg/buildtrees/alembic-hdf
-- <span class="nv">CURRENT_PORT_DIR</span><span class="o">=</span>D:/vcpkg/ports/alembic-hdf/.
-- Using cached D:/vcpkg/downloads/1.7.1.tar.gz
-- Testing integrity of cached file...
-- Testing integrity of cached file... OK
-- Extracting <span class="k">done</span>
-- Configuring x64-windows-rel
-- Configuring x64-windows-rel <span class="k">done</span>
-- Configuring x64-windows-dbg
PS D:<span class="se">\v</span>cpkg&gt; .<span class="se">\v</span>cpkg.exe install alembic-hdf:x64-windows
The following packages will be built and installed:
    alembic-hdf:x64-windows
Building package alembic-hdf:x64-windows...
-- <span class="nv">CURRENT_INSTALLED_DIR</span><span class="o">=</span>D:/vcpkg/installed/x64-windows
-- <span class="nv">DOWNLOADS</span><span class="o">=</span>D:/vcpkg/downloads
-- <span class="nv">CURRENT_PACKAGES_DIR</span><span class="o">=</span>D:/vcpkg/packages/alembic-hdf_x64-windows
-- <span class="nv">CURRENT_BUILDTREES_DIR</span><span class="o">=</span>D:/vcpkg/buildtrees/alembic-hdf
-- <span class="nv">CURRENT_PORT_DIR</span><span class="o">=</span>D:/vcpkg/ports/alembic-hdf/.
-- Using cached D:/vcpkg/downloads/1.7.1.tar.gz
-- Testing integrity of cached file...
-- Testing integrity of cached file... OK
-- Extracting <span class="k">done</span>
-- Configuring x64-windows-rel
-- Configuring x64-windows-rel <span class="k">done</span>
-- Configuring x64-windows-dbg
-- Configuring x64-windows-dbg <span class="k">done</span>
-- Package x64-windows-rel
-- Package x64-windows-rel <span class="k">done</span>
-- Package x64-windows-dbg
-- Package x64-windows-dbg <span class="k">done</span>
-- Performing post-build validation
Include files should not be duplicated into the /debug/include directory. If this cannot be disabled in the project cmake, use
    file<span class="o">(</span>REMOVE_RECURSE <span class="si">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="si">}</span>/debug/include<span class="o">)</span>
The /lib/cmake folder should be merged with /debug/lib/cmake and moved to /share/alembic-hdf/cmake.
The following cmake files were found outside /share/alembic-hdf. Please place cmake files in /share/alembic-hdf.

    D:/vcpkg/packages/alembic-hdf_x64-windows/lib/cmake/Alembic/AlembicConfig.cmake
    D:/vcpkg/packages/alembic-hdf_x64-windows/lib/cmake/Alembic/AlembicConfigVersion.cmake
    D:/vcpkg/packages/alembic-hdf_x64-windows/lib/cmake/Alembic/AlembicTargets-release.cmake
    D:/vcpkg/packages/alembic-hdf_x64-windows/lib/cmake/Alembic/AlembicTargets.cmake
    D:/vcpkg/packages/alembic-hdf_x64-windows/debug/lib/cmake/Alembic/AlembicConfig.cmake
    D:/vcpkg/packages/alembic-hdf_x64-windows/debug/lib/cmake/Alembic/AlembicConfigVersion.cmake
    D:/vcpkg/packages/alembic-hdf_x64-windows/debug/lib/cmake/Alembic/AlembicTargets-debug.cmake
    D:/vcpkg/packages/alembic-hdf_x64-windows/debug/lib/cmake/Alembic/AlembicTargets.cmake

The /debug/lib/cmake folder should be merged with /lib/cmake into /share/alembic-hdf

The following dlls were found in /lib or /debug/lib. Please move them to /bin or /debug/bin, respectively.

    D:/vcpkg/packages/alembic-hdf_x64-windows/lib/Alembic.dll


The following dlls were found in /lib or /debug/lib. Please move them to /bin or /debug/bin, respectively.

    D:/vcpkg/packages/alembic-hdf_x64-windows/debug/lib/Alembic.dll

The software license must be available at <span class="si">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="si">}</span>/share/alembic-hdf/copyright

    file<span class="o">(</span>COPY <span class="si">${</span><span class="nv">CURRENT_BUILDTREES_DIR</span><span class="si">}</span>/src/alembic-1.7.1/LICENSE.txt DESTINATION <span class="si">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="si">}</span>/share/alembic-hdf<span class="o">)</span>
    file<span class="o">(</span>RENAME <span class="si">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="si">}</span>/share/alembic-hdf/LICENSE.txt <span class="si">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="si">}</span>/share/alembic-hdf/copyright<span class="o">)</span>
The following EXEs were found in /bin or /debug/bin. EXEs are not valid distribution targets.

    D:/vcpkg/packages/alembic-hdf_x64-windows/bin/abcdiff.exe
    D:/vcpkg/packages/alembic-hdf_x64-windows/bin/abcecho.exe
    D:/vcpkg/packages/alembic-hdf_x64-windows/bin/abcechobounds.exe
    D:/vcpkg/packages/alembic-hdf_x64-windows/bin/abcls.exe
    D:/vcpkg/packages/alembic-hdf_x64-windows/bin/abcstitcher.exe
    D:/vcpkg/packages/alembic-hdf_x64-windows/bin/abctree.exe

The following EXEs were found in /bin or /debug/bin. EXEs are not valid distribution targets.

    D:/vcpkg/packages/alembic-hdf_x64-windows/debug/bin/abcdiff.exe
    D:/vcpkg/packages/alembic-hdf_x64-windows/debug/bin/abcecho.exe
    D:/vcpkg/packages/alembic-hdf_x64-windows/debug/bin/abcechobounds.exe
    D:/vcpkg/packages/alembic-hdf_x64-windows/debug/bin/abcls.exe
    D:/vcpkg/packages/alembic-hdf_x64-windows/debug/bin/abcstitcher.exe
    D:/vcpkg/packages/alembic-hdf_x64-windows/debug/bin/abctree.exe

Found <span class="m">9</span> error<span class="o">(</span>s<span class="o">)</span>. Please correct the portfile:
    D:<span class="se">\v</span>cpkg<span class="se">\p</span>orts<span class="se">\a</span>lembic-hdf<span class="se">\p</span>ortfile.cmake
-- Performing post-build validation <span class="k">done</span>
Error: Building package alembic-hdf:x64-windows failed with: POST_BUILD_CHECKS_FAILED
Please ensure you<span class="err">'</span>re using the latest portfiles with <span class="sb">`</span>.<span class="se">\v</span>cpkg update<span class="sb">`</span>, <span class="k">then</span>
submit an issue at https://github.com/Microsoft/vcpkg/issues including:
  Package: alembic-hdf:x64-windows
  Vcpkg version: <span class="m">0</span>.0.81-144d3718c4197b101c7d61ee6a258200371fb1ab

Additionally, attach any relevant sections from the log files above.
</pre>

<p>ã¨ã„ã†æ„Ÿã˜ã«ãªã£ãŸã€‚
ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã™ã”ãè¦ªåˆ‡ã€‚
ã‚ã¨ã€NINJAãƒ“ãƒ«ãƒ‰é€Ÿã„ã€‚
ã‚¨ãƒ©ãƒ¼ã«ã¯ãªã‚‹ãŒãƒ“ãƒ«ãƒ‰çµæœã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å‡ºåŠ›ã•ã‚ŒãŸã€‚</p>
<pre class="code literal-block"><span></span>VCPKG_DIR/packages/alembic-hdf_x64-windows
â”‚  BUILD_INFO
â”‚
â”œâ”€bin
â”‚      abcdiff.exe
â”‚      abcecho.exe
â”‚      abcechobounds.exe
â”‚      abcls.exe
â”‚      abcstitcher.exe
â”‚      abctree.exe
â”‚
â”œâ”€debug
â”‚  â”œâ”€bin
â”‚  â”‚      abcdiff.exe
â”‚  â”‚      abcecho.exe
â”‚  â”‚      abcechobounds.exe
â”‚  â”‚      abcls.exe
â”‚  â”‚      abcstitcher.exe
â”‚  â”‚      abctree.exe
â”‚  â”‚
â”‚  â”œâ”€include
â”‚  â”‚  â””â”€Alembic
â”‚  â”‚      â”œâ”€Abc
â”‚  â”‚      â”‚      *.h
â”‚  â”‚      â”‚
â”‚  â”‚      â”œâ”€AbcCollection
â”‚  â”‚      â”‚      *.h
â”‚  â”‚      â”‚
â”‚  â”‚      â”œâ”€AbcCoreAbstract
â”‚  â”‚      â”‚      *.h
â”‚  â”‚      â”‚
â”‚  â”‚      â”œâ”€AbcCoreFactory
â”‚  â”‚      â”‚      *.h
â”‚  â”‚      â”‚
â”‚  â”‚      â”œâ”€AbcCoreLayer
â”‚  â”‚      â”‚      *.h
â”‚  â”‚      â”‚
â”‚  â”‚      â”œâ”€AbcCoreOgawa
â”‚  â”‚      â”‚      *.h
â”‚  â”‚      â”‚
â”‚  â”‚      â”œâ”€AbcGeom
â”‚  â”‚      â”‚      *.h
â”‚  â”‚      â”‚
â”‚  â”‚      â”œâ”€AbcMaterial
â”‚  â”‚      â”‚      *.h
â”‚  â”‚      â”‚
â”‚  â”‚      â””â”€Util
â”‚  â”‚              *.h
â”‚  â”‚
â”‚  â””â”€lib
â”‚      â”‚  Alembic.dll
â”‚      â”‚  Alembic.lib
â”‚      â”‚
â”‚      â””â”€cmake
â”‚          â””â”€Alembic
â”‚                  AlembicConfig.cmake
â”‚                  AlembicConfigVersion.cmake
â”‚                  AlembicTargets-debug.cmake
â”‚                  AlembicTargets.cmake
â”‚
â”œâ”€include
â”‚  â””â”€Alembic
â”‚      â”œâ”€Abc
â”‚      â”‚      *.h
â”‚      â”‚
â”‚      â”œâ”€AbcCollection
â”‚      â”‚      *.h
â”‚      â”‚
â”‚      â”œâ”€AbcCoreAbstract
â”‚      â”‚      *.h
â”‚      â”‚
â”‚      â”œâ”€AbcCoreFactory
â”‚      â”‚      *.h
â”‚      â”‚
â”‚      â”œâ”€AbcCoreLayer
â”‚      â”‚      *.h
â”‚      â”‚
â”‚      â”œâ”€AbcCoreOgawa
â”‚      â”‚      *.h
â”‚      â”‚
â”‚      â”œâ”€AbcGeom
â”‚      â”‚      *.h
â”‚      â”‚
â”‚      â”œâ”€AbcMaterial
â”‚      â”‚      *.h
â”‚      â”‚
â”‚      â””â”€Util
â”‚              *.h
â”‚
â””â”€lib
    â”‚  Alembic.dll
    â”‚  Alembic.lib
    â”‚
    â””â”€cmake
        â””â”€Alembic
                AlembicConfig.cmake
                AlembicConfigVersion.cmake
                AlembicTargets-release.cmake
                AlembicTargets.cmake
</pre>

<p>ã“ã“ã‹ã‚‰ä¸è¦ãªã‚‚ã®ã‚’å‰Šé™¤ã—ãŸã‚Šã€å ´æ‰€ã®é•ã†ã‚‚ã®ã‚’ç§»å‹•ã—ãŸã‚Šã™ã‚‹ã“ã¨ã§å®Œæˆã§ããã†ã€‚
ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«æ²¿ã£ã¦ä¿®æ­£ã—ã¦ã¿ã‚‹</p>
<p><code>debug/include</code> ä¸è¦</p>
<p>ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å«ã¾ã‚Œã‚‹ã¨ãŠã‚Šã«ã€‚</p>
<pre class="code literal-block"><span></span><span class="nb">file</span><span class="p">(</span><span class="s">REMOVE_RECURSE</span> <span class="o">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="o">}</span><span class="s">/debug/include</span><span class="p">)</span>

<span class="err">lib/cmake/Alembic/*.cmakeã‚’share/alembic-hdfã«ç§»å‹•ã™ã‚‹ã¹ã—</span>
<span class="err">debug/lib/cmake/Alembicã‚’çµ±åˆã™ã‚‹ã¹ã—ã€‚</span>
<span class="nb">vcpkg_fixup_cmake_targets</span><span class="p">(</span><span class="s">CONFIG_PATH</span> <span class="s2">"lib/cmake/Alembic"</span><span class="p">)</span>
</pre>

<p>ã½ã„ã€‚ <code>alembic/portfile.cmake</code> ã‚’å‚è€ƒã«ã—ãŸ</p>
<pre class="code literal-block"><span></span><span class="err">lib/Alembic.dllã‚’bin/Alembic.dllã«ç§»å‹•ã›ã‚ˆ</span>
<span class="err">debug/lib/Alembic.dllã‚‚ã€‚</span>
<span class="nb">file</span><span class="p">(</span><span class="s">RENAME</span> <span class="o">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="o">}</span><span class="s">/lib/Alembic.dll</span> <span class="o">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="o">}</span><span class="s">/bin/Alembic.dll</span><span class="p">)</span>
<span class="nb">file</span><span class="p">(</span><span class="s">RENAME</span> <span class="o">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="o">}</span><span class="s">/debug/lib/Alembic.dll</span> <span class="o">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="o">}</span><span class="s">/debug/bin/Alembic.dll</span><span class="p">)</span>
</pre>

<p><code>alembic/portfile.cmake</code> ã‚’å‚è€ƒã«ã—ãŸ</p>
<p>ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã›ã‚ˆ
ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å«ã¾ã‚Œã‚‹ã¨ãŠã‚Šã«ã€‚</p>
<pre class="code literal-block"><span></span><span class="nb">file</span><span class="p">(</span><span class="s">COPY</span> <span class="o">${</span><span class="nv">CURRENT_BUILDTREES_DIR</span><span class="o">}</span><span class="s">/src/alembic-1.7.1/LICENSE.txt</span> <span class="s">DESTINATION</span> <span class="o">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="o">}</span><span class="s">/share/alembic-hdf</span><span class="p">)</span>
<span class="nb">file</span><span class="p">(</span><span class="s">RENAME</span> <span class="o">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="o">}</span><span class="s">/share/alembic-hdf/LICENSE.txt</span> <span class="o">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="o">}</span><span class="s">/share/alembic-hdf/copyright</span><span class="p">)</span>
</pre>

<p>exeã‚’å‰Šé™¤ã›ã‚ˆ</p>
<pre class="code literal-block"><span></span><span class="nb">file</span><span class="p">(</span><span class="s">GLOB</span> <span class="s">EXE</span> <span class="o">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="o">}</span><span class="s">/bin/*.exe</span><span class="p">)</span>
<span class="nb">file</span><span class="p">(</span><span class="s">GLOB</span> <span class="s">DEBUG_EXE</span> <span class="o">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="o">}</span><span class="s">/debug/bin/*.exe</span><span class="p">)</span>
<span class="nb">file</span><span class="p">(</span><span class="s">REMOVE</span> <span class="o">${</span><span class="nv">EXE</span><span class="o">}</span><span class="p">)</span>
<span class="nb">file</span><span class="p">(</span><span class="s">REMOVE</span> <span class="o">${</span><span class="nv">DEBUG_EXE</span><span class="o">}</span><span class="p">)</span>
</pre>

<p>alembic/portfile.cmakeã‚’å‚è€ƒã«ã—ãŸ
ãŠã¾ã‘: debugç”¨ã«pdbã‚’ã‚³ãƒ”ãƒ¼
alembic/portfile.cmakeã‚’å‚è€ƒã«ã—ãŸ
vcpkg_copy_pdbs()</p>
<p>vcpkg_install_cmakeã‚ˆã‚Šä¸‹ã‚’æŠœç²‹ã€‚</p>
<pre class="code literal-block"><span></span><span class="nb">vcpkg_install_cmake</span><span class="p">()</span>

<span class="c"># Remove debug/include</span>
<span class="nb">file</span><span class="p">(</span><span class="s">REMOVE_RECURSE</span> <span class="o">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="o">}</span><span class="s">/debug/include</span><span class="p">)</span>
<span class="c"># fix *.cmake</span>
<span class="nb">vcpkg_fixup_cmake_targets</span><span class="p">(</span><span class="s">CONFIG_PATH</span> <span class="s2">"lib/cmake/Alembic"</span><span class="p">)</span>
<span class="c"># Rename dll</span>
<span class="nb">file</span><span class="p">(</span><span class="s">RENAME</span> <span class="o">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="o">}</span><span class="s">/lib/Alembic.dll</span> <span class="o">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="o">}</span><span class="s">/bin/Alembic.dll</span><span class="p">)</span>
<span class="nb">file</span><span class="p">(</span><span class="s">RENAME</span> <span class="o">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="o">}</span><span class="s">/debug/lib/Alembic.dll</span> <span class="o">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="o">}</span><span class="s">/debug/bin/Alembic.dll</span><span class="p">)</span>
<span class="c"># Handle copyright</span>
<span class="nb">file</span><span class="p">(</span><span class="s">COPY</span> <span class="o">${</span><span class="nv">CURRENT_BUILDTREES_DIR</span><span class="o">}</span><span class="s">/src/alembic-1.7.1/LICENSE.txt</span> <span class="s">DESTINATION</span> <span class="o">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="o">}</span><span class="s">/share/alembic-hdf</span><span class="p">)</span>
<span class="nb">file</span><span class="p">(</span><span class="s">RENAME</span> <span class="o">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="o">}</span><span class="s">/share/alembic-hdf/LICENSE.txt</span> <span class="o">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="o">}</span><span class="s">/share/alembic-hdf/copyright</span><span class="p">)</span>
<span class="c"># Remove exe files</span>
<span class="nb">file</span><span class="p">(</span><span class="s">GLOB</span> <span class="s">EXE</span> <span class="o">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="o">}</span><span class="s">/bin/*.exe</span><span class="p">)</span>
<span class="nb">file</span><span class="p">(</span><span class="s">GLOB</span> <span class="s">DEBUG_EXE</span> <span class="o">${</span><span class="nv">CURRENT_PACKAGES_DIR</span><span class="o">}</span><span class="s">/debug/bin/*.exe</span><span class="p">)</span>
<span class="nb">file</span><span class="p">(</span><span class="s">REMOVE</span> <span class="o">${</span><span class="nv">EXE</span><span class="o">}</span><span class="p">)</span>
<span class="nb">file</span><span class="p">(</span><span class="s">REMOVE</span> <span class="o">${</span><span class="nv">DEBUG_EXE</span><span class="o">}</span><span class="p">)</span>
<span class="c"># Copy pdb</span>
<span class="nb">vcpkg_copy_pdbs</span><span class="p">()</span>
</pre>

<p>å†åº¦ãƒ“ãƒ«ãƒ‰ã€‚</p>
<p><code>&gt; vcpkg install alembic-hdf:x64-windows</code></p>
<p>ã†ã¾ãã„ã£ãŸã€‚
USE_HDF5ã‚’æœ‰åŠ¹ã«ã™ã‚‹
portfileã®ä¿®æ­£
CONTROLã«ä¾å­˜è¿½åŠ ã€‚
Build-Depends: ilmbase, hdf5</p>
<p>USE_HDF5ã‚’æœ‰åŠ¹ã«ã€‚</p>
<pre class="code literal-block"><span></span><span class="nb">vcpkg_configure_cmake</span><span class="p">(</span>
    <span class="s">SOURCE_PATH</span> <span class="o">${</span><span class="nv">SOURCE_PATH</span><span class="o">}</span>
    <span class="s">PREFER_NINJA</span> <span class="c"># Disable this option if project cannot be built with Ninja</span>
    <span class="s">OPTIONS</span> <span class="s">-DUSE_HDF5=ON</span>
    <span class="c"># OPTIONS_RELEASE -DOPTIMIZE=1</span>
    <span class="c"># OPTIONS_DEBUG -DDEBUGGABLE=1</span>
<span class="p">)</span>
</pre>

<p>ãƒ“ãƒ«ãƒ‰ã‚ã‚“ã©ã‚¨ãƒ©ãƒ¼
ãƒ“ãƒ«ãƒ‰ã—ã¦ã¿ã‚‹ãŒã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€‚</p>
<p><code>VCPKG_DIR\buildtrees\alembic-hdf\package-x64-windows-rel-out.log</code> ã‚’è¦‹ã¦åŸå› ã‚’æ¢ã‚‹ã€‚</p>
<p>hdf5ã«å¯¾ã™ã‚‹linkãŒç„¡ãã¦ã€hdf5é–¢é€£ã®ã‚·ãƒ³ãƒœãƒ«ãŒè¦‹ã¤ã‹ã‚‰ã‚“ã€‚
ãƒ‘ãƒƒãƒ
alembic-1.7.1/lib/Alembic/CMakeLists.txtã‚’ä¿®æ­£ã—ãŸã„ã®ã§ã‚„ã‚Šæ–¹ã‚’èª¿ã¹ã‚‹ã€‚
ãƒ‘ãƒƒãƒã®å½“ã¦æ–¹</p>
<p>portfile.cmakeã«è¨˜è¿°ã™ã‚‹ã€‚</p>
<pre class="code literal-block"><span></span><span class="err">vcpkg_extract_source_archiveã‚ˆã‚Šã‚ã¨ã€vcpkg_install_cmakeã‚ˆã‚Šå‰ã€‚</span>
<span class="nb">vcpkg_apply_patches</span><span class="p">(</span>
    <span class="s">SOURCE_PATH</span> <span class="o">${</span><span class="nv">SOURCE_PATH</span><span class="o">}</span>
    <span class="s">PATCHES</span> <span class="o">${</span><span class="nv">CMAKE_CURRENT_LIST_DIR</span><span class="o">}</span><span class="s">/fix-hdf5link.patch</span>
<span class="p">)</span>
</pre>

<p>ãƒ‘ãƒƒãƒã®ä½œã‚Šæ–¹</p>
<p>https://github.com/Microsoft/vcpkg/blob/master/docs/examples/patching-libpng.md#patching-the-code-to-improve-compatibility</p>
<p>ãªã‚‹ã»ã©ã€‚
gitã‚’æº–å‚™ã—ã¦ãƒ»ãƒ»ãƒ»</p>
<pre class="code literal-block"><span></span>vcpkg&gt; <span class="nb">cd</span> ./buildtrees/alembic-hdf/src/alembic-1.7.1/
vcpkg/buildtrees/alembic-hdf/src/alembic-1.7.1&gt; git init
vcpkg/buildtrees/alembic-hdf/src/alembic-1.7.1&gt; git add .
vcpkg/buildtrees/alembic-hdf/src/alembic-1.7.1&gt; git commit -m <span class="s2">"temp"</span>
</pre>

<p>ä¿®æ­£
alembic-1.7.1/lib/Alembic/CMakeLists.txtã‚’ä¿®æ­£ã€‚</p>
<pre class="code literal-block"><span></span>&gt; git diff
<span class="gd">--git a/lib/Alembic/CMakeLists.txt b/lib/Alembic/CMakeLists.txt</span>
<span class="gh">index 5028c91..1f81d50 100644</span>
<span class="gd">--- a/lib/Alembic/CMakeLists.txt</span>
<span class="gi">+++ b/lib/Alembic/CMakeLists.txt</span>
<span class="gu">@@ -49,6 +49,12 @@ ADD_SUBDIRECTORY(AbcMaterial)</span>
 ADD_SUBDIRECTORY(Ogawa)

 ADD_LIBRARY(Alembic ${LIB_TYPE} ${CXX_FILES})
<span class="gi">+IF (USE_HDF5)</span>
<span class="gi">+    TARGET_LINK_LIBRARIES(Alembic</span>
<span class="gi">+        ${HDF5_LIBRARIES}</span>
<span class="gi">+        )</span>
<span class="gi">+    ADD_DEFINITIONS(-DH5_BUILT_AS_DYNAMIC_LIB)</span>
<span class="gi">+ENDIF()</span>

 TARGET_INCLUDE_DIRECTORIES(Alembic
     PUBLIC
</pre>

<p>gitã§patchã‚’ä½œæˆ</p>
<p><code>&gt; git diff | out-file -enc ascii ..\..\..\..\ports\alembic-hdf\fix-hdf5link.patch</code></p>
<p>ãƒ“ãƒ«ãƒ‰</p>
<pre class="code literal-block"><span></span>&gt; .<span class="se">\v</span>cpkg.exe install alembic-hdf:x64-windows
Installing package alembic-hdf:x64-windows... <span class="k">done</span>
</pre>

<p>VCPKG_DIR/installed/x64-windows/bin/Alembic.dllã‚’dependencywalkerã§è¦‹ã¦ã¿ã‚‹ã¨ã°ã£ã¡ã‚Šhdf5.dllã¸ã®ãƒªãƒ³ã‚¯ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã€‚ä½œæ¥­å®Œäº†ã€‚
ã¯ã˜ã‚ã¦ã§èª¿ã¹ãªãŒã‚‰ã§ã‚‚ã‚ã‚Šã¨ã•ãã•ãä½œæ¥­ãŒé€²ã‚“ã ã€‚ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å‡ºã—æ–¹ã¨ã‹ã€ãƒ•ã‚©ãƒ«ãƒ€ã®æ§‹æˆã¨ã‹vcpkgãªã‹ãªã‹ãƒ¬ãƒ™ãƒ«ãŒé«˜ã„ãªã€‚</p>
<pre class="code literal-block"><span></span>ports
ports/alembic-hdf/CONTROL
Source: alembic-hdf
Version: <span class="m">1</span>.7.1
Description: alembic with hdf5
Build-Depends: ilmbase, hdf5
</pre>

<p>```ports/alembic-hdf/portfile.cmake</p>
<h2>Common Ambient Variables:</h2>
<h2>CURRENT_BUILDTREES_DIR    = ${VCPKG_ROOT_DIR}\buildtrees\${PORT}</h2>
<h2>CURRENT_PACKAGES_DIR      = ${VCPKG_ROOT_DIR}\packages\${PORT}_${TARGET_TRIPLET}</h2>
<h2>CURRENT_PORT_DIR          = ${VCPKG_ROOT_DIR}\ports\${PORT}</h2>
<h2>PORT                      = current port name (zlib, etc)</h2>
<h2>TARGET_TRIPLET            = current triplet (x86-windows, x64-windows-static, etc)</h2>
<h2>VCPKG_CRT_LINKAGE         = C runtime linkage type (static, dynamic)</h2>
<h2>VCPKG_LIBRARY_LINKAGE     = target library linkage type (static, dynamic)</h2>
<h2>VCPKG_ROOT_DIR            = <c:></c:>
</h2>
<h2>VCPKG_TARGET_ARCHITECTURE = target architecture (x64, x86, arm)</h2>
<h2></h2>
<p>include(vcpkg_common_functions)
set(SOURCE_PATH ${CURRENT_BUILDTREES_DIR}/src/alembic-1.7.1)
vcpkg_download_distfile(ARCHIVE
    URLS "https://github.com/alembic/alembic/archive/1.7.1.tar.gz"
    FILENAME "1.7.1.tar.gz"
    SHA512 89e30b681a76eaf79b20ebeff62c495971b0eb64b28f249a14bbcf3bdb40df7eda93b0ede299dd5511bd4587a2cc2d4ebd851fb89bf999fdccc31fee3cffbba2
)
vcpkg_extract_source_archive(${ARCHIVE})</p>
<p>vcpkg_apply_patches(
    SOURCE_PATH ${SOURCE_PATH}
    PATCHES ${CMAKE_CURRENT_LIST_DIR}/fix-hdf5link.patch
)</p>
<p>vcpkg_configure_cmake(
    SOURCE_PATH ${SOURCE_PATH}
    PREFER_NINJA # Disable this option if project cannot be built with Ninja
    OPTIONS -DUSE_HDF5=ON
    # OPTIONS_RELEASE -DOPTIMIZE=1
    # OPTIONS_DEBUG -DDEBUGGABLE=1
)</p>
<p>vcpkg_install_cmake()</p>
<h2>Remove debug/include</h2>
<p>file(REMOVE_RECURSE ${CURRENT_PACKAGES_DIR}/debug/include)</p>
<h2>fix *.cmake</h2>
<p>vcpkg_fixup_cmake_targets(CONFIG_PATH "lib/cmake/Alembic")</p>
<h2>Rename dll</h2>
<p>file(RENAME ${CURRENT_PACKAGES_DIR}/lib/Alembic.dll ${CURRENT_PACKAGES_DIR}/bin/Alembic.dll)
file(RENAME ${CURRENT_PACKAGES_DIR}/debug/lib/Alembic.dll ${CURRENT_PACKAGES_DIR}/debug/bin/Alembic.dll)</p>
<h2>Handle copyright</h2>
<p>file(COPY ${CURRENT_BUILDTREES_DIR}/src/alembic-1.7.1/LICENSE.txt DESTINATION ${CURRENT_PACKAGES_DIR}/share/alembic-hdf)
file(RENAME ${CURRENT_PACKAGES_DIR}/share/alembic-hdf/LICENSE.txt ${CURRENT_PACKAGES_DIR}/share/alembic-hdf/copyright)</p>
<h2>Remove exe files</h2>
<p>file(GLOB EXE ${CURRENT_PACKAGES_DIR}/bin/<em>.exe)
file(GLOB DEBUG_EXE ${CURRENT_PACKAGES_DIR}/debug/bin/</em>.exe)
file(REMOVE ${EXE})
file(REMOVE ${DEBUG_EXE})</p>
<h2>Copy pdb</h2>
<p>vcpkg_copy_pdbs()</p>
<pre class="code literal-block"><span></span>```ports/alembic-hdf/fix-hdf5link.patch
diff --git a/lib/Alembic/CMakeLists.txt b/lib/Alembic/CMakeLists.txt
index 5028c91..1f81d50 100644
--- a/lib/Alembic/CMakeLists.txt
+++ b/lib/Alembic/CMakeLists.txt
@@ -49,6 +49,12 @@ ADD_SUBDIRECTORY(AbcMaterial)
 ADD_SUBDIRECTORY(Ogawa)

 ADD_LIBRARY(Alembic <span class="cp">${</span><span class="n">LIB_TYPE</span><span class="cp">}</span> <span class="cp">${</span><span class="n">CXX_FILES</span><span class="cp">}</span>)
+IF (USE_HDF5)
+    TARGET_LINK_LIBRARIES(Alembic 
+        <span class="cp">${</span><span class="n">HDF5_LIBRARIES</span><span class="cp">}</span>
+        )
+    ADD_DEFINITIONS(-DH5_BUILT_AS_DYNAMIC_LIB)
+ENDIF()

 TARGET_INCLUDE_DIRECTORIES(Alembic
     PUBLIC
</pre>

<p>vcpkgã«PRé€ã£ãŸ
æ¡ç”¨ã•ã‚ŒãŸã®ã§ä¸Šè¨˜ã®ä½œæ¥­ã¯å¿…è¦ãªããªã£ãŸã®ãŒã€cmake-3.9.0ã®æ›´æ–°ã§FindHDF5ãŒå£Šã‚Œã‚‹ã¨ã„ã†äº‹æ…‹ãŒç™ºç”Ÿã—ãŸã®ã§å¯¾å¿œä¸­â€¦ã€‚</p>
</div>

<ul class="pager hidden-print">
<li class="previous">
        <a href="../../../../github/thinrenderer/" rel="prev" title="ThinRenderer">
            ThinRenderer ğŸ‘ˆ
        </a>
    </li>
    <li style="flex-grow: 1">
    <li class="next">
        <a href="../cmake_find_package/" rel="next" title="cmakeã®find_package">
            ğŸ‘‰ cmakeã®find_package
        </a>
    </li>
</ul></main><footer id="footer"><p>
            Powered by
            <a href="https://getnikola.com" rel="nofollow">Nikola</a>
        </p>
    </footer>
</body>
</html>
