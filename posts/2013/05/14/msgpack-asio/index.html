<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="generator" content="Nikola (getnikola.com)">
<meta name="viewport" content="width=device-width">
<script src="../../../../../assets/js/all-nocdn.js"></script><title>msgpack-rpcã®asioç‰ˆã‚’ä½œæˆä¸­ | ä¸‰æ¬¡å…ƒæ—¥èªŒ</title>
<link href="../../../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
</head>
<body>
    <h1 id="brand">
        <a href="../../../../../" title="ä¸‰æ¬¡å…ƒæ—¥èªŒ" rel="home">
            <span id="blog-title">ä¸‰æ¬¡å…ƒæ—¥èªŒ</span>
        </a>
    </h1>

    <nav id="menu"><ul>
<li><a href="../../../../../archive.html">Archives</a></li>
<li><a href="../../../../../categories/index.html">Tags</a></li>
<li><a href="../../../../../rss.xml">RSS feed</a></li>
<li><a href="../../../../../about">About</a></li>
<li><a href="../../../../../books">MemoBooks</a></li>

            
            
            
        </ul></nav><hr>
<main id="content"><h1 class="p-name entry-title" itemprop="headline name">
    <h1 class="p-name entry-title" itemprop="headline name">
    <a href="." class="u-url">msgpack-rpcã®asioç‰ˆã‚’ä½œæˆä¸­
    </a>
</h1>
<ul itemprop="keywords" class="tags">
<li>
        <time datetime="2013-05-14T00:00:00+09:00" title="2013-05-14">2013-05-14</time>
</li>
</ul>
</h1>

<div>
<p>msgpack-rpcã®asioç‰ˆã‚’ä½œæˆä¸­
é€£ä¼‘ã‹ã‚‰å§‹ã‚ã¦ã„ãŸmsgpack-rpcã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’asioã«ç½®ãæ›ãˆã¦Windowsã§ã‚‚å‹•ãã‚ˆã†ã«ã™ã‚‹è©¦ã¿ãŒã‚„ã£ã¨ç›®å‡¦ãŒç«‹ã£ãŸã€‚</p>
<p><a href="https://github.com/ousttrue/msgpack-asiorpc">https://github.com/ousttrue/msgpack-asiorpc</a></p>
<p>æ”¹ã‚</p>
<p><a href="https://github.com/ousttrue/msgpack-rpc-asio">https://github.com/ousttrue/msgpack-rpc-asio</a></p>
<p>å½“åˆã¯ <code>msgpack-rpc</code> ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã® <code>mpio</code> ã« <code>asio</code> ã® <code>kernel</code> ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ä¹—ã‚Šåˆ‡ã‚ã†ã¨ã—ãŸã®ã ãŒã€ã‚ã‚Šã¨ã™ãã«é “æŒ«ã—ãŸã€‚
<code>mpio</code> ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚¿ã§IOã‚’ç®¡ç†ã™ã‚‹APIãŒasioã¨åˆã‚ãªã„ã®ã§ã™ãªã€‚
æ¬¡ã«ã€ <code>msgpack-rpc</code> ã® <code>mp::wavy::loop</code> ã‚’asioã‚’ãƒ©ãƒƒãƒ—ã—ãŸã‚¯ãƒ©ã‚¹ã§ç½®ãæ›ãˆã‚‹ä½œæˆ¦ã§
é€²ã‚ã¦ã„ãŸã®ã ãŒã ã„ã¶æ”¹é€ ã—ã¦æ§‹é€ ãŒè¦‹ãˆã¦ããŸã¨ã“ã‚ã§ã€ <code>asio</code> ã¨ã®è¨­è¨ˆã®é•ã„ã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹ã®ãŒã‚ã‚“ã©ãã•ã
ãªã£ã¦ã¾ãŸé “æŒ«ã—ãŸã€‚ <a href="http://dev.activebasic.com/egtra/2011/10/27/449/">http://dev.activebasic.com/egtra/2011/10/27/449/</a>
ã‚’è¦‹ã‚‹ã¨ç°¡å˜ãã†ã«è¦‹ãˆã‚‹ã®ã ãŒåŠŸå¤«ãŒè¶³ã‚‰ãªã„ã‚ˆã†ã ã€‚
ã§ã€ä¸Šè¨˜ã®åçœã‚’è¸ã¾ãˆã¦ <code>asio</code> ã§ <code>msgpack-rpc</code> ã‚’è‡ªç”±ã«å®Ÿè£…ã™ã‚‹ã“ã¨ã«ã—ãŸã€‚
ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã¨ <code>msgpack-rpc</code> ã®å¤‰æ›éƒ¨åˆ†ã« <code>msgpack-rpc</code> ã®ã‚³ãƒ¼ãƒ‰ã‚’å€Ÿç”¨ã—ã¦ã€
ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€šä¿¡éƒ¨åˆ†ã¯ <code>asio</code> ã§æ™®é€šã«ä½œæˆã—ãŸã€‚
ã ã„ãŸã„ã“ã‚“ãªæ„Ÿã˜ã®APIã«ãªã‚‹äºˆå®šã€‚ </p>
<pre class="code literal-block"><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">server_method</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">;</span> <span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span> 
    <span class="kt">int</span> <span class="n">port</span><span class="o">=</span><span class="mi">18080</span><span class="p">;</span>
    <span class="c1">// server</span>
    <span class="n">boost</span><span class="o">::</span><span class="n">io_service</span> <span class="n">server_io</span><span class="p">;</span>
    <span class="n">msgpack</span><span class="o">::</span><span class="n">asiorpc</span><span class="o">::</span><span class="n">server</span> <span class="n">s</span><span class="p">(</span><span class="n">server_io</span><span class="p">);</span>
    <span class="n">s</span><span class="p">.</span><span class="n">add_handler</span><span class="p">(</span><span class="o">&amp;</span><span class="n">server_method</span><span class="p">,</span> <span class="s">"add"</span><span class="p">);</span>
    <span class="n">s</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">boost</span><span class="o">::</span><span class="n">asio</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">tcp</span><span class="o">::</span><span class="n">endpoint</span><span class="p">(</span><span class="n">boost</span><span class="o">::</span><span class="n">asio</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">tcp</span><span class="o">::</span><span class="n">v4</span><span class="p">(),</span> <span class="n">port</span><span class="p">));</span>
    <span class="n">boost</span><span class="o">::</span><span class="kr">thread</span> <span class="n">server_thread</span><span class="p">([</span><span class="o">&amp;</span><span class="n">server_io</span><span class="p">](){</span> <span class="n">server_io</span><span class="p">.</span><span class="n">run</span><span class="p">();</span> <span class="p">}</span>

    <span class="c1">// client</span>
    <span class="n">boost</span><span class="o">::</span><span class="n">io_service</span> <span class="n">client_io</span><span class="p">;</span>
    <span class="n">msgpack</span><span class="o">::</span><span class="n">asiorpc</span><span class="o">::</span><span class="n">session</span> <span class="n">c</span><span class="p">(</span><span class="n">server_io</span><span class="p">);</span> 
    <span class="n">c</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">boost</span><span class="o">::</span><span class="n">asio</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">tcp</span><span class="o">::</span><span class="n">endpoint</span><span class="p">(</span><span class="n">boost</span><span class="o">::</span><span class="n">asio</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">address</span><span class="o">::</span><span class="n">from_string</span><span class="p">(</span><span class="s">"127.0.0.1"</span><span class="p">),</span> <span class="n">port</span><span class="p">);</span>
    <span class="n">boost</span><span class="o">::</span><span class="kr">thread</span> <span class="n">client_thread</span><span class="p">([</span><span class="o">&amp;</span><span class="n">client_io</span><span class="p">](){</span> <span class="n">client_io</span><span class="p">.</span><span class="n">run</span><span class="p">();</span> <span class="p">}</span>

    <span class="c1">// request</span>
    <span class="k">auto</span> <span class="n">request</span><span class="o">=</span><span class="n">c</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="s">"add"</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

    <span class="c1">// blocking</span>
    <span class="kt">int</span> <span class="n">result</span><span class="p">;</span>
    <span class="n">request</span><span class="p">.</span><span class="n">convert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">result</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">resut</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="c1">// finalize</span>
    <span class="n">client_io</span><span class="p">.</span><span class="n">stop</span><span class="p">();</span>
    <span class="n">client_thread</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>

    <span class="n">server_io</span><span class="p">.</span><span class="n">stop</span><span class="p">();</span>
    <span class="n">server_thread</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre>

<p>åŸå‹ã¯ã ã„ãŸã„ã§ãã¦ <code>Windows</code> ã§ã‚‚å‹•ã„ãŸã®ã§ç¶šãã‚’ä½œã‚Šã“ã‚“ã§è¡ŒããŸã„ã€‚
ä»Šã®ã†ã¡ã« <code>msgpack::asiorpc</code> ã®ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã‚’å¤‰ãˆãŸã„ã‚ˆã†ãªæ°—ã‚‚ã™ã‚‹ãŒã©ã†ã—ã‚ˆã†ã‹ã­ã€‚
<code>msgpack::rpc::asio</code> ã¨ã‹ã‹ï¼Ÿã†ã…ã‚€ã€‚
ã‚ã¨ã€ã‚¯ãƒ©ã‚¹ã‚’ <code>UpperCamelCase</code> ã§ã€é–¢æ•°ã‚’ <code>lowerCamelCase</code> ã«å¤‰ãˆã‚ˆã†æ€ã£ã¦ã„ãŸãŒ
<code>boost</code> ã€ <code>msgpack</code> ã¨ä¸€ç·’ã«ä½¿ã†ã¨ãã®è¦‹æ „ãˆã‚’è€ƒæ…®ã™ã‚‹ã¨ã‚¹ã‚±ãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã‚‚ä¸€ç†ã‚ã‚‹ãªã€‚
ã‚¯ãƒ©ã‚¹åã¨åŒã˜å¤‰æ•°å(<code>request</code>ã¨ã‹)ã‚’ä½¿ã„ãŸã„ã¨ãã«å¤‰æ•°åã‚’reqç­‰ã«å¤‰ãˆã‚‹ã“ã¨ã‚’å¼·ã„ã‚‰ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹ã®ãŒ
æ°—ã«å…¥ã‚‰ãªã„ã¨ã“ã‚ã§ã¯ã‚ã‚‹ã®ã ãŒã€‚
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’ <code>msgpack-rpc-asio</code>
ã«å¤‰ãˆã¦ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã‚‚ <code>msgpack::rpc::asio</code> ã«å¤‰ãˆã‚‹ã“ã¨ã«ä»Šæ±ºã‚ãŸã€‚</p>
</div>

<ul class="pager hidden-print">
<li class="previous">
        <a href="../../../../../github/msgpack-rpc-asio/" rel="prev" title="msgpack-rpc-asio">
            msgpack-rpc-asio ğŸ‘ˆ
        </a>
    </li>
    <li style="flex-grow: 1">
    <li class="next">
        <a href="../../16/lambda/" rel="next" title="lambdaã®å¼•æ•°ã®å‹ã‚’å¾—ãŸã„">
            ğŸ‘‰ lambdaã®å¼•æ•°ã®å‹ã‚’å¾—ãŸã„
        </a>
    </li>
</ul></main><footer id="footer"><p>
            Powered by
            <a href="https://getnikola.com" rel="nofollow">Nikola</a>
        </p>
    </footer>
</body>
</html>
