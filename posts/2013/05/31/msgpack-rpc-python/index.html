<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="generator" content="Nikola (getnikola.com)">
<meta name="viewport" content="width=device-width">
<script src="../../../../../assets/js/all-nocdn.js"></script><title>ãŠã‚ŒãŠã‚Œmsgpack-rpc-pythonã‚’ä½œã‚‹ | ä¸‰æ¬¡å…ƒæ—¥èªŒ</title>
<link href="../../../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
</head>
<body>
    <h1 id="brand">
        <a href="../../../../../" title="ä¸‰æ¬¡å…ƒæ—¥èªŒ" rel="home">
            <span id="blog-title">ä¸‰æ¬¡å…ƒæ—¥èªŒ</span>
        </a>
    </h1>

    <nav id="menu"><ul>
<li><a href="../../../../../archive.html">Archives</a></li>
<li><a href="../../../../../categories/index.html">Tags</a></li>
<li><a href="../../../../../rss.xml">RSS feed</a></li>
<li><a href="../../../../../about">About</a></li>
<li><a href="../../../../../books">MemoBooks</a></li>

            
            
            
        </ul></nav><hr>
<main id="content"><h1 class="p-name entry-title" itemprop="headline name">
    <h1 class="p-name entry-title" itemprop="headline name">
    <a href="." class="u-url">ãŠã‚ŒãŠã‚Œmsgpack-rpc-pythonã‚’ä½œã‚‹
    </a>
</h1>
<ul itemprop="keywords" class="tags">
<li>
        <time datetime="2013-05-31T00:00:00+09:00" title="2013-05-31">2013-05-31</time>
</li>
    <li><a class="tag p-category" href="../../../../../categories/cpp/" rel="tag">cpp</a></li>
    <li><a class="tag p-category" href="../../../../../categories/msgpack/" rel="tag">msgpack</a></li>
</ul>
</h1>

<p>ãŠã‚ŒãŠã‚Œmsgpack-rpc-pythonã‚’ä½œã‚‹
MsgPackRPCã®pythonãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°(ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´)ãŒå¿…è¦ã«ãªã£ãŸã®ã§msgpack-rpc-pythonã‚’ä½¿ã£ã¦ã¿ãŸã®ã ãŒã€
GUI(pyqt)ã«è¼‰ã›ã¦æ¥ç¶šåˆ¶å¾¡ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ç´°ã‚„ã‹ã«åˆ¶å¾¡ã—ãŸã„ã®ã§ä¿ºä¿ºã§é¡ä¼¼å“ã‚’ä½œã‚‹ã“ã¨ã«ã—ãŸã€‚
tonado-msgpackã¨åä»˜ã‘ã¦å–ã‚Šåˆãˆãšä½œæ¥­é–‹å§‹ã€‚
https://github.com/ousttrue/tornado-msgpack
msgpack-rpc-pythonã®ãŠã‹ã’ã§tornadoã®å­˜åœ¨ã‚’çŸ¥ã£ãŸã®ã ãŒtornado.ioloopãŒè¦‹ã‚Œã°è¦‹ã‚‹ã»ã©boost::asioã£ã½ã„ã€‚
ã¨ã„ã†ã“ã¨ã§ã€c++ã§ä½œæˆä¸­ã®msgpack-rpc-asioã®pythonç‰ˆã®ã‚ˆã†ãªæ„Ÿã˜ã®APIã«ã—ã¦ã¿ãŸã€‚
ä»¥ä¸‹ã®ç‚¹ã‚’è€ƒæ…®ã—ã¦ã„ã‚‹ã€‚</p>
<p>tornado.ioloopã‚’éš ã•ãªã„
tornado.ioloopã‚’ã‚¹ãƒ¬ãƒƒãƒ‰ã«ä¹—ã›ã¦å›ã—ã£ã±ãªã—ã«ã™ã‚‹
tornado.ioloopã²ã¨ã¤ã§è¤‡æ•°ã®æ¥ç¶šã‚’æ‰±ã†
dispatcherã‚’ä¹—ã›æ›ãˆæ˜“ãã™ã‚‹ã€‚
æ¥ç¶šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®å¤‰åŒ–ã‚’ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§å—ã‘å–ã‚‹
éåŒæœŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’æ—©æœŸã«ã‚»ãƒƒãƒˆã™ã‚‹
TCPä»¥å¤–ã¯è€ƒæ…®ã—ãªã„</p>
<p>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
tonado_msgpack/
    setup.py
    sample/
        sample.py
    tonado_msgpack</p>
<p>setup.py
from distutils.core import setup</p>
<p>setup(
    name='tonado_msgpack',
    version='0.1',
    py_modules=['tonado_msgpack'],
    )</p>
<p>ä½œæ¥­é–‹å§‹
$ python setup.py develop --user</p>
<p>sample/sample.py</p>
<h2>!/usr/bin/env python</h2>
<p>import tornado_msgpack
import tornado</p>
<p>if <strong>name</strong>=="<strong>main</strong>":
    port=18080</p>
<div class="code"><pre class="code literal-block">#<span class="w"> </span><span class="nv">dispatcher</span><span class="w"></span>
<span class="nv">dispatcher</span><span class="o">=</span><span class="nv">tornado_msgpack</span>.<span class="nv">Dispatcher</span><span class="ss">()</span><span class="w"></span>
<span class="nv">def</span><span class="w"> </span><span class="nv">add</span><span class="ss">(</span><span class="nv">a</span>,<span class="w"> </span><span class="nv">b</span><span class="ss">)</span>:<span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">a</span><span class="o">+</span><span class="nv">b</span><span class="w"></span>
<span class="nv">dispatcher</span>.<span class="nv">add_handler</span><span class="ss">(</span><span class="s2">"add"</span>,<span class="w"> </span><span class="nv">add</span><span class="ss">)</span><span class="w"></span>

#<span class="w"> </span><span class="nv">server</span><span class="w"></span>
<span class="nv">server_loop</span><span class="o">=</span><span class="nv">tornado</span>.<span class="nv">ioloop</span>.<span class="nv">IOLoop</span><span class="ss">()</span><span class="w"></span>
<span class="nv">def</span><span class="w"> </span><span class="nv">on_receive</span><span class="ss">(</span><span class="nv">msg</span>,<span class="w"> </span><span class="nv">session</span><span class="ss">)</span>:<span class="w"></span>
<span class="w">    </span><span class="nb">result</span><span class="o">=</span><span class="nv">dispatcher</span>.<span class="nv">dispatch</span><span class="ss">(</span><span class="nv">msg</span><span class="ss">)</span><span class="w"></span>
<span class="w">    </span><span class="nv">session</span>.<span class="nv">send_async</span><span class="ss">(</span><span class="nb">result</span><span class="ss">)</span><span class="w"></span>
<span class="nv">server</span><span class="o">=</span><span class="nv">tornado_msgpack</span>.<span class="nv">Server</span><span class="ss">(</span><span class="nv">server_loop</span><span class="ss">)</span><span class="w"></span>
<span class="nv">server</span>.<span class="nv">listen</span><span class="ss">(</span><span class="s2">"localhost"</span>,<span class="w"> </span><span class="nv">port</span><span class="ss">)</span><span class="w"></span>
<span class="nv">server_thread</span><span class="o">=</span><span class="nv">threading</span>.<span class="nv">Thread</span><span class="ss">(</span><span class="nv">target</span><span class="o">=</span><span class="nv">lambda</span><span class="w"> </span>:<span class="w"> </span><span class="nv">server_loop</span>.<span class="nv">start</span><span class="ss">()</span><span class="w"> </span><span class="ss">)</span><span class="w"></span>

#<span class="w"> </span><span class="nv">clinet</span><span class="w"></span>
<span class="nv">client_loop</span><span class="o">=</span><span class="nv">tornado</span>.<span class="nv">ioloop</span>.<span class="nv">IOLoop</span><span class="ss">()</span><span class="w"></span>
<span class="nv">client</span><span class="o">=</span><span class="nv">tornado_msgpack</span>.<span class="nv">Client</span><span class="ss">(</span><span class="nv">client_loop</span><span class="ss">)</span><span class="w"></span>
<span class="nv">def</span><span class="w"> </span><span class="nv">on_status_changed</span><span class="ss">(</span><span class="nv">status</span><span class="ss">)</span>:<span class="w"></span>
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="nv">status</span><span class="ss">)</span><span class="w"></span>
<span class="nv">clinet</span>.<span class="nv">attach_status_callback</span><span class="ss">(</span><span class="nv">on_status_changed</span><span class="ss">)</span><span class="w"></span>
<span class="nv">client</span>.<span class="k">connect</span><span class="ss">(</span><span class="s2">"localhost"</span>,<span class="w"> </span><span class="nv">port</span><span class="ss">)</span><span class="w"></span>
<span class="nv">clinet_thread</span><span class="o">=</span><span class="nv">threading</span>.<span class="nv">Thread</span><span class="ss">(</span><span class="nv">target</span><span class="o">=</span><span class="nv">lambda</span><span class="w"> </span>:<span class="w"> </span><span class="nv">client_loop</span>.<span class="nv">start</span><span class="ss">()</span><span class="w"> </span><span class="ss">)</span><span class="w"></span>

#<span class="w"> </span><span class="nv">request</span><span class="w"></span>
<span class="nv">def</span><span class="w"> </span><span class="nv">on_receive</span><span class="ss">(</span><span class="nb">result</span><span class="ss">)</span>:<span class="w"></span>
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="nb">result</span><span class="ss">)</span><span class="w"></span>

<span class="nv">future</span><span class="o">=</span><span class="nv">clinet</span>.<span class="nv">call_async_with_callback</span><span class="ss">(</span><span class="nv">on_receive</span>,<span class="w"> </span><span class="s2">"add"</span>,<span class="w"> </span><span class="mi">1</span><span class="ss">)</span><span class="w"></span>
<span class="nv">future</span>.<span class="nv">join</span><span class="ss">()</span><span class="w"></span>

<span class="nv">future</span><span class="o">=</span><span class="nv">clinet</span>.<span class="nv">call_async_with_callback</span><span class="ss">(</span><span class="nv">on_receive</span>,<span class="w"> </span><span class="s2">"add"</span>,<span class="w"> </span><span class="mi">1</span>,<span class="w"> </span><span class="mi">2</span><span class="ss">)</span><span class="w"></span>
<span class="nv">future</span>.<span class="nv">join</span><span class="ss">()</span><span class="w"></span>

<span class="nv">future</span><span class="o">=</span><span class="nv">clinet</span>.<span class="nv">call_async_with_callback</span><span class="ss">(</span><span class="nv">on_receive</span>,<span class="w"> </span><span class="s2">"add"</span>,<span class="w"> </span><span class="mi">1</span>,<span class="w"> </span><span class="mi">2</span>,<span class="w"> </span><span class="mi">3</span><span class="ss">)</span><span class="w"></span>
<span class="nv">future</span>.<span class="nv">join</span><span class="ss">()</span><span class="w"></span>

<span class="nv">print</span><span class="ss">(</span><span class="s2">"stop client..."</span><span class="ss">)</span><span class="w"></span>
<span class="nv">client_loop</span>.<span class="nv">stop</span><span class="ss">()</span><span class="w"></span>
<span class="nv">clinet_thread</span>.<span class="nv">join</span><span class="ss">()</span><span class="w"></span>

<span class="nv">print</span><span class="ss">(</span><span class="s2">"stop server..."</span><span class="ss">)</span><span class="w"></span>
<span class="nv">server_loop</span>.<span class="nv">stop</span><span class="ss">()</span><span class="w"></span>
<span class="nv">server_thread</span>.<span class="nv">join</span><span class="ss">()</span><span class="w"></span>

<span class="nv">print</span><span class="ss">(</span><span class="s2">"done"</span><span class="ss">)</span><span class="w"></span>
</pre></div>

<p>ã¨ã‚Šã‚ãˆãšã“ã‚“ãªæ„Ÿã˜ã‚’äºˆå®šã€‚
./sample/sample.pyã§ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚¨ãƒ©ãƒ¼ãŒå‡ºãªããªã‚‹ã¨ã“ã‚ã¾ã§ç¢ºèªã€‚
tornado_msgpackã‚’é †æ¬¡å®Ÿè£…ã—ã¦ã„ãã€‚
Tornado Reference - http://www.tornadoweb.org/en/stable/
ã ã„ãŸã„å‹•ãã‚ˆã†ã«ãªã£ãŸã€‚
$ ./sample/sample
connected
&lt;_MainThread(MainThread, started 140102020679424)&gt;:send 9 bytes
<thread started>:on_read
<thread started>:send 48 bytes
<thread started>:on_read
on_receive:[1, 1, True, 'add() takes exactly 2 arguments (1 given)']
&lt;_MainThread(MainThread, started 140102020679424)&gt;:send 10 bytes
<thread started>:on_read
<thread started>:send 5 bytes
<thread started>:on_read
on_receive:[1, 2, False, 3]
&lt;_MainThread(MainThread, started 140102020679424)&gt;:send 11 bytes
<thread started>:on_read
<thread started>:send 59 bytes
<thread started>:on_read
on_receive:[1, 3, True, 'add() takes exactly 2 positional arguments (3 given)']
stop client...
stop server...
done</thread></thread></thread></thread></thread></thread></thread></thread></thread></p>
<p>ã‚µãƒ¼ãƒãƒ¼ã‚¹ãƒ¬ãƒƒãƒ‰ã®ioloopã¨ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¹ãƒ¬ãƒƒãƒ‰ã®ioloopãŒç›¸äº’ã«ã‚„ã‚Šå–ã‚Šã—ã¦ã„ã‚‹æ„Ÿã˜ã§ã¡ã‚ƒã‚“ã¨å‹•ã„ã¦ã„ã‚‹ã€‚</p>

<hr>
<ul class="pager hidden-print">
<li class="previous">
        <a href="../../30/python-path/" rel="prev" title="Pythonãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹">
            Pythonãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ ğŸ‘ˆ
        </a>
    </li>
    <li style="flex-grow: 1">
    <li class="next">
        <a href="../../../../../github/tornado-msgpack/" rel="next" title="tornado-msgpack">
            ğŸ‘‰ tornado-msgpack
        </a>
    </li>
</ul></main><footer id="footer"><p>
            Powered by
            <a href="https://getnikola.com" rel="nofollow">Nikola</a>
        </p>
    </footer>
</body>
</html>
