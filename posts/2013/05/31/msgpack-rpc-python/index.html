<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="generator" content="Nikola (getnikola.com)">
<meta name="viewport" content="width=device-width">
<script src="../../../../../assets/js/all-nocdn.js"></script><title>ãŠã‚ŒãŠã‚Œmsgpack-rpc-pythonã‚’ä½œã‚‹ | ä¸‰æ¬¡å…ƒæ—¥èªŒ</title>
<link href="../../../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
</head>
<body>
    <h1 id="brand">
        <a href="../../../../../" title="ä¸‰æ¬¡å…ƒæ—¥èªŒ" rel="home">
            <span id="blog-title">ä¸‰æ¬¡å…ƒæ—¥èªŒ</span>
        </a>
    </h1>

    <nav id="menu"><ul>
<li><a href="../../../../../archive.html">Archives</a></li>
<li><a href="../../../../../categories/index.html">Tags</a></li>
<li><a href="../../../../../rss.xml">RSS feed</a></li>
<li><a href="../../../../../about">About</a></li>
<li><a href="../../../../../books">MemoBooks</a></li>

            
            
            
        </ul></nav><hr>
<main id="content"><h1 class="p-name entry-title" itemprop="headline name">
    <h1 class="p-name entry-title" itemprop="headline name">
    <a href="." class="u-url">ãŠã‚ŒãŠã‚Œmsgpack-rpc-pythonã‚’ä½œã‚‹</a>
</h1>
<ul itemprop="keywords" class="tags">
<li>
        <time datetime="2013-05-31T00:00:00+09:00" title="2013-05-31">2013-05-31</time>
</li>
</ul>
</h1>

<div>
<p>ãŠã‚ŒãŠã‚Œmsgpack-rpc-pythonã‚’ä½œã‚‹
MsgPackRPCã®pythonãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°(ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´)ãŒå¿…è¦ã«ãªã£ãŸã®ã§msgpack-rpc-pythonã‚’ä½¿ã£ã¦ã¿ãŸã®ã ãŒã€
GUI(pyqt)ã«è¼‰ã›ã¦æ¥ç¶šåˆ¶å¾¡ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ç´°ã‚„ã‹ã«åˆ¶å¾¡ã—ãŸã„ã®ã§ä¿ºä¿ºã§é¡ä¼¼å“ã‚’ä½œã‚‹ã“ã¨ã«ã—ãŸã€‚
tonado-msgpackã¨åä»˜ã‘ã¦å–ã‚Šåˆãˆãšä½œæ¥­é–‹å§‹ã€‚
https://github.com/ousttrue/tornado-msgpack
msgpack-rpc-pythonã®ãŠã‹ã’ã§tornadoã®å­˜åœ¨ã‚’çŸ¥ã£ãŸã®ã ãŒtornado.ioloopãŒè¦‹ã‚Œã°è¦‹ã‚‹ã»ã©boost::asioã£ã½ã„ã€‚
ã¨ã„ã†ã“ã¨ã§ã€c++ã§ä½œæˆä¸­ã®msgpack-rpc-asioã®pythonç‰ˆã®ã‚ˆã†ãªæ„Ÿã˜ã®APIã«ã—ã¦ã¿ãŸã€‚
ä»¥ä¸‹ã®ç‚¹ã‚’è€ƒæ…®ã—ã¦ã„ã‚‹ã€‚</p>
<p>tornado.ioloopã‚’éš ã•ãªã„
tornado.ioloopã‚’ã‚¹ãƒ¬ãƒƒãƒ‰ã«ä¹—ã›ã¦å›ã—ã£ã±ãªã—ã«ã™ã‚‹
tornado.ioloopã²ã¨ã¤ã§è¤‡æ•°ã®æ¥ç¶šã‚’æ‰±ã†
dispatcherã‚’ä¹—ã›æ›ãˆæ˜“ãã™ã‚‹ã€‚
æ¥ç¶šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®å¤‰åŒ–ã‚’ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§å—ã‘å–ã‚‹
éåŒæœŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’æ—©æœŸã«ã‚»ãƒƒãƒˆã™ã‚‹
TCPä»¥å¤–ã¯è€ƒæ…®ã—ãªã„</p>
<p>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
tonado_msgpack/
    setup.py
    sample/
        sample.py
    tonado_msgpack</p>
<p>setup.py
from distutils.core import setup</p>
<p>setup(
    name='tonado_msgpack',
    version='0.1',
    py_modules=['tonado_msgpack'],
    )</p>
<p>ä½œæ¥­é–‹å§‹
$ python setup.py develop --user</p>
<p>sample/sample.py</p>
<h2>!/usr/bin/env python</h2>
<p>import tornado_msgpack
import tornado</p>
<p>if <strong>name</strong>=="<strong>main</strong>":
    port=18080</p>
<pre class="code literal-block"><span></span># dispatcher
dispatcher=tornado_msgpack.Dispatcher()
def add(a, b):
    return a+b
dispatcher.add_handler("add", add)

# server
server_loop=tornado.ioloop.IOLoop()
def on_receive(msg, session):
    result=dispatcher.dispatch(msg)
    session.send_async(result)
server=tornado_msgpack.Server(server_loop)
server.listen("localhost", port)
server_thread=threading.Thread(target=lambda : server_loop.start() )

# clinet
client_loop=tornado.ioloop.IOLoop()
client=tornado_msgpack.Client(client_loop)
def on_status_changed(status):
    print(status)
clinet.attach_status_callback(on_status_changed)
client.connect("localhost", port)
clinet_thread=threading.Thread(target=lambda : client_loop.start() )

# request
def on_receive(result):
    print(result)

future=clinet.call_async_with_callback(on_receive, "add", 1)
future.join()

future=clinet.call_async_with_callback(on_receive, "add", 1, 2)
future.join()

future=clinet.call_async_with_callback(on_receive, "add", 1, 2, 3)
future.join()

print("stop client...")
client_loop.stop()
clinet_thread.join()

print("stop server...")
server_loop.stop()
server_thread.join()

print("done")
</pre>

<p>ã¨ã‚Šã‚ãˆãšã“ã‚“ãªæ„Ÿã˜ã‚’äºˆå®šã€‚
./sample/sample.pyã§ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚¨ãƒ©ãƒ¼ãŒå‡ºãªããªã‚‹ã¨ã“ã‚ã¾ã§ç¢ºèªã€‚
tornado_msgpackã‚’é †æ¬¡å®Ÿè£…ã—ã¦ã„ãã€‚
Tornado Reference - http://www.tornadoweb.org/en/stable/
ã ã„ãŸã„å‹•ãã‚ˆã†ã«ãªã£ãŸã€‚
$ ./sample/sample
connected
&lt;_MainThread(MainThread, started 140102020679424)&gt;:send 9 bytes
<thread started>:on_read
<thread started>:send 48 bytes
<thread started>:on_read
on_receive:[1, 1, True, 'add() takes exactly 2 arguments (1 given)']
&lt;_MainThread(MainThread, started 140102020679424)&gt;:send 10 bytes
<thread started>:on_read
<thread started>:send 5 bytes
<thread started>:on_read
on_receive:[1, 2, False, 3]
&lt;_MainThread(MainThread, started 140102020679424)&gt;:send 11 bytes
<thread started>:on_read
<thread started>:send 59 bytes
<thread started>:on_read
on_receive:[1, 3, True, 'add() takes exactly 2 positional arguments (3 given)']
stop client...
stop server...
done</thread></thread></thread></thread></thread></thread></thread></thread></thread></p>
<p>ã‚µãƒ¼ãƒãƒ¼ã‚¹ãƒ¬ãƒƒãƒ‰ã®ioloopã¨ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¹ãƒ¬ãƒƒãƒ‰ã®ioloopãŒç›¸äº’ã«ã‚„ã‚Šå–ã‚Šã—ã¦ã„ã‚‹æ„Ÿã˜ã§ã¡ã‚ƒã‚“ã¨å‹•ã„ã¦ã„ã‚‹ã€‚</p>
</div>

<ul class="pager hidden-print">
<li class="previous">
        <a href="../../30/python-path/" rel="prev" title="Pythonãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹">
            Pythonãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ ğŸ‘ˆ
        </a>
    </li>
    <li style="flex-grow: 1">
    <li class="next">
        <a href="../../../../../github/tornado-msgpack/" rel="next" title="tornado-msgpack">
            ğŸ‘‰ tornado-msgpack
        </a>
    </li>
</ul></main><footer id="footer"><p>
            Powered by
            <a href="https://getnikola.com" rel="nofollow">Nikola</a>
        </p>
    </footer>
</body>
</html>
