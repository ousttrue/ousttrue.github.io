<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="generator" content="Nikola (getnikola.com)">
<meta name="viewport" content="width=device-width">
<script src="../../../../../assets/js/all-nocdn.js"></script><title>Gentoo再構築 | 三次元日誌</title>
<link href="../../../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
</head>
<body>
    <h1 id="brand">
        <a href="../../../../../" title="三次元日誌" rel="home">
            <span id="blog-title">三次元日誌</span>
        </a>
    </h1>

    <nav id="menu"><ul>
<li><a href="../../../../../archive.html">Archives</a></li>
<li><a href="../../../../../categories/index.html">Tags</a></li>
<li><a href="../../../../../rss.xml">RSS feed</a></li>
<li><a href="../../../../../about">About</a></li>
<li><a href="../../../../../books">MemoBooks</a></li>

            
            
            
        </ul></nav><hr>
<main id="content"><h1 class="p-name entry-title" itemprop="headline name">
    <a href="." class="u-url">Gentoo再構築</a>
</h1>
<div>
<p>Gentoo再構築
gentooのルートファイルシステムに10Gを割り当てていたのだがいつのまにかディスクフルになってしまった。
portageとhomeをmountしていたので大丈夫かと思っていたのだが意外と容量を使ってしまっていた様子。
いろいろインストールしすぎなのかもしれぬ。
とりあえず/var/logの大きいファイルをxzして急場を凌いだが、
パーティションの割り方の都合で拡大できないので新しく作り直すことにした。
作業記録。
ファイルシステム準備</p>
<h2>lvcreate -L 100G -n gentoo_root mygroup</h2>
<h2>mkfs.ext4 /dev/mygroup/gentoo_root</h2>
<h2>cd /mnt</h2>
<h2>mkdir gentoo</h2>
<h2>mount /dev/mygroup/gentoo_root</h2>
<p>Installing the Gentoo Installation Files
——————————————-</p>
<p>http://www.gentoo.org/doc/en/handbook/handbook-amd64.xml?part=1&amp;chap=5
stage3ファイルの取得と展開</p>
<h2>cd /mnt/gentoo</h2>
<h2>wget http://ftp.jaist.ac.jp/pub/Linux/Gentoo/releases/amd64/current-stage3/stage3-amd64-20130516.tar.bz2</h2>
<h2>tar xvjpf stage3-*.tar.bz2</h2>
<p>portageは旧パーティションを流用</p>
<h2>mkdir usr/portage</h2>
<h2>mount /dev/mygroup/portage usr/portage</h2>
<p>/etc/portage/make.conf</p>
<h2>These settings were set by the catalyst build script that automatically</h2>
<h2>built this stage.</h2>
<h2>Please consult /usr/share/portage/config/make.conf.example for a more</h2>
<h2>detailed example.</h2>
<p>CFLAGS="-march=native -O2 -pipe"</p>
<h2>CFLAGS="-march=bdver2 -O2 -pipe"</h2>
<p>CXXFLAGS="${CFLAGS}"</p>
<h2>WARNING: Changing your CHOST is not something that should be done lightly.</h2>
<h2>Please consult http://www.gentoo.org/doc/en/change-chost.xml before changing.</h2>
<p>CHOST="x86_64-pc-linux-gnu"</p>
<h2>These are the USE flags that were used in addition to what is provided by the</h2>
<h2>profile used for building.</h2>
<p>USE=""
USE="$USE -ldap"
USE="$USE mmx sse sse2 sse3 ssse3"
USE="$USE openal alsa gstreamer phonon pulseaudio xft xnest"
USE="$USE gtk gnome xfce imlib gconf"
USE="$USE qt4 kde"
USE="$USE gd imlib eigen"
USE="$USE sqlite apache2"
USE="$USE ffmpeg theora lame mms"
USE="$USE samba fuse udisks"
USE="$USE icu"
USE="$USE consolekit dbus pam policykit udev"
USE="$USE c++0x"</p>
<p>INPUT_DEVICES="evdev"</p>
<h2>VIDEO_CARDS="radeon"</h2>
<p>VIDEO_CARDS="fglrx"
LINGUAS="ja"</p>
<p>MAKEOPTS="-j5"
GENTOO_MIRRORS="http://ftp.iij.ad.jp/pub/linux/gentoo/ ftp://ftp.iij.ad.jp/pub/linux/gentoo/ http://ftp.jaist.ac.jp/pub/Linux/Gentoo/"</p>
<p>CFLAGSに-march=nativeを使えるようになった</p>
<p>Installing the Gentoo Base System
————————————</p>
<p>http://www.gentoo.org/doc/en/handbook/handbook-amd64.xml?part=1&amp;chap=6</p>
<h2>cp -L /etc/resolv.conf /mnt/gentoo/etc/</h2>
<h2>mount -t proc none /mnt/gentoo/proc</h2>
<h2>mount --rbind /sys /mnt/gentoo/sys</h2>
<h2>mount --rbind /dev /mnt/gentoo/dev</h2>
<h2>chroot /mnt/gentoo /bin/bash</h2>
<h2>source /etc/profile</h2>
<h2>export PS1="(chroot) $PS1"</h2>
<h2>emerge --sync</h2>
<h2>cp /usr/share/zoneinfo/Asia/Tokyo /etc/localtime</h2>
<h2>echo "Asia/Tokyo" &gt; /etc/timezone</h2>
<p>Configuring the Kernel
————————-</p>
<p>http://www.gentoo.org/doc/en/handbook/handbook-amd64.xml?part=1&amp;chap=7</p>
<h2>emerge gentoo-sources</h2>
<p>LVMからブートするのでgenkernelを使う</p>
<h2>emerge genkernel</h2>
<h2>genkernel --lvm --install all</h2>
<p>Configuring your System
————————–</p>
<p>http://www.gentoo.org/doc/en/handbook/handbook-amd64.xml?part=1&amp;chap=8</p>
<p>Installing Necessary System Tools
————————————</p>
<p>http://www.gentoo.org/doc/en/handbook/handbook-amd64.xml?part=1&amp;chap=9</p>
<p>Configuring the Bootloader
——————————</p>
<p>http://www.gentoo.org/doc/en/handbook/handbook-amd64.xml?part=1&amp;chap=10
/boot/grub/menu.lst
title genkernel 3.8.13
root (hd0,0)
kernel /boot/kernel-genkernel-x86_64-3.8.13-gentoo real_root=/dev/mygroup/gentoo_root rootfstype=ext4 dolvm
initrd /boot/initramfs-genkernel-x86_64-3.8.13-gentoo</p>
</div>
    </main><footer id="footer"><p>
            Powered by
            <a href="https://getnikola.com" rel="nofollow">Nikola</a>
        </p>
    </footer>
</body>
</html>
