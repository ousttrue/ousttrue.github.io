<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="generator" content="Nikola (getnikola.com)">
<meta name="viewport" content="width=device-width">
<script src="../../../../../assets/js/all-nocdn.js"></script><title>wafã§debugã¨releaseã®è¨­å®šã‚’è¨˜è¿°ã™ã‚‹(variant) | ä¸‰æ¬¡å…ƒæ—¥èªŒ</title>
<link href="../../../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
</head>
<body>
    <h1 id="brand">
        <a href="../../../../../" title="ä¸‰æ¬¡å…ƒæ—¥èªŒ" rel="home">
            <span id="blog-title">ä¸‰æ¬¡å…ƒæ—¥èªŒ</span>
        </a>
    </h1>

    <nav id="menu"><ul>
<li><a href="../../../../../archive.html">Archives</a></li>
<li><a href="../../../../../categories/index.html">Tags</a></li>
<li><a href="../../../../../rss.xml">RSS feed</a></li>
<li><a href="../../../../../about">About</a></li>
<li><a href="../../../../../books">MemoBooks</a></li>

            
            
            
        </ul></nav><hr>
<main id="content"><h1 class="p-name entry-title" itemprop="headline name">
    <h1 class="p-name entry-title" itemprop="headline name">
    <a href="." class="u-url">wafã§debugã¨releaseã®è¨­å®šã‚’è¨˜è¿°ã™ã‚‹(variant)
    </a>
</h1>
<ul itemprop="keywords" class="tags">
<li>
        <time datetime="2013-10-29T00:00:00+09:00" title="2013-10-29">2013-10-29</time>
</li>
</ul>
</h1>

<p>wafã§debugã¨releaseã®è¨­å®šã‚’è¨˜è¿°ã™ã‚‹(variant)
wafã§debugç‰ˆã¨releaseç‰ˆã®å‡ºåŠ›ã‚’åˆ†ã‘ã‚‹ã«ã¯variantãªã‚‹æ©Ÿèƒ½ã‚’ä½¿ã†ã€‚
+hello
  +hello.cpp
  +waf
  +wscript</p>
<p>ã¨å‰å›ã¨åŒæ§˜ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€‚ wscriptã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã™ã‚‹ã€‚</p>
<h2>coding: utf-8</h2>
<p>APPNAME='hello'
VERSION='1.0.0'</p>
<p>def configure(conf):
    # config 'debug'ã‚’ä½œã‚‹
    conf.setenv('debug')
    # debugã®è¨­å®š
    conf.env['MSVC_TARGETS'] = ['x86']
    conf.load('msvc')
    conf.env.CXXFLAGS = ['/nologo', '/EHsc']
    # PDBã‚„NDEBUGç­‰ã®è¨­å®šã‚’ãã£ã¡ã‚Šæ›¸ãå¿…è¦ãŒã‚ã‚‹</p>
<div class="code"><pre class="code literal-block"><span class="c1"># config 'release'ã‚’ä½œã‚‹ã€‚debugã®è¨­å®šã¯å¼•ãç¶™ãŒãªã„</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">setenv</span><span class="p">(</span><span class="s1">'release'</span><span class="p">)</span><span class="w"></span>
<span class="c1"># releaseã®è¨­å®š</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">'MSVC_TARGETS'</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">'x86'</span><span class="p">]</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">'msvc'</span><span class="p">)</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">CXXFLAGS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">'/nologo'</span><span class="p">,</span><span class="w"> </span><span class="s1">'/EHsc'</span><span class="p">]</span><span class="w"></span>
</pre></div>

<h2>BuildContextã®è¨­å®š</h2>
<p>def build(bld):
    bld.program(
            source='hello.cpp',
            target=APPNAME
            )</p>
<p>from waflib.Build import BuildContext</p>
<h2>BuildContextã‚’ä½¿ã†ã‚³ãƒãƒ³ãƒ‰</h2>
<p>class BuildDebug(BuildContext):
    # config 'debug' ã‚’ä½¿ã†variant
    # å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒbuild/debugã«å¤‰ã‚ã‚‹
    variant = "debug"
    # å‘¼ã³å‡ºã—ã‚³ãƒãƒ³ãƒ‰ã¯build_debug
    cmd = "build_debug"</p>
<h2>BuildContextã‚’ä½¿ã†ã‚³ãƒãƒ³ãƒ‰</h2>
<p>class BuildRelease(BuildContext):
    # config 'release' ã‚’ä½¿ã†variant
    # å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒbuild/releaseã«å¤‰ã‚ã‚‹
    variant = "release"
    # å‘¼ã³å‡ºã—ã‚³ãƒãƒ³ãƒ‰ã¯build_release
    cmd = "build_release"</p>
<p>variantã¨ã„ã†æ¦‚å¿µã‚’ä½¿ã†ã€‚
http://docs.waf.googlecode.com/git/book_17/single.html ã® 6.2.2.
Changing the output directory Configuration sets for variants
ã«è¨˜è¿°ãŒã‚ã‚‹ã€‚
ä½¿ã†</p>
<blockquote>
<p>python waf --help
waf [commands] [options]</p>
</blockquote>
<p>Main commands (example: ./waf build -j4)
  build        : executes the build
  build_debug  :
  build_release:
:
:
çœç•¥</p>
<p>ã¨ã„ã†æ„Ÿã˜ã§build_debug, build_releaseãŒå¢—ãˆã‚‹ã€‚</p>
<blockquote>
<p>python waf build_debug
Waf: Entering directory <code>C:\work\_waf\debug_release\build\debug'
[1/2] cxx: hello.cpp -&gt; build\debug\hello.cpp.1.o
hello.cpp
[2/2] cxxprogram: build\debug\hello.cpp.1.o -&gt; build\debug\hello.exe build\debug\hello.exe.manifest
Waf: Leaving directory</code>C:\work_waf\debug_release\build\debug'
'build_debug' finished successfully (0.487s)</p>
</blockquote>
<p>ç´ ã®ãƒ“ãƒ«ãƒ‰ã¯ã‚¨ãƒ©ãƒ¼ã«ãªã£ãŸã€‚ãŸã¶ã‚“å¯¾è±¡ã«ãªã‚‹åç„¡ã—ã®configãŒå­˜åœ¨ã—ãªã„ãŸã‚ã€‚</p>
<blockquote>
<p>python waf build
Waf: Entering directory <code>C:\work\_waf\debug_release\build'
[1/2] cxx: hello.cpp -&gt; build\hello.cpp.1.o
Waf: Leaving directory</code>C:\work_waf\debug_release\build'
Build failed
:
:
çœç•¥</p>
</blockquote>
<p>ã¨ã„ã†ã“ã¨ã§ç´ ã®ãƒ“ãƒ«ãƒ‰ã®æ™‚ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã¦æ­¢ã‚ã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚
buildãƒ¡ã‚½ãƒƒãƒ‰ã®å…ˆé ­ã«waf booké€šã‚Šã®è¨˜è¿°ã‚’å…¥ã‚Œã‚‹ã€‚</p>
<h2>BuildContextã®è¨­å®š</h2>
<p>def build(bld):
    if not bld.variant:
         bld.fatal('call "waf build_debug" or "waf build_release", and try "waf --help"')
    bld.program(
            source='hello.cpp',
            target=APPNAME
            )</p>
<blockquote>
<p>python waf build
Waf: Entering directory `C:\work_waf\debug_release\build'
call "waf build_debug" or "waf build_release", and try "waf --help"
python waf clean
call "waf build_debug" or "waf build_release", and try "waf --help"</p>
</blockquote>
<p>buildä»¥å¤–ã«ã‚‚buildãƒ¡ã‚½ãƒƒãƒ‰(BuildContext)ã‚’ä½¿ã†ã‚³ãƒãƒ³ãƒ‰ãŒã‚ã£ã¦ã€
http://docs.waf.googlecode.com/git/book_17/single.html ã® 12.1.2.
Context classes ã®ã‚¯ãƒ©ã‚¹å›³ã«ã‚ˆã‚‹ã¨ ListContext, CleanContext,
StepContext, InstallContext, UninstallContext
ãŒBuildContextã‚’ç¶™æ‰¿ã—ã¦ã„ã‚‹ã®ã§ã“ã‚Œã«å¯¾å¿œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰
ãã‚Œãã‚Œã«debugç‰ˆã€releaseç‰ˆã‚’å®šç¾©ã—ã¦ã‚„ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
waf bookã«æ›¸ã„ã¦ã‚ã‚‹ã‚ˆã†ã«ã‚³ãƒãƒ³ãƒ‰classã®è¨˜è¿°ã‚’å¤‰ãˆã‚‹ã€‚
from waflib.Build import BuildContext, ListContext, CleanContext, StepContext, InstallContext, UninstallContext</p>
<p>CONTEXTS=[BuildContext, ListContext, CleanContext, StepContext, InstallContext, UninstallContext]
VARIANTS=['debug', 'release']</p>
<p>for context in CONTEXTS:
    for variant_name in VARIANTS:
        name = context.<strong>name</strong>.replace('Context','').lower()
        class tmp(context):
            cmd = name + '_' + variant_name
            variant = variant_name</p>
<p>helpã‚’è¦‹ã‚‹ã¨å¤§é‡ã«å®šç¾©ã—ãŸã‚³ãƒãƒ³ãƒ‰ãŒå¢—ãˆã‚‹ã€‚</p>
<blockquote>
<p>python waf --help
waf [commands] [options]</p>
</blockquote>
<p>Main commands (example: ./waf build -j4)
  build            : executes the build
  build_debug      :
  build_release    :
  clean            : cleans the project
  clean_debug      :
  clean_release    :
  configure        : configures the project
  dist             : makes a tarball for redistributing the sources
  distcheck        : checks if the project compiles (tarball from 'dist')
  distclean        : removes the build directory
  install          : installs the targets on the system
  install_debug    :
  install_release  :
  list             : lists the targets to execute
  list_debug       :
  list_release     :
  step             : executes tasks in a step-by-step fashion, for debugging
  step_debug       :
  step_release     :
  uninstall        : removes the targets installed
  uninstall_debug  :
  uninstall_release:
  update           : updates the plugins from the <em>waflib/extras</em> directory
:
:
çœç•¥</p>
<blockquote>
<p>python waf clean_debug build_debug
'clean_debug' finished successfully (0.087s)
Waf: Entering directory <code>C:\work\_waf\debug_release\build\debug'
[1/2] cxx: hello.cpp -&gt; build\debug\hello.cpp.1.o
hello.cpp
[2/2] cxxprogram: build\debug\hello.cpp.1.o -&gt; build\debug\hello.exe build\debug\hello.exe.manifest
Waf: Leaving directory</code>C:\work_waf\debug_release\build\debug'
'build_debug' finished successfully (0.451s)</p>
</blockquote>
<p>ã“ã‚Œã§debug, releaseã®ä½¿ã„åˆ†ã‘ã¯ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚
variantã‚’è¿½åŠ ã™ã‚‹
64bitãƒ“ãƒ«ãƒ‰ã‚„ã€gccã®variantã‚’è¿½åŠ ã—ã¦ã¿ãŸã€‚</p>
<h2>coding: utf-8</h2>
<p>APPNAME='hello'
VERSION='1.0.0'</p>
<p>VARIANTS=[
'vc_debug', 'vc_release', 'vc64_debug', 'vc64_release',
'gcc_debug', 'gcc_release',
]</p>
<p>def configure(conf):
    # config 'debug'ã‚’ä½œã‚‹
    conf.setenv('debug')
    # debugã®è¨­å®š
    conf.env['MSVC_VERSIONS'] = ['msvc 10.0']
    conf.env['MSVC_TARGETS'] = ['x86']
    conf.load('msvc')
    conf.env.CXXFLAGS = ['/nologo', '/EHsc']
    # PDBã‚„NDEBUGç­‰ã®è¨­å®šã‚’ãã£ã¡ã‚Šæ›¸ãå¿…è¦ãŒã‚ã‚‹</p>
<div class="code"><pre class="code literal-block"><span class="c1"># config 'release'ã‚’ä½œã‚‹ã€‚debugã®è¨­å®šã¯å¼•ãç¶™ãŒãªã„</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">setenv</span><span class="p">(</span><span class="s1">'release'</span><span class="p">)</span><span class="w"></span>
<span class="c1"># releaseã®è¨­å®š</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">'MSVC_VERSIONS'</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">'msvc 10.0'</span><span class="p">]</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">'MSVC_TARGETS'</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">'x86'</span><span class="p">]</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">'msvc'</span><span class="p">)</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">CXXFLAGS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">'/nologo'</span><span class="p">,</span><span class="w"> </span><span class="s1">'/EHsc'</span><span class="p">]</span><span class="w"></span>

<span class="c1"># config 'debug'ã‚’ä½œã‚‹</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">setenv</span><span class="p">(</span><span class="s1">'vc64_debug'</span><span class="p">)</span><span class="w"></span>
<span class="c1"># debugã®è¨­å®š</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">'MSVC_VERSIONS'</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">'msvc 10.0'</span><span class="p">]</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">'MSVC_TARGETS'</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">'x64'</span><span class="p">]</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">'msvc'</span><span class="p">)</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">CXXFLAGS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">'/nologo'</span><span class="p">,</span><span class="w"> </span><span class="s1">'/EHsc'</span><span class="p">]</span><span class="w"></span>
<span class="c1"># PDBã‚„NDEBUGç­‰ã®è¨­å®šã‚’ãã£ã¡ã‚Šæ›¸ãå¿…è¦ãŒã‚ã‚‹</span><span class="w"></span>

<span class="c1"># config 'release'ã‚’ä½œã‚‹ã€‚debugã®è¨­å®šã¯å¼•ãç¶™ãŒãªã„</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">setenv</span><span class="p">(</span><span class="s1">'vc64_release'</span><span class="p">)</span><span class="w"></span>
<span class="c1"># releaseã®è¨­å®š</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">'MSVC_VERSIONS'</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">'msvc 10.0'</span><span class="p">]</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">'MSVC_TARGETS'</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">'x64'</span><span class="p">]</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">'msvc'</span><span class="p">)</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">CXXFLAGS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">'/nologo'</span><span class="p">,</span><span class="w"> </span><span class="s1">'/EHsc'</span><span class="p">]</span><span class="w"></span>

<span class="c1"># config 'debug'ã‚’ä½œã‚‹</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">setenv</span><span class="p">(</span><span class="s1">'gcc_debug'</span><span class="p">)</span><span class="w"></span>
<span class="c1"># debugã®è¨­å®š</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">'gxx'</span><span class="p">)</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">CXXFLAGS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">'-g'</span><span class="p">]</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">LINKFLAGS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">'-g'</span><span class="p">]</span><span class="w"></span>

<span class="c1"># config 'release'ã‚’ä½œã‚‹ã€‚debugã®è¨­å®šã¯å¼•ãç¶™ãŒãªã„</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">setenv</span><span class="p">(</span><span class="s1">'gcc_release'</span><span class="p">)</span><span class="w"></span>
<span class="c1"># releaseã®è¨­å®š</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">'gxx'</span><span class="p">)</span><span class="w"></span>
<span class="n">conf</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">CXXFLAGS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">'-O2'</span><span class="p">]</span><span class="w"></span>
</pre></div>

<h2>BuildContextã®è¨­å®š</h2>
<p>def build(bld):
    if not bld.variant:
         bld.fatal('call "waf build_debug" or "waf build_release", and try "waf --help"')
    bld.program(
            source='hello.cpp',
            target=APPNAME
            )</p>
<p>from waflib.Build import BuildContext, ListContext, CleanContext, StepContext, InstallContext, UninstallContext</p>
<p>CONTEXTS=[BuildContext, ListContext, CleanContext, StepContext, InstallContext, UninstallContext]</p>
<p>for context in CONTEXTS:
    for variant_name in VARIANTS:
        name = context.<strong>name</strong>.replace('Context','').lower()
        class tmp(context):
            cmd = name + '_' + variant_name
            variant = variant_name</p>

<hr>
<ul class="pager hidden-print">
<li class="previous">
        <a href="../waf/" rel="prev" title="pythonã«ã‚ˆã‚‹ãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆwafã‚’ä½¿ã„å§‹ã‚ãŸ">
            pythonã«ã‚ˆã‚‹ãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆwafã‚’ä½¿ã„å§‹ã‚ãŸ ğŸ‘ˆ
        </a>
    </li>
    <li style="flex-grow: 1">
    <li class="next">
        <a href="../../../11/25/win8/" rel="next" title="Windows8å°å…¥">
            ğŸ‘‰ Windows8å°å…¥
        </a>
    </li>
</ul></main><footer id="footer"><p>
            Powered by
            <a href="https://getnikola.com" rel="nofollow">Nikola</a>
        </p>
    </footer>
</body>
</html>
