"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2352],{9414:function(n,e,t){t.r(e),t.d(e,{default:function(){return u}});var o=t(1151),r=t(7294);function a(n){const e=Object.assign({p:"p",pre:"pre",code:"code"},(0,o.ah)(),n.components);return r.createElement(r.Fragment,null,r.createElement(e.p,null,"いつも JSONUtil や MiniJson+JsonNode を使うのだけど数値周りの cast で苦しんだので自前でつくることにした。"),"\n",r.createElement(e.p,null,"https://github.com/ousttrue/JsonSan~\nhttps://github.com/ousttrue/Osaru"),"\n",r.createElement(e.pre,null,r.createElement(e.code,null,'UnityのJSON\nUnityのJsonUtilityみたいなシリアライザ・デシリアライザと不可分のものは使いづらい。例えば、以下のようなjsonでpositionだけをデシリアライズしたい場合。\n{\n    "action": "hoge",\n    "params": {\n        "power": 9.8,\n        "position": [0, 1, 2]\n    }\n}\n\n下記のように使いたい。\nstring json;\n\nvar parsed=Json.Parse(json);\nvar x=(float)parsed["params"]["position"][0];\n\nMiniJson\n\nMiniJson\nMiniJsonをちょっと楽にするスクリプト\n\nMiniJsonはパースした時にObjectの入れ物としてDictionary[string, object]、Arrayの入れ物としてList[object]を使っている。ここから値を取り出すにはキャストを使うのだがこれがわりとはまる。\nint64 n=1234;\nvar no=(object)n;\nvar i=(int)no; // boxingされたint64型の値はobjectから直接intにキャストできない\n\n上記のような、ある数をobject型に代入してそれを違う型として取りだすようなときに面倒すぎだった。\n// こうすればできる\nvar i=(int)(int64)no;\n\nということで自作してみた。\nJsonSan Osaru\nJSON, Util, Parse, Reader, Deserializer|Serializerあたりの組み合わせが使い尽くされていたのでリポジトリ名がすごい適当になった。JSONさん。さらにMessagePackと統合してObjectStructure改めOsaruにした\n\nhttps://github.com/ousttrue/Osaru\n\nJSONの仕様を見ながらごりごりテストドリブンで実装した。\n\nhttp://www.json.org/json-ja.html\n\nJSONは、ObjectのキーがString限定なのに初めて気づいたり。Stackoverflowで「JavascriptのObjectリテラルとJSONは違うのだよ」というのを見たが、まぁそうですね。コメントとかキーのクォート省略とか。\n実装\nJSON文字列をパーサーに入力したらパース済みのノードとして結果を得る。\nvar json="[ \\"json\\" ]";\nvar node=Node.Parse(json);\n\nノードはJSONの定義に沿った型をenumで知っていて、GetNumber(), GetString(), GetBoolean()等が実装してあるので適当に値を取り出せる。MiniJsonでのはまりを反省してNumber型はdouble決め打ちにした。\npublic enum ValueType\n{\n    Unknown,\n\n    String,\n    Number,\n    Object,\n    Array,\n    Boolean,\n}\n\nDebug.Log(node.ValueType); // ValueType.String\nnode.GetString();\n\nnodeがObjectかArrayの場合がミソでパースした時点では”{“または”[“までしか読まないことにした。IEnumerable[Node]の発動で子要素への要求が来て中に読み進む。使い方によっては軽量。Count()を使ったりすると遅くなるであろう。\nforeach(var child in node)\n{\n    Debug.Log(child.GetString());\n}\n')))}var i=function(n){void 0===n&&(n={});const{wrapper:e}=Object.assign({},(0,o.ah)(),n.components);return e?r.createElement(e,n,r.createElement(a,n)):a(n)};t(8678);function c(n){let{data:e,children:t}=n;return r.createElement(r.Fragment,null,r.createElement("h1",null,e.mdx.frontmatter.title),r.createElement(o.Zo,null,t))}function u(n){return r.createElement(c,n,r.createElement(i,n))}},8678:function(n,e,t){t(7294)},1151:function(n,e,t){t.d(e,{Zo:function(){return c},ah:function(){return a}});var o=t(7294);const r=o.createContext({});function a(n){const e=o.useContext(r);return o.useMemo((()=>"function"==typeof n?n(e):{...e,...n}),[e,n])}const i={};function c({components:n,children:e,disableParentContext:t}){let c;return c=t?"function"==typeof n?n({}):n||i:a(n),o.createElement(r.Provider,{value:c},e)}}}]);
//# sourceMappingURL=component---src-templates-post-template-js-content-file-path-home-runner-work-ousttrue-github-io-ousttrue-github-io-content-posts-2017-02-osaru-md-2cd8148b98e2a8fcb585.js.map