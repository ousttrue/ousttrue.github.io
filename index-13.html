<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="ja">
<head>
<meta charset="utf-8">
<meta name="description" content="ä½œæ¥­è¨˜éŒ²">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ä¸‰æ¬¡å…ƒæ—¥èªŒ (éå»ã®è¨˜äº‹ 13ãƒšãƒ¼ã‚¸ç›®) | ä¸‰æ¬¡å…ƒæ—¥èªŒ</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="ja" href="rss.xml">
<link rel="canonical" href="https://ousttrue.github.io/index-13.html">
<link rel="prev" href="index-14.html" type="text/html">
<link rel="next" href="index-12.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">æœ¬æ–‡ã‚’èª­ã¿é£›ã°ã™</a>

<!-- Header and menu bar -->
<div class="container">
      <header class="blog-header py-3"><div class="row nbb-header align-items-center">
          <div class="col-md-3 col-xs-2 col-sm-2" style="width: auto;">
            <button class="navbar-toggler navbar-light bg-light nbb-navbar-toggler" type="button" data-toggle="collapse" data-target=".bs-nav-collapsible" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse bs-nav-collapsible bootblog4-search-form-holder">
                
            </div>
        </div>
          <div class="col-md-6 col-xs-10 col-sm-10 bootblog4-brand" style="width: auto;">
            <a class="navbar-brand blog-header-logo text-dark" href=".">

            <span id="blog-title">ä¸‰æ¬¡å…ƒæ—¥èªŒ</span>
        </a>
          </div>
            <div class="col-md-3 justify-content-end align-items-center bs-nav-collapsible collapse flex-collapse bootblog4-right-nav">
            <nav class="navbar navbar-light bg-white"><ul class="navbar-nav bootblog4-right-nav"></ul></nav>
</div>
    </div>
</header><nav class="navbar navbar-expand-md navbar-light bg-white static-top"><div class="collapse navbar-collapse bs-nav-collapsible" id="bs-navbar">
            <ul class="navbar-nav nav-fill d-flex w-100">
<li class="nav-item">
<a href="archive.html" class="nav-link">Archives</a>
                </li>
<li class="nav-item">
<a href="categories/index.html" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
</div>
<!-- /.navbar-collapse -->
</nav>
</div>

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
    
        

    
        
    <div class="postindex">
            <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2020/w3m-mod/" class="u-url">w3mæ”¹é€ </a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2020/w3m-mod/" rel="bookmark">
            <time class="published dt-published" datetime="2020-07-25T14:59:50Z" itemprop="datePublished" title="2020-07-25 14:59">2020-07-25 14:59</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2020/w3m-mod/#disqus_thread" data-disqus-identifier="cache/content/posts/2020/w3m-mod.html">ã‚³ãƒ¡ãƒ³ãƒˆ</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>ä»¥å‰ã«ã‚‚ä½•åº¦ã‹ã‚„ã£ãŸã“ã¨ãŒã‚ã‚‹ã®ã ã‘ã©ç«‹ã¡æ¶ˆãˆã«ãªã£ã¦ã„ãŸã€ <a href="http://w3m.sourceforge.net/index.ja.html">w3m</a> ã®æ”¹é€ ã‚’è©¦ã¿ã¦ã„ã‚‹ã€‚
w3m ã¯ã‚ã‚Šã¨å¥½ããªãƒ†ã‚­ã‚¹ãƒˆãƒ–ãƒ©ã‚¦ã‚¶ãªã®ã ãŒã€ 2011 å¹´ãã‚‰ã„ã® 0.5.3 ã§é–‹ç™ºãŒçµ‚äº†ã—ã¦ã„ã‚‹æ§˜å­ã€‚</p>
<p>https://github.com/ousttrue/w3m</p>
<p>ã¾ãšã¯ <code>C++</code> åŒ–ã—ã¦ã‹ã‚‰ã€HTMLå‡¦ç†ãªã©ã‚’å†å…¥å¯èƒ½ã«ã—ã¦ã‚¿ãƒ–ã”ã¨ã«ã‚¹ãƒ¬ãƒƒãƒ‰ç‹¬ç«‹ã™ã‚‹æ–¹å‘ã‚’ç›®æŒ‡ã™ã€‚
åŒæ™‚ã«ã€ <code>boehm-GC</code> ã‚’å°‘ã—ãšã¤ <code>STL</code> ã®ã‚³ãƒ³ãƒ†ãƒŠã‚„ <code>std::string</code> ã«ç½®ãæ›ãˆã‚‹ã€‚
ã©ã†ã‚‚ã€<code>c++</code> ã¨ <code>boehm-GC</code> ã®å…±å­˜ã™ã‚‹ã®ã«æŠ€ãŒã„ã‚‹ã‚‰ã—ãã€é©å½“ã«ç½®ãæ›ãˆã¦ã„ãã¨ãƒ¡ãƒ¢ãƒªç ´å£Šã§æ­»ã¬ã€‚<code>boehm-GC</code> ã‚’ã™ã¹ã¦ç½®ãæ›ãˆã‚‹å¿…è¦ãŒã‚ã‚Šãã†ã€‚<code>C++</code> ã‚¯ãƒ©ã‚¹ã®ãƒ¡ãƒ³ãƒãƒ¼ã« <code>GC</code> ãŒè¦ã‚‹ã€<code>GC struct</code> ã®ãƒ¡ãƒ³ãƒãƒ¼ã« <code>C++</code> ã‚¯ãƒ©ã‚¹ãŒå±…ã‚‹ã®ä¸¡æ–¹ã«å•é¡ŒãŒã‚ã‚‹ã£ã½ã„ã€‚ä¸€å¿œã€ <code>gc_cleanup</code> ã‚’ç¶™æ‰¿ã—ãŸã‚Šã—ã¦ã„ã‚‹ã®ã ã‘ã©ã€ã‚„ã‚Šæ–¹ãŒã¾ãšã„ã½ã„ã€‚</p>
<p>æ”¹é€ ã«ã‚ãŸã£ã¦ãªã‚‹ã¹ãæ©Ÿèƒ½ã‚’ç¶­æŒã—ã‚ˆã†ã¨ã—ã¦ã„ãŸã®ã ã‘ã©ã€ã‚ã‚‹ç¨‹åº¦ã‚ã‚Šãã£ã¦æ©Ÿèƒ½ã‚’è½ã¨ã•ãªã„ã¨æ‰‹ã«è² ãˆãªã„ã¨ã“ã‚ãŒã‚ã‚‹ã€‚</p>
<ul>
<li>http + https ä»¥å¤–ã®é€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯è½ã¨ã™ã€‚NNTP ã¨ã‹ Gopher ä½¿ã£ãŸã“ã¨ãªã„ã—ãªãƒ¼ã€FTPã‚‚ã„ã£ãŸã‚“è½ã¨ã™</li>
<li>backend, dump, halfload ç­‰ã®å‡ºåŠ›ã«ä»‹å…¥ã™ã‚‹æ©Ÿèƒ½ã¯è½ã¨ã™ã€‚ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚€ã®ãŒå¤§å¤‰</li>
<li>M17N, COLOR, IMAGE, MENU ã¯æ®‹ã™</li>
<li>Mouse ã¯å¾®å¦™ã€‚å‰Šã£ã¦ã‚‚ã‚ˆã„ã‹ã‚‚</li>
<li>GetText ã‚‚å‰Šã‚‹</li>
</ul>
<p>é‡ã‚’æ¸›ã‚‰ã™ã€‚æ€ã£ãŸã‚ˆã‚Šã‚³ãƒ¼ãƒ‰ãŒå¤šã‹ã£ãŸã®ã ã€‚</p>
<h2>ä¸‹æº–å‚™</h2>
<h3>msys2 ã§ã¨ã‚Šã‚ãˆãšãƒ“ãƒ«ãƒ‰</h3>
<p>WSL Ubuntu ã ã¨ãƒ“ãƒ«ãƒ‰ã§ããªã‹ã£ãŸã€‚
ã—ã‹ã—ã€msys2 ãªã‚‰ã‚ã‚Šã¨ç°¡å˜ã«ãƒ“ãƒ«ãƒ‰ã§ãã‚‹ã“ã¨ã‚’ç™ºè¦‹ã€‚</p>
<pre class="code literal-block"><span></span>$ pacman -S make gcc libgc-devel openssl-devel ncurses-devel
$ x86_64-pc-msys-gcc --version
x86_64-pc-msys-gcc <span class="o">(</span>GCC<span class="o">)</span> <span class="m">9</span>.3.0
Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2019</span> Free Software Foundation, Inc.
This is free software<span class="p">;</span> see the <span class="nb">source</span> <span class="k">for</span> copying conditions.  There is NO
warranty<span class="p">;</span> not even <span class="k">for</span> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
$ ./configure
</pre>

<p>ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ç’°å¢ƒã®æ–¹ãŒæ˜”ã¨å¤‰ã‚ã£ã¦ã—ã¾ã£ã¦ãƒ“ãƒ«ãƒ‰ã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€‚</p>
<p>ä¿®æ­£æ–¹æ³•ğŸ‘‡</p>
<p><a href="https://qiita.com/imkitchen/items/02a9df7baaaf434fee66">[CentOS7] emacs24ã«emacs-w3mã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</a></p>
<p><code>#ifdef</code> ã®èª¿æ•´</p>
<pre class="code literal-block"><span></span>// config.h
//#define USE_BINMODE_STREAM 1
//#define USE_EGD
</pre>

<pre class="code literal-block"><span></span>$ make
$ ./w3m www.google.com // å‹•ã„ãŸ
</pre>

<h3>WSL ã§ GC ãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã™ã‚‹å•é¡Œ</h3>
<p><code>boehm-GC</code> ãŒãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã«ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã“ã¨ã§ã€ <code>make</code> ä¸­ã®ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ <code>mktable</code> ãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã™ã‚‹ã®ãŒåŸå› ã§ãƒ“ãƒ«ãƒ‰ã‚¹ãƒ†ãƒƒãƒ—ãŒé€”ä¸­ã§æ­¢ã¾ã‚‹ã®ãŒåŸå› ã ã£ãŸã€‚ãªã®ã§ã€ãŸã¨ãˆãƒ“ãƒ«ãƒ‰æ¸ˆã¿ã® <code>w3m</code> ã‚’ <code>apt get</code> ã—ã¦ã‚‚ã€ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚‚åŒã˜åŸå› ã§ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã™ã‚‹ã€‚</p>
<p>ã‚¨ãƒ©ãƒ¼ã€‚</p>
<pre class="code literal-block"><span></span>Wrong __data_start/_end pair
fish: './build/w3m' terminated by signal SIGABRT (Abort)
</pre>

<p>https://hitkey.nekokan.dyndns.info/diary2004.php#D200424</p>
<p>ã«ã‚ˆã‚‹ã¨ã€stack size ã®åˆ¶é™ãŒåŸå› ã‚‰ã—ã„ã€‚</p>
<pre class="code literal-block"><span></span>$ <span class="nb">ulimit</span> -s
<span class="m">8192</span>
</pre>

<p>WSL ã§ã“ã‚Œã‚’å¤‰ãˆã‚‹ã«ã¯ãƒ»ãƒ»ãƒ»ã€‚</p>
<p>https://github.com/microsoft/WSL/issues/633</p>
<p>ç„¡ç†ã€‚</p>
<p><code>WSL2</code> ãªã‚‰ã§ãã‚‹ï¼Ÿ</p>
<pre class="code literal-block"><span></span>&gt; wsl -l -v
  NAME            STATE           VERSION
* Ubuntu-20.04    Running         2
</pre>

<p>ã‚„ã£ã¦ã¿ã‚‹ã€‚</p>
<pre class="code literal-block"><span></span>$ <span class="nb">ulimit</span> -s unlimited
&gt; <span class="nb">ulimit</span> -s
unlimited
</pre>

<p>ã§ããŸã€‚</p>
<pre class="code literal-block"><span></span>$ w3m
Wrong __data_start/_end pair
</pre>

<p>ã†ãƒ¼ã‚€ã€‚</p>
<pre class="code literal-block"><span></span>$ <span class="nb">ulimit</span> -s <span class="m">81920</span>
&gt; <span class="nb">ulimit</span> -s
<span class="m">81920</span>
</pre>

<p>å‹•ã„ãŸã€‚
8192KB ã§ã¯è¶³ã‚Šãªãã€ unlimited ã§ã¯å¤šã™ãã‚‹ã‚‰ã—ã„ã€‚ã“ã‚Œã¯ã€é›£ã—ã„ãªã€‚</p>
<p>ã¡ãªã¿ã«ã€ <code>gdb</code> ä¸Šãªã‚‰ã‚¹ã‚¿ãƒƒã‚¯å•é¡Œã‚’è§£æ±ºã—ãªãã¦ã‚‚å‹•ã„ãŸã€‚
<code>gdb</code> ãŒã‚¹ã‚¿ãƒƒã‚¯ã‚’è¦†ã„éš ã™ã®ã‹ãªï¼Ÿ
é–‹ç™ºã ã‘ãªã‚‰ã§ããªãã‚‚ãªã„ã€‚</p>
<h3>ãƒ“ãƒ«ãƒ‰ã‚·ã‚¹ãƒ†ãƒ </h3>
<p>ã¨ã‚Šã‚ãˆãšæ…£ã‚ŒãŸãƒ„ãƒ¼ãƒ«ã«å¤‰æ›´ã€‚
WSL ä¸Šã® vscode ã§ä½œæ¥­ã—ã¦ã„ã‚‹ã®ã‚‚ã‚ã‚Šã€autotools ã‹ã‚‰ CMake ã«å¤‰æ›´ã€‚
ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¯å¾Œé€€ã•ã›ã¦ã€æ–°ã—ã‚ã® gcc(c++20) ã§ãƒ“ãƒ«ãƒ‰ã§ãã‚Œã°ã„ã„ã‚„ã€‚
config.h ã‚„ funcname ç³»ã®ã‚³ãƒ¼ãƒ‰ç”Ÿæˆçµæœã¯ã‚³ãƒŸãƒƒãƒˆã—ã¡ã‚ƒã†ã€‚
libwc ãŒ static ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ã‹ã‚Œã¦ã„ã‚‹ã®ã‚‚ã€ã²ã¨ã¾ã¨ã‚ã«ã—ã¦ã—ã¾ã£ãŸã€‚
ã‚ã¨ã€é©å½“ã«ã‚½ãƒ¼ã‚¹ã‚’ãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã™ã‚‹ã€‚</p>
<p>ç”Ÿæˆã‚³ãƒ¼ãƒ‰ä¸€è¦§</p>
<table>
<thead><tr>
<th>ãƒ•ã‚¡ã‚¤ãƒ«</th>
<th>ç”Ÿæˆæ–¹æ³•</th>
<th>å…¥åŠ›</th>
<th>å‚™è€ƒ</th>
</tr></thead>
<tbody>
<tr>
<td>config.h</td>
<td>configure</td>
<td></td>
<td>å„ç¨® #define ãªã©</td>
</tr>
<tr>
<td>entity.h</td>
<td>Makefile(mktable)</td>
<td>entity.tab</td>
<td>./mktable 100 entity.tab &gt; entity.h</td>
</tr>
<tr>
<td>funcname.tab</td>
<td>Makefile(awk)</td>
<td>main.c, menu.c</td>
<td></td>
</tr>
<tr>
<td>funcname.c</td>
<td>Makefile(awk)</td>
<td>funcname.tab</td>
<td>sort funcname.tab ï½œ awk -f funcname0.awk &gt; funcname.c</td>
</tr>
<tr>
<td>funcname1.h</td>
<td>Makefile(awk)</td>
<td>funcname.tab</td>
<td></td>
</tr>
<tr>
<td>funcname2.h</td>
<td>Makefile(awk)</td>
<td>funcname.tab</td>
<td></td>
</tr>
<tr>
<td>functable.c</td>
<td>Makefile(mktable)</td>
<td>funcname.tab</td>
<td></td>
</tr>
<tr>
<td>tagtable.c</td>
<td>Makefile(mktable)</td>
<td>funcname.tab</td>
<td></td>
</tr>
</tbody>
</table>
<h3>è­¦å‘Šã‹ã‚‰ã‚¨ãƒ©ãƒ¼ã«å¼•ãä¸Šã’</h3>
<p>æ”¹é€ ã—ã¦ã„ãã®ã« <code>C</code> ã®ç·©ã„å‹åˆ¶é™ãŒå±é™º(ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãŒé€šã‚‹ã®ã«å‹ãŒä¸ä¸€è‡´ã«ãªã‚Šã‚„ã™ã„)ãªã®ã§ã€
ä»¥ä¸‹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã€‚</p>
<pre class="code literal-block"><span></span>-Werror=implicit-function-declaration
-Werror=int-conversion
-Werror=conversion-null
</pre>

<p>ã“ã‚Œã§ã€å‹å®£è¨€ã‚’è£œå¼·ã—ãªãŒã‚‰é€²ã‚ã‚‹ã€‚</p>
<h2>ç¬¬1æ®µéš</h2>
<ul>
<li>extern "C" ã‚’è¿½åŠ ã—ã¦ã‚½ãƒ¼ã‚¹ã®æ‹¡å¼µå­ã‚’ <code>.cpp</code> ã«å¤‰æ›´</li>
<li>extern "C" ã‚’ã¾ã¨ã‚ã¦å–ã‚Šé™¤ã</li>
<li>typedef struct tag ã‚’å–ã‚Šé™¤ã</li>
</ul>
<p>ã“ã“ã¾ã§ã‚„ã‚‹ã¨ã€è‡ªç”±ã« <code>c++</code> ã®ã‚³ãƒ¼ãƒ‰ã‚’æ··ãœã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
<code>std::string</code>ã€<code>std::vector</code>, <code>std::shared_ptr</code>, <code>std::function</code>, <code>std::string_view</code>, <code>template</code>, <code>class</code>, å‰æ–¹å®£è¨€, <code>auto</code>, <code>inline</code> ç­‰ä½¿ã„æ”¾é¡Œ ğŸ‘</p>
<p>ç‰¹ã« <code>std::string_view</code> ã®ä½¿ã„å‹æ‰‹ã‚’è©¦ã—ãŸã„ã€‚
æ‰€æœ‰ã—ãªã„æ–‡å­—åˆ—ã¯ã™ã¹ã¦ã€ <code>std::string_view</code> ã§ã„ã‘ã‚‹ã¨æ€ã†ã®ã ãŒã€‚
<code>split</code> ã® <code>std::string_view</code> ç‰ˆã¯å…·åˆãŒã‚ˆã‹ã£ãŸã€‚</p>
<h3>c++ åŒ– (extern "C")</h3>
<p>æ‰‹æ³•ã¨ã—ã¦ã¯ã€å„ã‚½ãƒ¼ã‚¹ã®æ‹¡å¼µå­ã‚’ <code>.c</code> ã‹ã‚‰ <code>.cpp</code> ã«å¤‰æ›´ã™ã‚‹ã€‚
<code>CMakeLists.txt</code> ã‚’ä¿®æ­£ã€‚
<code>#include</code> ã‚’ <code>extern "C"</code> ã§å›²ã‚€ã€ã§ <code>c++</code> åŒ–ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚</p>
<pre class="code literal-block"><span></span><span class="k">extern</span> <span class="s">"C"</span> <span class="p">{</span>
<span class="cp">#include</span> <span class="cpf">"xxx.h"</span><span class="cp"></span>
<span class="p">}</span>
</pre>

<p>ãŸã ã€ <code>cpp</code> ã§å®šç¾©ã™ã‚‹é–¢æ•°ã®å®£è¨€ãŒ <code>extern "C"</code> ã®ä¸­ã«å…¥ã‚‰ãªã„ã¨ãƒªãƒ³ã‚¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã®ã§ã€
ãã†ãªã‚‹ã‚ˆã†ã«ã‚½ãƒ¼ã‚¹ã”ã¨ã«ãƒ˜ãƒƒãƒ€ã‚’åˆ†é…ã—ã¦ã‚„ã‚‹ã€‚
<code>w3m</code> ã¯é–¢æ•°å®£è¨€ãŒå°‘æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ« <code>proto.h</code>, <code>fm.h</code> ã¨ã‹ã«é›†ä¸­ã—ã¦ã„ã‚‹ã®ã ãŒã€ã„ã£ã±ã„ã‚ã‚‹ã®ã§é›‘ã«ã‚„ã‚‹ã€‚
ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãŒé€šã‚Œã°ã‚ˆã„ã€‚</p>
<p>åˆ†é…ã™ã‚‹ã¨ãã«æœªå®šç¾©ã®å‹ã‚’å‰æ–¹å®£è¨€ã§ã™ã¾ã›ãŸã„ã®ã ã‘ã©ã€ <code>c</code> ã® <code>struct</code> å®šç¾©ãŒã€<code>struct tag</code> ã¨ <code>typedef</code> ã«åˆ†ã‹ã‚Œã¦ã„ã‚‹ã®ãŒã‚„ã£ã‹ã„ã ã£ãŸã€‚</p>
<pre class="code literal-block"><span></span><span class="c1">// C</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">hogeTag</span>
<span class="p">{</span>

<span class="p">}</span> <span class="n">Hoge</span><span class="p">;</span>
</pre>

<pre class="code literal-block"><span></span><span class="kt">void</span> <span class="nf">DoHoge</span><span class="p">(</span><span class="n">Hoge</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>

<span class="c1">// ã«å¯¾ã™ã‚‹å‰æ–¹å®£è¨€ã¯ã€</span>

<span class="k">struct</span> <span class="n">hogeTag</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">hogeTag</span> <span class="n">Hoge</span><span class="p">;</span>
</pre>

<p><code>C</code> ã®çŠ¶æ…‹ã§ã€å‰æ–¹å®£è¨€ã‚’å°å…¥ã§ããšãƒ˜ãƒƒãƒ€ã®åˆ†å‰²ãŒé›£èˆªã€‚
å‹ã”ã¨ã«åˆ¥ã®ãƒ˜ãƒƒãƒ€ã«åˆ†å‰²ã™ã‚‹ã“ã¨ã¯æ–­å¿µã—ã¦ã€
ã»ã¨ã‚“ã©å…¨éƒ¨ã® <code>struct</code> å®šç¾©ã®å…¥ã£ãŸãƒ˜ãƒƒãƒ€ã‚’ <code>fm.h</code> ã‹ã‚‰åˆ†é›¢ã—ã¦ä½œã‚‹ã®ã«ç•™ã‚ãŸã€‚</p>
<h3>DEFUN</h3>
<p><code>w3m</code> ã¯ <code>DEFUN</code> ã§ã‚­ãƒ¼ã‚¢ã‚µã‚¤ãƒ³ã§ãã‚‹é–¢æ•°ã‚’å®šç¾©ã—ã¦ã„ã‚‹ã€‚</p>
<p><a href="w3m/doc-jp/readme.func/">readme.func</a></p>
<p>ä»¥ä¸‹ã®ã‚ˆã†ã«ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãªã©ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒˆãƒªã‚¬ãƒ¼ã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã„ã†ã‚¤ãƒ¡ãƒ¼ã‚¸ã€‚</p>
<pre class="code literal-block"><span></span>Key
    KeyMap
        DEFUN
    Menu
        DEFUN
MouseAction
    ActionMap
        DEFUN
    Menu
        DEFUN
Alarm
    DEFUN
</pre>

<p>ã‚½ãƒ¼ã‚¹ã¯ã€<code>main.c</code> ã¨ <code>menu.c</code> ã« <code>DEFUN</code> ã¨ãã‚Œã®ä½¿ã†è£œåŠ©é–¢æ•°ãŒã¾ã¨ã‚ã¦å®šç¾©ã•ã‚Œã¦ã„ã¦ã€
ãƒ˜ãƒƒãƒ€ã¯ <code>proto.h</code> ã«å…¨éƒ¨å…¥ã‚Œã¨ãªã£ã¦ã„ã‚‹ã€‚</p>
<p>c++ ã§ä¸‹è¨˜ã®ã‚ˆã†ãªãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒãƒ£ã‚’ä½œã£ãŸã€‚</p>
<pre class="code literal-block"><span></span><span class="k">typedef</span> <span class="nf">void</span> <span class="p">(</span><span class="o">*</span><span class="n">Command</span><span class="p">)();</span>
<span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">Command</span><span class="o">&gt;</span> <span class="n">g_commandMap</span><span class="p">;</span>
</pre>

<p>ä½¿ã„æ¨ã¦ã® python ã§é–¢æ•°ã«ç™»éŒ²ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ãŸã€‚</p>
<h2>ç¬¬ï¼’æ®µéš</h2>
<ul>
<li>PODã˜ã‚ƒãªã„å‹ãŒå‹•ãã‚ˆã†ã«ã™ã‚‹<ul>
<li>constructor/destructor</li>
</ul>
</li>
<li>è„±GC<ul>
<li>ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’STLã«ç½®ãæ›ãˆã‚‹</li>
<li>std::string</li>
<li>std::shared_ptr</li>
</ul>
</li>
<li>æ©Ÿèƒ½ã”ã¨ã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–</li>
<li>å†å…¥å¯èƒ½</li>
</ul>
<h3>GC_MALLOC ã‹ã‚‰ gc_cleanup ç¶™æ‰¿ã¸</h3>
<p>boehm-GC ã‚’ <code>c++</code> ã®ã‚¯ãƒ©ã‚¹ã§ä½¿ã†æ–¹æ³•ã‚’èª¿ã¹ãŸã€‚</p>
<p>http://www.namikilab.tuat.ac.jp/~sasada/prog/boehmgc.html#i-0-5</p>
<p><code>w3m</code> ã§ã¯ã€ <code>GC</code> ã‚’å¤šç”¨ã—ã¦ã„ã‚‹ã€‚</p>
<p>ãŠã‚‚ã«ã€</p>
<ul>
<li>struct Str</li>
<li>ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³</li>
<li>struct ã® field</li>
</ul>
<p>ã¨ã„ã†æ„Ÿã˜ã«ã€‚
ã“ã®ã†ã¡ã€ struct ã® field ã§ä½¿ã‚ã‚Œã‚‹ã‚¿ã‚¤ãƒ—ã®å˜ç™ºã® <code>GC_MALLOC</code> ã—ã¦ã„ã‚‹å‹ã‚’ <code>gc_cleanup</code> ç¶™æ‰¿ã«ã—ã¦ã€ <code>new</code> ã§åˆæœŸåŒ–ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚</p>
<ul>
<li>bzero, bcopy, memcpy, sizeof</li>
</ul>
<p>ç­‰ã§ãƒ¡ãƒ¢ãƒªã‚¯ãƒªã‚¢ã—ã¦ã„ã‚‹ã¨ã“ã‚ã«æ³¨æ„ã™ã‚‹ã€‚
ã“ã‚Œã§ã€ãã®å‹ã¯ <code>constructor/destructor</code> ãŒå‹•ãã‚ˆã†ã«ãªã‚Šã€
ãƒ¡ãƒ³ãƒãƒ¼ã« <code>std::string</code> ç­‰ã‚’é…ç½®ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚
ã‚ã¨ã§ã€ <code>gc_cleanup</code> ã‹ã‚‰ <code>std::shared_ptr</code> ã«å¤‰æ›´ã™ã‚‹ã“ã¨ã‚‚è¦–é‡ã«å…¥ã‚Œã¦ã„ã‚‹ã€‚</p>
<h3>GCæ–‡å­—åˆ— Str</h3>
<p>ã‚¢ãƒ—ãƒªå…¨ä½“ã§ä½¿ã‚ã‚Œã¦ã„ã¦ä¸€æŒ™ã«ãªãã™ã“ã¨ã¯ã§ããªã„ã®ã ã‘ã©ã€æ§‹é€ ä½“ã®æœ«ç«¯ã®ãƒ¡ãƒ³ãƒãƒ¼ã‹ã‚‰ <code>std::string</code> ã«å¤‰ãˆã‚‹ã€‚
ã‚ã¨ã€ãŒã‚“ã°ã£ã¦ <code>const char *</code> ã®ç¯„å›²ã‚’å¢—ã‚„ã™ã€‚
<code>libwc</code> ã‹ã‚‰ <code>Str</code> ã‚’å‰¥ãã†ã¨æ€ã£ã¦ã„ãŸã®ã ãŒã€é€†ã« <code>libwc</code> ã« <code>Str</code> ã‚’å°ã˜è¾¼ã‚ã‚‹æ–¹å‘ã«è»Œé“ä¿®æ­£ã€‚
<code>indep.c</code> ã®ä¾¿åˆ©æ–‡å­—åˆ—é–¢æ•°ã‚‚å°‘ã—ãšã¤å¤‰ãˆã¦ãã€‚</p>
<h3>ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’æ¸›ã‚‰ã™</h3>
<p>é–¢æ•°ã®ä¸­ã§ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ã‚‹å ´åˆ(CurrentBufferãªã©)ã€ã“ã‚Œã‚’é–¢æ•°ã®å¼•æ•°çµŒç”±ã¨ã‹ã€ã‚¯ãƒ©ã‚¹ã®ãƒ¡ãƒ³ãƒãƒ¼çµŒç”±ã§ã‚‚ã‚‰ã†ã€‚é¢å€’ã§ã‚‚ Getter ã¨ Setter ã‚’åŒºåˆ¥ã—ã¦ã€ã©ã“ã§å¤‰æ›´ã•ã‚Œã†ã‚‹ã‹ã‚ã‹ã‚Šã‚„ã™ãã™ã‚‹ã€‚
ã‚¯ãƒ©ã‚¹ã®ãƒ¡ãƒ³ãƒãƒ¼ã¯ã€ <code>private</code> åŒ–ã‚’è©¦ã¿ã‚‹ã€‚</p>
<h3>Streamå‡¦ç†</h3>
<p>å¤šåˆ†ã€æœ€é›£é–¢ã® <code>loadGeneralFile</code> é–¢æ•°ã€‚700è¡Œãã‚‰ã„ã ã£ãŸã‹ã€‚
goto ã¨ã‹ longjmp ãŒã‚ã£ã¦ã‚ˆãã‚ã‹ã‚‰ãªã‹ã£ãŸã®ã ãŒã€æ…£ã‚Œã¦ããŸã€‚
<code>http</code>, <code>https</code>, <code>NNTP ?</code>, <code>gopher</code>, <code>ftp</code>, <code>pipe</code> ç­‰ã€<code>http</code> ã®ãƒ—ãƒ­ã‚­ã‚·ãƒ¼ã‚„ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã€ <code>www-auth</code> ãªã©ã‚’ä¸€æ‰‹ã«å‡¦ç†ã—ã¦ã„ã¦å®¹æ˜“ã«æ‰‹ã‚’ä»˜ã‘ã‚‰ã‚Œãªã„ã€‚
ä½•åº¦ã‹æ•´ç†ã—ã‚ˆã†ã¨ã—ã¦æ‚‰ãæ’ƒé€€ã•ã‚ŒãŸã®ã§ã€é›‘ã«ã‚„ã‚‹ã“ã¨ã«ã—ãŸã€‚
æ©Ÿèƒ½ã‚’ <code>http(https)</code> ã«çµã£ã¦ãã‚Œä»¥å¤–ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦ã¨ã«ã‹ãé‡ã‚’æ¸›ã‚‰ã™ã€‚
ãƒ—ãƒ­ã‚­ã‚·ãƒ¼ã¨ã‹ã€ <code>dump</code>, <code>halfload</code> ãªã©ã®ã‚ˆãçŸ¥ã‚‰ãªã„æ©Ÿèƒ½ã‚‚ã©ã‚“ã©ã‚“å‰Šã‚‹ã€‚
ã¨ã—ã¦ãªã‚“ã¨ã‹æ”¹é€ ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ããŸã€‚</p>
<p>ã“ã“ã‚’ <code>HttpClient</code>, <code>LocalFile</code>, <code>PipeReader</code> ã‚ãŸã‚Šã«æ•´ç†ã—ãŸã„ã€‚</p>
<h2>ç¬¬ï¼“æ®µéš</h2>
<p>Tab, Buffer, Line ã®ãƒªãƒ³ã‚¯ãƒªã‚¹ãƒˆã‚’ STL ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«ç½®ãæ›ãˆãŸã€‚</p>
<pre class="code literal-block"><span></span><span class="k">auto</span> <span class="n">buf</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
<span class="n">tab</span><span class="o">-&gt;</span><span class="n">push</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
</pre>

<p>ã¨ã„ã†å½¢ã‚’ç›®æŒ‡ã™ã€‚</p>
<p><code>loadGeneralFile</code> ã‚’è§£ãã»ãã—ã¦ã€ <code>HTTP</code> æ©Ÿèƒ½ã‚’æŠ½å‡ºã€ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã¾ã§å‹•ãã‚ˆã†ã«ã§ããŸã€‚
<code>loadGeneralFile</code> ã¯ã€</p>
<pre class="code literal-block"><span></span>* OpenStream/Send HTTP Request
* HTTP Response
    * 3xx =&gt; Redirect
* content-type ã§åˆ†å²
    * BufferLoader =&gt; Buffer
</pre>

<p>ã¨ã„ã†æ„Ÿã˜ã«æ•´ç†ã§ããã†ã€‚
Httpã¨Bufferãƒ­ãƒ¼ãƒ€ãƒ¼ã‚’å‰¯ä½œç”¨ã®ç„¡ã„é–¢æ•°ã«æ•´ç†ã§ãã‚Œã°å†å…¥å¯èƒ½ãŒè¦‹ãˆã¦ãã‚‹ã€‚
æ—©ã‚ã«åˆ†å²ã•ã›ã¦ã€åˆ†å²ã—ãŸã‚‰åˆæµã—ãªã„ã€‚åŒã˜å‡¦ç†ã¯é–¢æ•°ã§å…±æœ‰ã™ã‚‹ã¨ã„ã†æ–¹å‘æ€§ã§æ•´ç†ã€‚</p>
<p>Buffer ãŒå¤šæ©Ÿèƒ½ãªã®ã§ã€Document, HttpResponse, FileInfo ã¨ã‹ã«åˆ†å‰²ã—ãŸã„ã€‚</p>
<h2>ç¬¬ï¼”æ®µéš</h2>
<p>mainloop ã®å†å®Ÿè£…ã€‚libuv, libevent ç­‰ã‚’æ¤œè¨ã—ã¦ã„ãŸã®ã ã‘ã©ã€ c++ ã¨ã®è¦ªå’Œæ€§ã®é«˜ã„ asio ã‚’ä½¿ã†ã“ã¨ã«ã—ãŸã€‚
<code>tty read (keyboard input)</code>, <code>signal callback (sigint, winresize)</code>, <code>alarm</code> ã®å‰²ã‚Šè¾¼ã¿ã‚’ asio çµŒç”±ã«ã™ã‚‹ã€‚
ã‚¢ãƒ—ãƒªã®çµ‚äº†ã‚’loop ã®çµ‚äº†ã«ã—ã¦ã€è‡ªç„¶ã« destructor ãŒã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚</p>
<h2>ç¬¬ï¼•æ®µéš</h2>
<p>html parse ã‹ã‚‰ term ã¸ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°éƒ¨åˆ†ã®åˆ†è§£ã€‚
ã‚„ã£ã¨è§£èª­ã§ãã¦ï¼‘ãƒ‘ã‚¹ç›®</p>
<ul>
<li>å†…éƒ¨æ–‡å­—ã‚³ãƒ¼ãƒ‰(wtf-8)ã«å¤‰æ›</li>
<li>tokenize</li>
<li>tag ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦å±æ€§å–å¾— =&gt; ãƒ‘ãƒ¼ã‚¹ã«æˆåŠŸã—ãŸã‚‰è¡Œãƒãƒƒãƒ•ã‚¡ã«æ›¸ãæˆ»ã™ã€‚ãƒ•ã‚©ãƒ¼ãƒ ã®æƒ…å ±ã‚’è“„ç©ã™ã‚‹ã€‚ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ</li>
</ul>
<p>çµæœã¨ã—ã¦ã€è¡Œã®ãƒªã‚¹ãƒˆã¨ã€ãƒ•ã‚©ãƒ¼ãƒ æƒ…å ±ã‚’å¾—ã‚‹ã€‚</p>
<p>ï¼’ãƒ‘ã‚¹ç›®</p>
<ul>
<li>è¡Œã®ãƒªã‚¹ãƒˆã‚’å†åº¦ãƒ‘ãƒ¼ã‚¹</li>
<li>éã‚¿ã‚°éƒ¨åˆ†ã‚’Bufferã«å‡ºåŠ›</li>
<li>Aã‚¿ã‚°ã‚„ãƒ•ã‚©ãƒ¼ãƒ ã‚’ Anchor ãªã©ã«å‡ºåŠ›</li>
</ul>
<p>ã¨ã„ã†æ„Ÿã˜ã ã£ãŸã€‚
ï¼‘ãƒ‘ã‚¹ç›®ã§ html åŒ–ã™ã‚‹ã¨ãã«çŸ¥ã‚‰ãªã„å±æ€§ã‚’æ¨ã¦ãŸã‚Šã€å†…éƒ¨å±æ€§ã‚’è¿½åŠ ã—ãŸã‚Šã—ã¦ã„ã‚‹æ§˜å­ã€‚
ã“ã®ã€å†…éƒ¨å±æ€§ãŒã‚ˆãã‚ã‹ã‚‰ãªãã¦é›£ã—ã„ã€‚</p>
<h2>æ–‡å­—ã‚³ãƒ¼ãƒ‰</h2>
<p><code>content-charset</code> =&gt; <code>wtf</code> =&gt; <code>DisplayCharset</code> ã¨æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›ã—ã¦å‹•ä½œã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã£ãŸã€‚
è©¦ã—ã«ã€<code>utf-8</code> ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã£ã¦ã„ã‚‹ <code>html</code> ã§ <code>wtf</code> å¤‰æ›ã‚’é£›ã°ã—ã¦ã¿ãŸã¨ã“ã‚è¡¨ç¤ºãŒå£Šã‚ŒãŸã€‚
<code>wtf</code> ã¯ <code>utf-8</code> ã¨äº’æ›æ€§ãŒãªã„ã‚‰ã—ã„ã€‚
http://simonsapin.github.io/wtf-8/
ãªã®ã‹ã¨æ€ã£ãŸã®ã ãŒã€é•ã†ç‹¬è‡ªå½¢å¼ã‹ã‚‚ã—ã‚Œãªã„ã€‚</p>
<p>w3m ã¯ã€ã“ã® <code>wtf</code> ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã§ã€html ã‚¿ã‚°ã®ãƒ‘ãƒ¼ã‚¹ã€æ–‡å­—ã®ãƒã‚¤ãƒˆå¹…ã®åˆ¤å®šã€æ–‡å­—ã®ã‚«ãƒ©ãƒ å¹…ã®åˆ¤å®šã‚’ã—ã¦ã„ã‚‹ã®ã ãŒã€
<code>utf-8</code> ã§ã¯ã€æ–‡å­—ã®ãƒã‚¤ãƒˆå¹…ã€ã‚«ãƒ©ãƒ å¹…ã®åˆ¤å®šãŒç‹‚ã†ã€‚
ã¨ã„ã†ã“ã¨ã§ã€ <code>utf-8</code> ã§ã®ãƒã‚¤ãƒˆå¹…åˆ¤å®šã‚’è‡ªä½œã—ã¦ <code>wcwidth</code> ã‚’çµ„ã¿åˆã‚ã›ã¦ã¿ãŸã€‚
<code>*#12345;</code> å½¢å¼ã® <code>unicode</code> åŸ‹ã‚è¾¼ã¿ã«å¯¾å¿œã™ã‚‹ãŸã‚ã«ã€è¿½åŠ ã§ <code>unicode</code> =&gt; <code>utf-8</code> å¤‰æ›ã‚‚ä½œã£ãŸã€‚
æ­£ã—ãè¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ããŸã€‚</p>
<p>ã¨ã„ã†ã“ã¨ã§ã€<code>euc-jp</code> ã¨ <code>shift-jis</code> ã¨ <code>iso-2022-jp</code> ã‹ã‚‰ <code>utf-8</code> ã¸ã®å¤‰æ›ã‚’ä½œã‚Œã°æ—¥æœ¬èªã¯å¯¾å¿œã§ããã†ã€‚
<code>std::string_view</code>, <code>char32_t</code>, <code>char8_t</code> ã‚ãŸã‚Šã®æ–°ã—ã„å‹ã‚’ä½¿ã£ãŸ <code>\0</code> çµ‚ç«¯ã«é ¼ã‚‰ãªã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½œã£ã¦ã¿ã‚‹ã€‚</p>
<h2>ãƒ¡ãƒ¢</h2>
<h3>ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«åˆ†å‰²</h3>
<p>æ©Ÿèƒ½ã”ã¨ã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«åˆ†å‰²ã™ã‚‹ã€‚</p>
<ul>
<li>UI(frontend)<ul>
<li>Term<ul>
<li>ä½ãƒ¬ãƒ™ãƒ«æç”»<ul>
<li>termcap ã®é–¢æ•°ã‚’ç›´æ¥å‘¼ã¶ã€‚curses ã®è‡ªå‰å®Ÿè£…çš„ãª</li>
<li>ãƒãƒ«ãƒãƒã‚¤ãƒˆã€ãƒãƒ«ãƒã‚«ãƒ©ãƒ ã®æ–‡å­—åˆ—ã¨å¯†æ¥ã«é–¢é€£ã—ã¦ã„ã¦ libwc ã¨ä¸å¯åˆ†</li>
</ul>
</li>
<li>ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›</li>
<li>ãƒã‚¦ã‚¹å…¥åŠ›</li>
<li>ãƒªã‚µã‚¤ã‚ºã‚¤ãƒ™ãƒ³ãƒˆ</li>
<li>SIGNALãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°<ul>
<li>SIGINT =&gt; longjmp ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«å‡¦ç†ã‚’å®Ÿç¾ã—ã¦ã„ã‚‹ã€‚c++ ã®ãƒ‡ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¨ã‹ã¾ãšãã†</li>
</ul>
</li>
</ul>
</li>
<li>é«˜ãƒ¬ãƒ™ãƒ«æç”»<ul>
<li>Lineã®æ§‹ç¯‰(byte ã”ã¨ã« char ã¨ Lineprop ãŒãƒšã‚¢ã«ãªã‚‹)</li>
</ul>
</li>
<li>Tab</li>
<li>Buffer</li>
<li>Message</li>
<li>Menu</li>
<li>Keymap</li>
<li>LineInput<ul>
<li>SearchKey</li>
<li>History</li>
</ul>
</li>
</ul>
</li>
<li>
<p>IO(transport)</p>
<ul>
<li>IStream<ul>
<li>union =&gt; class polymorphismåŒ–</li>
<li>file descriptor</li>
<li>FILE*</li>
<li>ssl</li>
<li>memory</li>
<li>Compression</li>
</ul>
</li>
<li>LocalCGI</li>
</ul>
</li>
<li>
<p>http</p>
<ul>
<li>HttpSession<ul>
<li>HttpRequest</li>
<li>HttpResponse</li>
</ul>
</li>
<li>cookie</li>
<li>redirect</li>
<li>referer</li>
<li>https</li>
<li>ftp</li>
<li>URL</li>
</ul>
</li>
<li>
<p>HTML</p>
<ul>
<li>HTMLtagproc1</li>
<li>HTMLlineproc2body<ul>
<li>process_form</li>
<li>process_form_int</li>
</ul>
</li>
<li>form</li>
<li>table</li>
<li>frame</li>
<li>term rendering</li>
</ul>
</li>
<li>
<p>String</p>
<ul>
<li>æ–‡å­—ã‚³ãƒ¼ãƒ‰</li>
<li>quote</li>
<li>url escape</li>
<li>html escape</li>
<li>html entity</li>
<li>char_util<ul>
<li>myctype</li>
</ul>
</li>
<li>string_view_util<ul>
<li>strip</li>
</ul>
</li>
<li>string_util<ul>
<li>malloc</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>ãƒªãƒ³ã‚¯ã‚’ãŸã©ã‚‹(followLink)</h3>
<p>followA();
loadLink();
loadGeneralFile();</p>
<p>cmd_loadURL();
loadGeneralFile();</p>
<p>cmd_loadURL();
loadGeneralFile();</p>
<h3>æç”»ã™ã‚‹</h3>
<p>displayBuffer
redrawBuffer
redrawNLine</p>
<h3>keyå…¥åŠ›</h3>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2020/hugo-reinstall/" class="u-url">Hugoå†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2020/hugo-reinstall/" rel="bookmark">
            <time class="published dt-published" datetime="2020-07-25T13:50:27Z" itemprop="datePublished" title="2020-07-25 13:50">2020-07-25 13:50</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2020/hugo-reinstall/#disqus_thread" data-disqus-identifier="cache/content/posts/2020/hugo-reinstall.html">ã‚³ãƒ¡ãƒ³ãƒˆ</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>å†ã³ã‚µã‚¤ãƒˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ <code>hugo</code> ã«æˆ»ã—ãŸã€‚
ä»Šåº¦ã¯ã€ <code>travis-ci</code> ã®è‡ªå‹•ãƒ“ãƒ«ãƒ‰ã‚’å…¥ã‚ŒãŸã—ä¸‡å…¨ã€‚
è»½ããƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¸€å¼ã‚’ä½œã£ã¦ã¿ãŸã‘ã©ã€ä»Šå›ã¯å‰ã‚ˆã‚Šã‚‚ã‚ˆãç†è§£ã§ããŸã€‚
<code>partial</code>, <code>baseof</code> ã«åŠ ãˆã¦ <code>.Render</code> ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ãŸãã€‚
å¤‰æ•°ä»˜ãã®éƒ¨å“ã«åˆ†è§£ã§ãã¦ã€ã†ã¾ãå¼•æ•°ã«ãªã‚‹å¤‰æ•°ã‚’å…±æœ‰ã§ãã‚Œã°éƒ¨å“ã‚’å…±æœ‰ã§ãã‚‹ã€‚</p>
<p>ã¨ã‚Šã‚ãˆãšæ§‹é€ ã‚’ç†è§£ã™ã‚‹ãŸã‚ã«ãƒ‡ãƒãƒƒã‚°è‰²ãªã®ã§æ•´ãˆãŸã„ã¨ã“ã‚ã ãŒã€ãã®ã†ã¡ã‚„ã‚‹ã€‚
Webã‚‚ã®ã¯èª¿ã¹ã‚‹ç¯„å›²ãŒåºƒã™ãã¦é–¢å¿ƒãŒæ‹¡æ•£ã—ã¦ã—ã¾ã£ã¦ã€æ°—åŠ›ãŒä¿ãŸãªã„ã‚“ã‚ˆã­ã€‚</p>
<ul>
<li>github pages</li>
<li>hugo<ul>
<li>layout</li>
</ul>
</li>
<li>css<ul>
<li>scss</li>
<li>css3<ul>
<li>grid, flexbox</li>
</ul>
</li>
<li>css reset</li>
</ul>
</li>
<li>font<ul>
<li>icon</li>
</ul>
</li>
</ul>
<p>ãªã©ã®æ–­ç‰‡ã‚’é›†ã‚ã¦ããŸã€‚
ãã†ã„ãˆã° <code>Gatsby.js</code> ã«ã—ã‚ˆã†ã‹ã¨è€ƒãˆã¦ã„ãŸã®ã ã‘ã©ã€ç„¡é›£ã«ã‚ã‚‹ç¨‹åº¦çŸ¥ã£ã¦ã„ã‚‹ <code>hugo</code> ã«ã—ãŸã€‚
Webæ–¹é¢ã¯ä»˜ã‘ç„¼åˆƒãªã®ã§ã€ã‚ã¾ã‚Šå¿…è¦ãªçŸ¥è­˜ãŒå¢—ãˆã™ãã¦ã‚‚æ‰‹ã«è² ãˆãªã„ã€‚
ä»Šå›ã® hugo ä½œæ¥­ã§ã¯ <code>node.js</code> ã«ã¯è§¦ã‚Œãšã«ã™ã‚“ã§ã„ã‚‹ã®ã§ã€ã„ã„å¡©æ¢…ã¨ã„ã†ã‚‚ã®ã§ã‚ã‚‹ã€‚</p>
<p>ä¸€å¿œéå»è¨˜äº‹ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã¿ãŸãŒã€é›‘å¤šãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã§ãã¦ã„ã‚‹ã®ã§ã‚ã¾ã‚Šäº’æ›æ€§ãŒãªã‹ã£ãŸã€‚
<code>frontmatter</code> ã ã‘ç½®æ›ã¨ã‹ã§æ•´ãˆã¦ã¿ãŸã€‚</p>
<p>éå»è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã¿ãŸã¨ã“ã‚ã€</p>
<ul>
<li>hatena dialy</li>
<li>2012-11 tdiary(heroku)</li>
<li>2013-02 octopress</li>
<li>2013-10 tinkerer</li>
<li>2015-11 gulp</li>
<li>2017-02 hugo</li>
<li>2018 è‡ªåˆ†ã¨ã“ã§ç®¡ç†ã™ã‚‹ã®ãŒã‚ã‚“ã©ãã•ãã¦ Qiitaã¨ã‹ã«</li>
<li>2019-04 è‡ªä½œã®pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆ</li>
<li>2019-08 wyam</li>
<li>2019 è‡ªåˆ†ã¨ã“ã§ç®¡ç†ã™ã‚‹ã®ãŒã‚ã‚“ã©ãã•ãã¦ Qiitaã¨ã‹ã«</li>
<li>2020-07 hugo å¾©æ´»</li>
</ul>
<p>ã¨ã„ã†çµŒç·¯ã‚’ãŸã©ã£ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã£ãŸã€‚
ã—ã°ã‚‰ãã€hugo ã§ã„ã£ã¦ã¿ã‚ˆã†ã€‚</p>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2017/08/vcpkg_chcp65001/" class="u-url">vcpkgã§chcp 65001ãŒå¿…è¦ãªä»¶</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2017/08/vcpkg_chcp65001/" rel="bookmark">
            <time class="published dt-published" datetime="2017-08-31T00:00:00Z" itemprop="datePublished" title="2017-08-31 00:00">2017-08-31 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2017/08/vcpkg_chcp65001/#disqus_thread" data-disqus-identifier="cache/content/posts/2017/08/vcpkg_chcp65001.html">ã‚³ãƒ¡ãƒ³ãƒˆ</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>ã†ã¡ã®ç’°å¢ƒã§ã¯å¿…è¦ã€‚éè‹±èªWindowsã§æ•£è¦‹ã•ã‚Œã‚‹ã€‚ã‚ã—ã‚‚ã€ãƒ­ã‚·ã‚¢ï¼Ÿã®äººã®æ›¸ãè¾¼ã¿ã§åˆ†ã‹ã£ãŸã€‚</p>
<p><code>buildtrees/XXX/config-x86-windows-rel-err.log</code> ã«ä»¥ä¸‹ã®ã‚ˆã†ãª <code>rules.ninja</code> ã‚’å«ã‚€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã¯ã“ã‚Œã€‚</p>
<pre class="code literal-block"><span></span>CMake Error at D:/vcpkg/downloads/cmake-3.9.0-win32-x86/share/cmake-3.9/Modules/CMakeTestCCompiler.cmake:51 <span class="o">(</span>message<span class="o">)</span>:
  The C compiler <span class="s2">"C:/Program Files (x86)/Microsoft Visual</span>
<span class="s2">  Studio/2017/Community/VC/Tools/MSVC/14.10.25017/bin/HostX64/x86/cl.exe"</span> is
  not able to compile a simple <span class="nb">test</span> program.

  It fails with the following output:

   Change Dir: D:/vcpkg/buildtrees/opensubdiv/x86-windows-rel/CMakeFiles/CMakeTmp



  Run Build Command:<span class="s2">"D:/vcpkg/downloads/tools/ninja/ninja-1.7.2/ninja.exe"</span>
  <span class="s2">"cmTC_f5b9f"</span>

  ninja: error: build.ninja:30: loading <span class="s1">'rules.ninja'</span>:
  æŒ‡å®šã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚






  include rules.ninja



                     ^ near here






  CMake will not be able to correctly generate this project.
Call Stack <span class="o">(</span>most recent call first<span class="o">)</span>:
  CMakeLists.txt:25 <span class="o">(</span>project<span class="o">)</span>
</pre>

<p>å¯¾å‡¦æ³•ã¯ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’utf-8ã«ã™ã‚‹ã“ã¨ã€‚</p>
<p><code>&gt; chcp 65001</code></p>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2017/08/vcpkg_opensubdiv/" class="u-url">vcpkgã®OpenSubdivãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½œã£ã¦ã¿ã‚‹</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2017/08/vcpkg_opensubdiv/" rel="bookmark">
            <time class="published dt-published" datetime="2017-08-31T00:00:00Z" itemprop="datePublished" title="2017-08-31 00:00">2017-08-31 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2017/08/vcpkg_opensubdiv/#disqus_thread" data-disqus-identifier="cache/content/posts/2017/08/vcpkg_opensubdiv.html">ã‚³ãƒ¡ãƒ³ãƒˆ</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>CEDEC2017ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’èã„ã¦USDãƒ“ãƒ«ãƒ‰ã™ã‚‹æ°—ãŒæˆ»ã£ã¦ããŸã€‚éƒ¨å“ã®ã²ã¨ã¤ã€OpenSubdivã®vcpkgç‰ˆãƒ“ãƒ«ãƒ‰ã«å–ã‚Šçµ„ã‚“ã§ã¿ã‚‹ã€‚</p>
<p>packageã‚’ä½œã‚‹
POWERSHELLã‚’é–‹ã„ã¦vcpkgãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã€‚</p>
<pre class="code literal-block"><span></span>PS&gt; .<span class="se">\v</span>cpkg.exe create opensubdiv https://github.com/PixarAnimationStudios/OpenSubdiv/archive/v3_3_0.tar.gz
-- Generated portfile: vcpkg<span class="se">\p</span>orts<span class="se">\o</span>pensubdiv<span class="se">\p</span>ortfile.cmake
-- Generated CONTROL: vcpkg<span class="se">\p</span>orts<span class="se">\o</span>pensubdiv<span class="se">\C</span>ONTROL
-- To launch an editor <span class="k">for</span> these new files, run
--     .<span class="se">\v</span>cpkg edit opensubdiv

ports/opensubdiv/CONTROL
Source: opensubdiv
Version: <span class="m">3</span>.3.0
Description: An Open-Source subdivision surface library.
Build-Depends: tbb, glew, ptex
</pre>

<p><code>ports/opensubdiv/portfile.cmake</code></p>
<p>æœ€ä½é™ã€å±•é–‹ã™ã‚‹ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã€‚</p>
<p><code>set(SOURCE_PATH ${CURRENT_BUILDTREES_DIR}/src/OpenSubdiv-3_3_0)</code></p>
<p>ãƒ“ãƒ«ãƒ‰ã—ã¦ã¿ã‚‹
ã•ã™ãŒã«ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€‚vcpkg ã® <code>buildtree/opensubdiv</code> ã«æ½œã£ã¦ãƒ“ãƒ«ãƒ‰æ‰‹é †ã‚’èª¿ã¹ã¦ã¿ã‚‹ã€‚
æ‰‹å‹•ãƒ“ãƒ«ãƒ‰
OpenSubdivã®ãƒ“ãƒ«ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã¯CMakeã ã£ãŸã€‚
æ—©é€Ÿã€CmakeGUIã§ã‚„ã£ã¦ã¿ã‚‹ã€‚
<code>CMAKE_INSTALL_PREFIX=VCPKG_DIR/installed/x64-windows</code> ã ã‘è¨­å®šã—ã¦æ§˜å­ã‚’è¦‹ã‚‹ã€‚</p>
<p>CUDAã¨ã‹OpenCLã¨ã‹ãã£ã¡æ–¹é¢ã®ä¾å­˜ãŒã‚ã‚‹æ§˜å­ã€‚
NO_CUDAã¨NO_OPENCLã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ã¿ã‚‹ã€‚
ã‚ã¨NO_DOCã‚‚ã€‚
Solutionã‚’Generateã—ã¦ãƒ“ãƒ«ãƒ‰ã—ã¦ã¿ã‚‹ã€‚
Debugç‰ˆã ã‘tbb_debug.libãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã€‚
DEBUGç‰ˆã®FIND_PACKAGEã®ä¿®æ­£</p>
<pre class="code literal-block"><span></span><span class="err">OpenSubdiv-3_3_0/cmake/FindTBB.cmake</span>
    <span class="nb">find_library</span><span class="p">(</span><span class="s">TBB_</span><span class="o">${</span><span class="nv">TBB_LIB</span><span class="o">}</span><span class="s">_LIBRARY</span>
        <span class="s">NAMES</span>
            <span class="o">${</span><span class="nv">TBB_LIB</span><span class="o">}</span>
        <span class="s">HINTS</span>
            <span class="s2">"${TBB_LOCATION}/lib"</span>
            <span class="s2">"${TBB_LOCATION}/bin"</span>
            <span class="s2">"$ENV{TBB_LOCATION}/lib"</span>
            <span class="s2">"$ENV{TBB_LOCATION}/bin"</span>
            <span class="s2">"$ENV{PROGRAMFILES}/TBB/lib"</span>
            <span class="s">/usr/lib</span>
            <span class="s">/usr/lib/w32api</span>
            <span class="s">/usr/local/lib</span>
            <span class="s">/usr/X11R6/lib</span>
        <span class="s">PATH_SUFFIXES</span>
            <span class="s2">"${TBB_LIB_ARCH}"</span>
            <span class="s2">"${TBB_LIB_ARCH}/${TBB_COMPILER}"</span>
            <span class="s2">"${TBB_LIB_ARCH}/gcc4.4"</span>
            <span class="s2">"${TBB_LIB_ARCH}/gcc4.1"</span>
        <span class="s">DOC</span> <span class="s2">"Intel's Threading Building Blocks library"</span><span class="p">)</span>
</pre>

<p>vcpkgã§ã¯ã€<code>VCPKG_DIR/installed/x64-windows/debug/lib/tbb_debug.lib</code> ã«ã‚ã‚‹ã®ã§è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã­ã€‚
<code>TBB_LOCATION=VCPKG_DIR/installed/x64-windows/debug</code> ã‚’æŒ‡å®šã—ãŸã‚‰ã†ã¾ãã„ã£ãŸã€‚</p>
<p>portfile.cmakeã«åæ˜ 
ports/opensubdiv/portfile.cmake
ã“ã†ãªã£ãŸã€‚</p>
<pre class="code literal-block"><span></span><span class="nb">vcpkg_configure_cmake</span><span class="p">(</span>
    <span class="s">SOURCE_PATH</span> <span class="o">${</span><span class="nv">SOURCE_PATH</span><span class="o">}</span>
    <span class="c">#PREFER_NINJA # Disable this option if project cannot be built with Ninja</span>
    <span class="s">OPTIONS</span>
        <span class="c">#-DNO_LIB=1</span>
        <span class="s">-DNO_CUDA=1</span>
        <span class="s">-DNO_DOC=1</span>
        <span class="s">-DNO_OPENCL=1</span>
        <span class="s">-DNO_OPENGL=1</span>
        <span class="s">-DNO_METAL=1</span>
        <span class="s">-DNO_DX=1</span>
        <span class="c">#-DNO_OMP=1</span>
        <span class="s">-DNO_TESTS=1</span>
        <span class="s">-DNO_EXAMPLES=1</span>
        <span class="s">-DNO_TUTORIALS=1</span>
        <span class="s">-DNO_REGRESSION=1</span>
        <span class="s">-DNO_GLTESTS=1</span>
        <span class="c"># for tbb_debug.lib</span>
        <span class="s">-DTBB_LOCATION=</span><span class="o">${</span><span class="nv">CURRENT_INSTALLED_DIR</span><span class="o">}</span><span class="s">/debug</span>
    <span class="c"># OPTIONS_RELEASE -DOPTIMIZE=1</span>
    <span class="c"># OPTIONS_DEBUG -DDEBUGGABLE=1</span>
<span class="p">)</span>
</pre>

<p>package
VCPKG_DIR/packages/opensubdiv_x86-windows
packageã®èª¿æ•´
ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æŒ‡ç¤ºã«å¾“ã£ã¦ã€‚</p>
<p>```ports/opensubdiv/portfile.cmake
vcpkg_install_cmake()
vcpkg_copy_pdbs()</p>
<p>file(REMOVE_RECURSE ${CURRENT_PACKAGES_DIR}/debug/include)</p>
<h2>Handle copyright</h2>
<p>file(COPY ${CURRENT_BUILDTREES_DIR}/src/OpenSubdiv-3_3_0/LICENSE.txt DESTINATION ${CURRENT_PACKAGES_DIR}/share/opensubdiv)
file(RENAME ${CURRENT_PACKAGES_DIR}/share/opensubdiv/LICENSE.txt ${CURRENT_PACKAGES_DIR}/share/opensubdiv/copyright)</p>
<pre class="code literal-block"><span></span>ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ãŸã€‚

```shell
+---debug
|   \---lib
|           osdCPU.lib
|
+---include
|   \---opensubdiv
|       |   version.h
|       |
|       +---far
|       |       error.h
|       |       patchDescriptor.h
|       |       patchMap.h
|       |       patchParam.h
|       |       patchTable.h
|       |       patchTableFactory.h
|       |       primvarRefiner.h
|       |       ptexIndices.h
|       |       stencilTable.h
|       |       stencilTableFactory.h
|       |       topologyDescriptor.h
|       |       topologyLevel.h
|       |       topologyRefiner.h
|       |       topologyRefinerFactory.h
|       |       types.h
|       |
|       +---hbr
|       |       allocator.h
|       |       bilinear.h
|       |       catmark.h
|       |       cornerEdit.h
|       |       creaseEdit.h
|       |       face.h
|       |       faceEdit.h
|       |       fvarData.h
|       |       fvarEdit.h
|       |       halfedge.h
|       |       hierarchicalEdit.h
|       |       holeEdit.h
|       |       loop.h
|       |       mesh.h
|       |       subdivision.h
|       |       vertex.h
|       |       vertexEdit.h
|       |
|       +---osd
|       |       bufferDescriptor.h
|       |       cpuEvaluator.h
|       |       cpuPatchTable.h
|       |       cpuVertexBuffer.h
|       |       mesh.h
|       |       nonCopyable.h
|       |       ompEvaluator.h
|       |       ompKernel.h
|       |       opengl.h
|       |       tbbEvaluator.h
|       |       tbbKernel.h
|       |       types.h
|       |
|       +---sdc
|       |       bilinearScheme.h
|       |       catmarkScheme.h
|       |       crease.h
|       |       loopScheme.h
|       |       options.h
|       |       scheme.h
|       |       types.h
|       |
|       \---vtr
|               array.h
|               componentInterfaces.h
|               fvarLevel.h
|               fvarRefinement.h
|               level.h
|               refinement.h
|               sparseSelector.h
|               stackBuffer.h
|               types.h
|
+---lib
|       osdCPU.lib
|
\---share
    \---opensubdiv
            copyright
</pre>

<p>OpenSubdivã«ã¯dllã®ãƒ“ãƒ«ãƒ‰ã¯ç„¡ã„ã¿ãŸã„ã€‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ§‹æˆã‚‚template classã‚’ä¸»ä½“ã¨ã™ã‚‹ã‚‚ã®ã®ã‚ˆã†ã ã€‚</p>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2017/08/mediasink_use_dxva/" class="u-url">MediaSinkã§DXVA</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2017/08/mediasink_use_dxva/" rel="bookmark">
            <time class="published dt-published" datetime="2017-08-28T00:00:00Z" itemprop="datePublished" title="2017-08-28 00:00">2017-08-28 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2017/08/mediasink_use_dxva/#disqus_thread" data-disqus-identifier="cache/content/posts/2017/08/mediasink_use_dxva.html">ã‚³ãƒ¡ãƒ³ãƒˆ</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>MediaSinkã§DXVAã‚’ä½¿ã†ã«ã¯ã€‚</p>
<p>https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DX11VideoRenderer</p>
<p>è§£èª­ã®å¾ŒåŠã€‚
DXVAãŒä½•ã‹ã¨ã„ã†ã“ã¨ã«ã¤ã„ã¦ã¯ã¼ã‚“ã‚„ã‚Šã¨ã—ã¦ã„ã‚‹ã®ã ã‘ã‚Œã©ã€VideoSampleã®ãƒãƒƒãƒ•ã‚¡ãƒ¼ã«D3Dã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’ä½¿ã†ã¨ã„ã†ã“ã¨ã½ã„ã€‚</p>
<p>DirectX Surface Buffer</p>
<p>ã¨ã„ã†ã“ã¨ã¯Pipelineã®ã©ã“ã‹ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§CPUä¸Šã®bitmapã‚’CreateTextureã—ã¦GPUã«ç§»å‹•ã™ã‚‹ã®ã ã‘ã©ã€Decoderãªã‚ŠRendererãªã‚Šã®ãªã‚‹ã¹ãä¸Šæµã§GPUã«ä¸Šã’ãŸæ–¹ãŒã†ã‚Œã—ã„ã¨ã„ã†è©±ã€‚
ID3D11Deviceã‚’MediaSessionã«ä¾›çµ¦ã™ã‚‹
Pipelineã§ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’ã‚„ã‚Šã¨ã‚Šã™ã‚‹ã®ã ã‹ã‚‰ãƒ‡ãƒã‚¤ã‚¹ã‚’å…±æœ‰ã—ã¾ã—ã‚‡ã†ã¨ã€‚MediaSessionã®å ´åˆã¯ã€ãƒ¬ãƒ³ãƒ€ãƒ©ãŒãƒ‡ãƒã‚¤ã‚¹ã‚’ä½œæˆã—ã¦IMFDXGIDeviceManagerã‚’å…¬é–‹ã™ã‚‹ã€‚
å…¬é–‹ã™ã‚‹ã®ã¯IMFGetServiceã‚’é€šã—ã¦ã½ã„ã€‚
ã“ã®è¾ºã€‚
HRESULT DX11VideoRenderer::CMediaSink::GetService(__RPC__in REFGUID guidService, __RPC__in REFIID riid, __RPC__deref_out_opt LPVOID* ppvObject)
{
    HRESULT hr = S_OK;</p>
<pre class="code literal-block"><span></span>if (guidService == MF_RATE_CONTROL_SERVICE)
{
    hr = QueryInterface(riid, ppvObject);
}
else if (guidService == MR_VIDEO_RENDER_SERVICE)
{
    hr = m_pPresenter-&gt;QueryInterface(riid, ppvObject);
}
else if (guidService == MR_VIDEO_ACCELERATION_SERVICE)
{
    // ã“ã“ã‹ã‚‰IMFDXGIDeviceManagerã‚’å¾—ã‚‹
    hr = m_pPresenter-&gt;GetService(guidService, riid, ppvObject);
}
else
{
    hr = MF_E_UNSUPPORTED_SERVICE;
}

return hr;
</pre>

<p>}</p>
<p>å®Ÿé¨“
ã¾ã IMFGetServiceã‚’å®Ÿè£…ã—ã¦ã„ãªã„VideoRendererã§ã€
ProcessSampleã«å…¥ã£ã¦ãã‚‹IMFSampleã‹ã‚‰IMFDXGIBufferãŒå–å¾—ã§ãã‚‹ã‹è©¦ã—ã¦ã¿ã‚ˆã†ã€‚
DWORD cBuffers = 0;
auto hr = pSample-&gt;GetBufferCount(&amp;cBuffers);
if (FAILED(hr))
{
    return hr;
}</p>
<p>Microsoft::WRL::ComPtr<imfmediabuffer> pBuffer;
if (1 == cBuffers)
{
    hr = pSample-&gt;GetBufferByIndex(0, &amp;pBuffer);
}
else
{
    hr = pSample-&gt;ConvertToContiguousBuffer(&amp;pBuffer);
}
if (FAILED(hr))
{
    return hr;
}</imfmediabuffer></p>
<p>Microsoft::WRL::ComPtr<imfdxgibuffer> pDXGIBuffer;
hr = pBuffer.As(&amp;pDXGIBuffer);
if (FAILED(hr))
{
    // ã“ã“ã«æ¥ãŸ
    return hr;
}</imfdxgibuffer></p>
<p>Microsoft::WRL::ComPtr<id3d11texture2d> pTexture2D;
hr = pDXGIBuffer-&gt;GetResource(IID_PPV_ARGS(&amp;pTexture2D));
if (FAILED(hr))
{
    return hr;
}</id3d11texture2d></p>
<p>å®Ÿé¨“ï¼’
StreamSinkã«IMFGetServiceã‚’å®Ÿè£…ã—ãŸã€‚
// IMFGetService
STDMETHODIMP GetService(__RPC__in REFGUID guidService, __RPC__in REFIID riid, __RPC__deref_out_opt LPVOID* ppvObject)override
{
    HRESULT hr = S_OK;</p>
<pre class="code literal-block"><span></span>if (guidService == MR_VIDEO_ACCELERATION_SERVICE)
{
    if (riid == __uuidof(IMFDXGIDeviceManager))
    {
        if (NULL != m_pDXGIManager)
        {
            *ppvObject = (void*) static_cast&lt;IUnknown*&gt;(m_pDXGIManager);
            ((IUnknown*)*ppvObject)-&gt;AddRef();
        }
        else
        {
            hr = E_NOINTERFACE;
        }
    }
    else
    {
        hr = E_NOINTERFACE;
    }
}
else
{
    hr = MF_E_UNSUPPORTED_SERVICE;
}

return hr;
</pre>

<p>}</p>
<p>IMFSampleã‹ã‚‰ID3D11Texture2Dã‚’å–å¾—ã§ããŸã€‚
ä¸ŠæµãŒã€DXVAåŒ–ã•ã‚Œã¦Sampleã®ãƒãƒƒãƒ•ã‚¡ãŒãƒ†ã‚¯ã‚¹ãƒãƒ£ã«ãªã£ãŸã€‚
ã©ã‚“ãªãƒ†ã‚¯ã‚¹ãƒãƒ£ãªã®ã‹
ArraySize = 13
Format = DXGI_FORMAT_NV12</p>
<p>ä¸­èº«ãŒã‚ˆãã‚ã‹ã‚‰ã¬ã€‚
Decodeã•ã‚ŒãŸyuvãƒ•ãƒ¬ãƒ¼ãƒ ã‚’Swapchainã«ã‚³ãƒ”ãƒ¼ã™ã‚‹</p>
<p>deinterlace
YUV To RGB
ã‚µã‚¤ã‚ºèª¿æ•´</p>
<p>ç­‰ã‚’ã—ã¦ãƒ‡ã‚³ãƒ¼ãƒ‰æ¸ˆã¿ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’RGBç”»åƒã«ã™ã‚‹å·¥ç¨‹ã€‚
ï¼’ç¨®é¡ã®å®Ÿè£…ãŒã‚ã‚‹ã€‚</p>
<p>https://github.com/Microsoft/Windows-classic-samples/blob/master/Samples/DX11VideoRenderer/cpp/Presenter.cpp</p>
<p>ã®ä»¥ä¸‹ã®éƒ¨åˆ†ã€‚
if (m_useXVP)
{
    BOOL bInputFrameUsed = FALSE;</p>
<pre class="code literal-block"><span></span>hr = ProcessFrameUsingXVP( pCurrentType, pSample, pTexture2D, rcDest, ppOutputSample, &amp;bInputFrameUsed );

if (SUCCEEDED(hr) &amp;&amp; !bInputFrameUsed)
{
    *pbProcessAgain = TRUE;
}
</pre>

<p>}
else
{
    hr = ProcessFrameUsingD3D11( pTexture2D, pEVTexture2D, dwViewIndex, dwEVViewIndex, rcDest, *punInterlaceMode, ppOutputSample );</p>
<pre class="code literal-block"><span></span>// çœç•¥
</pre>

<p>}</p>
<p>ã©ã¡ã‚‰ã§ã‚‚ã ã„ãŸã„åŒã˜å‹•ãã«ãªã‚‹ã¨æ€ã†ã€‚
ProcessFrameUsingXVP</p>
<p>Video Processor MFT</p>
<p>åˆæœŸåŒ–æ™‚ã«IDXGIDeviceManagerã‚’ç›´æ¥æ¸¡ã—ã¦DXVAã‚’æœ‰åŠ¹ã«ã—ã¦ã„ã‚‹ã€‚
hr = CoCreateInstance(CLSID_VideoProcessorMFT, nullptr, CLSCTX_INPROC_SERVER, IID_IMFTransform, (void**)&amp;m_pXVP);
if (FAILED(hr))
{
    break;
}</p>
<p>// MFTã«DirectXã‚’æ¸¡ã™
hr = m_pXVP-&gt;ProcessMessage(MFT_MESSAGE_SET_D3D_MANAGER, ULONG_PTR(m_pDXGIManager));
if (FAILED(hr))
{
    break;
}</p>
<p>Textureã®å…¥ã£ãŸã‚µãƒ³ãƒ—ãƒ«ã‚’å‡¦ç†ã—ã¦ã€Textureã®å…¥ã£ãŸã‚µãƒ³ãƒ—ãƒ«ã«å‡ºåŠ›ã§ãã‚‹ã€‚
ProcessFrameUsingD3D11
D3D11VideoDeviceã‚’ä½¿ã†ã€‚
ã“ã£ã¡ã®æ–¹ãŒæ‰‹é †ãŒé•·ãã¦å¤§å¤‰ã€‚
ãŠãã‚‰ãã€VideoProcessorMFTã¯D3D11VideoDeviceã‚’ä½¿ã£ã¦å®Ÿè£…ã—ã¦ã„ã¦ã“ã¡ã‚‰ã®æ–¹ãŒãƒ­ãƒ¼ãƒ¬ãƒ™ãƒ«ãªã®ã§ã‚ã‚ã†ã€‚
Decode
APIã®èª¬æ˜ã¨ã—ã¦ã¯ã“ã‚Œã€‚</p>
<p>Supporting Direct3D 11 Video Decoding in Media Foundation</p>
<p>DX11VideoRendererã‚µãƒ³ãƒ—ãƒ«ã§ã¯ã€ç›´æ¥ä½¿ã£ã¦ã„ãªã„ã€‚
Video Processing
DX11VideoRendererã‚µãƒ³ãƒ—ãƒ«ã§ã¯ã€D3D11VideoDeviceã‚’æœ€å¾Œã®è‰²å¤‰æ›ç­‰ã§ä½¿ã£ã¦ã„ã‚‹ã€‚</p>
<p>DXVA Video Processing</p>
<p>Video Process Blit</p>
<p>DXVA2.0+D3D9ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã½ã„ã€‚
D3D11ã§ã¯ã“ã®é–¢æ•°ã€‚</p>
<p>D3D11VideoContext::VideoProcessorBlt</p>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2017/08/create_mediasink/" class="u-url">MediaSinkã‚’å®Ÿè£…ã™ã‚‹</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2017/08/create_mediasink/" rel="bookmark">
            <time class="published dt-published" datetime="2017-08-27T00:00:00Z" itemprop="datePublished" title="2017-08-27 00:00">2017-08-27 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2017/08/create_mediasink/#disqus_thread" data-disqus-identifier="cache/content/posts/2017/08/create_mediasink.html">ã‚³ãƒ¡ãƒ³ãƒˆ</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>DX11VideoRendererã‚’è§£èª­ã—ã¦ã€VideoRendererè¦ä»¶ã‚’æ¢ã‚‹ã€‚</p>
<p>Microsoftã®ã‚µãƒ³ãƒ—ãƒ«ãŒã‚ã‚Šå‚è€ƒã«ãªã‚‹ã€‚</p>
<p>https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DX11VideoRenderer</p>
<p>ã“ã‚Œã¯çµæ§‹ãŒã£ã¤ã‚Šä½œã£ã¦ã‚ã‚‹ã®ã§ã€å‰Šã£ã¦æœ€ä½é™å¿…è¦ãªè¦ç´ ã‚’æ¢ã‚‹ã€‚
IMFMediaSinkã‚’ä½œã‚‹
æ‰‹æŠœãã—ã¦IMFActivateæŠœãã§ã€‚
https://github.com/Microsoft/Windows-classic-samples/blob/master/Samples/DX11VideoRenderer/c++/DX11VideoRenderer.h
ã‚’å‚è€ƒã«æœ€ä½é™ã‚’å®Ÿè£…ã—ã¦ã¿ã‚‹ã€‚
guidgen.exeã§guidã‚’æ±ºã‚ãŸã€‚
CustomVideoRenderer.h</p>
<h2>pragma once</h2>
<h2>include <windows.h></windows.h>
</h2>
<p>// {8C5C51AD-F400-4B2A-BD36-4990D07420B4}
DEFINE_GUID(CLSID_CustomVideoRenderer, 
0x8c5c51ad, 0xf400, 0x4b2a, 0xbd, 0x36, 0x49, 0x90, 0xd0, 0x74, 0x20, 0xb4);</p>
<p>STDAPI CreateCustomVideoRenderer(REFIID riid, void **ppvObject);</p>
<p>DX11VideoRendererã‹ã‚‰å¿…è¦ãªéƒ¨åˆ†ã‚’ã‚³ãƒ”ãƒšã—ã¦ãã‚‹ã ã‘ã§ã‚ã‚‹ã€‚
CustomVideoRenderer.c++</p>
<h2>include "CustomVideoRenderer.h"</h2>
<h2>include <mfidl.h></mfidl.h>
</h2>
<p>class CustomVideoRenderer: public IMFMediaSink
{
    ULONG m_nRefCount = 1;</p>
<p>public:
    // IUnknown
    STDMETHODIMP_(ULONG) AddRef(void)override
    {
        return InterlockedIncrement(&amp;m_nRefCount);
    }</p>
<pre class="code literal-block"><span></span>STDMETHODIMP QueryInterface(REFIID iid, __RPC__deref_out _Result_nullonfailure_ void** ppv)override
{
    if (!ppv)
    {
        return E_POINTER;
    }
    if (iid == IID_IUnknown)
    {
        *ppv = static_cast&lt;IUnknown*&gt;(static_cast&lt;IMFMediaSink*&gt;(this));
    }
    else if (iid == __uuidof(IMFMediaSink))
    {
        *ppv = static_cast&lt;IMFMediaSink*&gt;(this);
    }
    else
    {
        *ppv = NULL;
        return E_NOINTERFACE;
    }
    AddRef();
    return S_OK;
}

STDMETHODIMP_(ULONG) Release(void)override
{
    ULONG uCount = InterlockedDecrement(&amp;m_nRefCount);
    if (uCount == 0)
    {
        delete this;
    }
    // For thread safety, return a temporary variable.
    return uCount;
}

// IMFMediaSink methods
STDMETHODIMP AddStreamSink(DWORD dwStreamSinkIdentifier, __RPC__in_opt IMFMediaType* pMediaType, __RPC__deref_out_opt IMFStreamSink** ppStreamSink)override;
STDMETHODIMP GetCharacteristics(__RPC__out DWORD* pdwCharacteristics)override;
STDMETHODIMP GetPresentationClock(__RPC__deref_out_opt IMFPresentationClock** ppPresentationClock)override;
STDMETHODIMP GetStreamSinkById(DWORD dwIdentifier, __RPC__deref_out_opt IMFStreamSink** ppStreamSink)override;
STDMETHODIMP GetStreamSinkByIndex(DWORD dwIndex, __RPC__deref_out_opt IMFStreamSink** ppStreamSink)override;
STDMETHODIMP GetStreamSinkCount(__RPC__out DWORD* pcStreamSinkCount)override;
STDMETHODIMP RemoveStreamSink(DWORD dwStreamSinkIdentifier)override;
STDMETHODIMP SetPresentationClock(__RPC__in_opt IMFPresentationClock* pPresentationClock)override;
STDMETHODIMP Shutdown(void)override;
</pre>

<p>};</p>
<p>STDAPI CreateCustomVideoRenderer(REFIID riid, void **ppvObject)
{
    if(!ppvObject){
        return E_FAIL;
    }</p>
<pre class="code literal-block"><span></span>auto sink=new CustomVideoRenderer();
*ppvObject=sink;
return S_OK;
</pre>

<p>}</p>
<p>ä½¿ã†
IMFStreamSinkã‹ã‚‰IMFTopologyNodeã‚’ä½œã‚‹ã€‚</p>
<p>Creating Output Nodes</p>
<pre class="code literal-block"><span></span><span class="nt">Microsoft</span><span class="p">::</span><span class="nd">WRL</span><span class="p">::</span><span class="nd">ComPtr</span><span class="o">&lt;</span><span class="nt">IMFTopologyNode</span><span class="o">&gt;</span> <span class="nt">pOutputNode</span><span class="o">;</span>
<span class="nt">if</span><span class="o">(</span><span class="nt">FAILED</span><span class="o">(</span><span class="nt">hr</span> <span class="o">=</span> <span class="nt">MFCreateTopologyNode</span><span class="o">(</span><span class="nt">MF_TOPOLOGY_OUTPUT_NODE</span><span class="o">,</span> <span class="o">&amp;</span><span class="nt">pOutputNode</span><span class="o">)))</span>
<span class="p">{</span>
    <span class="err">return</span> <span class="err">hr</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">Microsoft</span><span class="p">::</span><span class="nd">WRL</span><span class="p">::</span><span class="nd">ComPtr</span><span class="o">&lt;</span><span class="nt">IMFMediaSink</span><span class="o">&gt;</span> <span class="nt">pSink</span><span class="o">;</span>
<span class="o">//</span> <span class="nt">è‡ªå‰ã®IMFMediaSinkã‚’ä½œã‚‹</span>
<span class="nt">if</span><span class="o">(</span><span class="nt">FAILED</span><span class="o">(</span><span class="nt">hr</span><span class="o">=</span><span class="nt">CreateCustomVideoRenderer</span><span class="o">(</span><span class="nt">IID_PPV_ARGS</span><span class="o">(&amp;</span><span class="nt">pSink</span><span class="o">))))</span><span class="p">{</span>
    <span class="err">return</span> <span class="err">hr</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">Microsoft</span><span class="p">::</span><span class="nd">WRL</span><span class="p">::</span><span class="nd">ComPtr</span><span class="o">&lt;</span><span class="nt">IMFStreamSink</span><span class="o">&gt;</span> <span class="nt">pSSink</span><span class="o">;</span>
<span class="nt">if</span><span class="o">(</span><span class="nt">FAILED</span><span class="o">(</span><span class="nt">hr</span><span class="o">=</span><span class="nt">pSink-</span><span class="o">&gt;</span><span class="nt">GetStreamSinkByIndex</span><span class="o">(</span><span class="nt">0</span><span class="o">,</span> <span class="o">&amp;</span><span class="nt">pSSink</span><span class="o">)))</span><span class="p">{</span>
    <span class="err">//</span> <span class="err">ã¾ã ä½œã£ã¦ã„ãªã„ã®ã§ã“ã“ã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹</span>
    <span class="err">return</span> <span class="err">hr</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">if</span> <span class="o">(</span><span class="nt">FAILED</span><span class="o">(</span><span class="nt">hr</span> <span class="o">=</span> <span class="nt">pOutputNode-</span><span class="o">&gt;</span><span class="nt">SetObject</span><span class="o">(</span><span class="nt">pSSink</span><span class="p">.</span><span class="nc">Get</span><span class="o">())))</span>
<span class="p">{</span>
    <span class="err">return</span> <span class="err">hr</span><span class="p">;</span>
<span class="p">}</span>
</pre>

<p>IMFStreamSinkãŒã²ã¨ã¤ã¯å¿…è¦
ä½œã‚‹ã€‚
class CustomVideoStreamSink: public IMFStreamSink
{
    ULONG m_nRefCount = 1;</p>
<pre class="code literal-block"><span></span><span class="nt">const</span> <span class="nt">DWORD</span>                 <span class="nt">STREAM_ID</span><span class="o">;</span>
<span class="nt">CCritSec</span><span class="o">&amp;</span>                   <span class="nt">m_critSec</span><span class="o">;</span>                      <span class="o">//</span> <span class="nt">critical</span> <span class="nt">section</span> <span class="nt">for</span> <span class="nt">thread</span> <span class="nt">safety</span>
<span class="nt">Microsoft</span><span class="p">::</span><span class="nd">WRL</span><span class="p">::</span><span class="nd">ComPtr</span><span class="o">&lt;</span><span class="nt">IMFMediaSink</span><span class="o">&gt;</span>               <span class="nt">m_pSink</span><span class="o">;</span>
</pre>

<p>public:
    CustomVideoStreamSink(DWORD dwStreamId, CCritSec&amp; critSec
            , IMFMediaSink *parent)
        : STREAM_ID(dwStreamId)
          , m_critSec(critSec)
          , m_pSink(parent)
    {
    }</p>
<pre class="code literal-block"><span></span>// IUnknown
STDMETHODIMP_(ULONG) AddRef(void)override;
STDMETHODIMP QueryInterface(REFIID iid, __RPC__deref_out _Result_nullonfailure_ void** ppv)override;
STDMETHODIMP_(ULONG) Release(void)override;

// IMFStreamSink
STDMETHODIMP Flush(void)override;
STDMETHODIMP GetIdentifier(__RPC__out DWORD* pdwIdentifier)override;
STDMETHODIMP GetMediaSink(__RPC__deref_out_opt IMFMediaSink** ppMediaSink)override;
STDMETHODIMP GetMediaTypeHandler(__RPC__deref_out_opt IMFMediaTypeHandler** ppHandler)override;
STDMETHODIMP PlaceMarker(MFSTREAMSINK_MARKER_TYPE eMarkerType, __RPC__in const PROPVARIANT* pvarMarkerValue, __RPC__in const PROPVARIANT* pvarContextValue)override;
STDMETHODIMP ProcessSample(__RPC__in_opt IMFSample* pSample)override;

// IMFMediaEventGenerator (from IMFStreamSink)
STDMETHODIMP BeginGetEvent(IMFAsyncCallback* pCallback,IUnknown* punkState)override;
STDMETHODIMP EndGetEvent(IMFAsyncResult* pResult, _Out_ IMFMediaEvent** ppEvent)override;
STDMETHODIMP GetEvent(DWORD dwFlags, __RPC__deref_out_opt IMFMediaEvent** ppEvent)override;
STDMETHODIMP QueueEvent(MediaEventType met, __RPC__in REFGUID guidExtendedType, HRESULT hrStatus, __RPC__in_opt const PROPVARIANT* pvValue)override;
</pre>

<p>};</p>
<p>ãƒ¡ã‚½ãƒƒãƒ‰ã®ä¸­èº«ã¯
return E_FAIL;</p>
<p>ã§ãŠèŒ¶ã‚’æ¿ã—ãŸã€‚
IMFMediaSink::AddStreamSinkå®Ÿè£…
IMFMediaSink::GetStreamSinkByIdå®Ÿè£…
IMFMediaSink::GetStreamSinkByIndexå®Ÿè£…
IMFMediaSink::GetStreamSinkCountå®Ÿè£…
IMFMediaSink::RemoveStreamSinkå®Ÿè£…
å®Ÿè¡Œã—ã¦ã¿ã‚‹ã€‚
// Handler for Media Session events.
void OnPlayerEvent(HWND hwnd, WPARAM pUnkPtr)
{
    HRESULT hr = g_pPlayer-&gt;HandleEvent(pUnkPtr);
    if (FAILED(hr))
    {
        // ã“ã“ã«æ¥ã‚‹
        NotifyError(hwnd, L"An error occurred.", hr);
    }
    UpdateUI(hwnd, g_pPlayer-&gt;GetState());
}</p>
<pre class="code literal-block"><span></span>// Get the event status. If the operation that triggered the event 
// did not succeed, the status is a failure code.
HRESULT hrStatus = S_OK;
hr = pEvent-&gt;GetStatus(&amp;hrStatus);

// Check if the async operation succeeded.
if (SUCCEEDED(hr) &amp;&amp; FAILED(hrStatus)) 
{
    // ã“ã“ã«æ¥ã‚‹
    hr=hrStatus;
}
</pre>

<p>ãƒ‡ãƒãƒƒã‚¬ã§èª¿ã¹ãŸã‚‰IMFStreamSink::GetMediaSinkã®ç›´å¾Œã«ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã“ã¨ãŒã‚ã‹ã£ãŸã€‚
IMFStreamSink::GetMediaSinkå®Ÿè£…
ãŸã‚“ãŸã‚“ã¨ã‚¨ãƒ©ãƒ¼ã‚’ç›´ã—ã¦ã„ãã€‚
IMFStreamSink::GetMediaTypeHandlerå®Ÿè£…
HRESULT DX11VideoRenderer::CStreamSink::GetMediaTypeHandler(__RPC__deref_out_opt IMFMediaTypeHandler** ppHandler)
{
    CAutoLock lock(&amp;m_critSec);</p>
<pre class="code literal-block"><span></span>if (ppHandler == NULL)
{
    return E_POINTER;
}

HRESULT hr = CheckShutdown();

// This stream object acts as its own type handler, so we QI ourselves.
if (SUCCEEDED(hr))
{
    hr = this-&gt;QueryInterface(IID_IMFMediaTypeHandler, (void**)ppHandler);
}

return hr;
</pre>

<p>}</p>
<p>IMFMediaTypeHandlerãŒå¿…è¦ã€‚
StreamSinkã«IMFMediaTypeHandlerã‚’å®Ÿè£…
ã“ã®ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã¯StreamSinkãŒå‡¦ç†ã§ãã‚‹MediaTypeã‚’ç¤ºã™ã®ã§å¿…è¦ã€‚
ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’æ±ºã‚ã‚‹ã€‚
// IMFMediaTypeHandler
STDMETHODIMP GetCurrentMediaType(<em>Outptr</em> IMFMediaType<strong> ppMediaType);
STDMETHODIMP GetMajorType(__RPC__out GUID* pguidMajorType);
STDMETHODIMP GetMediaTypeByIndex(DWORD dwIndex, <em>Outptr</em> IMFMediaType</strong> ppType);
STDMETHODIMP GetMediaTypeCount(__RPC__out DWORD<em> pdwTypeCount);
STDMETHODIMP IsMediaTypeSupported(IMFMediaType</em> pMediaType, <em>Outptr_opt_result_maybenull</em> IMFMediaType*<em> ppMediaType);
STDMETHODIMP SetCurrentMediaType(IMFMediaType</em> pMediaType);</p>
<p>PresentationClockãŒå¿…è¦</p>
<p>Presentation Clock</p>
<p>IMFMediaSink::GetPresentationClockå®Ÿè£…
IMFMediaSink::SetPresentationClockå®Ÿè£…
MediaSinkã«IMFClockStateSinkã‚’å®Ÿè£…
// IMFClockStateSink methods
STDMETHODIMP OnClockPause(MFTIME hnsSystemTime);
STDMETHODIMP OnClockRestart(MFTIME hnsSystemTime);
STDMETHODIMP OnClockSetRate(MFTIME hnsSystemTime, float flRate);
STDMETHODIMP OnClockStart(MFTIME hnsSystemTime, LONGLONG llClockStartOffset);
STDMETHODIMP OnClockStop(MFTIME hnsSystemTime);</p>
<p>Data Flow
ã“ã“ã¾ã§ã®å®Ÿè£…ã§IMFSession::Startã®å‘¼ã³å‡ºã—ã«å¿œã˜ã¦IMFClockStateSink::OnClockStartãŒå‘¼ã°ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚
Data Flow</p>
<p>Media sinks use a pull model</p>
<p>MesiaSinkå´ã‹ã‚‰ã‚µãƒ³ãƒ—ãƒ«ã‚’å–ã‚Šã«è¡Œã‹ãªã„ã¨ã„ã‘ãªã„ã€‚</p>
<p>[1] The client sets the media types and the presentation clock. The media sink registers itself with the presentation clock to receive notifications about clock state changes.
[2][3][4] ã¯Prerollã€‚ãƒŸãƒ‹ãƒãƒ ã‚’ç›®æŒ‡ã™ä»Šå›ã¯çœç•¥ã€‚
[5] The client calls IMFPresentationClock::Start to start the presentation clock.
[6] The presentation clock notifies the media sink that the clock is starting, by calling IMFClockStateSink::OnClockStart.
[7] To get more data, each stream sink sends MEStreamSinkRequestSample events. In response to each of these events, the client gets the next sample and calls ProcessSample. This step is repeated until the presentation ends.</p>
<p>State Changes
IMFClockStateSinkã®å®Ÿè£…ã«ã¤ã„ã¦ã€‚</p>
<p>In addition, stream sinks must send the following events when they have completed the state transitions:</p>
<p>OnClockStart, OnClockRestart: MEStreamSinkStarted event
OnClockPause: MEStreamSinkPaused event
OnClockStop: MEStreamSinkStopped event</p>
<p>ãªã‚‹ã»ã©ã€‚
STDMETHODIMP OnClockStart(MFTIME hnsSystemTime, LONGLONG llClockStartOffset)override
{
    CAutoLock lock(&amp;m_csMediaSink);</p>
<pre class="code literal-block"><span></span>HRESULT hr = CheckShutdown();
if (SUCCEEDED(hr))
{
    //
    // ã“ã‚ŒãŒå¿…è¦ã€‚ã“ã®ã‚ã¨MEStreamSinkRequestSampleã‚’å—ã‘ä»˜ã‘ã‚‹
    //
    hr = m_pStream-&gt;QueueEvent(MEStreamSinkStarted, GUID_NULL, hr, NULL);
}
if (SUCCEEDED(hr))
{
    hr = m_pStream-&gt;QueueEvent(MEStreamSinkRequestSample, GUID_NULL, hr, NULL);
}

return hr;
</pre>

<p>}</p>
<p>ã¤ã„ã«IMFStreamSink::ProcessSampleãŒã‚³ãƒ¼ãƒ«ã•ã‚ŒãŸã€‚
è©¦ã—ã«ä¸‹è¨˜ã®ã‚ˆã†ãªå®Ÿè£…ã«ã—ã¦ã¿ãŸãŒã“ã‚Œã§ã¯Clockç„¡è¦–ã§æœ€é€Ÿã§ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’æ¶ˆåŒ–ã—ã¦ã—ã¾ã†ã®ã§ã ã‚ã€‚
int m_count = 0;
STDMETHODIMP ProcessSample(__RPC__in_opt IMFSample* pSample)override
{
    ++m_count;</p>
<pre class="code literal-block"><span></span>auto hr = S_OK;
hr = QueueEvent(MEStreamSinkRequestSample, GUID_NULL, hr, NULL);

return hr;
</pre>

<p>}</p>
<p>MEStreamSinkRequestSampleã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã™ã‚‹</p>
<p>Scheduled Work Items</p>
<p>ã“ã‚Œã‚’ä½¿ã£ã¦ã¿ã‚‹ã€‚
BOOL NeedMoreSamples(void)
{
    const DWORD cSamplesInFlight = /<em>m_SamplesToProcess.GetCount() +</em>/ m_cOutstandingSampleRequests;</p>
<pre class="code literal-block"><span></span>return cSamplesInFlight &lt; SAMPLE_QUEUE_HIWATER_THRESHOLD;
</pre>

<p>}</p>
<p>HRESULT RequestSamples(IMFAsyncResult* pAsyncResult)
{
    HRESULT hr = S_OK;</p>
<pre class="code literal-block"><span></span>while (NeedMoreSamples())
{
    hr = CheckShutdown();
    if (FAILED(hr))
    {
        break;
    }

    m_cOutstandingSampleRequests++;

    hr = QueueEvent(MEStreamSinkRequestSample, GUID_NULL, S_OK, NULL);
}

// å†çªå…¥
hr=QueueRequest();

return hr;
</pre>

<p>}</p>
<p>// æ­£ã—ã„Rateã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
const INT64 interval = 1000 / 30;</p>
<p>HRESULT QueueRequest()
{
    HRESULT hr = S_OK;</p>
<pre class="code literal-block"><span></span>if (SUCCEEDED(hr))
{
    // Enqueue
    MFWORKITEM_KEY cancelKey;
    hr = MFScheduleWorkItem(&amp;m_WorkQueueCB, nullptr, -interval, &amp;cancelKey);
}

return hr;
</pre>

<p>}</p>
<p>int m_count = 0;
STDMETHODIMP ProcessSample(__RPC__in_opt IMFSample* pSample)override
{
    ++m_count;</p>
<pre class="code literal-block"><span></span>m_cOutstandingSampleRequests--;

// do something

return  S_OK;
</pre>

<p>}</p>
<p>DX11VideoRenderer::CSchedulerã‚’ä½¿ãˆã°ã‚ˆã„ã¨æ€ã†ã€‚
ã ã„ãŸã„ä»•çµ„ã¿ãŒã‚ã‹ã£ãŸã€‚
DX11VideoRendererã‹ã‚‰å¼•ãç®—ã—ã¦æœ€å°é™ã®æ§‹æˆã«ã™ã‚‹(ProcessSampleãŒä½•ã‚‚ã—ãªã„)å ´åˆã€
ä»¥ä¸‹ã®éƒ¨å“ã‚’æ®‹ã™å¿…è¦ãŒã‚ã‚Šãã†ã€‚</p>
<p>Scheduler
StreamSink: IMFStreamSink, IMFMediaTypeHandler
MesiaSink: IMFMediaSink, IMFClockStateSink</p>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2017/08/media_foundation/" class="u-url">MeidaFoundationæƒ…å ±åé›†</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2017/08/media_foundation/" rel="bookmark">
            <time class="published dt-published" datetime="2017-08-25T00:00:00Z" itemprop="datePublished" title="2017-08-25 00:00">2017-08-25 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2017/08/media_foundation/#disqus_thread" data-disqus-identifier="cache/content/posts/2017/08/media_foundation.html">ã‚³ãƒ¡ãƒ³ãƒˆ</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>DirectShowå¾Œç¶™ã®å‹•ç”»ãƒ»éŸ³å£°ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€‚</p>
<p>sampleã®ã‚ã‚Šã‹</p>
<p>https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/Win7Samples/multimedia/mediafoundation</p>
<p>Win7Samplesã«æ°—ä»˜ã‹ãšãƒ»ãƒ»ãƒ»
ã¯ã˜ã‚ã®ä¸€æ­©
ã“ã“ã‹ã‚‰å§‹ã‚ã‚‹ã®ãŒã‚ˆã„ã€‚</p>
<p>Audio/Video Playback</p>
<p>How to Play Media Files with Media Foundation</p>
<p>Media Session Playback Exampleã€‚ã‚½ãƒ¼ã‚¹ã‚ã‚Š</p>
<p>MediaSessionPlaybackExampleã§å‹•ç”»ã‚’é–‹ãã¨ã“ã‚“ãªæ„Ÿã˜ã®Topologyã«ãªã‚‹ã€‚
å‹•ç”»(MediaSource)---&gt;video-&gt; EVR(MediaSink)
                 |
                 +-&gt;audio-&gt; SAR(MediaSink)</p>
<p>MediaSourceã¨MediaSinkã‚’ä½œã£ã¦ã¤ãªãã®ãŒMediaFoundationã®åŸºæœ¬æ¦‚å¿µã€‚
CMakeã§ãƒ“ãƒ«ãƒ‰ã§ãã‚‹ã‚ˆã†ã«å–ã‚Šã¾ã¨ã‚ãŸã€‚</p>
<p>https://github.com/ousttrue/MediaFoundationSample/tree/master/MediaSessionPlaybackExample</p>
<p>æ§‹æˆ
DirectShowã¨ã¯é•ã†æ„Ÿã˜ã®ã¨ã“ã‚ãŒã‚ã‚‹ã€‚</p>
<p>IMFMediaSourceãŒã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¨Demuxerã‚’å†…åŒ…ã—ã¦ã„ã‚‹
ãªã®ã§é€”ä¸­ã§æåˆ†ã‹ã‚Œã™ã‚‹ã¨ã„ã†ã‚ˆã‚Šã‚‚ã€IMFMediaStream -&gt; IMFTransform -&gt; IMFStreamSinkã¨ã„ã†ãƒ©ã‚¤ãƒ³ãŒè¤‡æ•°ã‚ã‚‹æ„Ÿã˜ã«ãªã‚‹ã€‚</p>
<p>+---------------+
|IMFMediaSource |
+---------------+
|+-------------+|
||IMFByteStream||
|+-------------+|                                          VideoRenderer
|  |  |Read     |                                          +------------+
|  |  v         |     (compressed) decoder (uncompressed)  |IMFMediaSink|
|  | +--------------+ IMFSample +------------+ IMFSample +-------------+|
|  | |IMFMediaStream|----------&gt;|IMFTransform|----------&gt;|IMFStreamSink|+
|  v +--------------+           +------------+           +-------------+
| +--------------+              +------------+           +-------------+
| |IMFMediaStream|-------------&gt;|IMFTransform|----------&gt;|IMFStreamSink|+
| +--------------+  IMFSample   +------------+ IMFSample +-------------+|
+---------------+   (compressed)           (uncompressed)  |IMFMediaSink|
                                                           +------------+
                                                           AudioRendrer</p>
<p>TopoEdit</p>
<p>https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/Win7Samples/multimedia/mediafoundation/topoedit
http://blogs.microsoft.co.il/pavely/2011/03/11/introduction-to-topoedit/</p>
<p>ã„ã‚ã‚“ãªAPI
MediaSource(å…¥åŠ›)ã¨MediaSink(å‡ºåŠ›)ã‚’é§†å‹•ã™ã‚‹é«˜ãƒ¬ãƒ™ãƒ«ã®APIãŒè¤‡æ•°ã‚ã‚‹ã€‚
[Obsolete]å¤ã®Player</p>
<p>IMFPMediaPlayer</p>
<p>Important  Deprecated. This API may be removed from future releases of Windows. Applications should use the Media Session for playback.</p>
<p>https://github.com/Microsoft/Windows-classic-samples/blob/master/Samples/Win7Samples/multimedia/mediafoundation/SimplePlay
https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/Win7Samples/multimedia/mediafoundation/MFPlayer2</p>
<p>[Desktop]å†ç”Ÿå‘ã‘ã®Session
Playerå‘ã‘ã®APIã€‚UWPã«ã¯ç„¡ã„ã€‚</p>
<p>Media Session
http://blog.firefly-vj.net/2009/06/01/mediafoundation-play-with-mediasession.html
Media Foundationã®å†ç”Ÿã‚µãƒ³ãƒ—ãƒ«ã®çŠ¶æ…‹ç®¡ç†ã‚’MSMã§è¡Œã†</p>
<p>Topology</p>
<p>Topologies</p>
<p>å¤‰æ›å‘ã‘ã®Reader
ClockãŒå¿…è¦ãªã„ç”¨é€”ã«å‘ã„ã¦ã„ã‚‹ã€‚
å„ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’æœ€é€Ÿã§å‡¦ç†ã—ãŸã„å ´åˆã‚„ã€MediaSourceãŒWebCamã§ã‚ã‚‹å ´åˆãªã©ã€‚</p>
<p>Source Reader
Using the Source Reader to Process Media Data
The Source Reader does not support reverse playback, even if the media source does.
MediaFoundationã§ID3D11Texture2Dã«å‹•ç”»ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’èª­ã¿è¾¼ã‚€ è¦šæ›¸Î²
MediaFoundation â€” å‹•ç”»ã®èª­ã¿è¾¼ã¿</p>
<p>[Desktop][UWP]WinRTã®Engine
Windows.Mediaã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼Ÿã€‚UWPã¨Desktopã®ä¸¡æ–¹ã§ä½¿ãˆã‚‹ã€‚</p>
<p>Supported Microsoft Media Foundation APIs for Windows Phone 8
Walkthrough: Using Microsoft Media Foundation for Windows Phone 8</p>
<p>using a MediaElement control is a much quicker and easier way
You also must use MF if you want to use video as a texture on 3-D geometry</p>
<p>DXVAãŒç°¡å˜ã«ã§ãã‚‹ã€‚ã‚€ã—ã‚UWPã§ã¯DXVAã—ã‹ãªã„æ§˜å­ã€‚æƒ…å ±å°‘ãªã„ã‘ã©ã€‚</p>
<p>Media engine native C++ video playback sample</p>
<p>MediaSource</p>
<p>Media Sources</p>
<p>Writing a Custom Media Source
Case Study: MPEG-1 Media Source</p>
<p>https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/Win7Samples/multimedia/mediafoundation/mpeg1source
https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/Win7Samples/multimedia/mediafoundation/wavsource</p>
<p>Source Resolver</p>
<p>Using the Source Resolver</p>
<p>URL</p>
<p>IMFSourceResolver::CreateObjectFromURL</p>
<p>ByteStream</p>
<p>IMFSourceResolver::CreateObjectFromByteStream</p>
<p>ByteStreamã‚’è‡ªä½œã™ã‚‹
MP3 File Source</p>
<p>https://msdn.microsoft.com/en-us/library/windows/desktop/ff685299(v=vs.85).aspx</p>
<p>MPEG-4 File Source</p>
<p>https://msdn.microsoft.com/en-us/library/windows/desktop/dd757766(v=vs.85).aspx</p>
<p>MediaSink</p>
<p>Media Sinks</p>
<p>EVR</p>
<p>Enhanced Video Renderer
MediaSink
HWNDã‚’æ¸¡ã—ã¦Windowã«æç”»ã•ã›ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ã€‚
Presenterã‚’è‡ªä½œã—ã¦æç”»ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã‚‹ã€‚
D3D9 ?
EVR ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¿ã‚’å®Ÿè£…ã™ã‚‹</p>
<p>SAR</p>
<p>Streaming Audio Renderer</p>
<p>AudioSinkè‡ªä½œ</p>
<p>https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/Win7Samples/multimedia/mediafoundation/wavsink</p>
<p>VideoSinkè‡ªä½œ</p>
<p>https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DX11VideoRenderer</p>
<p>Playbackã«å¯¾å¿œã—ãŸè‡ªå‰æç”»ã‚’ä½œã‚‹ã«ã¯ã€‚</p>
<p>MediaSinkã‚’è‡ªä½œã™ã‚‹
MediaSinkã§DXVAã‚’ä½¿ã†</p>
<p>SampleGrabberSink</p>
<p>MFCreateSampleGrabberSinkActivate</p>
<p>MediaTransform</p>
<p>Media Foundation Transforms</p>
<p>About MFTs</p>
<p>Comparison of MFTs and DMOs</p>
<p>H.264</p>
<p>H.264 Video Decoder</p>
<p>DXVA
DirectX Video Accelerationã€‚</p>
<p>About DXVA 2.0
Adding a Decoder to a Topology</p>
<p>MR_VIDEO_ACCELERATION_SERVICE
D3d9</p>
<p>Supporting DXVA 2.0 in Media Foundation
DXVA Video Processing
IDirect3DDeviceManager9</p>
<p>D3D11</p>
<p>https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DX11VideoRenderer
Supporting Direct3D 11 Video Decoding in Media Foundation
IMFDXGIDeviceManager</p>
<p>Sample &amp; Buffer
Sampleã®ä¸­ã«BufferãŒå…¥ã£ã¦ã„ã‚‹ã€‚</p>
<p>Media Samples</p>
<p>Video Samples</p>
<p>Media Buffers
https://github.com/loskutov/VideoCapture/blob/master/src/DesktopDuplicationSampleProvider.cpp</p>
<p>MediaType</p>
<p>Media Types</p>
<p>Presentation Clock</p>
<p>Presentation Clock</p>
<p>Media Event</p>
<p>Media Event Generators</p>
<p>linkã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
é–¢æ•°ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã‚ã‹ã‚‹ãŒå®šæ•°ã¯ã©ã‚Œã«å…¥ã£ã¦ã„ã‚‹ã‹ã‚ã‹ã‚‰ãªã„ã€‚
ã‚ã‚Šã¨ç·å½“ãŸã‚Šã§è©¦ã™ã¯ã‚ã«ãªã‚‹ã€‚</p>
<p>mf.lib
mfplat.lib
mfuuid.lib
strmiids.lib
wmcodecdspuuid.lib</p>
<p>å‚è€ƒ</p>
<p>Media Foundation Programming Guide</p>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2017/08/usd/" class="u-url">Pixarã®Universal Scene Descriptionã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦ã¿ã‚‹</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2017/08/usd/" rel="bookmark">
            <time class="published dt-published" datetime="2017-08-14T00:00:00Z" itemprop="datePublished" title="2017-08-14 00:00">2017-08-14 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2017/08/usd/#disqus_thread" data-disqus-identifier="cache/content/posts/2017/08/usd.html">ã‚³ãƒ¡ãƒ³ãƒˆ</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>20170902ã€‚å®Ÿã¯ãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒã‚ã£ã¦ã€ç°¡å˜ã«ãªã£ã¦ã„ãŸã€‚</p>
<p>å‹•ç”»ã§CEDEC2017ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’èã„ã¦ã‚ˆã•ã’ãªæ°—ãŒã—ãŸã®ã§å†åº¦ã‚„ã£ã¦ã¿ãŸ(ã¡ã‚‡ã£ã¨å‰ã«é€”ä¸­ã¾ã§ã‚„ã£ã¦æ”¾ç½®ã—ã¦ã„ãŸ)ã€‚
usdviewãŒä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ã¨ã‚ˆã„ã‚‰ã—ã„ã€‚</p>
<h3>Pixar USD ã® Windows ãƒ“ãƒ«ãƒ‰æ–¹æ³•ï¼ˆ2017/9 ç‰ˆï¼‰</h3>
<p>è‡ªå‹•ãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒã¤ã„ã¦ã„ã‚‹ã®ã§æ”¾ã£ã¦ãŠãã ã‘ãªã®ã ã‘ã©ã€ã†ã¾ãã„ã‹ãªã‹ã£ãŸã¨ã“ã‚ã‚’è£œè¶³ã™ã‚‹ã€‚
ç’°å¢ƒã¯ã€Windows10(64bit) + VisualStudio2017 + VisualStudio2015ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©è¿½åŠ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«(VisualStudio2017ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚ã‚‹)
visualstudioè£œè¶³
VisualStudioã¯ã€æœ€è¿‘ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«é™ã£ã¦ã‚‚ã„ã‚ã„ã‚ã‚ã‚‹ã€‚</p>
<p>VisualStudio2017(MSVC14.1)ã®ã¿
VisualStudio2017(MSVC14.1)ã«VS2015(MSVC14.0)ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒè¿½åŠ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹(ã†ã¡ã¯ã“ã‚Œ)
VisualStudio2015(MSVC14.0)ã®ã¿
Visual C++ 2015 Build Tools(MSVC14.0)Python3ãƒ“ãƒ«ãƒ‰å‘ã‘ã«IDEã®ç„¡ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³)</p>
<p>ã‚‚ã®ã«ã‚ˆã£ã¦vcvars.batã®å ´æ‰€ãŒé•ã£ã¦ã€bjamã¨ã‹distutilsãŒã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®ç™ºè¦‹ã«å¤±æ•—ã—ãŸã‚Šã™ã‚‹å ´åˆãŒã‚ã‚‹ã‚ˆã†ã ã€‚
cl.exeãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‚ˆã†ãªå ´åˆã€visualstudioã®æä¾›ã™ã‚‹è¨­å®šæ¸ˆã¿ã®dosãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‹ã‚‰å§‹ã‚ã‚‹ã®ãŒæ‰‹å …ã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚
ä¸€å¿œã€
VisualStudio2017 - x64 native tools command promptã‹ã‚‰ã¯ã˜ã‚ã‚‹ã€‚
CMakeã¯VisualStudioã®æ¤œå‡ºã«ã‚ã¾ã‚Šå¤±æ•—ã—ãªã„ã®ã§ã€ãŠã‚‚ã«Boostã®ãƒ“ãƒ«ãƒ‰å¯¾ç­–ã€‚
åŠ¹æœãŒã‚ã£ãŸã‹ã¯ä¸æ˜ã€‚
D:\work&gt; cl
Microsoft(R) C/C++ Optimizing Compiler Version 19.10.25019 for x64
Copyright (C) Microsoft Corporation.  All rights reserved.</p>
<p>ä½¿ã„æ–¹: cl [ ã‚ªãƒ—ã‚·ãƒ§ãƒ³... ] ãƒ•ã‚¡ã‚¤ãƒ«å... [ /link ãƒªãƒ³ã‚¯ ã‚ªãƒ—ã‚·ãƒ§ãƒ³... ]</p>
<p>VS2017ã—ã‹å…¥ã£ã¦ã„ãªã„ã¨ã
build_usd.pyå†…Boost.Pythonã«é–¢ã—ã¦msvc=14.0æŒ‡å®š(VS2015)ãŒã‚ã‚‹ã®ã§ã€ã“ã‚Œã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã™ã‚Œã°ãŸã¶ã‚“VS2017ã—ã‹ãªãã¦ã‚‚ãƒ“ãƒ«ãƒ‰ã§ãã‚‹ã€‚Windowsç‰ˆã®Python2.7ã®ãƒ“ãƒ«ãƒ‰ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã¯VS2008(MSVC9.0)ã‚‰ã—ã„ã€‚</p>
<p><a href="https://www.microsoft.com/en-us/download/details.aspx?id=44266">https://www.microsoft.com/en-us/download/details.aspx?id=44266</a></p>
<p>pythonè£œè¶³
Python27ä»¥å¤–ã®PythonãŒå…¥ã£ã¦ã„ã‚‹ã¨ã¯ã¾ã‚‹ç‡ãŒä¸ŠãŒã‚‹ã€‚</p>
<pre class="code literal-block"><span></span><span class="nt">D</span><span class="o">:</span><span class="err">\</span><span class="nt">work</span><span class="o">&gt;</span> <span class="nt">python</span> <span class="nt">-V</span>
<span class="nt">Python</span> <span class="nt">3</span><span class="p">.</span><span class="nc">6</span><span class="p">.</span><span class="nc">0</span> <span class="o">::</span> <span class="nt">Anaconda</span> <span class="nt">4</span><span class="p">.</span><span class="nc">3</span><span class="p">.</span><span class="nc">0</span> <span class="o">(</span><span class="nt">64-bit</span><span class="o">)</span>

<span class="nt">é•ã†Pythonã ãƒ¼</span><span class="err">ã€‚</span>
<span class="nt">D</span><span class="o">:</span><span class="err">\</span><span class="nt">work</span><span class="o">&gt;</span> <span class="nt">set</span> <span class="nt">PATH</span><span class="o">=</span><span class="nt">D</span><span class="o">:</span><span class="err">\</span><span class="nt">Python27</span><span class="o">;</span><span class="nt">D</span><span class="o">:</span><span class="err">\</span><span class="nt">Python27</span><span class="err">\</span><span class="nt">Scripts</span><span class="o">;%</span><span class="nt">PATH</span><span class="o">%</span>
<span class="nt">D</span><span class="o">:</span><span class="err">\</span><span class="nt">work</span><span class="o">&gt;</span> <span class="nt">python</span> <span class="nt">-V</span>
<span class="nt">Python</span> <span class="nt">2</span><span class="p">.</span><span class="nc">7</span><span class="p">.</span><span class="nc">14rc1</span>
<span class="nt">D</span><span class="o">:</span><span class="err">\</span><span class="nt">work</span><span class="o">&gt;</span> <span class="nt">pip</span> <span class="nt">install</span> <span class="nt">pyside</span>
<span class="nt">Collecting</span> <span class="nt">pyside</span>
  <span class="nt">Downloading</span> <span class="nt">PySide-1</span><span class="p">.</span><span class="nc">2</span><span class="p">.</span><span class="nc">4-cp27-none-win_amd64</span><span class="p">.</span><span class="nc">whl</span> <span class="o">(</span><span class="nt">45</span><span class="p">.</span><span class="nc">0MB</span><span class="o">)</span>
    <span class="nt">100</span><span class="o">%</span> <span class="o">|</span><span class="err">################################</span><span class="o">|</span> <span class="nt">45</span><span class="p">.</span><span class="nc">0MB</span> <span class="nt">36kB</span><span class="o">/</span><span class="nt">s</span>
<span class="nt">Installing</span> <span class="nt">collected</span> <span class="nt">packages</span><span class="o">:</span> <span class="nt">pyside</span>
<span class="nt">Successfully</span> <span class="nt">installed</span> <span class="nt">pyside-1</span><span class="p">.</span><span class="nc">2</span><span class="p">.</span><span class="nc">4</span>
</pre>

<p>pythonä½¿ã„ãŸã‚‹ã‚‚ã®ï¼’ç³»ã€ï¼“ç³»ä¸¡æ–¹å…¥ã£ã¦ã„ãŸã‚Šã™ã‚‹ã‚‚ã®ã§ã‚ã‚‹ã€‚
cloneã—ã¦ãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ</p>
<pre class="code literal-block"><span></span>D:\work&gt; git clone https://github.com/PixarAnimationStudios/USD

D:\work&gt; mkdir USD_build
D:\work&gt; cd USD_build
D:\work\USD_build&gt;

D:\work\USD_build&gt; python ..\USD\build_scripts\build_usd.py
usage: build_usd.py [-h] [-n] [-v | -q] [--build BUILD]
                    [--generator GENERATOR]
                    [--build-shared | --build-monolithic] [--src SRC]
                    [--inst INST] [--force FORCE_BUILD] [--force-all]
                    [--tests | --no-tests] [--docs | --no-docs]
                    [--imaging | --usd-imaging | --no-imaging]
                    [--ptex | --no-ptex] [--embree | --no-embree]
                    [--embree-location EMBREE_LOCATION]
                    [--alembic | --no-alembic] [--hdf5 | --no-hdf5]
                    [--maya | --no-maya] [--maya-location MAYA_LOCATION]
                    [--katana | --no-katana]
                    [--katana-api-location KATANA_API_LOCATION]
                    [--houdini | --no-houdini]
                    [--houdini-location HOUDINI_LOCATION]
                    install_dir
build_usd.py: error: too few arguments

D:\work\USD_build&gt; python ..\USD\build_scripts\build_usd.py .
ERROR: CMake not found -- please install it and adjust your PATH
</pre>

<p>ã“ã‚“ãªé¢¨ã«è¶³ã‚Šãªã„ãƒ„ãƒ¼ãƒ«ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã‚‹ã®ã§ã›ã£ã›ã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãƒ‘ã‚¹ã‚’è¨­å®šã™ã‚‹ã€‚</p>
<blockquote>
<p>set PATH=D:\Program Files\CMake\bin;%PATH%
set PATH=D:\Program Files\NASM;%PATH%</p>
</blockquote>
<p>buildâ€¦</p>
<h3>Alembicã¨ã‹ç„¡ã—ã®æœ€å°ãƒ“ãƒ«ãƒ‰ã€‚</h3>
<pre class="code literal-block"><span></span>D:\work\USD_build&gt; python ..\USD\build_scripts\build_usd.py .

Building with settings:
  USD source directory          D:\work\USD
  USD install directory         D:\work\USD_build
  3rd-party source directory    D:\work\USD_build\src
  3rd-party install directory   D:\work\USD_build
  Build directory               D:\work\USD_build\build

  Building                      Shared libraries
    Imaging                     On
      Ptex support:             Off
    UsdImaging                  On
    Documentation               Off
    Tests                       Off
    Alembic Plugin              Off
      HDF5 support:             Off
    Maya Plugin                 Off
    Katana Plugin               Off
    Houdini Plugin              Off

    Dependencies                zlib, boost, TBB, JPEG, TIFF, PNG, OpenEXR, GLEW, OpenImageIO, OpenSubdiv, PyOpenGL

STATUS: Installing zlib...
STATUS: Installing boost...
STATUS: Installing TBB...
STATUS: Installing JPEG...
STATUS: Installing TIFF...
STATUS: Installing PNG...
</pre>

<p>ã“ã‚“ãªæ„Ÿã˜ã«é †ç•ªã«ãƒ“ãƒ«ãƒ‰ãŒé€²ã‚“ã§ã„ãã€‚
pngã®ãƒ“ãƒ«ãƒ‰ã§ã“ã‘ãŸ
pngrutil.obj : error LNK2019: æœªè§£æ±ºã®å¤–éƒ¨ã‚·ãƒ³ãƒœãƒ« inflateValidate ãŒé–¢æ•° png_inflate_claim ã§å‚ç…§ã•ã‚Œã¾ã—ãŸã€‚</p>
<p>ä½•æ•…ã‹ã€zlibã¸ã®ãƒªãƒ³ã‚¯ãŒã†ã¾ãã„ã£ã¦ã„ãªã„ï¼Ÿ
CMakeã®GUIã§sourceã‚’USD_build/src/libpng-1.6.29ã€buildã‚’D:/dev/_alembic/USD_build/build/libpng-1.6.29ã«ã—ã¦ç¢ºèªã™ã‚‹ã¨ZLIB_LIBRARY_RELEASEãŒC:/Program Files/Anaconda3/Library/lib/z.libã«ãªã£ã¦ã„ã¦ãŠå¯Ÿã—ã€‚
pythonã‚’ãƒ•ãƒ«ãƒ‘ã‚¹ã§æŒ‡å®šã—ãŸã‚‰ãªã‚“ã‹æ²»ã£ãŸã€‚é•ã†PythonãŒæ„å›³ã›ãšä½¿ã‚ã‚Œã¦ã„ãŸã‹ã€‚
dosçª“ã¯ã€whichã‚³ãƒãƒ³ãƒ‰ãŒç„¡ã„ã—ã‚ˆãã‚ã‹ã‚‰ã‚“ã€‚</p>
<pre class="code literal-block"><span></span>work\USD_build&gt; D:\python27\python ..\USD\build_scripts\build_usd.py . --force png

STATUS: Installing PNG...
STATUS: Installing OpenEXR...
STATUS: Installing GLEW...
STATUS: Installing OpenImageIO...
STATUS: Installing OpenSubdiv...
STATUS: Installing PyOpenGL...
STATUS: Installing PyOpenGL...
STATUS: Installing USD...

Success! To use USD, please ensure that you have:
  The following in your PYTHONPATH environment variable:
    D:\dev\_alembic\USD_build\lib\python

  The following in your PATH environment variable:
    D:\dev\_alembic\USD_build\bin
    D:\dev\_alembic\USD_build\lib
</pre>

<p>ãƒ“ãƒ«ãƒ‰ã§ããŸã€‚</p>
<h3>Boost.Pythonãƒ¡ãƒ¢</h3>
<p>boost_python-vc140-mt-1_61.dllãŒpython36.dllã¨ã‹é•ã†ã®ã«ãƒªãƒ³ã‚¯ã—ã¦ã—ã¾ã†å ´åˆã€‚
æœ€æ‚ªPythonã‚’ã™ã¹ã¦ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦Python27(64bit)ã ã‘ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚Œã°ã„ã‘ã‚‹ã®ã ãŒã€ãã‚Œã§ã¯è² ã‘ãŸæ°—ãŒã™ã‚‹ã®ã§Boost.Pythonã«ä½¿ã†Pythonã‚’å¼·åˆ¶ã™ã‚‹æ–¹æ³•ã€‚
USD_BUILD/user-conifg.jam
using python
    : 2.7                   # Version
    : C:\Python27\python.exe      # Python Path
    : C:\Python27\include         # include path
    : C:\Python27\libs            # lib path(s)
    ;</p>
<p>ã‚’ä½œã£ã¦ç’°å¢ƒå¤‰æ•°BOOST_BUILD_PATHã‚’user-config.jamã®ã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«æŒ‡å®šã™ã‚‹ã€‚
%USERROFILE%\user-config.jamã«ä½œã£ã¦BOOST_BUILD_PATHç„¡ã—ã§ã‚‚ã‚ˆã„ãŒã€æ¶ˆã—å¿˜ã‚Œã‚‹ã¨ã‚ã¨ã§ã¯ã¾ã‚‹å¯èƒ½æ€§ãŒå¢—ãˆã‚‹ã¨æ€ã†ã€‚</p>
<p>http://www.boost.org/build/doc/html/bbv2/overview/configuration.html</p>
<p>Windowsã®Boost.Pythonã¯ä½œã‚‹ã¨ãã‚‚ä½¿ã†ã¨ãã‚‚ãƒªãƒ³ã‚¯ã§ã¯ã¾ã‚‹ã€‚
usdviewã‚’ä½¿ã£ã¦ã¿ã‚‹
USD_BUILD/bin/usdviewãŒã‚ã‚‹ã€‚
USD_BUILD\bin&gt; D:\python27\python usdview</p>
<p>sys.path
Traceback (most recent call last):
  File "usdview", line 25, in <module>
    import pxr.Usdviewq as Usdviewq
ImportError: No module named pxr.Usdviewq</module></p>
<p>environ[â€˜PATHâ€™]
Traceback (most recent call last):
  File "usdview", line 37, in <module>
    Usdviewq.Launcher().Run()
  File "D:\dev_alembic\USD_build\lib\python\pxr\Usdviewq__init__.py", line 54, in Run
    valid = self.ValidateOptions(arg_parse_result)
  File "D:\dev_alembic\USD_build\lib\python\pxr\Usdviewq__init__.py", line 167, in ValidateOptions
    from pxr import Sdf
  File "D:\dev_alembic\USD_build\lib\python\pxr\Sdf__init__.py", line 24, in <module>
    import _sdf
ImportError: DLL load failed: æŒ‡å®šã•ã‚ŒãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚</module></module></p>
<p>usdviewã‚’æ”¹é€ ã—ã¦ã—ã¾ãŠã†ã€‚
ç’°å¢ƒå¤‰æ•°PATHã¨PYTHONPATHã‚’è¿½åŠ ã€‚
usdview.cmdæ”¹é€ ã§ã‚‚ã‚ˆã„ãŒpythonã®æ–¹ãŒæ›¸ãã‚„ã™ã„ã®ã§ã€‚
usdviewã®å†’é ­ã®importå‰ã«ä¸‹è¨˜ã‚’è¿½åŠ ã€‚
import os
import sys</p>
<p>basepath=os.path.dirname(os.path.dirname(os.path.abspath(<strong>file</strong>)))
bin_dir=os.path.join(basepath, 'bin')
lib_dir=os.path.join(basepath, 'lib')
libpython_dir=os.path.join(lib_dir, 'python')</p>
<p>sys.path.append(libpython_dir)
os.environ['PATH']="%s;%s;" % (bin_dir, lib_dir) + os.environ['PATH']</p>
<p>import pxr.Usdviewq as Usdviewq</p>
<p>å®Ÿè¡Œã€‚
USD_BUILD\bin&gt; D:\python27\python usdview
usage: usdview [-h] [--renderer {opt,simple}] [--select PRIMPATH]
               [--camera CAMERA] [--mask PRIMPATH[,PRIMPATH...]]
               [--clearsettings] [--norender] [--unloaded] [--timing]
               [--memstats {none,stage,stageAndImaging}]
               [--numThreads NUMTHREADS] [--ff FIRSTFRAME] [--lf LASTFRAME]
               [--complexity COMPLEXITY] [--quitAfterStartup]
               usdFile
usdview: error: too few arguments</p>
<p>å¼•æ•°ãŒå¿…è¦ã¨ã€‚
cube.usd</p>
<h2>usda 1.0</h2>
<p>def Cube "Cube"
{
}</p>
<p>å®Ÿè¡Œã€‚
Warning: in Link at line 180 of D:\dev_alembic\USD\pxr\imaging\lib\hd\glslProgram.cpp -- Failed to link shader:
Geometry shader(s) failed to link.
Geometry link error: HW_UNSUPPORTED.
ERROR: Internal compile error, error code: E_SC_LITERAL_NOT_DEFINED
Shader not supported by HW</p>
<p>Windowã¯å‡ºãŸã€‚ã—ã‹ã—glslã®ã‚¨ãƒ©ãƒ¼ã§3DViewã®æç”»ãŒã§ãã¬ã€‚
Rx480ãŒã ã‚ãªã®ã ã‚ã†ã‹ã€‚
GTXè²·ã‚ã­ã°ãƒ»ãƒ»ãƒ»
Alembicè¿½åŠ ã™ã‚‹
ToDo</p>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2017/08/pybullet/" class="u-url">PyBulletã‚’ä½¿ã£ã¦ã¿ã‚‹</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2017/08/pybullet/" rel="bookmark">
            <time class="published dt-published" datetime="2017-08-14T00:00:00Z" itemprop="datePublished" title="2017-08-14 00:00">2017-08-14 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2017/08/pybullet/#disqus_thread" data-disqus-identifier="cache/content/posts/2017/08/pybullet.html">ã‚³ãƒ¡ãƒ³ãƒˆ</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>BulletPhysicsã®å…¬å¼Pythonãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãŒå‡ºã¦ãŸã®ã§ä½¿ã£ã¦ã¿ã‚‹ã€‚</p>
<p>Windows10(64bit) + Python3.6
pip</p>
<blockquote>
<p>C:\Python36\Scripts\pip.exe install pybullet</p>
</blockquote>
<p>cl.exe not foundçš„ãª
msvc-14.0ãªã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã«ã‚‚é–¢ã‚ã‚‰ãšå‡ºã‚‹ãªã‚‰
ã“ã‚Œ
ã‹ã‚‚ã—ã‚Œãªã„
C:\Python36\Lib\distutils_msvccompiler.pyã‚’ä¿®æ­£ã™ã‚Œã°ã„ã‘ã‚‹ã‹ã‚‚ã€‚
    try:
        out = subprocess.check_output(
            'cmd /u /c "{}" {} &amp;&amp; set'.format(vcvarsall, plat_spec),
            stderr=subprocess.STDOUT,
        ).decode('utf-16le', errors='replace')
        #######################################################################
        if out.startswith("Error in script usage"):
            out = subprocess.check_output(
                'cmd /u /c "{}" {} &amp;&amp; set'.format("C:\Program Files (x86)\Microsoft Visual C++ Build Tools\vcbuildtools.bat", plat_spec),
                stderr=subprocess.STDOUT,
            ).decode('utf-16le', errors='replace')
        #######################################################################
    except subprocess.CalledProcessError as exc:
        log.error(exc.output)
        raise DistutilsPlatformError("Error executing {}"
                .format(exc.cmd))</p>
<p>utf-8ãŒã©ã†ã“ã†çš„ãª
ã„ã„åŠ æ¸›Windowsã¯CP932ã‚’ä½¿ã†ã®ã‚„ã‚ã¦æ¬²ã—ã„ã®ã ã‘ã©ã€‚
chcp65001</p>
<p>ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ããŸã€‚
ä½¿ã£ã¦ã¿ã‚‹</p>
<p>pybullet quickstart guide</p>
<p>æ—¥ä»˜ãŒ2017ã§æ€ã£ãŸã‚ˆã‚Šæ–°ã—ã„ã€‚ã‚€ã—ã‚ã€è¨˜è¿°ä¸­ãã‚‰ã„ã‹ã€‚
hello pybullet
import pybullet as p
physicsClient = p.connect(p.GUI)#or p.DIRECT for non-graphical version
p.setGravity(0,0,-10)
planeId = p.loadURDF("plane.urdf")
cubeStartPos = [0,0,1]
cubeStartOrientation = p.getQuaternionFromEuler([0,0,0])
boxId = p.loadURDF("r2d2.urdf",cubeStartPos, cubeStartOrientation)
p.stepSimulation()
cubePos, cubeOrn = p.getBasePositionAndOrientation(boxId)
print(cubePos,cubeOrn)
p.disconnect()</p>
<p>plane.urdfã¯ã©ã“ã«ã‚ã‚‹ã®ã‹ã€‚
bullet3ã®ã‚½ãƒ¼ã‚¹ã®ä¸­ã«ã‚ã£ãŸã€‚bullet3/build/data/plane.urdf</p>
<?xml version="0.0" ?><p><robot name="plane"><link name="planeLink">
<contact><lateral_friction value="1"></lateral_friction></contact><inertial><origin rpy="0 0 0" xyz="0 0 0"></origin><mass value=".0"></mass><inertia ixx="0" ixy="0" ixz="0" iyy="0" iyz="0" izz="0"></inertia></inertial><visual><origin rpy="0 0 0" xyz="0 0 0"></origin><geometry><mesh filename="plane.obj" scale="1 1 1"></mesh></geometry><material name="white"><color rgba="1 1 1 1"></color></material></visual><collision><origin rpy="0 0 0" xyz="0 0 -5"></origin><geometry><box size="30 30 10"></box></geometry></collision></robot></p>
<p>ãªã‚‹ã»ã©ãƒ¼ã€‚
ã¡ã‚‡ã£ã¨helloã‚’æ”¹é€ 
import os
os.chdir('D:/dev/_python/bullet3/build/data') # urdfã®ã‚ã‚‹ã¨ã“ã‚ã«ç§»å‹•</p>
<p>import pybullet as p
physicsClient = p.connect(p.GUI)#or p.DIRECT for non-graphical version
p.setGravity(0,0,-10)
planeId = p.loadURDF("plane.urdf")
cubeStartPos = [0,0,1]
cubeStartOrientation = p.getQuaternionFromEuler([0,0,0])
boxId = p.loadURDF("r2d2.urdf",cubeStartPos, cubeStartOrientation)</p>
<p>while True: # ã¨ã‚Šã‚ãˆãšpythonã‚’æŠœã‘ãªã„ã‚ˆã†ã«
    p.stepSimulation()
    cubePos, cubeOrn = p.getBasePositionAndOrientation(boxId)
    print(cubePos,cubeOrn)</p>
<p>p.disconnect()</p>
<p>é¢ç™½ãã†ã€‚</p>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2017/08/cmake_find_boost_python/" class="u-url">CMakeã§Boost.Pythonã‚’ä½¿ã†</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2017/08/cmake_find_boost_python/" rel="bookmark">
            <time class="published dt-published" datetime="2017-08-09T00:00:00Z" itemprop="datePublished" title="2017-08-09 00:00">2017-08-09 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2017/08/cmake_find_boost_python/#disqus_thread" data-disqus-identifier="cache/content/posts/2017/08/cmake_find_boost_python.html">ã‚³ãƒ¡ãƒ³ãƒˆ</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>Windowsä¸Šã®CMakeã§FIND_PACKAGE(Boost)ã™ã‚‹ä»¶ã«ã¤ã„ã¦ã€‚</p>
<p>Boost.Pythonã®ãƒ“ãƒ«ãƒ‰
C:/boost_1_61_0ã«è§£å‡ã—ã¦ã€b2 --with-pythonã—ãŸã¨ã™ã‚‹ã€‚
ã®ã‚ˆã†ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã€‚
C:/boost_1_61_0
    stage
        lib
            boost_python.lib</p>
<p>FIND_PACKAGE
BOOST.Pythonã‚’ä½¿ã†å ´åˆã¯ä¸‹è¨˜ã®è¨˜è¿°ã‚’ã—ã¦ã€-DBOOST_ROOT=C:/boost_1_61_0ã‚’æŒ‡å®šã—ã¦ã‚„ã‚‹ã¨cmakeã¯Boost.Pythonã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
ãŸã ã—ã€æ¤œç´¢ãƒ‘ã‚¹ãŒ${BOOST_ROOT}/stage/libæ±ºã‚æ‰“ã¡ã€‚
FIND_PACKAGE (Boost COMPONENTS PYTHON REQUIRED)
MESSAGE(STATUS ${Boost_LIBRARIES})</p>
<p>è¦‹ã¤ã‹ã£ãŸ
optimizedD:/lib/boost_1_61_0/stage/lib/boost_python-vc140-mt-1_61.libdebugD:/lib/boost_1_61_0/stage/lib/boost_python-vc140-mt-gd-1_61.lib</p>
<p>Python3ã¯ï¼Ÿ
FIND_PACKAGE (Boost COMPONENTS python3 REQUIRED)
MESSAGE(STATUS ${Boost_LIBRARIES})</p>
<p>ã§ã„ã‘ã‚‹ã€‚
ã—ã‹ã—ã€è­¦å‘ŠãŒå‡ºãŸã€‚
CMake Warning at D:/Program Files/CMake/share/cmake-3.9/Modules/FindBoost.cmake:1564 (message):
  No header defined for python3; skipping header check
Call Stack (most recent call first):
  CMakeLists.txt:42 (FIND_PACKAGE)</p>
<p>3ãŒã¤ã„ã¦ãªãã¦ã‚‚åŒã˜ã ã£ãŸ
stage/libã«å‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹boost_python3.dllã¨boost_python.dllã¯åŒã˜ãƒã‚¤ãƒŠãƒªã½ã„ã€‚
static, sharedã®å‘¼ã³åˆ†ã‘ã¯ï¼Ÿ
å¾Œã§ã€‚
FindBoost</p>
<p>https://cmake.org/cmake/help/latest/module/FindBoost.html</p>
<p>ã—ã‹ã—
FIND_PACKAGEã—ãŸçµæœã®Boost_LIBRARIESã‚’ä½¿ã†ã®ã«ã¯æ³¨æ„ãŒå¿…è¦ã€‚
ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–‹ç™ºã§ã€ãƒ‡ãƒãƒƒã‚°ç‰ˆã«Releaseç‰ˆã®Pythonã‚’ãƒªãƒ³ã‚¯ã™ã‚‹å ´åˆ(é€šå¸¸ãã†ã™ã‚‹)ã«ã€Boost.Pytnonã‚‚Releaseç‰ˆã«ãƒªãƒ³ã‚¯ã™ã‚‹ã¹ããªã®ã§ã“ã“ã§ã¯ã¾ã‚Šã†ã‚‹(ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã¯é€šã‚‹ãŒå®Ÿè¡Œæ™‚ã«è¬ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹)ã€‚LINK_DIRECTORIESã‚’ä½¿ã£ã¦ã€ãƒªãƒ³ã‚¯å¯¾è±¡ã¯BOOSTã®autolinké ¼ã‚Šã®æ–¹ãŒç¢ºå®Ÿã‹ã‚‚ã—ã‚Œãªã„ã€‚</p>
<p>BOOST_ALL_NO_LIB ã‚’å®šç¾©ã—ã¦ Boost_LIBRARIESã«ãƒªãƒ³ã‚¯ã™ã‚‹
Boost_LIBRARIESã‚’ä½¿ã‚ãšã«ã€Boostã®AutoLinkã«å¾“ã†</p>
<p>ã®ã„ãšã‚Œã‹ã«ãªã‚‹ãŒã€ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–‹ç™ºã§ã¯å¾Œè€…ãŒãŠã™ã™ã‚ã‹ã€‚</p>
</div>
                </div>
            </article>
</div>
    
        <ul class="pager postindexpager clearfix">
<li class="previous"><a href="index-14.html" rel="prev">æ–°ã—ã„è¨˜äº‹</a></li>
            <li class="next"><a href="index-12.html" rel="next">éå»ã®è¨˜äº‹</a></li>
        </ul>
<script>var disqus_shortname="nikolademo";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><!--End of body content--><footer id="footer">
            Contents Â© 2021         <a href="mailto:ousttrue@gmail.com">ousttrue</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
            
        </footer>
</div>
</div>


        <script src="assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
