"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1622],{4754:function(e,t,n){n.r(t),n.d(t,{default:function(){return u}});var a=n(1151),l=n(7294);function s(e){const t=Object.assign({p:"p",span:"span",h2:"h2"},(0,a.ah)(),e.components);return l.createElement(l.Fragment,null,l.createElement(t.p,null,"hererocks が VS2019BuildTools を検知して動作するように改造してみた。"),"\n",l.createElement(t.p,null,"https://github.com/luarocks/hererocks/pull/15"),"\n",l.createElement(t.p,null,"通るかどうかは微妙。\n内容的に、通りづらそう。\n古い vc を使っていたり MinGW 使っていたりすると実験できないしね。\nとりあえず、既存の動いている部分が壊れないようには配慮した。"),"\n",l.createElement(t.p,null,"採用されれば、"),"\n",l.createElement(t.p,null,"https://github.com/wbthomason/packer.nvim/issues/302"),"\n",l.createElement(t.p,null,"も進展する。\nWindows 版の luarocks 呼び出しに改造が必要なのだが、\n先に hererocks が動いている必要があるという順番。"),"\n",l.createElement(t.p,null,"とりあえず単体で試すことができて"),"\n",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text"># C:/Python38/Scripts/pip.exe\n$ pip install https://github.com/ousttrue/hererocks/archive/add_vswhere.zip</code></pre></div>'}}),"\n",l.createElement(t.p,null,"とする。"),"\n",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text"># C:/Python38/Scripts/hererocks.exe\n$ hererocks.exe --target vs -j 2.1.0-beta3 -r latest build_dir\nUsing cl.exe found in PATH.\nFetching LuaJIT 2.1.0-beta3 (target: vs) (cached)\nVerifying SHA256 checksum\nBuilding LuaJIT 2.1.0-beta3 (target: vs)\nInstalling LuaJIT 2.1.0-beta3 (target: vs)\nFetching LuaRocks 3.7.0 (cached)\nVerifying SHA256 checksum\nBuilding and installing LuaRocks 3.7.0</code></pre></div>'}}),"\n",l.createElement(t.p,null,"lua はシステムにインストールして全体でライブラリを共有するというよりは、\nプロジェクト単位でインストールしてローカルに必要なライブラリだけを追加するという運用になりそう。\nなので、 hererocks でプロジェクトローカルに lua をサクッとビルドできるのはなかなかよい。\npython の venv 的な運用。\n展開先は、 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">.gitignore</code>'}})," する。"),"\n",l.createElement(t.p,null,"ただ、外部ライブラリのラッパーがさくっと動くかというと Windows だと厳しいものがありますな・・・。\nvcpkg と連携させるとか、更なる頑張りが必要かもしれない。\nなので、 luajit の ffi が面白いかもしれない。\nstandalone の lua インタプリタを使う場合は ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">hererocks</code>'}})," がいいのではないか。"),"\n",l.createElement(t.h2,null,"vswhere メモ"),"\n",l.createElement(t.p,null,"https://github.com/Microsoft/vswhere"),"\n",l.createElement(t.p,null,l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">cl.exe</code>'}}),", ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">msbuild.exe</code>'}})," などの探索に使う。\n",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">vs2017 version 15.2</code>'}})," 以降に入っているらしい。"),"\n",l.createElement(t.p,null,"こんな感じに使う。"),"\n",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text"># %ProgramFiles(x86)%\\Microsoft Visual Studio\\Installer\\vswhere.exe\n> vswhere -nologo -products *\ninstanceId: 6762dfe1\ninstallDate: 2020/07/21 9:26:34\ninstallationName: VisualStudio/16.7.3+30503.244\ninstallationPath: C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\BuildTools\ninstallationVersion: 16.7.30503.244\nproductId: Microsoft.VisualStudio.Product.BuildTools\nproductPath: C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\BuildTools\\Common7\\Tools\\LaunchDevCmd.bat\nstate: 4294967295\nisComplete: 1\nisLaunchable: 1\nisPrerelease: 0\nisRebootRequired: 0\ndisplayName: Visual Studio Build Tools 2019\ndescription: Visual Studio Build Tools では、Visual Studio IDE を必要とせずに、MSBuild ベースのネイティブ マネージド アプリケーションをビルドできます。また、Visual C++ のコンパイラやライブラリ、MFC、ATL、および C++/CLI サポートをインストールするオプションも用意されています。\nchannelId: VisualStudio.16.Release\nchannelUri: https://aka.ms/vs/16/release/channel\nenginePath: C:\\Program Files (x86)\\Microsoft Visual Studio\\Installer\\resources\\app\\ServiceHub\\Services\\Microsoft.VisualStudio.Setup.Service\nreleaseNotes: https://go.microsoft.com/fwlink/?LinkId=660893#16.7.3\nthirdPartyNotices: https://go.microsoft.com/fwlink/?LinkId=660909\nupdateDate: 2020-09-13T06:19:26.0508205Z\ncatalog_buildBranch: d16.7\ncatalog_buildVersion: 16.7.30503.244\ncatalog_id: VisualStudio/16.7.3+30503.244\ncatalog_localBuild: build-lab\ncatalog_manifestName: VisualStudio\ncatalog_manifestType: installer\ncatalog_productDisplayVersion: 16.7.3\ncatalog_productLine: Dev16\ncatalog_productLineVersion: 2019\ncatalog_productMilestone: RTW\ncatalog_productMilestoneIsPreRelease: False\ncatalog_productName: Visual Studio\ncatalog_productPatchVersion: 3\ncatalog_productPreReleaseMilestoneSuffix: 1.0\ncatalog_productSemanticVersion: 16.7.3+30503.244\ncatalog_requiredEngineVersion: 2.7.3132.26759\nproperties_campaignId:\nproperties_channelManifestId: VisualStudio.16.Release/16.7.3+30503.244\nproperties_nickname:\nproperties_setupEngineFilePath: C:\\Program Files (x86)\\Microsoft Visual Studio\\Installer\\vs_installershell.exe</code></pre></div>'}}),"\n",l.createElement(t.p,null,"https://github.com/microsoft/vswhere/wiki/Find-VC"),"\n",l.createElement(t.p,null,"フィルタをかけられる。"),"\n",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">> vswhere -latest -products * -requires Microsoft.VisualStudio.Component.VC.Tools.x86.x64 -property installationPath\nC:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\BuildTools</code></pre></div>'}}),"\n",l.createElement(t.p,null,"見つかったパスから先は固定であるとみなして、 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">vcvars64.bat</code>'}})," などを見つける。"))}var o=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,a.ah)(),e.components);return t?l.createElement(t,e,l.createElement(s,e)):s(e)},r=(n(8678),n(8838));const i={code:e=>{let{children:t,className:n}=e;return n?l.createElement(r.Z,{className:n},t):l.createElement("code",null,t)}};function c(e){let{data:t,children:n}=e;return l.createElement(l.Fragment,null,l.createElement("h1",null,t.mdx.frontmatter.title),l.createElement(a.Zo,{components:i},n))}function u(e){return l.createElement(c,e,l.createElement(o,e))}}}]);
//# sourceMappingURL=component---src-templates-post-template-js-content-file-path-home-runner-work-ousttrue-github-io-ousttrue-github-io-content-posts-2021-fix-hererocks-md-1747a18d41d65b27378d.js.map