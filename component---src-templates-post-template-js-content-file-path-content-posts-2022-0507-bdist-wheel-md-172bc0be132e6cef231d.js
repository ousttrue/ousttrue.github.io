"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7344],{8343:function(n,a,s){s.r(a),s.d(a,{default:function(){return k}});var t=s(1151),e=s(7294);function p(n){const a=Object.assign({h1:"h1",span:"span",p:"p",code:"code"},(0,t.ah)(),n.components);return e.createElement(e.Fragment,null,e.createElement(a.h1,null,"bdist_wheel + pep517 ではまる"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">setup.py bdist_wheel</code></pre></div>'}}),"\n",e.createElement(a.p,null,"なら成功するが、"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">pip wheel .</code></pre></div>'}}),"\n",e.createElement(a.p,null,"だと失敗するという現象に悩まされる。\ncmake でビルドしている extension の pyd が含まれないのである。"),"\n",e.createElement(a.p,null,"原因は、 ",e.createElement(a.code,null,"setup.py")," の下記の記述。"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">build_ext_cmake</span><span class="token punctuation">(</span>build_ext<span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">for</span> ext <span class="token keyword">in</span> self<span class="token punctuation">.</span>extensions<span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>build_cmake<span class="token punctuation">(</span>ext<span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">build_cmake</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> ext<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token comment"># these dirs will be created in build_py, so if you don\'t have</span>\n        <span class="token comment"># any python sources to bundle, the dirs will be missing</span>\n        build_temp <span class="token operator">=</span> pathlib<span class="token punctuation">.</span>Path<span class="token punctuation">(</span>self<span class="token punctuation">.</span>build_temp<span class="token punctuation">)</span>\n        build_temp<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>parents<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n        ext_path <span class="token operator">=</span> pathlib<span class="token punctuation">.</span>Path<span class="token punctuation">(</span>self<span class="token punctuation">.</span>get_ext_fullpath<span class="token punctuation">(</span>ext<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># &lt;- これ</span>\n        ext_path<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>parents<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"直した。"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">        ext_path <span class="token operator">=</span> pathlib<span class="token punctuation">.</span>Path<span class="token punctuation">(</span>self<span class="token punctuation">.</span>get_ext_fullpath<span class="token punctuation">(</span>ext<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>absolute<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"たぶん、 ",e.createElement(a.code,null,"get_ext_fullpath")," が相対パスを返していて、変なところに ",e.createElement(a.code,null,"pyd")," が出力されていた。\npip の時だけフォルダの構成や pwd が変わっている様子。"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">pip wheel . -v</code></pre></div>'}}),"\n",e.createElement(a.p,null,"として、ログと睨めっこしていたら気付いた。\npip が subprocess とか使うので、デバッガがアタッチできなくて、なかなかわからなかった。"))}var l=function(n){void 0===n&&(n={});const{wrapper:a}=Object.assign({},(0,t.ah)(),n.components);return a?e.createElement(a,n,e.createElement(p,n)):p(n)},c=s(8678),o=s(4160),u=s(8736);const i={code:n=>{let{children:a,className:s}=n;return s?e.createElement(u.Z,{className:s},a):e.createElement("code",null,a)}};function r(n){let{data:a,children:s}=n;const p=a.mdx.frontmatter;return e.createElement(c.Z,null,e.createElement("h1",null,p.title),e.createElement("div",{className:"tags-index"},p.tags&&p.tags.length>0&&p.tags.map((n=>e.createElement(o.rU,{to:"/tags/"+n+"/",itemProp:"url"},e.createElement("button",null,n))))),e.createElement(t.Zo,{components:i},s))}function k(n){return e.createElement(r,n,e.createElement(l,n))}}}]);
//# sourceMappingURL=component---src-templates-post-template-js-content-file-path-content-posts-2022-0507-bdist-wheel-md-172bc0be132e6cef231d.js.map