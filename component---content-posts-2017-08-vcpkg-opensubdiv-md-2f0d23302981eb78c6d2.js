"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4930],{1397:function(e,n,t){t.r(n);var l=t(1151),a=t(7294);function r(e){const n=Object.assign({p:"p",pre:"pre",code:"code"},(0,l.ah)(),e.components);return a.createElement(a.Fragment,null,a.createElement(n.p,null,"CEDEC2017のセッションを聞いてUSDビルドする気が戻ってきた。部品のひとつ、OpenSubdivのvcpkg版ビルドに取り組んでみる。"),"\n",a.createElement(n.p,null,"packageを作る\nPOWERSHELLを開いてvcpkgディレクトリに移動。"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-shell"},"PS> .\\vcpkg.exe create opensubdiv https://github.com/PixarAnimationStudios/OpenSubdiv/archive/v3_3_0.tar.gz\n-- Generated portfile: vcpkg\\ports\\opensubdiv\\portfile.cmake\n-- Generated CONTROL: vcpkg\\ports\\opensubdiv\\CONTROL\n-- To launch an editor for these new files, run\n--     .\\vcpkg edit opensubdiv\n\nports/opensubdiv/CONTROL\nSource: opensubdiv\nVersion: 3.3.0\nDescription: An Open-Source subdivision surface library.\nBuild-Depends: tbb, glew, ptex\n")),"\n",a.createElement(n.p,null,a.createElement(n.code,null,"ports/opensubdiv/portfile.cmake")),"\n",a.createElement(n.p,null,"最低限、展開するアーカイブのパスを指定。"),"\n",a.createElement(n.p,null,a.createElement(n.code,null,"set(SOURCE_PATH ${CURRENT_BUILDTREES_DIR}/src/OpenSubdiv-3_3_0)")),"\n",a.createElement(n.p,null,"ビルドしてみる\nさすがにエラーになる。vcpkg の ",a.createElement(n.code,null,"buildtree/opensubdiv")," に潜ってビルド手順を調べてみる。\n手動ビルド\nOpenSubdivのビルドシステムはCMakeだった。\n早速、CmakeGUIでやってみる。\n",a.createElement(n.code,null,"CMAKE_INSTALL_PREFIX=VCPKG_DIR/installed/x64-windows")," だけ設定して様子を見る。"),"\n",a.createElement(n.p,null,"CUDAとかOpenCLとかそっち方面の依存がある様子。\nNO_CUDAとNO_OPENCLにチェックを入れてみる。\nあとNO_DOCも。\nSolutionをGenerateしてビルドしてみる。\nDebug版だけtbb_debug.libが見つからないエラーが出た。\nDEBUG版のFIND_PACKAGEの修正"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-cmake"},'OpenSubdiv-3_3_0/cmake/FindTBB.cmake\n    find_library(TBB_${TBB_LIB}_LIBRARY\n        NAMES\n            ${TBB_LIB}\n        HINTS\n            "${TBB_LOCATION}/lib"\n            "${TBB_LOCATION}/bin"\n            "$ENV{TBB_LOCATION}/lib"\n            "$ENV{TBB_LOCATION}/bin"\n            "$ENV{PROGRAMFILES}/TBB/lib"\n            /usr/lib\n            /usr/lib/w32api\n            /usr/local/lib\n            /usr/X11R6/lib\n        PATH_SUFFIXES\n            "${TBB_LIB_ARCH}"\n            "${TBB_LIB_ARCH}/${TBB_COMPILER}"\n            "${TBB_LIB_ARCH}/gcc4.4"\n            "${TBB_LIB_ARCH}/gcc4.1"\n        DOC "Intel\'s Threading Building Blocks library")\n')),"\n",a.createElement(n.p,null,"vcpkgでは、",a.createElement(n.code,null,"VCPKG_DIR/installed/x64-windows/debug/lib/tbb_debug.lib")," にあるので見つかりませんね。\n",a.createElement(n.code,null,"TBB_LOCATION=VCPKG_DIR/installed/x64-windows/debug")," を指定したらうまくいった。"),"\n",a.createElement(n.p,null,"portfile.cmakeに反映\nports/opensubdiv/portfile.cmake\nこうなった。"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-cmake"},"vcpkg_configure_cmake(\n    SOURCE_PATH ${SOURCE_PATH}\n    #PREFER_NINJA # Disable this option if project cannot be built with Ninja\n    OPTIONS\n        #-DNO_LIB=1\n        -DNO_CUDA=1\n        -DNO_DOC=1\n        -DNO_OPENCL=1\n        -DNO_OPENGL=1\n        -DNO_METAL=1\n        -DNO_DX=1\n        #-DNO_OMP=1\n        -DNO_TESTS=1\n        -DNO_EXAMPLES=1\n        -DNO_TUTORIALS=1\n        -DNO_REGRESSION=1\n        -DNO_GLTESTS=1\n        # for tbb_debug.lib\n        -DTBB_LOCATION=${CURRENT_INSTALLED_DIR}/debug\n    # OPTIONS_RELEASE -DOPTIMIZE=1\n    # OPTIONS_DEBUG -DDEBUGGABLE=1\n)\n")),"\n",a.createElement(n.p,null,"package\nVCPKG_DIR/packages/opensubdiv_x86-windows\npackageの調整\nエラーメッセージの指示に従って。"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-ports/opensubdiv/portfile.cmake"},"vcpkg_install_cmake()\nvcpkg_copy_pdbs()\n\nfile(REMOVE_RECURSE ${CURRENT_PACKAGES_DIR}/debug/include)\n\n# Handle copyright\nfile(COPY ${CURRENT_BUILDTREES_DIR}/src/OpenSubdiv-3_3_0/LICENSE.txt DESTINATION ${CURRENT_PACKAGES_DIR}/share/opensubdiv)\nfile(RENAME ${CURRENT_PACKAGES_DIR}/share/opensubdiv/LICENSE.txt ${CURRENT_PACKAGES_DIR}/share/opensubdiv/copyright)\n")),"\n",a.createElement(n.p,null,"以下のようになった。"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-shell"},"+---debug\n|   \\---lib\n|           osdCPU.lib\n|\n+---include\n|   \\---opensubdiv\n|       |   version.h\n|       |\n|       +---far\n|       |       error.h\n|       |       patchDescriptor.h\n|       |       patchMap.h\n|       |       patchParam.h\n|       |       patchTable.h\n|       |       patchTableFactory.h\n|       |       primvarRefiner.h\n|       |       ptexIndices.h\n|       |       stencilTable.h\n|       |       stencilTableFactory.h\n|       |       topologyDescriptor.h\n|       |       topologyLevel.h\n|       |       topologyRefiner.h\n|       |       topologyRefinerFactory.h\n|       |       types.h\n|       |\n|       +---hbr\n|       |       allocator.h\n|       |       bilinear.h\n|       |       catmark.h\n|       |       cornerEdit.h\n|       |       creaseEdit.h\n|       |       face.h\n|       |       faceEdit.h\n|       |       fvarData.h\n|       |       fvarEdit.h\n|       |       halfedge.h\n|       |       hierarchicalEdit.h\n|       |       holeEdit.h\n|       |       loop.h\n|       |       mesh.h\n|       |       subdivision.h\n|       |       vertex.h\n|       |       vertexEdit.h\n|       |\n|       +---osd\n|       |       bufferDescriptor.h\n|       |       cpuEvaluator.h\n|       |       cpuPatchTable.h\n|       |       cpuVertexBuffer.h\n|       |       mesh.h\n|       |       nonCopyable.h\n|       |       ompEvaluator.h\n|       |       ompKernel.h\n|       |       opengl.h\n|       |       tbbEvaluator.h\n|       |       tbbKernel.h\n|       |       types.h\n|       |\n|       +---sdc\n|       |       bilinearScheme.h\n|       |       catmarkScheme.h\n|       |       crease.h\n|       |       loopScheme.h\n|       |       options.h\n|       |       scheme.h\n|       |       types.h\n|       |\n|       \\---vtr\n|               array.h\n|               componentInterfaces.h\n|               fvarLevel.h\n|               fvarRefinement.h\n|               level.h\n|               refinement.h\n|               sparseSelector.h\n|               stackBuffer.h\n|               types.h\n|\n+---lib\n|       osdCPU.lib\n|\n\\---share\n    \\---opensubdiv\n            copyright\n")),"\n",a.createElement(n.p,null,"OpenSubdivにはdllのビルドは無いみたい。ライブラリ構成もtemplate classを主体とするもののようだ。"))}n.default=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,l.ah)(),e.components);return n?a.createElement(n,e,a.createElement(r,e)):r(e)}},1151:function(e,n,t){t.d(n,{ah:function(){return r}});var l=t(7294);const a=l.createContext({});function r(e){const n=l.useContext(a);return l.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}}}]);
//# sourceMappingURL=component---content-posts-2017-08-vcpkg-opensubdiv-md-2f0d23302981eb78c6d2.js.map