<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="ja">
<head>
<meta charset="utf-8">
<meta name="description" content="作業記録">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>三次元日誌 (過去の記事 10ページ目) | 三次元日誌</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="ja" href="rss.xml">
<link rel="canonical" href="https://ousttrue.github.io/index-10.html">
<link rel="prev" href="index-11.html" type="text/html">
<link rel="next" href="index-9.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">本文を読み飛ばす</a>

<!-- Header and menu bar -->
<div class="container">
      <header class="blog-header py-3"><div class="row nbb-header align-items-center">
          <div class="col-md-3 col-xs-2 col-sm-2" style="width: auto;">
            <button class="navbar-toggler navbar-light bg-light nbb-navbar-toggler" type="button" data-toggle="collapse" data-target=".bs-nav-collapsible" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse bs-nav-collapsible bootblog4-search-form-holder">
                
            </div>
        </div>
          <div class="col-md-6 col-xs-10 col-sm-10 bootblog4-brand" style="width: auto;">
            <a class="navbar-brand blog-header-logo text-dark" href=".">

            <span id="blog-title">三次元日誌</span>
        </a>
          </div>
            <div class="col-md-3 justify-content-end align-items-center bs-nav-collapsible collapse flex-collapse bootblog4-right-nav">
            <nav class="navbar navbar-light bg-white"><ul class="navbar-nav bootblog4-right-nav"></ul></nav>
</div>
    </div>
</header><nav class="navbar navbar-expand-md navbar-light bg-white static-top"><div class="collapse navbar-collapse bs-nav-collapsible" id="bs-navbar">
            <ul class="navbar-nav nav-fill d-flex w-100">
<li class="nav-item">
<a href="archive.html" class="nav-link">Archives</a>
                </li>
<li class="nav-item">
<a href="categories/index.html" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
</div>
<!-- /.navbar-collapse -->
</nav>
</div>

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
    
        

    
        
    <div class="postindex">
            <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2017/05/hugo_layout/" class="u-url">Hugoのレイアウトとコンテントの関係</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2017/05/hugo_layout/" rel="bookmark">
            <time class="published dt-published" datetime="2017-05-22T00:00:00Z" itemprop="datePublished" title="2017-05-22 00:00">2017-05-22 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2017/05/hugo_layout/#disqus_thread" data-disqus-identifier="cache/content/posts/2017/05/hugo_layout.html">コメント</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>概要</p>
<p>hugoコマンド実行時に以下のタスクが実行される
contentのmdファイルをsingle.htmlを使ってhtmlに変換する(1対1)
contentのサブフォルダをsectionと呼ぶ。sectionのサブフォルダはsectionにならない
sectionのindex.htmlをlist.htmlで生成する
topのindex.htmlをindex.htmlまたはlist.htmlで生成する(サイト全体で1)</p>
<pre class="code literal-block"><span></span>     +-------+
     |layouts|
     +-------+
         |
         v
</pre>

<p>content -----+-------&gt; public / (index.html or list.html) -&gt; index.html
  + post                    + post / (list.html) -&gt; index.html
    + 2017                    + 2017
      + 05                      + 05
        + article1.md             + article1 / (single.html) -&gt; index.html
        + article2.md             + article2 / (single.html) -&gt; index.html
        + article3.md             + article3 / (single.html) -&gt; index.html</p>
<p>contentフォルダの構成</p>
<p>https://gohugo.io/overview/source-directory/#content-for-home-page-and-other-list-pages</p>
<p>個別記事(single content)のmdをhtmlに変換する</p>
<p>https://gohugo.io/templates/content/</p>
<p>個々のページをhtmlに変換(render)するときにどのTemplateを選択するのかについての説明が上記にある。
デフォルトは /themes/THEME/layouts/_default/single.htmlが使われる。
セクション毎にセクション内の記事のリスト(list content)のhtmlを生成する</p>
<p>https://gohugo.io/templates/list/</p>
<p>セクションページのhtmlを生成するときにどのTemplateを選択するのかについての説明が上記にある。
デフォルトは/themes/THEME/layouts/_default/list.htmlが使われる。
サイトトップのhtmlを生成する</p>
<p>https://gohugo.io/templates/homepage/</p>
<p>サイトトップのhtmlを生成するときにどのTemplateを選択するのかについての説明が上記にある。
以下の順に選択される。</p>
<p>/themes/THEME/layouts/index.html
/themes/THEME/layouts/_default/list.html
/themes/THEME/layouts/_default/single.html</p>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2017/05/hugo_dict/" class="u-url">hugoでmapを使ってpartialに追加の変数を渡す</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2017/05/hugo_dict/" rel="bookmark">
            <time class="published dt-published" datetime="2017-05-14T00:00:00Z" itemprop="datePublished" title="2017-05-14 00:00">2017-05-14 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2017/05/hugo_dict/#disqus_thread" data-disqus-identifier="cache/content/posts/2017/05/hugo_dict.html">コメント</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>hugoのrange内のpartialから.Siteにアクセスできなくて困ったので、代替する方法を探した。</p>
<p>こんな感じ。
config.tomlでSite.Params.tagiconsを定義。
[Params.tagicons]
python = "icon-python"
tinkerer = "icon-python"
gulp = "icon-gulp"
ruby = "icon-ruby"
heroku = "icon-heroku"</p>
<p>partial呼び出し。
{{ range .Params.tags }} 
    {{ partial "tags.html" (dict "tag" . "icons" $.Site.Params.tagicons) }}
{{ end }}</p>
<p>partialで使う。
<i class="{{ index .icons .tag }}" aria-hidden="true"></i>
{{ .tag }}</p>
<p>http://gohugo.io/templates/functions/#dict</p>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2017/05/blender_secondary/" class="u-url">Blenderで揺れ物</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2017/05/blender_secondary/" rel="bookmark">
            <time class="published dt-published" datetime="2017-05-06T00:00:00Z" itemprop="datePublished" title="2017-05-06 00:00">2017-05-06 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2017/05/blender_secondary/#disqus_thread" data-disqus-identifier="cache/content/posts/2017/05/blender_secondary.html">コメント</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>MmdUtilityでmmdモデルをインポートして物理を取り入れるべく、Blenderの物理で揺れ物をセットアップする方法を調べている。</p>
<p>剛体を入れる
素直にmeshオブジェクトを作って剛体を設定していく。
剛体とボーンを連動させる
ボーンの動きを剛体に反映する(ゆれない。ゆれものの接続先)
Kinematic、BlenderではPassiveかつAnimatedになる設定。
ボーンの動きを剛体に伝えなければならないので剛体オブジェクトにコンストレイントを追加する。copy transformかchild ofが候補になる。どっちも問題がある。copy transformにするとボーンのヘッドのtransformを剛体の中心にコピーするのでずれる。child ofにすると剛体の親とボーンの両方の影響を受けるようになってしまうので原点から移動できなくなる。前者の方が致命的なので後者を選択して、剛体の親オブジェクトが原点に留まるように工夫することにする。
剛体の動きを骨に反映する(ゆれもの)
Dynamic,  BlenderではActive。
剛体の動きをボーンに伝えるべく、ポーズボーンにコンストレイントを追加する。child ofで剛体を指定する。この場合、親ボーンと剛体の両方の影響を受けてしまうので親ボーンの影響を切らねばならない。parentにNoneをセットするか、use_inherit_rotation, use_inherit_scale, use_inherit_locationをFalseにするのだけど、そうすると今度はポーズを変えたときについてこなくなる。一筋縄でいかないな・・・。ポーズ変えたときに追随させるスクリプトを用意すべしということか。
参考</p>
<ul>
<li><a href="https://github.com/12funkeys/rigid_bodys_gen">https://github.com/12funkeys/rigid_bodys_gen</a></li>
<li><a href="http://mrsoramame.jpn.org/archives/138">http://mrsoramame.jpn.org/archives/138</a></li>
</ul>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2017/05/font_mfizz/" class="u-url">Geek向けアイコンフォントfont-mfizz</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2017/05/font_mfizz/" rel="bookmark">
            <time class="published dt-published" datetime="2017-05-06T00:00:00Z" itemprop="datePublished" title="2017-05-06 00:00">2017-05-06 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2017/05/font_mfizz/#disqus_thread" data-disqus-identifier="cache/content/posts/2017/05/font_mfizz.html">コメント</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>bootstrap入れたのでfontawesomeも取り入れてみたのだが、よりgeek向けのアイコンフォントを見つけた。</p>
<p>http://fizzed.com/oss/font-mfizz
プログラミング言語のアイコンとかあったので取り入れてみた。</p>
<p>みんな大好きgopherくん</p>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2017/05/asio/" class="u-url">boostから独立したasio</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2017/05/asio/" rel="bookmark">
            <time class="published dt-published" datetime="2017-05-05T00:00:00Z" itemprop="datePublished" title="2017-05-05 00:00">2017-05-05 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2017/05/asio/#disqus_thread" data-disqus-identifier="cache/content/posts/2017/05/asio.html">コメント</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>vcpkgを眺めていたらnot boostなasioを発見した。</p>
<p>asioをBoostに含まれているオフィシャル感のあるクロスプラットフォームな通信ライブラリととらえていたのだけど、c++11でboostのよく使う部分がc++にかなり取り込まれて肥大化する一方のboostを避ける気持ちが生まれていた。</p>
<p><a href="http://think-async.com/Asio/AsioAndBoostAsio">http://think-async.com/Asio/AsioAndBoostAsio</a></p>
<p>読んでみるとついにヘッダオンリー化を果たしたらしい。boostの外に出ないとヘッダオンリー化が難しそうではある。たしか、asioはsocket周りじゃなくてerror周りのクラスがコンパイル対象なのに引きずられてasioを使うにはコンパイルを強いられるということがあった。技術的にはだいぶ前からヘッダオンリー化は可能であったのだろうがついにやってくれたか。素晴らしい。解凍するとギガ単位になる最近のboostはいかがなものかと思ってた。
稀に使われているぽい、拙作のmsgpack-asioもヘッダオンリーのasioを使って近代化したいなぁ。あと、msgpackの実装も
<a href="https://github.com/nlohmann/json">https://github.com/nlohmann/json</a>
に切り替えたい。
c++11以降、c++界隈が活性化しているような気がするな。</p>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2017/05/hugo_theme/" class="u-url">Hugoのテーマ作り</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2017/05/hugo_theme/" rel="bookmark">
            <time class="published dt-published" datetime="2017-05-05T00:00:00Z" itemprop="datePublished" title="2017-05-05 00:00">2017-05-05 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2017/05/hugo_theme/#disqus_thread" data-disqus-identifier="cache/content/posts/2017/05/hugo_theme.html">コメント</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>hugoの仕組みも気になることだし作ってみることにした。</p>
<p>Hugoのテーマを何個か作ったので知見をまとめてみる
https://gohugo.io/tutorials/creating-a-new-theme/</p>
<p>新しくテーマを作る
$ hugo new theme hoge</p>
<p>themes/hogeにテーマのテンプレートが作成される。
３つのテンプレート
layout/index.html</p>

<p></p>

  {{- range first 10 .Data.Pages }}
    <h5><a href="posts/2017/05/hugo_theme/%7B%7B%20.Permalink%20%7D%7D">{{ .Title }}</a></h5>
  {{- end }}

<p></p>
<p>layout/_default/single.html</p>

<p>
</p>
  <title>{{ .Title }}</title>
<h2>{{ .Title }}</h2>
  <h6>{{ .Date.Format "Mon, Jan 2, 2006" }}</h6>
  {{ .Content }}
  <h5><a href="posts/2017/05/hugo_theme/%7B%7B%20.Site.BaseURL%20%7D%7D">Home</a></h5>

<p></p>
<p>layout/_default/list.html</p>

<p></p>

  <h2>Articles</h2>
  {{- range first 10 .Data.Pages }}
    <h5><a href="posts/2017/05/hugo_theme/%7B%7B%20.Permalink%20%7D%7D">{{ .Title }}</a></h5>
  {{- end }}
  <h5><a href="posts/2017/05/hugo_theme/%7B%7B%20.Site.BaseURL%20%7D%7D">Home</a></h5>

<p></p>
<p>partial導入
layout/_default/header.html
layout/_default/footer.html
bootstrap</p>
<p>http://getbootstrap.com/</p>
<p>2column
sticky-footer
tags</p>
<p>http://text.baldanders.info/hugo/section/
http://text.baldanders.info/hugo/categories-and-tags-list/</p>
<p>付ける
frontmatterに
tags = ["hugo"]</p>
<p>のように書く。よくわからないがアルファベットの大文字は避けた方がよさげ。マルチバイト文字はOKぽい。
single
.Params.tagsに格納されているので以下のようにして使う
{{ range .Params.tags }}
<a href="tags/%7B%7B%20.%20%7C%20urlize%20%7D%7D/">{{ . }}</a>
{{ end }}</p>
<p>list
.Data.Pagesを列挙して中から取り出せる
{{ range .Data.Pages }}
    </p>
<hr>
    {{ range .Params.tags }}
    <a href="tags/%7B%7B%20.%20%7C%20urlize%20%7D%7D/">{{ . }}</a>
    {{ end }}
{{ end}}
<p>サイトのタグ一覧</p>
<p>Hugoでwebサイト構築(12) タグの列挙
https://gohugo.io/taxonomies/ordering/</p>
<p>{{ range $name, $value := $.Site.Taxonomies.Alphabetical }}
    </p>
<li>
        <a href="posts/2017/05/hugo_theme/%7B%7B%20%24.Site.BaseURL%20%7D%7D/tags/%7B%7B%20%24name%20%7D%7D/">
        <div>
<span class="badge">{{ .Count }}</span>{{ $name }}</div>
        </a>
    </li>
{{ end }}
<p>pagination</p>
<p>http://wdkk.co.jp/note/2015/0915-hugo-pagination/
https://gohugo.io/extras/pagination/</p>
<p>more</p>
<p>https://gohugo.io/content/summaries/</p>
<p>目次</p>
<p>https://gohugo.io/extras/toc/</p>
<p>syntax highlight</p>
<p>https://gohugo.io/extras/highlighting/</p>
<p>prev/next</p>
<p>http://qiita.com/y_hokkey/items/f9d8b66b3770a82d4c1c#%E5%89%8D%E3%81%AE%E8%A8%98%E4%BA%8B%E6%AC%A1%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%B8%E3%81%AE%E3%83%8A%E3%83%93%E3%82%B2%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3</p>
<p>作業中
あまりかっこよくならんね…。
とりあえず読めるようにはなってきた。
まぁ、見易さ優先で。</p>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2017/05/vcpkg/" class="u-url">vc向けのメタビルドツールvcpkgを発見</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2017/05/vcpkg/" rel="bookmark">
            <time class="published dt-published" datetime="2017-05-04T00:00:00Z" itemprop="datePublished" title="2017-05-04 00:00">2017-05-04 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2017/05/vcpkg/#disqus_thread" data-disqus-identifier="cache/content/posts/2017/05/vcpkg.html">コメント</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>uwp向けのlibpngのビルドのエラーを修正する過程でvcpkgを見つけた。
vc向けのメタビルドツールの予感。</p>
<p>cloneして</p>
<blockquote>
<p>git clone https://github.com/Microsoft/vcpkg.git</p>
</blockquote>
<p>buildする</p>
<blockquote>
<p>cd vcpkg
vcpkg&gt; ./bootstrap.bat</p>
</blockquote>
<p>UWP版のpackageインストール
vcpkg&gt; ./vcpkg install libpng:x86-uwp</p>
<p>なるほど。
OpenCVのUWP版はあるかな・・・。
vcpkg&gt; ./vcpkg install opencv:x86-uwp</p>
<p>あった。
最新版のopencv-3.2.0もビルドできるやん。
一瞬にして作り始めていた、
https://github.com/ousttrue/bldproc/tree/master/procs
がオワコンになった。
検索してみたら日本語の紹介記事が一つあった。</p>
<p>【速報】Vcpkg: Windowsの公式C++ライブラリ管理ツール</p>
<p>desktopビルドできた</p>
<p>ffpmeg(msys2をダウンロードして使っていた。わかる)</p>
<p>uwpビルドできた</p>
<p>opencv
openssl</p>
<p>uwpビルドできなかった</p>
<p>cairo。途中でpeclのビルドに失敗する(pixmanはビルドできたのでオプション外せばいけそう)。
bullet3。ちょっと修正が要るか</p>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2017/05/uwp_dll/" class="u-url">UWPでNativeDllを使う</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2017/05/uwp_dll/" rel="bookmark">
            <time class="published dt-published" datetime="2017-05-03T00:00:00Z" itemprop="datePublished" title="2017-05-03 00:00">2017-05-03 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2017/05/uwp_dll/#disqus_thread" data-disqus-identifier="cache/content/posts/2017/05/uwp_dll.html">コメント</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>UWPでNativeのDLLを使うとどんな感じなのか試してみた。</p>
<p>https://github.com/ousttrue/UwpNativeDllSample</p>
<p>CMakeのCache機構のせいで挙動を勘違いした部分を書き直し。</p>
<p>自前でビルドしたlibpng.dllでpngを表示するサンプル。
デスクトップアプリとの違い</p>
<p>dllのロードパスがカレントディレクトリと環境変数PATHに記述された場所ではなく、projectのトップレベルのみ
デスクトップと公開されているAPIに差異がある
projectが違う。x86 vxprojとuwp32 vcxprojのdiffの抜粋。</p>
<blockquote>
<pre class="code literal-block"><span></span><span class="nt">&lt;ApplicationType&gt;</span>Windows Store<span class="nt">&lt;/ApplicationType&gt;</span>^M
<span class="nt">&lt;DefaultLanguage&gt;</span>en-US<span class="nt">&lt;/DefaultLanguage&gt;</span>^M
<span class="nt">&lt;ApplicationTypeRevision&gt;</span>10.0<span class="nt">&lt;/ApplicationTypeRevision&gt;</span>^M
<span class="nt">&lt;MinimumVisualStudioVersion&gt;</span>14.0<span class="nt">&lt;/MinimumVisualStudioVersion&gt;</span>^M
<span class="nt">&lt;AppContainerApplication&gt;</span>true<span class="nt">&lt;/AppContainerApplication&gt;</span>^M
</pre>

</blockquote>
<p>zlib-1.2.11を無修正でビルドできた。
libpng-1.6.29は_ExitProcessにリンクする段階でエラーになった</p>
<p>修正方法が書いてあった。</p>
<p>https://github.com/Microsoft/vcpkg/blob/master/docs/example-3-patch-libpng.md</p>
<p>UWP向けビルドオプション/zw
無くても動いた。UWP固有のAPIにアクセスするときもしくはC++/CXに必要？</p>
<p>https://msdn.microsoft.com/ja-jp/library/hh561383.aspx</p>
<p>cmakeでWindowsStore向けのprojectを生成する
Microsoft版のcmakeなら作れる。
VS2017にも含まれていて以下のパスにあった。
C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\Common7\IDE\CommonExtensions\Microsoft\CMake\CMake\bin\cmake.exe
本家のcmakeでもできるかもしれないが未確認。
プロジェクトを生成するときに以下のオプションを指定する。</p>
<p>-DCMAKE_SYSTEM_NAME=WindowsStore
-DCMAKE_SYSTEM_VERSION=10.0</p>
<p>これだけだとCMAKE_SYSTEM_PROCESSORが空になってlibpngではエラーになる。追加で下記のオプションも指定した。</p>
<p>-DCMAKE_SYSTEM_PROCESSOR=x86</p>
<p>ほかに/zwの指定など。</p>
<p>-DCMAKE_C_FLAGS=/ZW /EHsc /DWIN32=1
-DCMAKE_CXX_FLAGS=/ZW /EHsc /DWIN32=1</p>
<p>例
zlib-1.2.11/build&gt; cmake.exe .. -G Visual Studio 15 2017 -DCMAKE_SYSTEM_PROCESSOR=x86 -DCMAKE_SYSTEM_NAME=WindowsStore -DCMAKE_SYSTEM_VERSION=10.0 -DCMAKE_C_FLAGS=/ZW /EHsc /DWIN32=1 -DCMAKE_CXX_FLAGS=/ZW /EHsc /DWIN32=1 </p>
<p _dll='"DLL' _hresult="(HRESULT" _libpng16_="'libpng16'">C#からDllImport
Desktopの時と記述方法は同じ。dllの配置場所は上記の通りprojectに放り込むだけ。
デスクトップ向けにビルドしたdllは動くのか
動いた。
逆にUWP向けにビルドしたdllはデスクトップで動くのか
動かなかった。ソース互換はある程度あるがバイナリ互換は無い。</p>
<p>このエラーがデスクトップでuwpのdllを呼び出したとき固有のエラーメッセージぽい。
まとめ
CMakeの場合はプロジェクト生成オプションさえわかれば、 デスクトップとそれほど使い勝手は変わらない。この煩雑な手順を記録しておくべく自動ビルドツール作成中。</p>
<p>https://github.com/ousttrue/bldproc</p>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2017/04/mmdbrige_build/" class="u-url">MmdBridgeのビルドスクリプトを作った</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2017/04/mmdbrige_build/" rel="bookmark">
            <time class="published dt-published" datetime="2017-04-24T00:00:00Z" itemprop="datePublished" title="2017-04-24 00:00">2017-04-24 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2017/04/mmdbrige_build/#disqus_thread" data-disqus-identifier="cache/content/posts/2017/04/mmdbrige_build.html">コメント</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>MmdBridgeのビルド手順をまとめたpythonスクリプトを作った。</p>
<p>https://github.com/ousttrue/mmdbridge</p>
<p>さくっとVisualStudio2015 64bit版をビルドできる。
WITH_VMD, WITH_PMXまで対応。
WITH_ALEMBICはいずれ。
Boost.Pythonをビルドするスクリプトも作ったのだけど、作業中に遭遇したpybuildがヘッダオンリーをと言っておりよさげだったので置き換えてみた。
Boost.Pythonの弱点のBoostを解凍するめんどくささ(Boostのファイル数は多すぎ)と、種類ごとにビルドしないといけない煩雑さから解放されるのでとてもよい。</p>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2017/04/boost_python/" class="u-url">Boost.Pythonのリンク周り</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2017/04/boost_python/" rel="bookmark">
            <time class="published dt-published" datetime="2017-04-22T00:00:00Z" itemprop="datePublished" title="2017-04-22 00:00">2017-04-22 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2017/04/boost_python/#disqus_thread" data-disqus-identifier="cache/content/posts/2017/04/boost_python.html">コメント</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>mmdbridgeのビルドで必要になったBoost.Python周り。
どうやら、OpenEXR界隈では結構使われている様子。
AlembicとかUSDとか。
しかしWindows版のBoost.Pythonはリンク周りにはまり要素が多いので、記録しといた。</p>
<p>Pythonへのリンク
python_d.libにリンクする必要がない場合
Python自体のデバッグをするのでなければpython_dにリンクする必要はない。
python_dへのリンクの必要性は、リンクするライブラリをDebugで統一する必要の有無なのだけど、
pydを作っているときは必要ない。python.exeではなくpython_d.exeから実行して何もかもが、Debugを参照するようにするのはつらい。そうではなくて自分のアプリがPythonを内臓する場合は、python_dにリンクした方がよい。DebugとReleaseの混在によるエラーが出る可能性があるので。で、mmdbridgeは後者なのでpython_dをリンクすることに妥当性がある。
python_d.libへのリンクを防止する</p>
<p>https://stackoverflow.com/questions/16200997/why-doesnt-include-python-h-work</p>
<h2>ifdef _DEBUG</h2>
<p>#undef _DEBUG
  #include <python.h>
  #define _DEBUG</python.h></p>
<h2>else</h2>
<p>#include <python.h></python.h></p>
<h2>endif</h2>
<p>これが、常套手段になるようでpydの開発時には入れておくとよい。
Boost.Pythonがpython_dにリンクする</p>
<p>boost-1.64.0
python-3.5.3</p>
<p>debug版のboostをビルドしたのだが、よく見るとRelease版のpython35.dllの方がリンクされていた。がんばって、DEBUGマクロの定義等を調べたのだがなかなかわからなかった。どうやらどこかでundef _DEBUGされているらしいと当たりがついた。</p>
<p>boost/python/detail/wrap_python.hpp</p>
<h2>ifdef _DEBUG</h2>
<h2>ifndef BOOST_DEBUG_PYTHON</h2>
<h2>ifdef _MSC_VER</h2>
<pre class="code literal-block"><span></span>// VC8.0 will complain if system headers are #included both with
// and without _DEBUG defined, so we have to #include all the
// system headers used by pyconfig.h right here.
</pre>

<h2>include <stddef.h></stddef.h>
</h2>
<h2>include <stdarg.h></stdarg.h>
</h2>
<h2>include <stdio.h></stdio.h>
</h2>
<h2>include <stdlib.h></stdlib.h>
</h2>
<h2>include <assert.h></assert.h>
</h2>
<h2>include <errno.h></errno.h>
</h2>
<h2>include <ctype.h></ctype.h>
</h2>
<h2>include <wchar.h></wchar.h>
</h2>
<h2>include <basetsd.h></basetsd.h>
</h2>
<h2>include <io.h></io.h>
</h2>
<h2>include <limits.h></limits.h>
</h2>
<h2>include <float.h></float.h>
</h2>
<h2>include <string.h></string.h>
</h2>
<h2>include <math.h></math.h>
</h2>
<h2>include <time.h></time.h>
</h2>
<h2>endif</h2>
<h2>undef _DEBUG // Don't let Python force the debug library just because we're debugging.</h2>
<h2>define DEBUG_UNDEFINED_FROM_WRAP_PYTHON_H</h2>
<h2>endif</h2>
<h2>endif</h2>
<p>python_d.libにリンクするには
b2 --with-python --debug-configuration python-debugging=on</p>
<p>として
libboost_python3-vc140-mt-gyd-1_64
を作成する。gydのyがpython debugらしい。
Boost.Pythonへのリンク
boostはどうやってリンクするライブラリの名前を決めているのか</p>
<h2>pragma comment(lib,"wsock32.lib")</h2>
<p>どこかに#pragmaが記述されているはずだが。</p>
<p>https://stackoverflow.com/questions/16200997/why-doesnt-include-python-h-work
http://d.hatena.ne.jp/torutk/20121004/p1</p>
<p>autolinkらしい。自動的に有効になる。</p>
<p>http://www.boost.org/doc/libs/1_48_0/boost/config/auto_link.hpp</p>
<p>pragmaリンクの名前が一致しないんだけど</p>
<p>libboost_python3-vc140-mt-gd-1_64にリンクしたいのだがlibboost_python-vc140-mt-gd-1_64にリンクしようとする
boost_python3_vc140-mt-gd-1_64にリンクしたいのいだがlibboost_python-vc140-mt-gd-1_64にリンクしようとする</p>
<p>BOOST_ALL_NO_LIB</p>
<p>を定義してautolinkを阻止して自分でリンクする。
python3はどうやって決まるのか
むしろboost_python3がBOOST_LIB_NAMEから決まる。
BOOST_LIB_NAMEは、boost/python/detail/config.hppで下記の記述がある。
boost-1.61.0</p>
<h2>define BOOST_LIB_NAME boost_python</h2>
<p>boost_python3.dllとboost_python.dllは両方Python3にリンクされとった
なんだってー。つまり、boostは複数のPythonに対するビルド結果を共存させることは考慮されていないということだった。なるほど
ReleaseビルドとDebugビルドは同じReleaseのdllにリンクするべき
Debug版であっても、boost_python.dllも同じRelease版にリンクされる。
AutoLinkに逆らわない方がよい。
CMakeのFIND_PACKAGE(BOOST)によるBoost_LIBRARIESは使わない方がよいかもしれない。デバッグの方にリンクされてはまりうる。ていうか、はまった。
結論として、AutoLink邪魔だーからAutoLinkに従えとなった。
pybindを使おう
ヘッダオンリーなので。リンク無いし。</p>
<p>https://github.com/pybind/pybind11</p>
<p>既存のBoost.Pythonを使ったコードでも、pybindはBoost.Pythonと似たAPIになっているので簡単に置き換えられる。</p>
<p>pybind11でC++の関数をpythonから使う</p>
</div>
                </div>
            </article>
</div>
    
        <ul class="pager postindexpager clearfix">
<li class="previous"><a href="index-11.html" rel="prev">新しい記事</a></li>
            <li class="next"><a href="index-9.html" rel="next">過去の記事</a></li>
        </ul>
<script>var disqus_shortname="nikolademo";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><!--End of body content--><footer id="footer">
            Contents © 2021         <a href="mailto:ousttrue@gmail.com">ousttrue</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
            
        </footer>
</div>
</div>


        <script src="assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
