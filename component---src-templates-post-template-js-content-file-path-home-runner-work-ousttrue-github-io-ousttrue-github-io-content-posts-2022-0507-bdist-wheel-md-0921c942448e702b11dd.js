"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9509],{8343:function(e,t,n){n.r(t),n.d(t,{default:function(){return p}});var l=n(1151),r=n(7294);function a(e){const t=Object.assign({h1:"h1",pre:"pre",code:"code",p:"p"},(0,l.ah)(),e.components);return r.createElement(r.Fragment,null,r.createElement(t.h1,null,"bdist_wheel + pep517 ではまる"),"\n",r.createElement(t.pre,null,r.createElement(t.code,null,"setup.py bdist_wheel\n")),"\n",r.createElement(t.p,null,"なら成功するが、"),"\n",r.createElement(t.pre,null,r.createElement(t.code,null,"pip wheel .\n")),"\n",r.createElement(t.p,null,"だと失敗するという現象に悩まされる。\ncmake でビルドしている extension の pyd が含まれないのである。"),"\n",r.createElement(t.p,null,"原因は、 ",r.createElement(t.code,null,"setup.py")," の下記の記述。"),"\n",r.createElement(t.pre,null,r.createElement(t.code,{className:"language-python"},"class build_ext_cmake(build_ext):\n\n    def run(self):\n        for ext in self.extensions:\n            self.build_cmake(ext)\n\n    def build_cmake(self, ext):\n        # these dirs will be created in build_py, so if you don't have\n        # any python sources to bundle, the dirs will be missing\n        build_temp = pathlib.Path(self.build_temp)\n        build_temp.mkdir(parents=True, exist_ok=True)\n        ext_path = pathlib.Path(self.get_ext_fullpath(ext.name)) # <- これ\n        ext_path.parent.mkdir(parents=True, exist_ok=True)\n")),"\n",r.createElement(t.p,null,"直した。"),"\n",r.createElement(t.pre,null,r.createElement(t.code,{className:"language-python"},"        ext_path = pathlib.Path(self.get_ext_fullpath(ext.name)).absolute()\n")),"\n",r.createElement(t.p,null,"たぶん、 ",r.createElement(t.code,null,"get_ext_fullpath")," が相対パスを返していて、変なところに ",r.createElement(t.code,null,"pyd")," が出力されていた。\npip の時だけフォルダの構成や pwd が変わっている様子。"),"\n",r.createElement(t.pre,null,r.createElement(t.code,null,"pip wheel . -v\n")),"\n",r.createElement(t.p,null,"として、ログと睨めっこしていたら気付いた。\npip が subprocess とか使うので、デバッガがアタッチできなくて、なかなかわからなかった。"))}var c=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,l.ah)(),e.components);return t?r.createElement(t,e,r.createElement(a,e)):a(e)};n(8678);function u(e){let{data:t,children:n}=e;return r.createElement(r.Fragment,null,r.createElement("h1",null,t.mdx.frontmatter.title),r.createElement(l.Zo,null,n))}function p(e){return r.createElement(u,e,r.createElement(c,e))}},8678:function(e,t,n){n(7294)},1151:function(e,t,n){n.d(t,{Zo:function(){return u},ah:function(){return a}});var l=n(7294);const r=l.createContext({});function a(e){const t=l.useContext(r);return l.useMemo((()=>"function"==typeof e?e(t):{...t,...e}),[t,e])}const c={};function u({components:e,children:t,disableParentContext:n}){let u;return u=n?"function"==typeof e?e({}):e||c:a(e),l.createElement(r.Provider,{value:u},t)}}}]);
//# sourceMappingURL=component---src-templates-post-template-js-content-file-path-home-runner-work-ousttrue-github-io-ousttrue-github-io-content-posts-2022-0507-bdist-wheel-md-0921c942448e702b11dd.js.map