<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>三次元日誌</title>

    

  <script src="https://ousttrue.github.io/plugins/elasticlunr.min.js" defer></script>
  <script src="https://ousttrue.github.io/search_index.en.js" defer></script>
  <script src="https://ousttrue.github.io/js/search.js" defer></script>

    

     
    <link rel="stylesheet" href="https://ousttrue.github.io/main.css">
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css"
      />
    
  </head>

  <body class="container">
    <a class="site_title" href="https:&#x2F;&#x2F;ousttrue.github.io&#x2F;">
      <div>三次元日誌</div>
    </a>

    <nav class="nav">
      <a class="item" href="/tags/">tags</a>
      <a class="item" href="https://github.com/ousttrue" aria-label="github">
        <i class="fab fa-github fa-lg"></i>
      </a>
      

        
            <form class="navbar-form">
                <input id="userinput" class="form-control is-search" type="search" placeholder="Search docs..."
                    aria-label="Search docs..." autocomplete="off">
                <div id="suggestions" class="shadow bg-white rounded"></div>
            </form>
        
    </nav>

    <main class="main">
<div class="page">
<div class="content">
  <div class="headline">
  
  

  
  <a class="headline_title" href="https:&#x2F;&#x2F;ousttrue.github.io&#x2F;python&#x2F;sphinx-in-hugo&#x2F;"> hugoで作ったサイトにSphinxを埋めこむ 
  

  
  </a>

  

  <div>
    <ul class="tags">
      <li class="headline_date">
        <div class="year">2017</div>
        <div class="md">0916</div>
      </li>
      
      

    </ul>
  </div>
</div>
 <p>MarkdownできるらしいのでSphinxを入れてみる。</p>
<p>テストページ</p>
<p>Sphinx install
pyenvでpython-3.6.2を導入した。
$ pyenv global 3.6.2
$ python -V
Python 3.6.2
$ pip install sphinx</p>
<p>http://www.sphinx-doc.org/en/stable/markdown.html</p>
<p>ドキュメントを作ってみる</p>
<p>project_name
author_name
version</p>
<p>は必須で作る時に決めなければならない。
$ sphinx-quickstart</p>
<p>いろいろ質問が出てくるが面倒なのでリターン連打。
ウイザード方式ではなくコマンドラインで一息に入力する方式だとこんな感じか。
$ sphinx-quickstart -q -p project_name -a author_name -v 1.0 --sep directory_name
Creating file directory_name↲/source/conf.py.
Creating file directory_name↲/source/index.rst.
Creating file directory_name↲/Makefile.
Creating file directory_name↲/make.bat.</p>
<p>Finished: An initial directory structure has been created.</p>
<p>You should now populate your master file directory_name↲/source/index.rst and create other documentation
source files. Use the Makefile to build the docs, like so:
make builder
where &quot;builder&quot; is one of the supported builders, e.g. html, latex or linkcheck.</p>
<p>ディレクトリ構成はこんな感じに。
directory_name
+ souce
+ conf.py
+ index.rst
+ Makefile
+ build
+ html # make htmlの出力</p>
<p>hugoのサブフォルダにビルド結果をコピーする
hugoroot
+ sphinxroot
+ build
+html
+ public
sphinx # ../sphinxroot/build/html/*をコピーする</p>
<p>hugosite$ sphinx-quickstart -q -p project_name -a author_name -v 1.0 --sep sphinxroot
hugosite$ hugo
hugosite$ pushd shphinxroot
hugosite/sphinxroot$ make html
hugosite/sphinxroot$ rsync -av build/html ../public/sphinx
sending incremental file list
created directory ../public/sphinx
html/
html/.buildinfo
html/genindex.html
html/index.html
html/objects.inv
html/search.html
html/searchindex.js
html/_sources/
html/_sources/index.rst.txt
html/_static/
html/_static/ajax-loader.gif
html/_static/alabaster.css
html/_static/basic.css
html/_static/comment-bright.png
html/_static/comment-close.png
html/_static/comment.png
html/_static/custom.css
html/_static/doctools.js
html/_static/down-pressed.png
html/_static/down.png
html/_static/file.png
html/_static/jquery-3.1.0.js
html/_static/jquery.js
html/_static/minus.png
html/_static/plus.png
html/_static/pygments.css
html/_static/searchtools.js
html/_static/underscore-1.3.1.js
html/_static/underscore.js
html/_static/up-pressed.png
html/_static/up.png
html/_static/websupport.js
hugosite/sphinxroot$ popd</p>
<p>rsyncの呼び方変更。ソースの指定の最後を/にすることでディレクトリそのものではなく中身を送る意味になる。
$ rsync -av build/html/ ../public/sphinx
sending incremental file list
created directory ../public/sphinx
./
.buildinfo
genindex.html
index.html
objects.inv
search.html
searchindex.js
_sources/
_sources/index.rst.txt
_static/
_static/ajax-loader.gif
_static/alabaster.css
_static/basic.css
_static/comment-bright.png
_static/comment-close.png
_static/comment.png
_static/custom.css
_static/doctools.js
_static/down-pressed.png
_static/down.png
_static/file.png
_static/jquery-3.1.0.js
_static/jquery.js
_static/minus.png
_static/plus.png
_static/pygments.css
_static/searchtools.js
_static/underscore-1.3.1.js
_static/underscore.js
_static/up-pressed.png
_static/up.png
_static/websupport.js</p>
<p>hugosite/public$ python -m http.server</p>
<p>http://localhost:8000/sphinx/
で生成したサイトが表示できた。
livereloadで自動更新サーバー</p>
<p>Python Livereload を使って Sphinx でドキュメントを書く
https://pypi.python.org/pypi/livereload</p>
<p>#!/usr/bin/env python
import os</p>
<p>os.system('make html')</p>
<p>from livereload import Server, shell</p>
<p>server = Server()
server.watch('source/<strong>/*.rst', shell('make html'))
server.watch('source/</strong>/*.md', shell('make html'))
server.serve(
open_url=False,
root='build/html',
port=8080,
host='0.0.0.0'
)</p>
<p>markdownを使う</p>
<p>Markdownを使う
http://www.sphinx-doc.org/en/stable/markdown.html</p>
<p>ImportError: cannot import name DocParser</p>
<p>SphinxでMarkdownを使うときに注意すること</p>
<p>バージョン固定
いろいろエラーが出る。
TypeError: 'NoneType' object is not callable</p>
<p>documented that 1.6 breaks recommonmark
Sphinx 1.5.x was the last working version for recommonmark 0.4.0</p>
<p>$ pip install recommonmark==0.4.0
$ pip install sphix==1.5</p>
<p>1.5にすると・・・
AttributeError: module 'locale' has no attribute 'normalize'</p>
<p>localeがsphinx.localeで置き換えられとる。
仕方ないので
強制的に再インポートするコードを入れた。
site-packages/sphinx/<strong>init</strong>.py
def main(argv=sys.argv):
# reimport locale
if 'locale' in sys.modules:
del sys.modules['locale']
if sys.path[0].find('sphinx')!=-1:↲
head=sys.path.pop(0)↲
import locale↲</p>
<pre style="background-color:#2b303b;">
<code>if sys.argv[1:2] == ['-M']:↲
    sys.exit(make_main(argv))↲
else:↲
    sys.exit(build_main(argv))↲
</code></pre>
<p>とりあえず動くようになった。ぐぬぬ・・・
TOC
AutoStructifyでできると書いてあるがバージョンを0.4.0に固定したからかうまく動かぬ。
eval_rstで。
'''eval_rst
.. toctree::</p>
<p>item
'''</p>
<p>エラー
TOCツリーにこの指定を入れるとエラーになる
.. toctree::
:caption: Contents:↲</p>
<p>themeを変える</p>
<p>見やすいテーマを設定する</p>
<p>日本語</p>
<p>日本語セクションにアンカーが貼られるようにする</p>
<p>github
.nojekyllでいいらしいがうまくいかなかったので。</p>
<p>https://github.com/michaeljones/sphinx-to-github</p>
<p>python3だと修正が要る。python2では試していない。</p>

</div>

<nav class="toc">


</nav>
</div>
</main>

    <footer class="footer">Powered by <a href="https://www.getzola.org/">Zola</a> <a href="https://github.com/ousttrue/zola/tree/custom">custom</a></footer>

  </body>
</html>
