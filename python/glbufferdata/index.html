<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>三次元日誌</title>

    

  <script src="https://ousttrue.github.io/plugins/elasticlunr.min.js" defer></script>
  <script src="https://ousttrue.github.io/search_index.en.js" defer></script>
  <script src="https://ousttrue.github.io/js/search.js" defer></script>

    

     
    <link rel="stylesheet" href="https://ousttrue.github.io/main.css">
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css"
      />
    
  </head>

  <body class="container">
    <a class="site_title" href="https:&#x2F;&#x2F;ousttrue.github.io&#x2F;">
      <div>三次元日誌</div>
    </a>

    <nav class="nav">
      <a class="item" href="/tags/">tags</a>
      <a class="item" href="https://github.com/ousttrue" aria-label="github">
        <i class="fab fa-github fa-lg"></i>
      </a>
      

        
            <form class="navbar-form">
                <input id="userinput" class="form-control is-search" type="search" placeholder="Search docs..."
                    aria-label="Search docs..." autocomplete="off">
                <div id="suggestions" class="shadow bg-white rounded"></div>
            </form>
        
    </nav>

    <main class="main">
<div class="page">
<div class="content">
  <div class="headline">
  
  

  
  <a class="headline_title" href="https:&#x2F;&#x2F;ousttrue.github.io&#x2F;python&#x2F;glbufferdata&#x2F;"> PyOpenGLのglBufferDataにはどんなデータが渡せるのか 
  

  
  </a>

  

  <div>
    <ul class="tags">
      <li class="headline_date">
        <div class="year">2017</div>
        <div class="md">0801</div>
      </li>
      
      


    <li class="tag"><a href="https:&#x2F;&#x2F;ousttrue.github.io&#x2F;tags&#x2F;python&#x2F;">python</a></li>

    <li class="tag"><a href="https:&#x2F;&#x2F;ousttrue.github.io&#x2F;tags&#x2F;opengl&#x2F;">opengl</a></li>




    </ul>
  </div>
</div>
 <p>glBufferDataに数字のlistを渡す場合以下のように渡せるがどうゆう実装なのか。</p>
<pre style="background-color:#2b303b;">
<code class="language-py" data-lang="py"><span style="color:#c0c5ce;">vertices=[</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">, </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">] </span><span style="color:#65737e;"># x, y, z

</span><span style="color:#bf616a;">glBufferData</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">GL_ARRAY_BUFFER</span><span style="color:#c0c5ce;">, 
        </span><span style="color:#96b5b4;">len</span><span style="color:#c0c5ce;">(vertices)*</span><span style="color:#d08770;">4</span><span style="color:#c0c5ce;">,  </span><span style="color:#65737e;"># byte size
        </span><span style="color:#c0c5ce;">(ctypes.c_float*</span><span style="color:#96b5b4;">len</span><span style="color:#c0c5ce;">(vertices))(*vertices), </span><span style="color:#65737e;"># 謎のctypes
        </span><span style="color:#bf616a;">GL_STATIC_DRAW</span><span style="color:#c0c5ce;">)
</span></code></pre>
<p>非常に読み辛かったがVisualStudioでステップ実行して動きを追ってみた。</p>
<pre style="background-color:#2b303b;">
<code class="language-py" data-lang="py"><span style="color:#65737e;"># site-packages/OpenGL/GL/VERSION/GL_1_5.py
</span><span style="color:#c0c5ce;">@</span><span style="color:#bf616a;">_lazy</span><span style="color:#c0c5ce;">( glBufferData )
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">glBufferData</span><span style="color:#c0c5ce;">( </span><span style="color:#bf616a;">baseOperation</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">target</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">size</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">data</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">None</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">usage</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">None </span><span style="color:#c0c5ce;">):
    </span><span style="color:#65737e;">&quot;&quot;&quot;Copy given data into the currently bound vertex-buffer-data object

    target -- the symbolic constant indicating which buffer type is intended
    size -- if provided, the count-in-bytes of the array
    data -- data-pointer to be used, may be None to initialize without
        copying over a data-set
    usage -- hint to the driver as to how to set up access to the buffer

    Note: parameter &quot;size&quot; can be omitted, which makes the signature
        glBufferData( target, data, usage )
    instead of:
        glBufferData( target, size, data, usage )
    &quot;&quot;&quot;
    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">usage is </span><span style="color:#d08770;">None</span><span style="color:#c0c5ce;">:
        usage = data
        data = size
        size = </span><span style="color:#d08770;">None
    </span><span style="color:#c0c5ce;">data = ArrayDatatype.</span><span style="color:#bf616a;">asArray</span><span style="color:#c0c5ce;">( data ) </span><span style="color:#65737e;"># &lt;- ここでPythonの型をOpenGLに渡せるように変換
    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">size is </span><span style="color:#d08770;">None</span><span style="color:#c0c5ce;">:
        size = ArrayDatatype.</span><span style="color:#bf616a;">arrayByteCount</span><span style="color:#c0c5ce;">( data )
    </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">baseOperation</span><span style="color:#c0c5ce;">( target, size, data, usage )
</span></code></pre>
<p>難関。デバッガ無しでは追えませんでした。</p>
<pre style="background-color:#2b303b;">
<code class="language-py" data-lang="py"><span style="color:#65737e;"># site-packages/OpenGL/arrays/arraydatatype.py
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">HandlerRegistry</span><span style="color:#eff1f5;">( </span><span style="color:#a3be8c;">dict </span><span style="color:#eff1f5;">):
    </span><span style="color:#b48ead;">def </span><span style="color:#96b5b4;">__init__</span><span style="color:#c0c5ce;">( </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">plugin_match </span><span style="color:#c0c5ce;">):
        </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.match = plugin_match

    </span><span style="color:#b48ead;">def </span><span style="color:#96b5b4;">__call__</span><span style="color:#c0c5ce;">( </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">value </span><span style="color:#c0c5ce;">): </span><span style="color:#65737e;"># 4
        &quot;&quot;&quot;Lookup of handler for given value&quot;&quot;&quot;
        </span><span style="color:#b48ead;">try</span><span style="color:#c0c5ce;">:
            typ = value.__class__
        </span><span style="color:#b48ead;">except </span><span style="color:#c0c5ce;">AttributeError </span><span style="color:#b48ead;">as </span><span style="color:#c0c5ce;">err:
            typ = </span><span style="color:#96b5b4;">type</span><span style="color:#c0c5ce;">(value)
        handler = </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">get</span><span style="color:#c0c5ce;">( typ )
        </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">not handler:
            </span><span style="color:#b48ead;">if </span><span style="color:#96b5b4;">hasattr</span><span style="color:#c0c5ce;">( typ, &#39;</span><span style="color:#a3be8c;">__mro__</span><span style="color:#c0c5ce;">&#39; ):
                </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">base </span><span style="color:#b48ead;">in </span><span style="color:#c0c5ce;">typ.__mro__:
                    handler = </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">get</span><span style="color:#c0c5ce;">( base )
                    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">not handler:
                        handler = </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">match</span><span style="color:#c0c5ce;">( base ) </span><span style="color:#65737e;"># 5
                        </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">handler:
                            handler = handler.</span><span style="color:#bf616a;">load</span><span style="color:#c0c5ce;">()
                            </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">handler:
                                handler = </span><span style="color:#bf616a;">handler</span><span style="color:#c0c5ce;">()
                    </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">handler:
                        </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">[ typ ] = handler
                        </span><span style="color:#b48ead;">if </span><span style="color:#96b5b4;">hasattr</span><span style="color:#c0c5ce;">( handler, &#39;</span><span style="color:#a3be8c;">registerEquivalent</span><span style="color:#c0c5ce;">&#39; ):
                            handler.</span><span style="color:#bf616a;">registerEquivalent</span><span style="color:#c0c5ce;">( typ, base )
                        </span><span style="color:#b48ead;">return </span><span style="color:#c0c5ce;">handler
            </span><span style="color:#b48ead;">raise </span><span style="color:#bf616a;">TypeError</span><span style="color:#c0c5ce;">(
                    &quot;&quot;&quot;</span><span style="color:#a3be8c;">No array-type handler for type </span><span style="color:#d08770;">%s</span><span style="color:#a3be8c;">.</span><span style="color:#d08770;">%s</span><span style="color:#a3be8c;"> (value: </span><span style="color:#d08770;">%s</span><span style="color:#a3be8c;">) registered</span><span style="color:#c0c5ce;">&quot;&quot;&quot;%(
                        typ.__module__, </span><span style="color:#96b5b4;">type</span><span style="color:#c0c5ce;">.__name__, </span><span style="color:#96b5b4;">repr</span><span style="color:#c0c5ce;">(value)[:</span><span style="color:#d08770;">50</span><span style="color:#c0c5ce;">]
                        )
                    )
            </span><span style="color:#b48ead;">return </span><span style="color:#c0c5ce;">handler

</span><span style="color:#bf616a;">GLOBAL_REGISTRY </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">HandlerRegistry</span><span style="color:#c0c5ce;">(
    plugins.FormatHandler.match </span><span style="color:#65737e;"># 6 -&gt; plugins.pyに進む
    </span><span style="color:#c0c5ce;">) </span><span style="color:#65737e;"># 3
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ArrayDatatype</span><span style="color:#eff1f5;">( </span><span style="color:#a3be8c;">object </span><span style="color:#eff1f5;">):
    </span><span style="color:#c0c5ce;">getHandler = </span><span style="color:#bf616a;">GLOBAL_REGISTRY</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">__call__ </span><span style="color:#65737e;"># 2
    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">asArray</span><span style="color:#c0c5ce;">( </span><span style="color:#bf616a;">cls</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">value</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">typeCode</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">None </span><span style="color:#c0c5ce;">): </span><span style="color:#65737e;"># 0 &lt;- glBufferDataから呼ばれる
        &quot;&quot;&quot;Given a value, convert to preferred array representation&quot;&quot;&quot;
        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">cls</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">getHandler</span><span style="color:#c0c5ce;">(value).</span><span style="color:#bf616a;">asArray</span><span style="color:#c0c5ce;">( value, typeCode or </span><span style="color:#bf616a;">cls</span><span style="color:#c0c5ce;">.typeConstant ) </span><span style="color:#65737e;"># 1
    </span><span style="color:#c0c5ce;">asArray = </span><span style="color:#96b5b4;">classmethod</span><span style="color:#c0c5ce;">( logs.</span><span style="color:#bf616a;">logOnFail</span><span style="color:#c0c5ce;">( asArray, _log ) )
</span></code></pre><pre style="background-color:#2b303b;">
<code class="language-py" data-lang="py"><span style="color:#65737e;"># site-packages/OpenGL/plugins.py
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Plugin</span><span style="color:#eff1f5;">( </span><span style="color:#a3be8c;">object </span><span style="color:#eff1f5;">):
    </span><span style="color:#65737e;">&quot;&quot;&quot;Base class for plugins to be loaded&quot;&quot;&quot;
    </span><span style="color:#c0c5ce;">loaded = </span><span style="color:#d08770;">False
    </span><span style="color:#b48ead;">def </span><span style="color:#96b5b4;">__init__</span><span style="color:#c0c5ce;">( </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">name</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">import_path</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">check </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">None</span><span style="color:#c0c5ce;">, **</span><span style="color:#bf616a;">named </span><span style="color:#c0c5ce;">):
        </span><span style="color:#65737e;">&quot;&quot;&quot;Register the plug-in&quot;&quot;&quot;
        </span><span style="color:#bf616a;">self</span><span style="color:#c0c5ce;">.registry.</span><span style="color:#bf616a;">append</span><span style="color:#c0c5ce;">( </span><span style="color:#bf616a;">self </span><span style="color:#c0c5ce;">) </span><span style="color:#65737e;"># &lt;-  FormatHandlerのインスタンスが登録される

</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">FormatHandler</span><span style="color:#eff1f5;">( </span><span style="color:#a3be8c;">Plugin </span><span style="color:#eff1f5;">):
    </span><span style="color:#65737e;">&quot;&quot;&quot;Data-type storage-format handler&quot;&quot;&quot;
    </span><span style="color:#c0c5ce;">registry = [] </span><span style="color:#65737e;"># &lt;- OpenGL/__init__.pyで初期化される
    </span><span style="color:#c0c5ce;">@</span><span style="color:#96b5b4;">classmethod
    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">match</span><span style="color:#c0c5ce;">( </span><span style="color:#bf616a;">cls</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">value </span><span style="color:#c0c5ce;">): </span><span style="color:#65737e;"># 7
        &quot;&quot;&quot;Lookup appropriate handler based on value (a type)&quot;&quot;&quot;
        </span><span style="color:#c0c5ce;">key = &#39;</span><span style="color:#d08770;">%s</span><span style="color:#a3be8c;">.</span><span style="color:#d08770;">%s</span><span style="color:#c0c5ce;">&#39;%( value.__module__, value.__name__ )
        </span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">plugin </span><span style="color:#b48ead;">in </span><span style="color:#bf616a;">cls</span><span style="color:#c0c5ce;">.registry: </span><span style="color:#65737e;"># &lt;- ここにハンドラのリストがある
            </span><span style="color:#c0c5ce;">set = </span><span style="color:#96b5b4;">getattr</span><span style="color:#c0c5ce;">( plugin, &#39;</span><span style="color:#a3be8c;">check</span><span style="color:#c0c5ce;">&#39;, ())
            </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">set and key in set:
                </span><span style="color:#b48ead;">return </span><span style="color:#c0c5ce;">plugin
        </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">None
</span></code></pre>
<p>これらがimport時にFormatHandlerとして登録される。</p>
<pre style="background-color:#2b303b;">
<code class="language-py" data-lang="py"><span style="color:#65737e;"># site-packages/OpenGL/__init__.py
</span><span style="color:#bf616a;">FormatHandler</span><span style="color:#c0c5ce;">( &#39;</span><span style="color:#a3be8c;">none</span><span style="color:#c0c5ce;">&#39;, &#39;</span><span style="color:#a3be8c;">OpenGL.arrays.nones.NoneHandler</span><span style="color:#c0c5ce;">&#39;, [ _bi+&#39;</span><span style="color:#a3be8c;">.NoneType</span><span style="color:#c0c5ce;">&#39;],</span><span style="color:#bf616a;">isOutput</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">False </span><span style="color:#c0c5ce;">)

</span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">sys.version_info[</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">] &lt; </span><span style="color:#d08770;">3</span><span style="color:#c0c5ce;">:
    </span><span style="color:#bf616a;">FormatHandler</span><span style="color:#c0c5ce;">( &#39;</span><span style="color:#a3be8c;">str</span><span style="color:#c0c5ce;">&#39;, &#39;</span><span style="color:#a3be8c;">OpenGL.arrays.strings.StringHandler</span><span style="color:#c0c5ce;">&#39;,[_bi+&#39;</span><span style="color:#a3be8c;">.str</span><span style="color:#c0c5ce;">&#39;], </span><span style="color:#bf616a;">isOutput</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">False </span><span style="color:#c0c5ce;">)
    </span><span style="color:#bf616a;">FormatHandler</span><span style="color:#c0c5ce;">( &#39;</span><span style="color:#a3be8c;">unicode</span><span style="color:#c0c5ce;">&#39;, &#39;</span><span style="color:#a3be8c;">OpenGL.arrays.strings.UnicodeHandler</span><span style="color:#c0c5ce;">&#39;,[_bi+&#39;</span><span style="color:#a3be8c;">.unicode</span><span style="color:#c0c5ce;">&#39;], </span><span style="color:#bf616a;">isOutput</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">False </span><span style="color:#c0c5ce;">)
</span><span style="color:#b48ead;">else</span><span style="color:#c0c5ce;">:
    </span><span style="color:#bf616a;">FormatHandler</span><span style="color:#c0c5ce;">( &#39;</span><span style="color:#a3be8c;">bytes</span><span style="color:#c0c5ce;">&#39;, &#39;</span><span style="color:#a3be8c;">OpenGL.arrays.strings.StringHandler</span><span style="color:#c0c5ce;">&#39;,[_bi+&#39;</span><span style="color:#a3be8c;">.bytes</span><span style="color:#c0c5ce;">&#39;], </span><span style="color:#bf616a;">isOutput</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">False </span><span style="color:#c0c5ce;">)
    </span><span style="color:#bf616a;">FormatHandler</span><span style="color:#c0c5ce;">( &#39;</span><span style="color:#a3be8c;">str</span><span style="color:#c0c5ce;">&#39;, &#39;</span><span style="color:#a3be8c;">OpenGL.arrays.strings.UnicodeHandler</span><span style="color:#c0c5ce;">&#39;,[_bi+&#39;</span><span style="color:#a3be8c;">.str</span><span style="color:#c0c5ce;">&#39;], </span><span style="color:#bf616a;">isOutput</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">False </span><span style="color:#c0c5ce;">)
    
</span><span style="color:#bf616a;">FormatHandler</span><span style="color:#c0c5ce;">( &#39;</span><span style="color:#a3be8c;">list</span><span style="color:#c0c5ce;">&#39;, &#39;</span><span style="color:#a3be8c;">OpenGL.arrays.lists.ListHandler</span><span style="color:#c0c5ce;">&#39;, [
    _bi+&#39;</span><span style="color:#a3be8c;">.list</span><span style="color:#c0c5ce;">&#39;,
    _bi+&#39;</span><span style="color:#a3be8c;">.tuple</span><span style="color:#c0c5ce;">&#39;,
], </span><span style="color:#bf616a;">isOutput</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">False </span><span style="color:#c0c5ce;">)
</span><span style="color:#bf616a;">FormatHandler</span><span style="color:#c0c5ce;">( &#39;</span><span style="color:#a3be8c;">numbers</span><span style="color:#c0c5ce;">&#39;, &#39;</span><span style="color:#a3be8c;">OpenGL.arrays.numbers.NumberHandler</span><span style="color:#c0c5ce;">&#39;, [
    _bi+&#39;</span><span style="color:#a3be8c;">.int</span><span style="color:#c0c5ce;">&#39;,
    _bi+&#39;</span><span style="color:#a3be8c;">.float</span><span style="color:#c0c5ce;">&#39;,
    _bi+&#39;</span><span style="color:#a3be8c;">.long</span><span style="color:#c0c5ce;">&#39;,
], </span><span style="color:#bf616a;">isOutput</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">False </span><span style="color:#c0c5ce;">)
</span><span style="color:#bf616a;">FormatHandler</span><span style="color:#c0c5ce;">(
    &#39;</span><span style="color:#a3be8c;">ctypesarrays</span><span style="color:#c0c5ce;">&#39;, &#39;</span><span style="color:#a3be8c;">OpenGL.arrays.ctypesarrays.CtypesArrayHandler</span><span style="color:#c0c5ce;">&#39;,
    [
        &#39;</span><span style="color:#a3be8c;">_ctypes.ArrayType</span><span style="color:#c0c5ce;">&#39;,
        &#39;</span><span style="color:#a3be8c;">_ctypes.PyCArrayType</span><span style="color:#c0c5ce;">&#39;,
        &#39;</span><span style="color:#a3be8c;">_ctypes.Array</span><span style="color:#c0c5ce;">&#39;,
        &#39;</span><span style="color:#a3be8c;">_ctypes.array.Array</span><span style="color:#c0c5ce;">&#39;,
    ],
    </span><span style="color:#bf616a;">isOutput</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">True</span><span style="color:#c0c5ce;">,
)
</span><span style="color:#bf616a;">FormatHandler</span><span style="color:#c0c5ce;">(
    &#39;</span><span style="color:#a3be8c;">ctypesparameter</span><span style="color:#c0c5ce;">&#39;,
    &#39;</span><span style="color:#a3be8c;">OpenGL.arrays.ctypesparameters.CtypesParameterHandler</span><span style="color:#c0c5ce;">&#39;,
    [
        _bi+&#39;</span><span style="color:#a3be8c;">.CArgObject</span><span style="color:#c0c5ce;">&#39;,
        &#39;</span><span style="color:#a3be8c;">ctypes.c_uint</span><span style="color:#c0c5ce;">&#39;,
        &#39;</span><span style="color:#a3be8c;">ctypes.c_int</span><span style="color:#c0c5ce;">&#39;,
        &#39;</span><span style="color:#a3be8c;">ctypes.c_float</span><span style="color:#c0c5ce;">&#39;,
        &#39;</span><span style="color:#a3be8c;">ctypes.c_double</span><span style="color:#c0c5ce;">&#39;,
        &#39;</span><span style="color:#a3be8c;">ctypes.c_ulong</span><span style="color:#c0c5ce;">&#39;,
        &#39;</span><span style="color:#a3be8c;">ctypes.c_long</span><span style="color:#c0c5ce;">&#39;,
        &#39;</span><span style="color:#a3be8c;">ctypes.c_longlong</span><span style="color:#c0c5ce;">&#39;,
    ],
    </span><span style="color:#bf616a;">isOutput</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">True</span><span style="color:#c0c5ce;">,
)
</span><span style="color:#bf616a;">FormatHandler</span><span style="color:#c0c5ce;">( &#39;</span><span style="color:#a3be8c;">ctypespointer</span><span style="color:#c0c5ce;">&#39;, &#39;</span><span style="color:#a3be8c;">OpenGL.arrays.ctypespointers.CtypesPointerHandler</span><span style="color:#c0c5ce;">&#39;,[
    &#39;</span><span style="color:#a3be8c;">ctypes.c_void_p</span><span style="color:#c0c5ce;">&#39;,
    &#39;</span><span style="color:#a3be8c;">_ctypes._Pointer</span><span style="color:#c0c5ce;">&#39;,
    &#39;</span><span style="color:#a3be8c;">ctypes.c_char_p</span><span style="color:#c0c5ce;">&#39;,
    &#39;</span><span style="color:#a3be8c;">_ctypes.pointer._Pointer</span><span style="color:#c0c5ce;">&#39;,
],</span><span style="color:#bf616a;">isOutput</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">False </span><span style="color:#c0c5ce;">)
</span><span style="color:#bf616a;">FormatHandler</span><span style="color:#c0c5ce;">( &#39;</span><span style="color:#a3be8c;">numpy</span><span style="color:#c0c5ce;">&#39;, &#39;</span><span style="color:#a3be8c;">OpenGL.arrays.numpymodule.NumpyHandler</span><span style="color:#c0c5ce;">&#39;, [
    &#39;</span><span style="color:#a3be8c;">numpy.ndarray</span><span style="color:#c0c5ce;">&#39;,
    &#39;</span><span style="color:#a3be8c;">numpy.core.memmap.memmap</span><span style="color:#c0c5ce;">&#39;,
],</span><span style="color:#bf616a;">isOutput</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">True </span><span style="color:#c0c5ce;">)
</span><span style="color:#bf616a;">FormatHandler</span><span style="color:#c0c5ce;">( &#39;</span><span style="color:#a3be8c;">buffer</span><span style="color:#c0c5ce;">&#39;, &#39;</span><span style="color:#a3be8c;">OpenGL.arrays.buffers.BufferHandler</span><span style="color:#c0c5ce;">&#39;, [
    &#39;</span><span style="color:#a3be8c;">OpenGL.arrays._buffers.Py_buffer</span><span style="color:#c0c5ce;">&#39;,
    _bi+&#39;</span><span style="color:#a3be8c;">.memoryview</span><span style="color:#c0c5ce;">&#39;,
    _bi+&#39;</span><span style="color:#a3be8c;">.bytearray</span><span style="color:#c0c5ce;">&#39;,
],</span><span style="color:#bf616a;">isOutput</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">True </span><span style="color:#c0c5ce;">)
</span><span style="color:#bf616a;">FormatHandler</span><span style="color:#c0c5ce;">( &#39;</span><span style="color:#a3be8c;">vbo</span><span style="color:#c0c5ce;">&#39;, &#39;</span><span style="color:#a3be8c;">OpenGL.arrays.vbo.VBOHandler</span><span style="color:#c0c5ce;">&#39;, [&#39;</span><span style="color:#a3be8c;">OpenGL.arrays.vbo.VBO</span><span style="color:#c0c5ce;">&#39;,&#39;</span><span style="color:#a3be8c;">OpenGL_accelerate.vbo.VBO</span><span style="color:#c0c5ce;">&#39;],</span><span style="color:#bf616a;">isOutput</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">False </span><span style="color:#c0c5ce;">)
</span><span style="color:#bf616a;">FormatHandler</span><span style="color:#c0c5ce;">( &#39;</span><span style="color:#a3be8c;">vbooffset</span><span style="color:#c0c5ce;">&#39;, &#39;</span><span style="color:#a3be8c;">OpenGL.arrays.vbo.VBOOffsetHandler</span><span style="color:#c0c5ce;">&#39;, [&#39;</span><span style="color:#a3be8c;">OpenGL.arrays.vbo.VBOOffset</span><span style="color:#c0c5ce;">&#39;,&#39;</span><span style="color:#a3be8c;">OpenGL_accelerate.vbo.VBOOffset</span><span style="color:#c0c5ce;">&#39;],</span><span style="color:#bf616a;">isOutput</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">False </span><span style="color:#c0c5ce;">)
</span></code></pre>
<p>numpyとか定義されているね。なるほど。</p>
<p><code>(ctypes.c_float*len(vertices))(*vertices)</code> は <code>ctypes.c_float</code> にマッチして、<code>CtypesArrayHandler</code> によって処理される。
一方、単なるPythonのlistであるverticesは、<code>OpenGL.arrays.lists.ListHandler</code> によって処理されて <code>NotImplementedError</code> に落ちるのであった。</p>
<pre style="background-color:#2b303b;">
<code class="language-py" data-lang="py"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">ListHandler</span><span style="color:#eff1f5;">( </span><span style="color:#a3be8c;">formathandler.FormatHandler </span><span style="color:#eff1f5;">):
    </span><span style="color:#c0c5ce;">@</span><span style="color:#96b5b4;">classmethod
    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">asArray</span><span style="color:#c0c5ce;">( </span><span style="color:#bf616a;">cls</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">value</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">typeCode</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">None </span><span style="color:#c0c5ce;">):
        </span><span style="color:#65737e;">&quot;&quot;&quot;Convert given value to a ctypes array value of given typeCode
        
        This does a *lot* of work just to get the data into the correct
        format.  It&#39;s not going to be anywhere near as fast as a numpy
        or similar approach!
        &quot;&quot;&quot;
        </span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">typeCode is </span><span style="color:#d08770;">None</span><span style="color:#c0c5ce;">:
            </span><span style="color:#b48ead;">raise </span><span style="color:#bf616a;">NotImplementedError</span><span style="color:#c0c5ce;">( &quot;&quot;&quot;</span><span style="color:#a3be8c;">Haven&#39;t implemented type-inference for lists yet</span><span style="color:#c0c5ce;">&quot;&quot;&quot; )
</span></code></pre>
<p>確かにlistだと中身の型が決められんね。なるほど。</p>

</div>

<nav class="toc">


</nav>
</div>
</main>

    <footer class="footer">Powered by <a href="https://www.getzola.org/">Zola</a> <a href="https://github.com/ousttrue/zola/tree/custom">custom</a></footer>

  </body>
</html>
