"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9096],{5072:function(n,s,a){a.r(s),a.d(s,{default:function(){return r}});var t=a(1151),p=a(7294);function e(n){const s=Object.assign({h1:"h1",p:"p",h2:"h2",ul:"ul",li:"li",a:"a",blockquote:"blockquote",span:"span",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",h3:"h3"},(0,t.ah)(),n.components);return p.createElement(p.Fragment,null,p.createElement(s.h1,null,"geojson"),"\n",p.createElement(s.p,null,"既存のライブラリが重厚長大なものが多いのだけど、\nOpenGL や SVG のような二次元のベクター描画で簡単に済ませたい。\nその方向で調査。"),"\n",p.createElement(s.h2,null,"format"),"\n",p.createElement(s.ul,null,"\n",p.createElement(s.li,null,p.createElement(s.a,{href:"https://datatracker.ietf.org/doc/html/rfc7946"},"https://datatracker.ietf.org/doc/html/rfc7946")),"\n",p.createElement(s.li,null,p.createElement(s.a,{href:"https://ja.wikipedia.org/wiki/GeoJSON"},"https://ja.wikipedia.org/wiki/GeoJSON"),"\n",p.createElement(s.ul,null,"\n",p.createElement(s.li,null,p.createElement(s.a,{href:"https://en.wikipedia.org/wiki/GeoJSON"},"https://en.wikipedia.org/wiki/GeoJSON")),"\n"),"\n"),"\n"),"\n",p.createElement(s.blockquote,null,"\n",p.createElement(s.p,null,"GeoJSON is a geospatial data"),"\n"),"\n",p.createElement(s.p,null,"以下のような様式。\n",p.createElement(s.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">Feature</code>'}})," の中に ",p.createElement(s.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">Geometry</code>'}})," が入っている。"),"\n",p.createElement(s.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>\n    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"FeatureCollection"</span><span class="token punctuation">,</span>\n    <span class="token property">"features"</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n        <span class="token punctuation">{</span>\n            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Feature"</span><span class="token punctuation">,</span>\n            <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n            <span class="token property">"geometry"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">]</span>\n<span class="token punctuation">}</span></code></pre></div>'}}),"\n",p.createElement(s.table,null,p.createElement(s.thead,null,p.createElement(s.tr,null,p.createElement(s.th,null,"Geometry Object"))),p.createElement(s.tbody,null,p.createElement(s.tr,null,p.createElement(s.td,null,"Point")),p.createElement(s.tr,null,p.createElement(s.td,null,"MultiPoint")),p.createElement(s.tr,null,p.createElement(s.td,null,"LineString")),p.createElement(s.tr,null,p.createElement(s.td,null,"MultiLineString")),p.createElement(s.tr,null,p.createElement(s.td,null,"Polygon")),p.createElement(s.tr,null,p.createElement(s.td,null,"MultiPolygon")),p.createElement(s.tr,null,p.createElement(s.td,null,"GeometryCollection")))),"\n",p.createElement(s.h3,null,"Point"),"\n",p.createElement(s.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>\n    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Point"</span><span class="token punctuation">,</span>\n    <span class="token property">"coordinates"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">100.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span>\n<span class="token punctuation">}</span></code></pre></div>'}}),"\n",p.createElement(s.h3,null,"Polygon"),"\n",p.createElement(s.p,null,"穴が空いている場合は、複数の頂点リストを保持する。"),"\n",p.createElement(s.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token comment">// No holes:</span>\n\n<span class="token punctuation">{</span>\n    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Polygon"</span><span class="token punctuation">,</span>\n    <span class="token property">"coordinates"</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n        <span class="token punctuation">[</span>\n            <span class="token punctuation">[</span><span class="token number">100.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            <span class="token punctuation">[</span><span class="token number">101.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            <span class="token punctuation">[</span><span class="token number">101.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            <span class="token punctuation">[</span><span class="token number">100.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            <span class="token punctuation">[</span><span class="token number">100.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span>\n        <span class="token punctuation">]</span>\n    <span class="token punctuation">]</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// with holes:</span>\n\n<span class="token punctuation">{</span>\n    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Polygon"</span><span class="token punctuation">,</span>\n    <span class="token property">"coordinates"</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n        <span class="token punctuation">[</span>\n            <span class="token punctuation">[</span><span class="token number">100.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            <span class="token punctuation">[</span><span class="token number">101.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            <span class="token punctuation">[</span><span class="token number">101.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            <span class="token punctuation">[</span><span class="token number">100.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            <span class="token punctuation">[</span><span class="token number">100.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span>\n        <span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token punctuation">[</span>\n            <span class="token punctuation">[</span><span class="token number">100.8</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            <span class="token punctuation">[</span><span class="token number">100.8</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            <span class="token punctuation">[</span><span class="token number">100.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            <span class="token punctuation">[</span><span class="token number">100.2</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            <span class="token punctuation">[</span><span class="token number">100.8</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">]</span>\n        <span class="token punctuation">]</span>\n    <span class="token punctuation">]</span>\n<span class="token punctuation">}</span></code></pre></div>'}}),"\n",p.createElement(s.h2,null,"read"),"\n",p.createElement(s.p,null,"python で素直に読んでみた。"),"\n",p.createElement(s.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> pathlib\n<span class="token keyword">import</span> json\n\n\n<span class="token keyword">def</span> <span class="token function">process_geometry</span><span class="token punctuation">(</span>geometry<span class="token punctuation">:</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">match</span> geometry<span class="token punctuation">:</span>\n        <span class="token keyword">case</span> <span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"MultiPolygon"</span><span class="token punctuation">,</span> <span class="token string">"coordinates"</span><span class="token punctuation">:</span> coordinates<span class="token punctuation">}</span><span class="token punctuation">:</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>coordinates<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> polygon\'</span></span><span class="token punctuation">)</span>\n            <span class="token keyword">for</span> coord <span class="token keyword">in</span> coordinates<span class="token punctuation">:</span>\n                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'  </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>coord<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> rings\'</span></span><span class="token punctuation">)</span>\n                <span class="token keyword">for</span> x <span class="token keyword">in</span> coord<span class="token punctuation">:</span>\n                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f\'    </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> points\'</span></span><span class="token punctuation">)</span>\n\n\n<span class="token keyword">def</span> <span class="token function">process_feature</span><span class="token punctuation">(</span>feature<span class="token punctuation">:</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">match</span> feature<span class="token punctuation">:</span>\n        <span class="token keyword">case</span> <span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"Feature"</span><span class="token punctuation">,</span> <span class="token string">"properties"</span><span class="token punctuation">:</span> props<span class="token punctuation">,</span> <span class="token string">"geometry"</span><span class="token punctuation">:</span> geometry<span class="token punctuation">}</span><span class="token punctuation">:</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>\n            process_geometry<span class="token punctuation">(</span>geometry<span class="token punctuation">)</span>\n\n        <span class="token keyword">case</span> <span class="token keyword">_</span><span class="token punctuation">:</span>\n            <span class="token keyword">raise</span> NotImplementedError<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n\n<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>path<span class="token punctuation">:</span> pathlib<span class="token punctuation">.</span>Path<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>path<span class="token punctuation">.</span>read_bytes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token keyword">match</span> data<span class="token punctuation">:</span>\n        <span class="token keyword">case</span> <span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"FeatureCollection"</span><span class="token punctuation">,</span> <span class="token string">"features"</span><span class="token punctuation">:</span> features<span class="token punctuation">}</span><span class="token punctuation">:</span>\n            <span class="token keyword">for</span> feature <span class="token keyword">in</span> features<span class="token punctuation">:</span>\n                process_feature<span class="token punctuation">(</span>feature<span class="token punctuation">)</span>\n\n\n<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">\'__main__\'</span><span class="token punctuation">:</span>\n    main<span class="token punctuation">(</span>pathlib<span class="token punctuation">.</span>Path<span class="token punctuation">(</span><span class="token string">\'japan.geo.json\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>'}}),"\n",p.createElement(s.p,null,p.createElement(s.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">jpan.geo.json</code>'}})," は、 ",p.createElement(s.a,{href:"https://github.com/dataofjapan/land"},"https://github.com/dataofjapan/land")," です。\n実行結果。"),"\n",p.createElement(s.span,{dangerouslySetInnerHTML:{__html:"<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{'nam': 'Kyoto Fu', 'nam_ja': '京都府', 'id': 26}\n4 polygon\n  1 rings\n    1235 points\n  1 rings\n    6 points\n  1 rings\n    8 points\n  1 rings\n    6 points</code></pre></div>"}}),"\n",p.createElement(s.p,null,"なるほど。"),"\n",p.createElement(s.h2,null,"GL_LINE_LOOP"),"\n",p.createElement(s.p,null,"単純に ",p.createElement(s.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">GL_LINE_LOOP</code>'}})," で描画できそうとわかった。"),"\n",p.createElement(s.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">process_geometry</span><span class="token punctuation">(</span>geometry<span class="token punctuation">:</span> <span class="token builtin">dict</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Polygon<span class="token punctuation">:</span>\n    <span class="token keyword">match</span> geometry<span class="token punctuation">:</span>\n        <span class="token keyword">case</span> <span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"Polygon"</span><span class="token punctuation">,</span> <span class="token string">"coordinates"</span><span class="token punctuation">:</span> polygon<span class="token punctuation">}</span><span class="token punctuation">:</span>\n            <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>polygon<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>\n            array <span class="token operator">=</span> <span class="token punctuation">(</span>float2 <span class="token operator">*</span> <span class="token builtin">len</span><span class="token punctuation">(</span>polygon<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n            <span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>polygon<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n                array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> float2<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>\n            <span class="token keyword">return</span> Polygon<span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token punctuation">[</span>SubMesh<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n\n        <span class="token keyword">case</span> <span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"MultiPolygon"</span><span class="token punctuation">,</span> <span class="token string">"coordinates"</span><span class="token punctuation">:</span> polygons<span class="token punctuation">}</span><span class="token punctuation">:</span>\n            array <span class="token operator">=</span> <span class="token punctuation">(</span>float2 <span class="token operator">*</span> <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>polygon<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> polygon <span class="token keyword">in</span> polygons<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n            i <span class="token operator">=</span> <span class="token number">0</span>\n            submeshes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n            <span class="token keyword">for</span> polygon <span class="token keyword">in</span> polygons<span class="token punctuation">:</span>\n                <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>polygon<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>\n                submeshes<span class="token punctuation">.</span>append<span class="token punctuation">(</span>SubMesh<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>polygon<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n                <span class="token keyword">for</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">in</span> polygon<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>\n                    array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> float2<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>\n                    i <span class="token operator">+=</span> <span class="token number">1</span>\n            <span class="token keyword">return</span> Polygon<span class="token punctuation">(</span>array<span class="token punctuation">,</span> submeshes<span class="token punctuation">)</span>\n\n        <span class="token keyword">case</span> <span class="token keyword">_</span><span class="token punctuation">:</span>\n            <span class="token keyword">raise</span> NotImplementedError<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>'}}),"\n",p.createElement(s.p,null,p.createElement(s.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">orthogonal</code>'}})," の方で適当にビューポートを ",p.createElement(s.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">(140, 35)</code>'}})," というような適当な経度緯度に調整してやればよさそう。"),"\n",p.createElement(s.h2,null,"data"),"\n",p.createElement(s.ul,null,"\n",p.createElement(s.li,null,p.createElement(s.a,{href:"https://github.com/dataofjapan/land"},"https://github.com/dataofjapan/land")),"\n",p.createElement(s.li,null,p.createElement(s.a,{href:"http://geojson.io/"},"http://geojson.io/")),"\n"),"\n",p.createElement(s.h2,null,"参考"),"\n",p.createElement(s.ul,null,"\n",p.createElement(s.li,null,p.createElement(s.a,{href:"https://qiita.com/kkdd/items/416b955fb2d3e1327edc"},"GeoJSON (RFC7946) 仕様の注意点など")),"\n",p.createElement(s.li,null,p.createElement(s.a,{href:"https://github.com/jeremyfromearth/cinder-geojson-experiments"},"https://github.com/jeremyfromearth/cinder-geojson-experiments")),"\n",p.createElement(s.li,null,p.createElement(s.a,{href:"https://github.com/soolmaz-mk/Atlasi"},"https://github.com/soolmaz-mk/Atlasi")),"\n"))}var o=function(n){void 0===n&&(n={});const{wrapper:s}=Object.assign({},(0,t.ah)(),n.components);return s?p.createElement(s,n,p.createElement(e,n)):e(n)},c=a(8678),l=a(1883),u=a(8838);const k={code:n=>{let{children:s,className:a}=n;return a?p.createElement(u.Z,{className:a},s):p.createElement("code",null,s)}};function i(n){let{data:s,children:a}=n;const e=s.mdx.frontmatter;return p.createElement(c.Z,null,p.createElement("h1",null,e.title),p.createElement("div",{className:"tags-index"},e.tags&&e.tags.length>0&&e.tags.map((n=>p.createElement(l.rU,{to:"/tags/"+n+"/",itemProp:"url"},p.createElement("button",null,n))))),p.createElement(t.Zo,{components:k},a))}function r(n){return p.createElement(i,n,p.createElement(o,n))}}}]);
//# sourceMappingURL=component---src-templates-post-template-js-content-file-path-home-runner-work-ousttrue-github-io-ousttrue-github-io-content-posts-2021-winter-geojson-md-879fa5be9a82f791f6fa.js.map