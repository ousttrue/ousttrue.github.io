<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="ja">
<head>
<meta charset="utf-8">
<meta name="description" content="ä½œæ¥­è¨˜éŒ²">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ä¸‰æ¬¡å…ƒæ—¥èªŒ (éå»ã®è¨˜äº‹ 14ãƒšãƒ¼ã‚¸ç›®) | ä¸‰æ¬¡å…ƒæ—¥èªŒ</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="ja" href="rss.xml">
<link rel="canonical" href="https://ousttrue.github.io/index-14.html">
<link rel="prev" href="index-15.html" type="text/html">
<link rel="next" href="index-13.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">æœ¬æ–‡ã‚’èª­ã¿é£›ã°ã™</a>

<!-- Header and menu bar -->
<div class="container">
      <header class="blog-header py-3"><div class="row nbb-header align-items-center">
          <div class="col-md-3 col-xs-2 col-sm-2" style="width: auto;">
            <button class="navbar-toggler navbar-light bg-light nbb-navbar-toggler" type="button" data-toggle="collapse" data-target=".bs-nav-collapsible" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse bs-nav-collapsible bootblog4-search-form-holder">
                
            </div>
        </div>
          <div class="col-md-6 col-xs-10 col-sm-10 bootblog4-brand" style="width: auto;">
            <a class="navbar-brand blog-header-logo text-dark" href=".">

            <span id="blog-title">ä¸‰æ¬¡å…ƒæ—¥èªŒ</span>
        </a>
          </div>
            <div class="col-md-3 justify-content-end align-items-center bs-nav-collapsible collapse flex-collapse bootblog4-right-nav">
            <nav class="navbar navbar-light bg-white"><ul class="navbar-nav bootblog4-right-nav"></ul></nav>
</div>
    </div>
</header><nav class="navbar navbar-expand-md navbar-light bg-white static-top"><div class="collapse navbar-collapse bs-nav-collapsible" id="bs-navbar">
            <ul class="navbar-nav nav-fill d-flex w-100">
<li class="nav-item">
<a href="archive.html" class="nav-link">Archives</a>
                </li>
<li class="nav-item">
<a href="categories/index.html" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
</div>
<!-- /.navbar-collapse -->
</nav>
</div>

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
    
        

    
        
    <div class="postindex">
            <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2021/lua_imgui_plan/" class="u-url">lua ã«ã‚ˆã‚‹ imgui è¨ˆç”»</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2021/lua_imgui_plan/" rel="bookmark">
            <time class="published dt-published" datetime="2021-07-17T00:00:00+09:00" itemprop="datePublished" title="2021-07-17 00:00">2021-07-17 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2021/lua_imgui_plan/#disqus_thread" data-disqus-identifier="cache/content/posts/2021/lua_imgui_plan.html">ã‚³ãƒ¡ãƒ³ãƒˆ</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<h3>rust ã§ D3D11 ãƒ¬ãƒ³ãƒ€ãƒ©ã‚’é€²ã‚ã¦ããŸãŒãƒ»ãƒ»ãƒ»</h3>
<p>å½“åˆ <code>rust</code> ã§ <code>d3d11</code> ã®ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã‚’ä½œã‚ã†ã¨ã—ã¦ä½œæ¥­ã‚’é€²ã‚ã¦ã„ãŸã€‚
<code>imgui</code> ã‚’çµ„ã¿è¾¼ã‚“ã§ã€ <code>glTF</code> ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦ <code>unlit</code> ã§æç”»ã™ã‚‹ã¨ã“ã‚ã¾ã§ä½œã£ãŸãŒã€
<code>GUI</code> ã®ä½œã‚Šã“ã¿ãŒå¤§å¤‰ãã†ãªæ„Ÿã˜ã ã£ãŸã€‚
<code>rust</code> ã¯é–¢æ•°ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ãŒç„¡ã„ã®ã§ã€€<code>imgui</code> ã®ãƒ©ãƒƒãƒ‘ãƒ¼ã®ä½¿ã„å‹æ‰‹ãŒ <code>c++</code> ã‚ˆã‚Šè½ã¡ã‚‹ãªã©ã€‚
ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã‚’æ¸¡ã›ã‚‹ã®ã¯ç´ æ•µãªã®ã ãŒã€‚</p>
<h3>nvim-0.5 ã¯ãŠã‚‚ã—ã‚ã„</h3>
<p>ã“ã“ã§å¯„ã‚Šé“ã—ã¦ã€ <code>nvim</code> ã‚’ã„ã˜ã‚Šå§‹ã‚ãŸã€‚
ã¡ã‚‡ã†ã©ãƒãƒ¼ã‚¸ãƒ§ãƒ³ <code>0.5</code> ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã€<code>0.5</code> ã«ãªã‚‹ã¨ lua ã‚µãƒãƒ¼ãƒˆãŒå¼·åŒ–ã•ã‚Œã¦ã€è¨­å®šãŒ lua ã§æ›¸ã‘ã‚‹ã¨ã®ã“ã¨ã€‚</p>
<ul>
<li><a href="https://zenn.dev/hituzi_no_sippo/articles/871c06cdbc45b53181e3">Neovimã¨Lua</a></li>
</ul>
<p>ã¨ã„ã†ã“ã¨ã§ Windows å‘ã‘ã®ã‚½ãƒ¼ã‚¹ã‹ã‚‰ã®ãƒ“ãƒ«ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½œã£ã¦ <code>nvim</code> ç’°å¢ƒã‚’æ•´å‚™ã—ã¦ã¿ãŸã€‚
lua ã§è¨˜è¿°ã•ã‚ŒãŸ plugin ã‚’ãªã‚‹ã¹ãæ¡ç”¨ã€‚</p>
<p><a href="https://github.com/ousttrue/my_nvim">https://github.com/ousttrue/my_nvim</a></p>
<p>æœ€è¿‘å¸¸ç”¨ã—ã¦ã„ãŸã€ <code>vscode</code> ã®ä¾¿åˆ©ã•ã«ã©ã“ã¾ã§è¿½ã„ã¤ã‘ã‚‹ã‹ã€‚</p>
<ul>
<li>Language Server Protocolã€‚nvim-0.5 ã‹ã‚‰ nvim-lsp (luaã§æ›¸ã„ã¦ã‚ã‚‹) ãŒã‚ã‚‹ã€‚çµ„ã¿è¾¼ã¿</li>
<li>Debug Adapter Protocolã€‚nvim-0.5 ã‹ã‚‰ nvim-dap (lulã§æ›¸ã„ã¦ã‚ã‚‹) ãŒã‚ã‚‹ã€‚<a href="https://github.com/mfussenegger/nvim-dap">https://github.com/mfussenegger/nvim-dap</a>
</li>
</ul>
<p>vscode ã‹ã‚‰ <code>lsp</code> ã¨ <code>dap</code> ã¨ã„ã†é‡è¦ãªè³‡ç”£ã‚’æŒã£ã¦ã“ã‚Œã‚‹ã®ã§æ…£ã‚Œã‚Œã°ã„ã‘ãã†ã§ã‚ã‚‹ã€‚
èª¿ã¹ãŸã¨ã“ã‚ä¸‹è¨˜ã®ã‚ˆã†ã ã£ãŸã€‚</p>
<ul>
<li>codelldb(native debugger c++ ã‚„ rust) ã¯ nvim-dap ã‚’æ”¹é€ ã™ã‚Œã°ä½¿ãˆãŸ <a href="https://github.com/ousttrue/nvim-dap">https://github.com/ousttrue/nvim-dap</a>
</li>
<li>rust-analyzer å‹•ã„ãŸ</li>
<li>python: lsp, dap ã¨ã‚‚ã«å‹•ããã†</li>
<li>lua: lsp, dap ã¨ã‚‚ã«å‹•ããã†</li>
<li>csharp: lsp, dap ã¨ã‚‚ã«å‹•ããã†(Unityã¯ã†ã¾ãã„ã‹ãš)</li>
</ul>
<p>nvim-lsp ã‚‚ nvim-dap ã‚‚ lua ã§ç°¡å˜ã«è¨˜è¿°ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚ã°ã€ãŸã¶ã‚“ã‚ã‹ã‚‹ã€‚
ã‚ã¨ã¯ã€ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼ã‚’æ•´å‚™ã™ã‚Œã°é–‹ç™ºç’°å¢ƒã«ä½¿ãˆãã†ã€‚</p>
<h3>luarocks ã® Windows é‹ç”¨</h3>
<p>lua ã§è¨˜è¿°ã•ã‚ŒãŸ nvim ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ <a href="https://github.com/wbthomason/packer.nvim">https://github.com/wbthomason/packer.nvim</a> ã‚’æ¡ç”¨ã—ãŸã®ã ãŒã€
Windows ã§ luarocks æ©Ÿèƒ½ãŒå‹•ã‹ãªã‹ã£ãŸã€‚<a href="https://luarocks.org/">https://luarocks.org/</a> ã¯ <code>lua</code> ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã€‚
ã¡ã‚‡ã£ã¨ã€å¤ã‚(vc2017ã‚ˆã‚Šå‰)ã® vc ã§ãªã„ã¨ã ã‚ã½ã„ã€‚
æ”¹é€ ã—ãŸã€‚</p>
<ul>
<li>https://github.com/ousttrue/packer.nvim</li>
<li>https://github.com/ousttrue/hererocks</li>
</ul>
<p>hererocks ã¯ã€luarocks ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã€‚
<code>LUA_PATH</code> <code>package.path</code> ã‚’ç†è§£ã—ãŸã€‚</p>
<h3>ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ã® lua ã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿ã«ã‚ˆã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</h3>
<p>luarocks ãŒç„¡äº‹ã« Windows ã§é‹ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã§ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ­ãƒ¼ã‚«ãƒ«ã«å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã€
ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ã® lua ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã‚’èµ·ç‚¹ã«ã—ãŸã‚¢ãƒ—ãƒªé–‹ç™ºãŒã§ããªã„ã‹æ¢ã£ã¦ã¿ãŸã€‚
lua ã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿ãŒã‚¢ãƒ—ãƒªçµ„ã¿è¾¼ã¿ã ã¨ dap ã®é‹ç”¨ãŒã—ã¥ã‚‰ã„(port é–‹ã‘ã¦ attach ã¨ã‹ã«ãªã‚‹)ã®ã§ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ã® lua ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã‚’æ¨ã™ã€‚</p>
<pre class="code literal-block"><span></span># ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ
project_root
  + lua(.gitignore) # hererocks ã§ãƒ­ãƒ¼ã‚«ãƒ«ãƒ“ãƒ«ãƒ‰ã™ã‚‹
  + main.lua
</pre>

<p>ã“ã‚Œã§ã€ <code>lsp</code> ã¨ <code>dap</code> ãŒåˆ©ç”¨ã§ãã‚Œã°å¿«é©ã«ãªã‚‹ã®ã§ã¯ãªã„ã‹ã€‚</p>
<h4>lua ã® LanguageServer</h4>
<ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=sumneko.lua">https://marketplace.visualstudio.com/items?itemName=sumneko.lua</a></li>
<li><a href="https://github.com/sumneko/lua-language-server">https://github.com/sumneko/lua-language-server</a></li>
</ul>
<p>ãŒã—ã£ã‹ã‚Šå‹•ãã€<code>EmmyLua</code> ã®å‹ãƒ’ãƒ³ãƒˆã‚’æ´»ç”¨ã§ãã‚‹ã“ã¨ãŒåˆ†ã‹ã£ãŸã€‚</p>
<p><a href="https://github.com/neovim/nvim-lspconfig/blob/a21a509417aa530fb7b54020f590fa5ccc67de77/CONFIG.md#sumneko_lua">https://github.com/neovim/nvim-lspconfig/blob/a21a509417aa530fb7b54020f590fa5ccc67de77/CONFIG.md#sumneko_lua</a> ã«ä¾‹ãŒã‚ã£ã¦ã€</p>
<pre class="code literal-block"><span></span><span class="nb">require</span><span class="s1">'lspconfig'</span><span class="p">.</span><span class="n">sumneko_lua</span><span class="p">.</span><span class="n">setup</span> <span class="p">{</span>
  <span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">Lua</span> <span class="o">=</span> <span class="p">{</span>
      <span class="n">workspace</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1">-- Make the server aware of Neovim runtime files</span>
        <span class="n">library</span> <span class="o">=</span> <span class="p">{</span>
          <span class="p">[</span><span class="n">vim</span><span class="p">.</span><span class="n">fn</span><span class="p">.</span><span class="n">expand</span><span class="p">(</span><span class="s1">'$VIMRUNTIME/lua'</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">-- luaæ¨™æº–ã®å‹å®šç¾©ãŒã‚ã‚‹</span>
          <span class="p">[</span><span class="n">vim</span><span class="p">.</span><span class="n">fn</span><span class="p">.</span><span class="n">expand</span><span class="p">(</span><span class="s1">'$VIMRUNTIME/lua/vim/lsp'</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">-- Vimã®å‹å®šç¾©ãŒã‚ã‚‹</span>
        <span class="p">},</span>
      <span class="p">},</span>
    <span class="p">},</span>
  <span class="p">},</span>
<span class="p">}</span>
</pre>

<p>ã‚¤ãƒ³ãƒ†ãƒªã‚»ãƒ³ã‚¹ãŒåŠ¹ãã—ã€çµ„ã¿è¾¼ã¿é–¢æ•°ã®å‹ãƒ’ãƒ³ãƒˆã‚‚è¿½åŠ ã§ãã‚‹ã€‚</p>
<h4>lua ã® DebugAdapter</h4>
<p>DebugAdapter ã‚‚å•é¡Œãªãå‹•ã„ãŸã€‚
luajit ã®å ´åˆã¯å¯¾å¿œã—ã¦ã„ã‚‹ã‚‚ã®ã‚’ä½¿ã†ã¹ã—ã€‚</p>
<h5>Lua Debug</h5>
<ul>
<li>
<a href="https://marketplace.visualstudio.com/items?itemName=actboy168.lua-debug">https://marketplace.visualstudio.com/items?itemName=actboy168.lua-debug</a><ul>
<li><a href="https://github.com/actboy168/lua-debug">https://github.com/actboy168/lua-debug</a></li>
</ul>
</li>
</ul>
<p><a href="https://github.com/actboy168/bee.lua">https://github.com/actboy168/bee.lua</a> ã®</p>
<ul>
<li>Add error hook (for debugger)</li>
<li>Add resume/yield hook (for debugger)</li>
</ul>
<p>è¬ã®æ©Ÿèƒ½ã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã½ã„ã€‚</p>
<h5>Local Lua Debugger</h5>
<ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=tomblind.local-lua-debugger-vscode">https://marketplace.visualstudio.com/items?itemName=tomblind.local-lua-debugger-vscode</a></li>
<li>
<p><a href="https://github.com/tomblind/local-lua-debugger-vscode">https://github.com/tomblind/local-lua-debugger-vscode</a></p>
</li>
<li>
<p>luajit ã§ã‚‚å‹•ã</p>
</li>
<li>TypeScriptToLua ã§æ›¸ã‹ã‚Œã¦ã„ã‚‹</li>
</ul>
<h3>lua ã§ 3D</h3>
<p>ã¡ã‚‡ã£ã¨è©¦ã—ãŸã¨ã“ã‚ã€ luajit ã® <a href="https://luajit.org/ext_ffi.html">FFI</a> ã‚’ä½¿ã†ã®ãŒæœ‰æœ›ãã†ã¨ã„ã†æ„Ÿè§¦ã‚’å¾—ãŸã€‚
d3d ã¯ lua ã§ã‚„ã£ã¦ã„ã‚‹äººãŒã‚ã¾ã‚Šã„ãªã‹ã£ãŸã€‚</p>
<ul>
<li><a href="https://github.com/sonoro1234/LuaJIT-GLFW">https://github.com/sonoro1234/LuaJIT-GLFW</a></li>
<li><a href="https://github.com/sonoro1234/LuaJIT-ImGui">https://github.com/sonoro1234/LuaJIT-ImGui</a></li>
</ul>
<p>æœ€æ–°ã® luajit-2.1.0-beta3(lua-5.1ä»•æ§˜) ã§ã„ãã€‚</p>
<h3>imgui ã® ffi</h3>
<p><code>cimgui</code> ã§ã¯ãªã ç´ ã® <code>imgui</code> ã® luajit ffi ã§ãã‚‹ã‹å®Ÿé¨“ã—ãŸã€‚</p>
<p><a href="https://stackoverflow.com/questions/6691651/is-it-possible-to-use-functions-from-c-namespaces-with-luajit-ffi">https://stackoverflow.com/questions/6691651/is-it-possible-to-use-functions-from-c-namespaces-with-luajit-ffi</a></p>
<pre class="code literal-block"><span></span><span class="n">ffi</span><span class="p">.</span><span class="n">cdef</span><span class="s">[[</span>
<span class="s">void Test1_Method1(void) asm("_ZN5Test17Method1Ev");</span>
<span class="s">]]</span>
</pre>

<p>ã®ã‚ˆã†ã« mangling ã«å¯¾å¿œã™ã‚Œã°ã§ããã†ã€‚</p>
<h3>libclang ã«ã‚ˆã‚‹ ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</h3>
<p>ã¨ã„ã†ã“ã¨ã§ã€ <code>luajit</code> + <code>FFI</code> ã‚’ä¸­å¿ƒã« <code>imgui</code> ãƒ©ãƒƒãƒ‘ãƒ¼ã‚’ä½œã£ã¦ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã¨ã„ã†ã‹ 3D ãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ãƒ•ãƒ©ã¨ãªã‚‹ã€
ç°¡å˜ãªãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã¨ <code>Gizmo</code> ã«å¯¾å¿œã—ãŸãƒ„ãƒ¼ãƒ«ã‚­ãƒƒãƒˆã‚’ä½œã‚‹ã¨ã„ã†æ–¹å‘ã«ãªã£ã¦ããŸã€‚</p>
<p><code>imgui</code> ã® <code>luajit</code> <code>FFI</code> ã®ä½¿ã„å‹æ‰‹ãŒé‡è¦ã€‚</p>
<p><a href="https://github.com/ousttrue/limgui">https://github.com/ousttrue/limgui</a></p>
<ul>
<li>[ ] libclang ã§ <code>imgui.h</code> ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦ã€luajit FFI ç”Ÿæˆã¨ <code>lsp</code> ã¸ã® EmmyLua ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆã‚’åŒæ™‚ã«ã‚„ã‚‹ãƒ„ãƒ¼ãƒ«ã€‚</li>
</ul>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2021/fix_hererocks/" class="u-url">VS2019 å‘ã‘ã« hererocks ã‚’ä¿®æ­£(vswhere ã‚’ä½¿ã†)</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2021/fix_hererocks/" rel="bookmark">
            <time class="published dt-published" datetime="2021-07-15T00:00:00+09:00" itemprop="datePublished" title="2021-07-15 00:00">2021-07-15 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2021/fix_hererocks/#disqus_thread" data-disqus-identifier="cache/content/posts/2021/fix_hererocks.html">ã‚³ãƒ¡ãƒ³ãƒˆ</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>hererocks ãŒ VS2019BuildTools ã‚’æ¤œçŸ¥ã—ã¦å‹•ä½œã™ã‚‹ã‚ˆã†ã«æ”¹é€ ã—ã¦ã¿ãŸã€‚</p>
<p><a href="https://github.com/luarocks/hererocks/pull/15">https://github.com/luarocks/hererocks/pull/15</a></p>
<p>é€šã‚‹ã‹ã©ã†ã‹ã¯å¾®å¦™ã€‚
å†…å®¹çš„ã«ã€é€šã‚Šã¥ã‚‰ãã†ã€‚
å¤ã„ vc ã‚’ä½¿ã£ã¦ã„ãŸã‚Š MinGW ä½¿ã£ã¦ã„ãŸã‚Šã™ã‚‹ã¨å®Ÿé¨“ã§ããªã„ã—ã­ã€‚
ã¨ã‚Šã‚ãˆãšã€æ—¢å­˜ã®å‹•ã„ã¦ã„ã‚‹éƒ¨åˆ†ãŒå£Šã‚Œãªã„ã‚ˆã†ã«ã¯é…æ…®ã—ãŸã€‚</p>
<p>æ¡ç”¨ã•ã‚Œã‚Œã°ã€</p>
<p><a href="https://github.com/wbthomason/packer.nvim/issues/302">https://github.com/wbthomason/packer.nvim/issues/302</a></p>
<p>ã‚‚é€²å±•ã™ã‚‹ã€‚
Windows ç‰ˆã® luarocks å‘¼ã³å‡ºã—ã«æ”¹é€ ãŒå¿…è¦ãªã®ã ãŒã€
å…ˆã« hererocks ãŒå‹•ã„ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹ã¨ã„ã†é †ç•ªã€‚</p>
<p>ã¨ã‚Šã‚ãˆãšå˜ä½“ã§è©¦ã™ã“ã¨ãŒã§ãã¦</p>
<pre class="code literal-block"><span></span># C:/Python38/Scripts/pip.exe
$ pip install https://github.com/ousttrue/hererocks/archive/add_vswhere.zip
</pre>

<p>ã¨ã™ã‚‹ã€‚</p>
<pre class="code literal-block"><span></span># C:/Python38/Scripts/hererocks.exe
$ hererocks.exe --target vs -j 2.1.0-beta3 -r latest build_dir
Using cl.exe found in PATH.
Fetching LuaJIT 2.1.0-beta3 (target: vs) (cached)
Verifying SHA256 checksum
Building LuaJIT 2.1.0-beta3 (target: vs)
Installing LuaJIT 2.1.0-beta3 (target: vs)
Fetching LuaRocks 3.7.0 (cached)
Verifying SHA256 checksum
Building and installing LuaRocks 3.7.0
</pre>

<p>lua ã¯ã‚·ã‚¹ãƒ†ãƒ ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦å…¨ä½“ã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å…±æœ‰ã™ã‚‹ã¨ã„ã†ã‚ˆã‚Šã¯ã€
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå˜ä½ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã«å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã ã‘ã‚’è¿½åŠ ã™ã‚‹ã¨ã„ã†é‹ç”¨ã«ãªã‚Šãã†ã€‚
ãªã®ã§ã€ hererocks ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ­ãƒ¼ã‚«ãƒ«ã« lua ã‚’ã‚µã‚¯ãƒƒã¨ãƒ“ãƒ«ãƒ‰ã§ãã‚‹ã®ã¯ãªã‹ãªã‹ã‚ˆã„ã€‚
python ã® venv çš„ãªé‹ç”¨ã€‚
å±•é–‹å…ˆã¯ã€ <code>.gitignore</code> ã™ã‚‹ã€‚</p>
<p>ãŸã ã€å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ©ãƒƒãƒ‘ãƒ¼ãŒã•ãã£ã¨å‹•ãã‹ã¨ã„ã†ã¨ Windows ã ã¨å³ã—ã„ã‚‚ã®ãŒã‚ã‚Šã¾ã™ãªãƒ»ãƒ»ãƒ»ã€‚
vcpkg ã¨é€£æºã•ã›ã‚‹ã¨ã‹ã€æ›´ãªã‚‹é ‘å¼µã‚ŠãŒå¿…è¦ã‹ã‚‚ã—ã‚Œãªã„ã€‚
ãªã®ã§ã€ luajit ã® ffi ãŒé¢ç™½ã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚
standalone ã® lua ã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿ã‚’ä½¿ã†å ´åˆã¯ <code>hererocks</code> ãŒã„ã„ã®ã§ã¯ãªã„ã‹ã€‚</p>
<h3>vswhere ãƒ¡ãƒ¢</h3>
<p><a href="https://github.com/Microsoft/vswhere">https://github.com/Microsoft/vswhere</a></p>
<p><code>cl.exe</code>, <code>msbuild.exe</code> ãªã©ã®æ¢ç´¢ã«ä½¿ã†ã€‚
<code>vs2017 version 15.2</code> ä»¥é™ã«å…¥ã£ã¦ã„ã‚‹ã‚‰ã—ã„ã€‚</p>
<p>ã“ã‚“ãªæ„Ÿã˜ã«ä½¿ã†ã€‚</p>
<pre class="code literal-block"><span></span># %ProgramFiles(x86)%\Microsoft Visual Studio\Installer\vswhere.exe
&gt; vswhere -nologo -products *
instanceId: 6762dfe1
installDate: 2020/07/21 9:26:34
installationName: VisualStudio/16.7.3+30503.244
installationPath: C:\Program Files (x86)\Microsoft Visual Studio\2019\BuildTools
installationVersion: 16.7.30503.244
productId: Microsoft.VisualStudio.Product.BuildTools
productPath: C:\Program Files (x86)\Microsoft Visual Studio\2019\BuildTools\Common7\Tools\LaunchDevCmd.bat
state: 4294967295
isComplete: 1
isLaunchable: 1
isPrerelease: 0
isRebootRequired: 0
displayName: Visual Studio Build Tools 2019
description: Visual Studio Build Tools ã§ã¯ã€Visual Studio IDE ã‚’å¿…è¦ã¨ã›ãšã«ã€MSBuild ãƒ™ãƒ¼ã‚¹ã®ãƒã‚¤ãƒ†ã‚£ãƒ– ãƒãƒãƒ¼ã‚¸ãƒ‰ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ“ãƒ«ãƒ‰ã§ãã¾ã™ã€‚ã¾ãŸã€Visual C++ ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€MFCã€ATLã€ãŠã‚ˆã³ C++/CLI ã‚µãƒãƒ¼ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚‚ç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚
channelId: VisualStudio.16.Release
channelUri: https://aka.ms/vs/16/release/channel
enginePath: C:\Program Files (x86)\Microsoft Visual Studio\Installer\resources\app\ServiceHub\Services\Microsoft.VisualStudio.Setup.Service
releaseNotes: https://go.microsoft.com/fwlink/?LinkId=660893#16.7.3
thirdPartyNotices: https://go.microsoft.com/fwlink/?LinkId=660909
updateDate: 2020-09-13T06:19:26.0508205Z
catalog_buildBranch: d16.7
catalog_buildVersion: 16.7.30503.244
catalog_id: VisualStudio/16.7.3+30503.244
catalog_localBuild: build-lab
catalog_manifestName: VisualStudio
catalog_manifestType: installer
catalog_productDisplayVersion: 16.7.3
catalog_productLine: Dev16
catalog_productLineVersion: 2019
catalog_productMilestone: RTW
catalog_productMilestoneIsPreRelease: False
catalog_productName: Visual Studio
catalog_productPatchVersion: 3
catalog_productPreReleaseMilestoneSuffix: 1.0
catalog_productSemanticVersion: 16.7.3+30503.244
catalog_requiredEngineVersion: 2.7.3132.26759
properties_campaignId:
properties_channelManifestId: VisualStudio.16.Release/16.7.3+30503.244
properties_nickname:
properties_setupEngineFilePath: C:\Program Files (x86)\Microsoft Visual Studio\Installer\vs_installershell.exe
</pre>

<p><a href="https://github.com/microsoft/vswhere/wiki/Find-VC">https://github.com/microsoft/vswhere/wiki/Find-VC</a></p>
<p>ãƒ•ã‚£ãƒ«ã‚¿ã‚’ã‹ã‘ã‚‰ã‚Œã‚‹ã€‚</p>
<pre class="code literal-block"><span></span>&gt; vswhere -latest -products * -requires Microsoft.VisualStudio.Component.VC.Tools.x86.x64 -property installationPath
C:\Program Files (x86)\Microsoft Visual Studio\2019\BuildTools
</pre>

<p>è¦‹ã¤ã‹ã£ãŸãƒ‘ã‚¹ã‹ã‚‰å…ˆã¯å›ºå®šã§ã‚ã‚‹ã¨ã¿ãªã—ã¦ã€ <code>vcvars64.bat</code> ãªã©ã‚’è¦‹ã¤ã‘ã‚‹ã€‚</p>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2021/lua_debug_adapter/" class="u-url">lua ã® DebugAdapter ã‚’æ›¸ã„ã¦ã¿ãŸ</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2021/lua_debug_adapter/" rel="bookmark">
            <time class="published dt-published" datetime="2021-07-13T00:00:00+09:00" itemprop="datePublished" title="2021-07-13 00:00">2021-07-13 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2021/lua_debug_adapter/#disqus_thread" data-disqus-identifier="cache/content/posts/2021/lua_debug_adapter.html">ã‚³ãƒ¡ãƒ³ãƒˆ</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>nvim ã® nvim-dap ã§ lua ã‚’ãƒ‡ãƒãƒƒã‚°ã™ã‚‹ã¹ãè‡ªåˆ†ã§æ›¸ã„ã¦ã¿ãŸã€‚
æ‰‹é ƒãªã®ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸã®ã§ã€‚</p>
<p><a href="https://github.com/ousttrue/my_nvim/blob/master/luada.lua">https://github.com/ousttrue/my_nvim/blob/master/luada.lua</a></p>
<p><a href="https://microsoft.github.io/debug-adapter-protocol/">https://microsoft.github.io/debug-adapter-protocol/</a> ã®è‡ªå‰å®Ÿè£…ã€‚</p>
<p><code>request</code> ã®ã†ã¡ <code>initialize</code>, <code>launch</code>, <code>setBreakpoints</code>, <code>configurationDone</code>, <code>threads</code>, <code>stackTrace</code>, <code>scopes</code>, <code>variables</code>, <code>continue</code>, <code>next</code> ã‚’å®Ÿè£…ã—ãŸã€‚
<code>event</code> ã®ã†ã¡ <code>initialized</code>, <code>exited</code>, <code>stopped(breakpoint, step)</code> ã‚’å®Ÿè£…ã—ãŸã€‚</p>
<p>ã“ã‚Œã§æœ€ä½é™ã® breakpoint ã‚’è¨­å®šã—ã¦æ­¢ã‚ã‚‹ã€ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œã€å¤‰æ•°è¡¨ç¤ºã¾ã§ã§ããŸã€‚</p>
<p>ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã‚’è¨­å®šã—ã¦</p>
<pre class="code literal-block"><span></span><span class="nb">require</span><span class="p">(</span><span class="s1">'dap'</span><span class="p">).</span><span class="n">set_log_level</span><span class="p">(</span><span class="s1">'trace'</span><span class="p">)</span>
</pre>

<p>nvim ã® <code>:lua print(vim.fn.stdpath "cache")</code> ã«é…ç½®ã•ã‚Œã‚‹ <code>dap.log</code> ã‚’è¦³å¯Ÿã—ãŸã‚‰ã ã„ãŸã„ã§ããŸã€‚</p>
<p>nvim-dap ã®è¨­å®šã¯ä»¥ä¸‹ã€‚</p>
<pre class="code literal-block"><span></span><span class="kd">local</span> <span class="n">dap</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"dap"</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">luada</span> <span class="o">=</span> <span class="n">vim</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">nvim_get_var</span><span class="p">(</span><span class="s2">"my_nvim_root"</span><span class="p">)</span> <span class="o">..</span> <span class="s2">"/luada.lua"</span>

<span class="c1">-- luada adapter ã‚’ç™»éŒ²</span>
<span class="n">dap</span><span class="p">.</span><span class="n">adapters</span><span class="p">.</span><span class="n">luada</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">-- debugç”¨ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ lua ã§å®Ÿè¡Œã—ã€æ¨™æº–å…¥å‡ºåŠ›ã§ DAP é€šä¿¡(JSON-RPC)ã‚’é–‹å§‹ã™ã‚‹</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="s2">"executable"</span><span class="p">,</span>
    <span class="n">command</span> <span class="o">=</span> <span class="n">vim</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">nvim_get_var</span><span class="p">(</span><span class="s2">"my_nvim_root"</span><span class="p">)</span> <span class="o">..</span> <span class="s2">"/neovim/.deps/usr/bin/luajit.exe"</span><span class="p">,</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">{</span> <span class="n">luada</span> <span class="p">},</span>
<span class="p">}</span>
<span class="c1">-- filetype lua ã®ã¨ãã« luada ã‚’ä½¿ç”¨ã™ã‚‹ã€‚launch ã®å¼•æ•°</span>
<span class="n">dap</span><span class="p">.</span><span class="n">configurations</span><span class="p">.</span><span class="n">lua</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">{</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">"lua debug adapter"</span><span class="p">,</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="s2">"luada"</span><span class="p">,</span>
        <span class="n">request</span> <span class="o">=</span> <span class="s2">"launch"</span><span class="p">,</span>
        <span class="n">program</span> <span class="o">=</span> <span class="s2">"${fileDirname}</span><span class="se">\\</span><span class="s2">${file}"</span><span class="p">,</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span> <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre>

<pre class="code literal-block"><span></span>+---------+    DAP       +--------------------+
| nvim dap|-------&gt;stdin |luajit.exe luada.lua|
|         |&lt;-------stdout|                    |
+---------+              +--------------------+
                                              +==&gt; loadscript(target_lua_script)
</pre>

<p>å…¥å‡ºåŠ›ã‚’ DAP ã§å æœ‰ã—ã¦ã—ã¾ã†ã®ã§ã€ãã‚Œã§ã‚‚å¤§ä¸ˆå¤«ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã—ã‹ãƒ‡ãƒãƒƒã‚°ã§ããªã„ã€‚
(print é–¢æ•°ã¯ã€stderr ã«å‡ºåŠ›ã™ã‚‹ã‚ˆã†ã«é€€é¿ã—ãŸã®ã§ã€<code>dap.log</code> ã«ã¯å‡ºã‚‹)</p>
<p>ç´ ã® standalone ã® lua interpreter ã§ç°¡å˜ã«ã§ãã‚‹ç¯„å›²ã§å®Ÿè£…ã™ã‚‹æ–¹é‡ã€‚</p>
<h3>ã¯ã¾ã‚Šãƒã‚¤ãƒ³ãƒˆ</h3>
<h4>Windows ç‰ˆ ã¯ã€<code>io.stdout</code> ã§ <code>CR</code> ãŒ <code>CRLF</code> ã«å¤‰æ›ã•ã‚Œã‚‹ã®ã‚’å›é¿ã§ããªã„ã€‚</h4>
<pre class="code literal-block"><span></span><span class="n">setmode</span><span class="p">(</span><span class="n">_fileno</span><span class="p">(</span><span class="n">stdout</span><span class="p">),</span><span class="n">_O_BINARY</span><span class="p">);</span>
</pre>

<p>ã‚’ lua ã§å‘¼ã³å‡ºã™æ‰‹æ®µãŒç„¡ã„ã€‚</p>
<pre class="code literal-block"><span></span>Content-Leght: 123\n\n
</pre>

<p>ã¨å‡ºåŠ›ã—ã¦å¤‰æ›ã•ã‚Œã‚‹ã®ã«ä»»ã›ã‚‹ã“ã¨ã«ã—ãŸã€‚</p>
<h4>debug.sethook å†…ã§ coroutine.yield ã§ããªã„</h4>
<p><a href="https://stackoverflow.com/questions/54858455/lua-debug-hooks-seems-to-prevent-the-coroutine-from-working">https://stackoverflow.com/questions/54858455/lua-debug-hooks-seems-to-prevent-the-coroutine-from-working</a></p>
<p>breakpoint ç­‰ã«ã‚ˆã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆä¸­æ–­ã‚’ <code>coroutine.yield</code> ã§å®Ÿè£…ã—ã‚ˆã†ã¨ã—ãŸã®ã ã‘ã©æ–­å¿µã—ãŸã€‚
(yield ã™ã‚‹ã¨ <code>suspend</code> ã«ãªã‚‰ãšã« <code>dead</code> ã«ãªã‚‹)</p>
<p><a href="https://github.com/tomblind/local-lua-debugger-vscode">https://github.com/tomblind/local-lua-debugger-vscode</a> ã¯ã€coroutine ã§å®Ÿè£…ã—ã¦ã„ã‚‹ã‚ˆã†ãªæ°—ãŒã™ã‚‹ã®ã ãŒãƒ»ãƒ»ãƒ»ã€‚</p>
<p>yield ã™ã‚‹ä»£ã‚ã‚Šã« main.loop ã‚’ãƒã‚¹ãƒˆã•ã›ã¦ãã“ã§é€šä¿¡å¾…æ©Ÿã•ã›ã‚‹ã“ã¨ã«ã—ãŸã€</p>
<h4>launch ã§é–‹å§‹ã™ã‚‹ã¨æ—©ã™ãã‚‹</h4>
<p>ã“ã‚Œã¯ã€ <code>nvim-dap</code> ã®å®Ÿè£…ã®å•é¡Œã®ã‚ˆã†ãªæ°—ãŒã™ã‚‹ãŒã€
capabilities ã«ä»¥ä¸‹ã‚’è¨­å®šã—ã¦ã€ <code>configurationDone</code> ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§è‡ªé–‹å§‹ã™ã‚‹ã€‚</p>
<pre class="code literal-block"><span></span><span class="n">supportsConfigurationDoneRequest</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</pre>

<h3>ToDo</h3>
<p>luada ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œã£ã¦ vscode æ‹¡å¼µã¨ã—ã¦ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹ã€‚</p>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2021/packer_luarocks/" class="u-url">packer ã‹ã‚‰ luarocks ã‚’ä½¿ã†</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2021/packer_luarocks/" rel="bookmark">
            <time class="published dt-published" datetime="2021-07-08T00:00:00+09:00" itemprop="datePublished" title="2021-07-08 00:00">2021-07-08 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2021/packer_luarocks/#disqus_thread" data-disqus-identifier="cache/content/posts/2021/packer_luarocks.html">ã‚³ãƒ¡ãƒ³ãƒˆ</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>nvim ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ packer ã«ã€ luarocks ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ©Ÿèƒ½ãŒã‚ã‚‹ã®ã ãŒ Windows hererocks ãŒå¤±æ•—ã™ã‚‹ã€‚
Linux ã¯ã€ hererocks ã¯ã§ãã‚‹ãŒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒãƒ­ãƒ¼ãƒ‰ã§ãã¬ã€‚
å•é¡Œã®å°‘ãªã„ Linux ã‹ã‚‰èª¿ã¹ã¦ã„ãã€‚</p>
<h3>Linux</h3>
<p>packer è¨­å®šã§ lua ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®šã‚’è¨˜è¿°ã™ã‚‹ã¨ã€ <code>hererocks</code> ã‚’ç”¨ã„ã¦ luarocks ãŒ <code>~/.config/nvim/hererocks</code> ã«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã•ã‚Œã‚‹ã“ã¨ã¯åˆ†ã‹ã£ãŸã€‚</p>
<pre class="code literal-block"><span></span><span class="c1">-- packer ã§ lua ã® penlight ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</span>
<span class="n">use_rocks</span> <span class="s2">"penlight"</span> 
</pre>

<p>ã—ã‹ã—ã€</p>
<pre class="code literal-block"><span></span><span class="nb">require</span> <span class="s2">"penlight"</span>
</pre>

<p>ãŒã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€‚
<code>package.path</code> ã« luarocks ãŒç„¡ãã¦ã†ã¾ãã„ã‹ãªã„ã½ã„ï¼Ÿ</p>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2021/nvim_init/" class="u-url">nvim.init ã§ã¯ã¾ã‚‹</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2021/nvim_init/" rel="bookmark">
            <time class="published dt-published" datetime="2021-07-01T00:00:00+09:00" itemprop="datePublished" title="2021-07-01 00:00">2021-07-01 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2021/nvim_init/#disqus_thread" data-disqus-identifier="cache/content/posts/2021/nvim_init.html">ã‚³ãƒ¡ãƒ³ãƒˆ</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>Windows ã§ã‚‚ç’°å¢ƒå¤‰æ•° <code>XDG_CONFIG_HOME</code> ã‚’è¨­å®šã—ã¦ã„ã‚‹ã¨ã€ <code>%USERPROFILE%/AppData/Local/nvim</code> ãŒç„¡åŠ¹ã«ãªã‚‹ã€‚</p>
<p><a href="https://neovim.io/doc/user/starting.html#%24XDG_CONFIG_HOME">https://neovim.io/doc/user/starting.html#$XDG_CONFIG_HOME</a></p>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2021/nvim_dap_codelldb/" class="u-url">nvim-dap ã§ coldelldb å‹•ã„ãŸ</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2021/nvim_dap_codelldb/" rel="bookmark">
            <time class="published dt-published" datetime="2021-06-27T00:00:00+09:00" itemprop="datePublished" title="2021-06-27 00:00">2021-06-27 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2021/nvim_dap_codelldb/#disqus_thread" data-disqus-identifier="cache/content/posts/2021/nvim_dap_codelldb.html">ã‚³ãƒ¡ãƒ³ãƒˆ</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p><a href="https://github.com/mfussenegger/nvim-dap">nvim-dap</a> ã§ rust ã‚’ãƒ‡ãƒãƒƒã‚°ã™ã‚‹ã¹ãæ‚ªæˆ¦è‹¦é—˜ä¸­ã€‚
nvim-dap ã¨ã„ã†ã®ã¯ã€æ¥ãŸã‚‹ nvim-0.5 ã§å‹•ãã‚ˆã†ã«ãªã‚‹ã€ <code>vscode</code> ã®ãƒ‡ãƒãƒƒã‚°ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã‚’å‹•ä½œã•ã›ã‚‹æ©Ÿèƒ½ã€‚</p>
<p>rust(Windows) ã¯ native debugger ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚Œã°ã„ã„ã®ã§ã€ã„ãã¤ã‹é¸æŠè‚¢ãŒã‚ã£ã¦</p>
<ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools">https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=lanza.lldb-vscode">https://marketplace.visualstudio.com/items?itemName=lanza.lldb-vscode</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb">https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb</a></li>
</ul>
<p>æœ€å¾Œã®ã€<code>vscode-lldb(codelldb)</code> <a href="https://github.com/vadimcn/vscode-lldb">https://github.com/vadimcn/vscode-lldb</a> ãŒä½¿ã„ãŸã„ã€‚</p>
<h3>codelldb ã®èµ·å‹•</h3>
<p>nvim-dap ã‹ã‚‰ <code>codelldb.exe</code> ãƒ—ãƒ­ã‚»ã‚¹ã¯èµ·å‹•ã—ã¦ã„ã‚‹æ§˜å­ã€‚é€šä¿¡ãŒã†ã¾ãã„ã£ã¦ãªã„ã‚ˆã†ã«è¦‹ãˆã‚‹ã€‚</p>
<pre class="code literal-block"><span></span>&gt; .\.cache\dein\repos\github.com\puremourning\vimspector\gadgets\windows\CodeLLDB\adapter\codelldb.exe
Listening on port 55201
</pre>

<p>æ¨™æº–å…¥å‡ºåŠ›ã‚’ä½¿ã†ãƒ¢ãƒ¼ãƒ‰ã«ãªã£ã¦ã„ãªã„ã®ã§ã¯ï¼Ÿ</p>
<p><code>adapter/src/lib.rs</code></p>
<pre class="code literal-block"><span></span><span class="n">async</span><span class="w"> </span><span class="k">fn</span> <span class="nf">run_debug_server</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">addr</span>: <span class="nc">net</span>::<span class="n">SocketAddr</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">adapter_settings</span>: <span class="nc">debug_protocol</span>::<span class="n">AdapterSettings</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">multi_session</span>: <span class="kt">bool</span><span class="p">,</span><span class="w"></span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">listener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TcpListener</span>::<span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">addr</span><span class="p">).</span><span class="n">await</span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">"Listening on port {}"</span><span class="p">,</span><span class="w"> </span><span class="n">listener</span><span class="p">.</span><span class="n">local_addr</span><span class="p">().</span><span class="n">unwrap</span><span class="p">().</span><span class="n">port</span><span class="p">());</span><span class="w"></span>
</pre>

<p>é¡ã‚‹ã€‚ <code>main -&gt; debug_server -&gt; entry -&gt; run_debug_server</code></p>
<pre class="code literal-block"><span></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">env_logger</span>::<span class="n">Builder</span>::<span class="n">from_default_env</span><span class="p">().</span><span class="n">init</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">matches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">App</span>::<span class="n">new</span><span class="p">(</span><span class="s">"codelldb"</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="n">Arg</span>::<span class="n">with_name</span><span class="p">(</span><span class="s">"port"</span><span class="p">).</span><span class="n">long</span><span class="p">(</span><span class="s">"port"</span><span class="p">).</span><span class="n">takes_value</span><span class="p">(</span><span class="kc">true</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="n">Arg</span>::<span class="n">with_name</span><span class="p">(</span><span class="s">"multi-session"</span><span class="p">).</span><span class="n">long</span><span class="p">(</span><span class="s">"multi-session"</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="n">Arg</span>::<span class="n">with_name</span><span class="p">(</span><span class="s">"preload"</span><span class="p">).</span><span class="n">long</span><span class="p">(</span><span class="s">"preload"</span><span class="p">).</span><span class="n">multiple</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="n">takes_value</span><span class="p">(</span><span class="kc">true</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="n">Arg</span>::<span class="n">with_name</span><span class="p">(</span><span class="s">"liblldb"</span><span class="p">).</span><span class="n">long</span><span class="p">(</span><span class="s">"liblldb"</span><span class="p">).</span><span class="n">takes_value</span><span class="p">(</span><span class="kc">true</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="n">Arg</span>::<span class="n">with_name</span><span class="p">(</span><span class="s">"params"</span><span class="p">).</span><span class="n">long</span><span class="p">(</span><span class="s">"params"</span><span class="p">).</span><span class="n">takes_value</span><span class="p">(</span><span class="kc">true</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">subcommand</span><span class="p">(</span><span class="n">SubCommand</span>::<span class="n">with_name</span><span class="p">(</span><span class="s">"terminal-agent"</span><span class="p">).</span><span class="n">arg</span><span class="p">(</span><span class="n">Arg</span>::<span class="n">with_name</span><span class="p">(</span><span class="s">"port"</span><span class="p">).</span><span class="n">long</span><span class="p">(</span><span class="s">"port"</span><span class="p">).</span><span class="n">takes_value</span><span class="p">(</span><span class="kc">true</span><span class="p">)))</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">get_matches</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matches</span><span class="p">.</span><span class="n">subcommand_matches</span><span class="p">(</span><span class="s">"terminal-agent"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">terminal_agent</span>::<span class="n">terminal_agent</span><span class="p">(</span><span class="o">&amp;</span><span class="n">matches</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">debug_server</span><span class="p">(</span><span class="o">&amp;</span><span class="n">matches</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre>

<p>ã©ã†ã‚„ã‚‰ã€ <code>executable</code> ã‹ã¤ <code>stdio ã§ã¯ãªã tcp</code> é€šä¿¡ã¨ã„ã†ã‚¿ã‚¤ãƒ—ã§ nvim-dap ã§ã¯æœªå¯¾å¿œã¨ã„ã†ã“ã¨ã§ã‚ˆã•ãã†ã€‚ï¼Ÿ</p>
<ul>
<li>èµ·å‹•</li>
<li>
<code>Listening on port XXXXX</code> ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰ port ã‚’å¾—ã‚‹</li>
<li>ãã®ãƒãƒ¼ãƒˆã«å¯¾ã—ã¦ TCP æ¥ç¶šã¨ã„ã†æ‰‹é †ãŒå¿…è¦</li>
</ul>
<p><a href="https://code.visualstudio.com/api/extension-guides/debugger-extension#alternative-approach-to-develop-a-debugger-extension">https://code.visualstudio.com/api/extension-guides/debugger-extension#alternative-approach-to-develop-a-debugger-extension</a></p>
<p>ã® <code>DebugAdapterServer</code> ã‚¿ã‚¤ãƒ—ã«ã‚ãŸã‚‹ã€‚</p>
<h3>nvim-dap ã®æ”¹é€ ã‚’è©¦ã¿ã‚‹</h3>
<p>adapter.type <code>executable</code>, <code>server</code> ã«åŠ ãˆã¦ã€ç¬¬3ã® <code>executable_server</code> ã‚’ä½œã‚Œã‚‹ã‹ã€‚</p>
<pre class="code literal-block"><span></span><span class="kd">local</span> <span class="kr">function</span> <span class="nf">run_adapter</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">configuration</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="n">configuration</span><span class="p">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">'[no name]'</span>
  <span class="kd">local</span> <span class="n">options</span> <span class="o">=</span> <span class="n">adapter</span><span class="p">.</span><span class="n">options</span> <span class="ow">or</span> <span class="p">{}</span>
  <span class="n">opts</span> <span class="o">=</span> <span class="n">vim</span><span class="p">.</span><span class="n">tbl_extend</span><span class="p">(</span><span class="s1">'keep'</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="p">{</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="n">cwd</span><span class="p">,</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="n">env</span>
  <span class="p">})</span>
  <span class="kr">if</span> <span class="n">adapter</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">'executable'</span> <span class="kr">then</span>
    <span class="n">lazy</span><span class="p">.</span><span class="n">progress</span><span class="p">.</span><span class="n">report</span><span class="p">(</span><span class="s1">'Running: '</span> <span class="o">..</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">M</span><span class="p">.</span><span class="n">launch</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">configuration</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
  <span class="kr">elseif</span> <span class="n">adapter</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">'server'</span> <span class="kr">then</span>
    <span class="n">lazy</span><span class="p">.</span><span class="n">progress</span><span class="p">.</span><span class="n">report</span><span class="p">(</span><span class="s1">'Running: '</span> <span class="o">..</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">M</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">adapter</span><span class="p">.</span><span class="n">host</span><span class="p">,</span> <span class="n">adapter</span><span class="p">.</span><span class="n">port</span><span class="p">,</span> <span class="n">configuration</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
  <span class="kr">elseif</span> <span class="n">adapter</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">'executable_server'</span> <span class="kr">then</span> <span class="c1">-- ğŸ‘ˆã“ã‚Œã‚’è¿½åŠ ã—ãŸ</span>
    <span class="n">lazy</span><span class="p">.</span><span class="n">progress</span><span class="p">.</span><span class="n">report</span><span class="p">(</span><span class="s1">'Running: '</span> <span class="o">..</span> <span class="n">name</span><span class="p">)</span>
    <span class="c1">-- local session = M.launch(adapter, configuration, opts)</span>
    <span class="kd">local</span> <span class="n">stdin</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">executable_server</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
    <span class="c1">-- `Error executing luv callback: vimL function must not be called in a lua loop callback`</span>
    <span class="n">vim</span><span class="p">.</span><span class="n">loop</span><span class="p">.</span><span class="n">read_start</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="n">vim</span><span class="p">.</span><span class="n">schedule_wrap</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
      <span class="c1">-- codelldb ã®å‡ºåŠ›ã‹ã‚‰ port ã‚’å¾—ã‚‹</span>
      <span class="c1">-- Lisening on port xxxxx</span>
      <span class="kd">local</span> <span class="n">port</span> <span class="o">=</span> <span class="nb">string.match</span><span class="p">(</span><span class="n">data</span> <span class="p">,</span> <span class="s2">"Listening on port (%d+)"</span> <span class="p">)</span>
      <span class="n">M</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="kc">nil</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">configuration</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">))</span>
  <span class="kr">else</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s1">'Invalid adapter type %s, expected `executable` or `server`'</span><span class="p">,</span> <span class="n">adapter</span><span class="p">.</span><span class="n">type</span><span class="p">))</span>
  <span class="kr">end</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">executable_server</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">vim</span><span class="p">.</span><span class="n">loop</span>
  <span class="kd">local</span> <span class="n">stdin</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">new_pipe</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">stdout</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">new_pipe</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">new_pipe</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">handle</span>
  <span class="kd">local</span> <span class="kr">function</span> <span class="nf">onexit</span><span class="p">()</span>
    <span class="n">stdin</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>
    <span class="n">stdout</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>
    <span class="n">stderr</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>
    <span class="n">handle</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>
  <span class="kr">end</span>
  <span class="kd">local</span> <span class="n">options</span> <span class="o">=</span> <span class="n">adapter</span><span class="p">.</span><span class="n">options</span> <span class="ow">or</span> <span class="p">{}</span>
  <span class="kd">local</span> <span class="n">pid_or_err</span>
  <span class="n">handle</span><span class="p">,</span> <span class="n">pid_or_err</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">spawn</span><span class="p">(</span><span class="n">adapter</span><span class="p">.</span><span class="n">command</span><span class="p">,</span> <span class="p">{</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">adapter</span><span class="p">.</span><span class="n">args</span><span class="p">;</span>
    <span class="n">stdio</span> <span class="o">=</span> <span class="p">{</span><span class="n">stdin</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">};</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="n">cwd</span><span class="p">;</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="n">env</span><span class="p">;</span>
    <span class="n">detached</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">},</span> <span class="n">onexit</span><span class="p">)</span>
  <span class="nb">assert</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="s1">'Error running '</span> <span class="o">..</span> <span class="n">adapter</span><span class="p">.</span><span class="n">command</span> <span class="o">..</span> <span class="s1">': '</span> <span class="o">..</span> <span class="n">pid_or_err</span><span class="p">)</span>

  <span class="kr">return</span> <span class="n">stdin</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">attach</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
  <span class="kr">if</span> <span class="n">session</span> <span class="kr">then</span>
    <span class="n">session</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>
  <span class="kr">end</span>
  <span class="kr">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">.</span><span class="n">request</span> <span class="kr">then</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'config needs the `request` property which must be one of `attach` or `launch`'</span><span class="p">)</span>
    <span class="kr">return</span>
  <span class="kr">end</span>
  <span class="c1">-- initialize ãŒæ—©ã™ãã‚‹ã®ã§ config ã‚’ connect å¼•æ•°ã«</span>
  <span class="n">session</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">'dap.session'</span><span class="p">):</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
  <span class="kr">return</span> <span class="n">session</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nc">Session</span><span class="p">:</span><span class="nf">connect</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">session</span> <span class="o">=</span> <span class="n">session_defaults</span><span class="p">(</span><span class="n">opts</span> <span class="ow">or</span> <span class="p">{})</span>
  <span class="nb">setmetatable</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">self</span><span class="p">)</span>
  <span class="n">self</span><span class="p">.</span><span class="n">__index</span> <span class="o">=</span> <span class="n">self</span>

  <span class="kd">local</span> <span class="n">client</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">new_tcp</span><span class="p">()</span>
  <span class="n">session</span><span class="p">.</span><span class="n">client</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">write</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> 
        <span class="n">client</span><span class="p">:</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> 
    <span class="kr">end</span><span class="p">;</span>
    <span class="n">close</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>
      <span class="n">client</span><span class="p">:</span><span class="n">shutdown</span><span class="p">()</span>
      <span class="n">client</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>
    <span class="kr">end</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">client</span><span class="p">:</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span> <span class="ow">or</span> <span class="s1">'127.0.0.1'</span><span class="p">,</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">port</span><span class="p">),</span> <span class="kr">function</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="kr">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="kr">then</span> <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="kr">end</span>
    <span class="n">client</span><span class="p">:</span><span class="n">read_start</span><span class="p">(</span><span class="n">rpc</span><span class="p">.</span><span class="n">create_read_loop</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
      <span class="n">session</span><span class="p">:</span><span class="n">handle_body</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
    <span class="kr">end</span><span class="p">))</span>

    <span class="c1">-- connect ãŒæˆç«‹ã—ã¦ã‹ã‚‰ initialize ã‚’é€ã‚‹</span>
    <span class="n">session</span><span class="p">:</span><span class="n">initialize</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

  <span class="kr">end</span><span class="p">)</span>
  <span class="kr">return</span> <span class="n">session</span>
<span class="kr">end</span>
</pre>

<p>å‹•ã„ãŸã€‚ PR ä½œã‚ã†ã€‚</p>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2021/rust_ffi/" class="u-url">rust ã® ffi</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2021/rust_ffi/" rel="bookmark">
            <time class="published dt-published" datetime="2021-06-20T00:00:00+09:00" itemprop="datePublished" title="2021-06-20 00:00">2021-06-20 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2021/rust_ffi/#disqus_thread" data-disqus-identifier="cache/content/posts/2021/rust_ffi.html">ã‚³ãƒ¡ãƒ³ãƒˆ</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>rust ã® FFI ã«å–ã‚Šçµ„ã‚“ã§ã„ãŸã€‚
çµå±€ã€ sdl binding ã¨ imgui binding ã‚’è‡ªä½œã—ãŸã€‚</p>
<p>ä¸¡æ–¹ã¨ã‚‚ã€æ—¢å­˜ã® crate ãŒã‚ã‚‹ã®ã«ä½•æ•…ã‚ã–ã‚ã–è‡ªä½œã™ã‚‹ã®ã‹ã¨è¨€ãˆã°ã€
ãƒ©ãƒƒãƒ—ã•ã‚Œã¦ä½¿ã„æ–¹ãŒå¤‰ã‚ã£ãŸã¨ã“ã‚ã‚’å­¦ã¶ã®ãŒé¢å€’ãã•ã‹ã£ãŸã‹ã‚‰ã˜ã‚ƒã€‚
<a href="https://crates.io/crates/sdl2">SDL</a> ã¯ã€€<code>HWND</code> ã‚’å–å¾—ã™ã‚‹æ–¹æ³•ãŒã‚ã‹ã‚Šã«ããã¦ <code>SDL_Event</code> ã‚’ <code>imgui</code> ã«æ¸¡ã™æ–¹æ³•ã¯ã‚ã‹ã‚‰ãªã‹ã£ãŸã€‚
<a href="https://crates.io/crates/imgui">imgui</a> ã¯æœ€æ–°ç‰ˆã® <code>docking</code> ãƒ–ãƒ©ãƒ³ãƒãŒä½¿ã„ãŸã‹ã£ãŸã€‚</p>
<p><a href="https://crates.io/crates/clang-sys">clang-sys</a> ã‚’ä½¿ã£ã¦ rust ã® FFI ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã€
<a href="https://crates.io/crates/cc">cc</a> ã‚’ä½¿ã£ã¦ <code>build.rs</code> ã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ãƒ“ãƒ«ãƒ‰ã—ãŸã€‚
ã“ã‚Œã§ã€ <code>c</code> <code>c++</code> ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚½ãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰ã—ã¦ã‚¹ã‚¿ãƒ†ã‚£ãƒƒã‚¯ãƒªãƒ³ã‚¯ã—ã€ <code>FFI</code> ã§é–¢æ•°ã‚’å‘¼ã³å‡ºã—æ”¾é¡Œã€‚</p>
<p><code>imgui</code> ã® FFI ç”Ÿæˆã®æ–¹ãŒç°¡å˜ã§ã€ <code>SDL</code> ã®æ–¹ã¯ C ã®ãƒã‚¯ãƒ­ã«è‹¦ã—ã‚“ã (é›‘ã«å¯¾å¿œ)ã€‚
ã¨ã¯ã„ãˆã€ã‚ã‚Šã¨ç´ ç›´ã«è¨˜è¿°ã§ãã‚‹ã®ã§å¿«é©ã§ã‚ã£ãŸã€‚</p>
<p>ãŠã‹ã’ã§ã€ rust ã® FFI å‘¨ã‚Šã«å¯¾ã™ã‚‹ç¿’ç†Ÿåº¦ãŒã ã„ã¶ä¸ŠãŒã£ãŸã€‚</p>
<h3>ã§ããªã„ã“ã¨</h3>
<p>POD ã® struct ã‚’ return ã™ã‚‹é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã¨ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ãŸã€‚</p>
<pre class="code literal-block"><span></span><span class="n">ImVec2</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">GetContentRegionAvail</span><span class="p">();</span>
</pre>

<p>Dè¨€èªã ã‘ã©</p>
<p>https://forum.dlang.org/thread/dkamxcamwttszxwwxttv@forum.dlang.org</p>
<p>ã®ä»¶ã‚‰ã—ãã€C++ å´ã§ãƒ©ãƒƒãƒ—ã—ãŸã€‚</p>
<pre class="code literal-block"><span></span><span class="kt">void</span> <span class="nf">pGetContentRegionAvail</span><span class="p">(</span><span class="n">ImVec2</span> <span class="o">*</span><span class="n">pOut</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">pOut</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">*</span><span class="n">pOut</span> <span class="o">=</span> <span class="n">GetContentRegionAvail</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre>

<h3>è‡ªç”±ã« static link ã§ãã‚‹</h3>
<p>build.rs ã‚’é§†ä½¿ã—ã¦è‡ªç”±ã«ãƒªãƒ³ã‚¯ã§ãã‚‹ã®ã§ã€ã‚¹ã‚¿ãƒ†ã‚£ãƒƒã‚¯ãƒªãƒ³ã‚¯ã¨ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’åˆ¶å¾¡ã§ãã‚‹ã®ã§ä¾¿åˆ©ã€‚
ç‰¹ã« Windows ã®å ´åˆã€ã‚·ã‚¹ãƒ†ãƒ ã«å…±é€šã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒæœŸå¾…ã§ããªã„ã®ã§ã€
DLLã‚’ä½œã£ã¦ã‚³ãƒ”ãƒ¼ã—ãŸå…¥ã‚Šãƒ‘ã‚¹ã‚’é€šã™ã‚ˆã‚Šã¯ã€ã‚¹ã‚¿ãƒ†ã‚£ãƒƒã‚¯ãƒªãƒ³ã‚¯ã™ã‚‹æ–¹ãŒæ°—æ¥½ã€‚
ä»Šå›ã¯ <code>cc</code> ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ãŸã‘ã©ã€<code>c++/c</code> ã¯ CMake ã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹æ–¹ãŒç®¡ç†ã—ã‚„ã™ã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚</p>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2021/mdbook/" class="u-url">mdBook ã‚‚ã‚„ã£ã¦ã¿ã‚‹</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2021/mdbook/" rel="bookmark">
            <time class="published dt-published" datetime="2021-06-14T00:00:00+09:00" itemprop="datePublished" title="2021-06-14 00:00">2021-06-14 00:00</time><span class="updated"> (æ›´æ–°æ—¥æ™‚
                    <time class="dt-updated" datetime="2021-08-31T00:00:00+09:00" itemprop="dateUpdated" title="2021-08-31 00:00">2021-08-31 00:00</time>)</span>
            </a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2021/mdbook/#disqus_thread" data-disqus-identifier="cache/content/posts/2021/mdbook.html">ã‚³ãƒ¡ãƒ³ãƒˆ</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<ul>
<li><a href="https://rust-lang.github.io/mdBook/">https://rust-lang.github.io/mdBook/</a></li>
<li><a href="https://github.com/rust-lang/mdBook">https://github.com/rust-lang/mdBook</a></li>
</ul>
<h2>ä½œã£ã¦ã¿ãŸ</h2>
<ul>
<li><a href="https://github.com/ousttrue/cmake_book">https://github.com/ousttrue/cmake_book</a></li>
</ul>
<p>gh-pages</p>
<ul>
<li><a href="https://ousttrue.github.io/cmake_book/">https://ousttrue.github.io/cmake_book/</a></li>
</ul>
<h2>config.toml</h2>
<h3>base_url ã®è¨­å®šã«ã¯ã¾ã‚‹</h3>
<p>base_url ã®è¨­å®šã ã‘æ¢ã—å›ã£ãŸã€‚
gh-pages ã® url ãŒ <code>https://ousttrue.github.io/cmake_book/</code> ã¨ root ãƒ•ã‚©ãƒ«ãƒ€ã§ã¯ç„¡ã„ã®ã§å¿…ç”¨ã€‚</p>
<p><code>book.toml</code></p>
<pre class="code literal-block"><span></span><span class="k">[output.html]</span>
<span class="na">site-url</span> <span class="o">=</span> <span class="s">"https://ousttrue.github.io/cmake_book/"</span>
</pre>

<h3>github</h3>
<p><code>book.toml</code></p>
<pre class="code literal-block"><span></span><span class="k">[output.html]</span>
<span class="na">git-repository-url</span> <span class="o">=</span> <span class="s">"https://github.com/rust-lang/mdBook/tree/master/guide"</span>
<span class="na">edit-url-template</span> <span class="o">=</span> <span class="s">"https://github.com/rust-lang/mdBook/edit/master/guide/{path}"</span>
</pre>

<h2>github actions</h2>
<p><a href="https://github.com/marketplace/actions/mdbook-action">https://github.com/marketplace/actions/mdbook-action</a></p>
<p>ã‚’å‚è€ƒã«ã—ãŸã®ã ã‘ã©ã€
ã¡ã‚‡ã£ã¨ã¯ã¾ã£ãŸã€‚</p>
<pre class="code literal-block"><span></span><span class="n">name</span><span class="o">:</span> <span class="n">github</span> <span class="n">pages</span>
<span class="n">on</span><span class="o">:</span> <span class="o">[</span><span class="n">push</span><span class="o">]</span> <span class="err">#</span> <span class="o">&lt;=</span> <span class="err">æ›¸ãæ–¹å¤‰ã‚ã£ã¦ãŸ</span><span class="o">(</span><span class="n">pushã—ã¦ã‚‚jobãŒèµ·å‹•ã—ãªã„</span><span class="o">)</span>
<span class="n">jobs</span><span class="o">:</span>
  <span class="n">Explore</span><span class="o">-</span><span class="n">GitHub</span><span class="o">-</span><span class="n">Actions</span><span class="o">:</span> <span class="err">#</span> <span class="o">&lt;=</span> <span class="err">æ›¸ãæ–¹å¤‰ã‚ã£ã¦ãŸï¼Ÿ</span><span class="o">(</span><span class="err">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¨ã—ã¦èªè­˜ã•ã‚Œãªã„ï¼Ÿ</span><span class="o">)</span>
    <span class="n">runs</span><span class="o">-</span><span class="n">on</span><span class="o">:</span> <span class="n">ubuntu</span><span class="o">-</span><span class="mf">18.04</span>
    <span class="n">steps</span><span class="o">:</span>
      <span class="o">-</span> <span class="n">uses</span><span class="o">:</span> <span class="n">actions</span><span class="o">/</span><span class="n">checkout</span><span class="err">@</span><span class="n">v2</span>

      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">Setup</span> <span class="n">mdBook</span>
        <span class="n">uses</span><span class="o">:</span> <span class="n">peaceiris</span><span class="o">/</span><span class="n">actions</span><span class="o">-</span><span class="n">mdbook</span><span class="err">@</span><span class="n">v1</span>
        <span class="k">with</span><span class="o">:</span>
          <span class="n">mdbook</span><span class="o">-</span><span class="n">version</span><span class="o">:</span> <span class="s2">"latest"</span>

      <span class="o">-</span> <span class="n">run</span><span class="o">:</span> <span class="n">mdbook</span> <span class="n">build</span>

      <span class="o">-</span> <span class="n">name</span><span class="o">:</span> <span class="n">Deploy</span>
        <span class="n">uses</span><span class="o">:</span> <span class="n">peaceiris</span><span class="o">/</span><span class="n">actions</span><span class="o">-</span><span class="n">gh</span><span class="o">-</span><span class="n">pages</span><span class="err">@</span><span class="n">v3</span>
        <span class="err">#</span> <span class="k">if</span><span class="o">:</span> <span class="n">github</span><span class="o">.</span><span class="na">ref</span> <span class="o">==</span> <span class="s1">'refs/heads/main'</span> <span class="o">&lt;=</span> <span class="err">ã‚ã‚‹ã¨å‹•ã‹ãªã„</span>
        <span class="k">with</span><span class="o">:</span>
          <span class="n">github_token</span><span class="o">:</span> <span class="n">$</span><span class="o">{{</span> <span class="n">secrets</span><span class="o">.</span><span class="na">GITHUB_TOKEN</span> <span class="o">}}</span>
          <span class="n">publish_dir</span><span class="o">:</span> <span class="o">./</span><span class="n">book</span>
</pre>

<p>å‹•ã‹ãªã„ã¨ãã€ç‰¹ã« action ã¨ã—ã¦èªè­˜ã•ã‚Œã¦ã„ãªã„ã¨ãã¯å…¨ãæ‰‹æ›ã‹ã‚ŠãŒç„¡ãã¦é›£å„€ã—ãŸã€‚</p>
<p><a href="https://docs.github.com/ja/actions/quickstart">https://docs.github.com/ja/actions/quickstart</a></p>
<p>ã¯å‹•ã„ãŸã®ã§ã€ã“ã‚Œã¨é•ã†ã¨ã“ã‚ã‚’è¦‹æ¯”ã¹ã¦å‹˜ã§ãªãŠã—ãŸã€‚
ã‚ˆãã‚ã‹ã£ã¦ã„ãªã„ã€‚</p>
<h2>mdbook ã® SUMMARY.md</h2>
<p><code>SUMMARY.md</code> ã«ãƒšãƒ¼ã‚¸æ§‹æˆã‚’å…ˆã«è¨˜è¿°ã—ã¦ç« ç«‹ã¦ã‚’ä½œã£ã¦ã‹ã‚‰ä¸­èº«ã‚’è¨˜è¿°ã—ã¦ã„ãã®ãŒé¢ç™½ã„ã€‚
ã“ã®ä»•çµ„ã¿ãŒåˆã†ã‚‚ã®ã¯ã€ <code>zola</code> ã‚ˆã‚Š <code>mdbook</code> ã®æ–¹ãŒã‚µã‚¯ã‚µã‚¯ä½œã‚Œãã†ã€‚
<code>hugo</code> ã¨ã‹ã¨é•ã£ã¦å„ãƒšãƒ¼ã‚¸ã« <code>frontmatter</code> ãŒä¸è¦ãªã®ã§ã€
ãƒšãƒ¼ã‚¸ã‚’è¶³ã—ãŸã‚Šå¼•ã„ãŸã‚Šã™ã‚‹ã™ã‚‹å ´åˆã¯ã“ã¡ã‚‰ã®æ–¹ãŒä½¿ã„ã‚„ã™ã„ã€‚</p>
<p>Scrapbox ä¸Šã«ã‚ã‚‹ãƒ¡ãƒ¢ã‚’æ•´ç†ã™ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚</p>
<p>ä½œã£ãŸã€‚</p>
<ul>
<li><a href="https://ousttrue.github.io/cmake_book/">cmake_book</a></li>
<li><a href="https://ousttrue.github.io/rust_exercise_book/">rustç·´ç¿’å¸³</a></li>
</ul>
<p>ã‚ã¨ã€ <code>blender ã® addon ä½œæˆãƒ¡ãƒ¢</code> ã¨ã‹ <code>Unity ã®ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ãƒ¡ãƒ¢</code> ã¨ã‹ä½œã‚‹ã‹ã‚‚ã€‚</p>
<ul>
<li><a href="https://ousttrue.github.io/bldner_book/">blender_book</a></li>
<li><a href="https://ousttrue.github.io/unity_book/">unity memo</a></li>
</ul>
<h2>mdbook ã‚’ gh-pages ã§åˆæœŸåŒ–ã™ã‚‹æ‰‹é †</h2>
<p>github ã« repository ã‚’ä½œã£ã¦ gh-pages ã«å…¬é–‹ã™ã‚‹ã¨ã“ã‚ã¾ã§</p>
<ul>
<li>new repository <code>https://github.com/GITHUB_USER_NAME/MDBOOK_REPOSITORY_NAME</code>
</li>
<li>git clone GIT_REPOSITORY</li>
<li>cd GIT_REPOSITORY</li>
<li>mdbook init</li>
</ul>
<p><code>book.toml</code></p>
<pre class="code literal-block"><span></span><span class="k">[output.html]</span>
<span class="na">site-url</span> <span class="o">=</span> <span class="s">"https://${USER_NAME}.github.io/${REPO_NAME}/"</span>
<span class="na">git-repository-url</span> <span class="o">=</span> <span class="s">"https://github.com/${USER_NAME}/${REPO_NAME}/tree/master"</span>
<span class="na">edit-url-template</span> <span class="o">=</span> <span class="s">"https://github.com/${USER_NAME}/${REPO_NAME}/edit/master/{path}"</span>
</pre>

<ul>
<li>.github/workflows/gh-pages.yml</li>
</ul>
<pre class="code literal-block"><span></span><span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">github pages</span>
<span class="nt">on</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">push</span><span class="p p-Indicator">]</span>
<span class="nt">jobs</span><span class="p">:</span>
  <span class="nt">Explore-GitHub-Actions</span><span class="p">:</span>
    <span class="nt">runs-on</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ubuntu-18.04</span>
    <span class="nt">steps</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">uses</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">actions/checkout@v2</span>

      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Setup mdBook</span>
        <span class="nt">uses</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">peaceiris/actions-mdbook@v1</span>
        <span class="nt">with</span><span class="p">:</span>
          <span class="nt">mdbook-version</span><span class="p">:</span> <span class="s">"latest"</span>

      <span class="p p-Indicator">-</span> <span class="nt">run</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mdbook build</span>

      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Deploy</span>
        <span class="nt">uses</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">peaceiris/actions-gh-pages@v3</span>
        <span class="nt">with</span><span class="p">:</span>
          <span class="nt">github_token</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${{ secrets.GITHUB_TOKEN }}</span>
          <span class="nt">publish_dir</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./book</span>
</pre>

<ul>
<li>git add .</li>
<li>git commit -m init</li>
<li>git push<ul>
<li>action ãŒç™ºå‹•ã—ã€mdbook ãŒãƒ“ãƒ«ãƒ‰ã—ãŸ book ãƒ•ã‚©ãƒ«ãƒ€ãŒ gh-pages ãƒ–ãƒ©ãƒ³ãƒã« push ã•ã‚Œã‚‹</li>
</ul>
</li>
<li>github ã® settings - pages ã‹ã‚‰ gh-pages branch ã‚’é¸ã‚“ã§ root ã‚’è¨­å®šã™ã‚‹<ul>
<li>ã—ã°ã‚‰ãã™ã‚‹ã¨ <code>https://GITHUB_USER_NAME.github.io/MDBOOK_REPOSITORY_NAME/</code> ãŒæœ‰åŠ¹ã«ãªã‚‹</li>
</ul>
</li>
</ul>
<p>åˆå›ã«ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¾ã§ä½•å›ã‹ push ãŒè¦ã‚‹ã‹ã‚‚ã€‚</p>
<ul>
<li>repo ä½œã‚‹</li>
<li>gh-pages branch ã« push ã™ã‚‹</li>
<li>è¨­å®šã§ gh-pages ã‚’æœ‰åŠ¹ã«ã™ã‚‹</li>
<li>å†åº¦ push ã— action ã‚’ç™ºå‹•ã•ã›ã‚‹ã€‚ã“ã®è¾ºã§ã‚µã‚¤ãƒˆãŒè¦‹ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹</li>
</ul>
<h2>å‚è€ƒ</h2>
<p><a href="https://o296.com/e/mdbook_as_blog.html">https://o296.com/e/mdbook_as_blog.html</a></p>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2021/zola_template/" class="u-url">zola ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ•´å‚™ã™ã‚‹</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2021/zola_template/" rel="bookmark">
            <time class="published dt-published" datetime="2021-06-14T00:00:00+09:00" itemprop="datePublished" title="2021-06-14 00:00">2021-06-14 00:00</time><span class="updated"> (æ›´æ–°æ—¥æ™‚
                    <time class="dt-updated" datetime="2021-08-31T00:00:00+09:00" itemprop="dateUpdated" title="2021-08-31 00:00">2021-08-31 00:00</time>)</span>
            </a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2021/zola_template/#disqus_thread" data-disqus-identifier="cache/content/posts/2021/zola_template.html">ã‚³ãƒ¡ãƒ³ãƒˆ</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>ã‚µã‚¤ãƒˆæ•´å‚™ã®ãƒ¡ãƒ¢ã€‚å…±é€šåŒ–ã—ã¦éƒ¨å“ã‚’å°‘ãªãã—ãŸã€‚</p>
<ul>
<li>zola è¨­å®š</li>
<li>template æ§‹ç¯‰</li>
<li>å ´åˆã«ã‚ˆã£ã¦ã¯ zola ã®æ”¹é€ </li>
</ul>
<h2>å…±é€š</h2>
<ul>
<li>[x] title</li>
<li>[x] æ—¥ä»˜</li>
<li>[x] è¦‹å‡ºã—ã®è¦‹ãŸç›®</li>
</ul>
<h2>Markdown</h2>
<ul>
<li>[x] url æ–‡å­—åˆ—ã‚’è‡ªå‹•ã§ãƒªãƒ³ã‚¯ã«ã—ãŸã„ã€‚markdownã§ <code>&lt;url&gt;</code> ã¨è¨˜è¿°ã™ã‚‹ã¹ã—</li>
</ul>
<h2>20210716: masonry å…¥ã‚Œã¦ã¿ãŸ</h2>
<p><a href="https://masonry.desandro.com/">https://masonry.desandro.com/</a></p>
<h2>20210717: TOC</h2>
<ul>
<li>[x] ç›®æ¬¡
ã ã„ãŸã„ã§ããŸã€‚
github ãŒå¢—ãˆã™ãã¦ã‚«ã‚ªã‚¹ãªã®ã§ä¸è¦ãªã‚‚ã®ã‚’æ•´ç†ã›ã­ã°ãƒ»ãƒ»ãƒ»</li>
</ul>
<h2>20210725: è‰²</h2>
<p>ä½œæ¥­ç”¨ã«åŒºåŸŸã”ã¨ã«è‰²åˆ†ã‘ã—ã¦ã„ãŸã®ã‚’ã‚„ã‚ã¦ã€åœ°å‘³ãªè‰²ã«å¤‰æ›´ã€‚</p>
<pre class="code literal-block"><span></span><span class="k">@mixin</span><span class="nf"> MAIN_COLOR</span> <span class="p">{</span>
    <span class="nt">color</span><span class="nd">:</span> <span class="nt">black</span><span class="o">;</span>
    <span class="nt">background-color</span> <span class="nt">white</span><span class="o">;</span>
<span class="p">}</span>
</pre>

<p>ã®ã‚ˆã†ãªæ–¹æ³•ã‚’è©¦ã—ã¦ã¿ãŸã€‚</p>
<h2>20210725: TOC å›ºå®š</h2>
<pre class="code literal-block"><span></span><span class="nt">position</span><span class="o">:</span> <span class="nt">fixed</span><span class="o">;</span>
</pre>

<h2>20210725: ç”»åƒã‚’å…¥ã‚Œã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã¿ãŸ</h2>
<p><code>page.assets</code> ã‚„ <code>section.assets</code> ã«æƒ³å®šã—ãŸå½¢ã§å…¥ã£ã¦ã“ãªã„ã®ã§ã€
ç„¡ç†ã‚„ã‚Šãƒ‘ã‚¹ã‚’æ“ä½œã—ãŸã®ã ãŒã€ã•ã™ãŒã«ã“ã‚Œã¯ã¡ã‚‡ã£ã¨ãƒ»ãƒ»ãƒ»</p>
<pre class="code literal-block"><span></span>  {% if page.extra.image %}
  {% set s = page.relative_path | split(pat="/") %}
  {% set len = s | length %}
  {% set sl = s | slice(start=0, end=len-1) %}
  {% set j = sl | join(sep="/") %}
  {% set image_url = resize_image(path=j ~ "/" ~ page.extra.image, width=600, op="fit_width") %}
  <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">"{{ image_url }}"</span><span class="err">"</span><span class="p">&gt;</span>
  {% endif %}
</pre>

<p>ãªã‚“ã‹ã€ <code>zola</code> ãŒã‚ã‚Šã¨èé€šãŒåˆ©ã‹ãªã„ã“ã¨ãŒåˆ†ã‹ã£ã¦ããŸã€‚
<code>resize_image</code> ã§æ˜ç¤ºçš„ã«ç”»åƒã‚’åŠ å·¥ã™ã‚‹ã¨ã„ã†è¨­è¨ˆã¯ç†è§£ã€‚ãªã‚‹ã»ã©ã€‚
å½“æ–¹ã€ <code>md</code> ãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã« <code>png, jpg</code> ã‚’æ”¾ã‚Šè¾¼ã‚“ã§ãã‚Œã‚’è¨˜äº‹å†…ã§ä½¿ã„ãŸã„ã®ã§ã™ã€‚
ç”»åƒã‚’ä¸­å¤®ã® <code>static</code> ãƒ•ã‚©ãƒ«ãƒ€ã«ã¾ã¨ã‚ã¦å…¥ã‚Œã¦ãŠãã®å«Œãªã®ã§ã€‚
æ”¹é€ ã—ã¦ page.assets ã«æ”¾ã‚Šè¾¼ã‚“ã§ã—ã¾ãŠã†ã€‚</p>
<p><code>hugo</code> ã»ã©å¤šæ©Ÿèƒ½è¤‡é›‘ã§ãªãã€ <code>zola</code> ã»ã© strict ã§ãªã„ã€ãã‚“ãªã»ã©ã»ã©ãªãƒ„ãƒ¼ãƒ«ãŒæœ›ã¾ã‚Œã‚‹ã€‚</p>
<h2>20210815: pagination</h2>
<p><a href="https://www.getzola.org/documentation/templates/pagination/">https://www.getzola.org/documentation/templates/pagination/</a></p>
<p>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚ˆã‚Šã‚‚ã‚½ãƒ¼ã‚¹ã‚’èª­ã‚‚ã† w
5åˆ†ã‚‚ã‹ã‹ã‚‰ã¬ã€‚</p>
<pre class="code literal-block"><span></span>      {% if paginator.current_index == 1 %}
</pre>

<h2>20210829: å†…éƒ¨ãƒªãƒ³ã‚¯è¨˜æ³•</h2>
<p><code>.md</code> ã®è¨˜æ³•ã€‚</p>
<p><a href="https://www.getzola.org/documentation/content/linking/#internal-links">https://www.getzola.org/documentation/content/linking/#internal-links</a></p>
<p><code>[NvimTexture](@/posts/2021/summer/nvimtexture.md)</code></p>
<p><code>@</code> ã¨ <code>.md</code> ãŒå¿…è¦ã€‚</p>
<h2>20210831: search</h2>
<p><a href="https://www.getzola.org/documentation/content/search/">https://www.getzola.org/documentation/content/search/</a></p>
<p>è¨­å®šã¯ <code>build_search_index = true</code> ã™ã‚‹ã ã‘ãªã®ã ãŒã€
template ä½œã‚‹ã®ã¯å¤§å¤‰ã€‚</p>
<p><a href="https://github.com/aaranxu/adidoks">https://github.com/aaranxu/adidoks</a> ã‹ã‚‰éƒ¨å“ã‚’é ‚ã„ã¦ããŸã€‚</p>
</div>
                </div>
            </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2021/init_zola/" class="u-url">ã‚µã‚¤ãƒˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ Zola ã«å¤‰æ›´</a></h1>
                <div class="metadata">
                    <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                        ousttrue
                    </span></p>
            <p class="dateline">
            <a href="posts/2021/init_zola/" rel="bookmark">
            <time class="published dt-published" datetime="2021-06-12T00:00:00+09:00" itemprop="datePublished" title="2021-06-12 00:00">2021-06-12 00:00</time></a>
            </p>
                        <p class="commentline">
        
    <a href="posts/2021/init_zola/#disqus_thread" data-disqus-identifier="cache/content/posts/2021/init_zola.html">ã‚³ãƒ¡ãƒ³ãƒˆ</a>


                </p>
</div>
            </header><div class="e-content entry-content">
                    <div>
<p>æœ€è¿‘ã€ rust ã‚’å†é–‹ã—ãŸã®ã§ã€
<code>Static Site Generator</code> ã‚’ go è£½ã® hugo ã‹ã‚‰ rust è£½ã® zola ã«å¤‰æ›´ã—ã¦ã¿ãŸã€‚</p>
<p><a href="https://www.getzola.org/">https://www.getzola.org/</a></p>
<h2>hugo ã®ã‹ã‚‰ã®å¼•ã£è¶Šã—</h2>
<h3>zola ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h3>
<h3>åˆæœŸåŒ–</h3>
<h3>config.toml ã‚’ hugo ç‰ˆã‹ã‚‰ zola ç‰ˆã«æ›¸ãæ›ãˆã‚‹ã€‚</h3>
<p>æœ€ä½é™ base_urlã€‚</p>
<h3>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ã¿ã‚‹</h3>
<pre class="code literal-block"><span></span>$ zola serve
</pre>

<p>ä¸€éƒ¨ã®è¨˜äº‹ã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã€‚</p>
<pre class="code literal-block"><span></span><span class="n">Reason</span><span class="o">:</span> <span class="n">There</span> <span class="k">is</span> <span class="n">a</span> <span class="n">link</span> <span class="n">that</span> <span class="k">is</span> <span class="n">missing</span> <span class="n">a</span> <span class="n">URL</span>
</pre>

<p>ã©ã®è¨˜äº‹ãŒã¾ãšã„ã‹ã¯ã‚ã‹ã‚‹ãŒã€ä½•è¡Œç›®ã¨ã‹å ´æ‰€ã¯ã‚ã‹ã‚‰ãªã„ã®ã‹ã—ã‚‰ã€‚
é©å½“ã«ãªãŠã™ã€‚</p>
<pre class="code literal-block"><span></span>$ zola check
</pre>

<p>ã®æ–¹ãŒãƒ‡ãƒãƒƒã‚°å‘ã‘ã€‚
ã„ãã¤ã‹ãªãŠã—ãŸã‚‰ã€ã‚¨ãƒ©ãƒ¼ã¯å‡ºãªããªã£ãŸã€‚</p>
<h2>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç”¨æ„ã™ã‚‹</h2>
<p>https://www.getzola.org/documentation/getting-started/overview/</p>
<p>ã«å¾“ã£ã¦åŸºæœ¬çš„ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆã€‚
index.html, section.html, page.html ã®3ç¨®é¡ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã‚µãƒ¼ãƒã•ã‚Œã‚‹ã€‚
section.html ã¨ page.html ã¯ã€section ã®ãƒ•ãƒ­ãƒ³ãƒˆãƒã‚¿ãƒ¼ã€ <code>template</code>, <code>page_template</code> ã§å¤‰æ›´ã§ãã‚‹ã€‚</p>
<h2>zola ã® content æ§‹æˆ</h2>
<p>section(ãƒ•ã‚©ãƒ«ãƒ€) ã« page ãŒæ‰€å±ã™ã‚‹ã¨ã„ã†æ§‹æˆã¿ãŸã„ã€‚
section ã¨ã†ã®ã¯å˜ãªã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã§ã¯ãªãã¦ã€folder/index.md ã‚‚ã—ãã¯ folder/_index.md ã‚’ã•ã™ã€‚</p>
<ul>
<li>root =&gt; index.html<ul>
<li>section<ul>
<li>_index.md (ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ãªã‚‹) =&gt; section.html</li>
<li>page1.md =&gt; page.html</li>
<li>page2.md =&gt; page.html</li>
<li>subsection (_index.md ãŒç„¡ã„ã®ã§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ç„¡ã„) =&gt; ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œãªã„<ul>
<li>page3.md (orphan page) =&gt; page.html</li>
<li>page4.md (orphan page) =&gt; page.html</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«æ‰€å±ã—ãªã„ page ã¯ orphan page ã¨ãªã‚Šã€ <code>section.pages</code> ã®ã‚ˆã†ã«åˆ—æŒ™ã™ã‚‹ã“ã¨ãŒã§ããªããªã‚‹ã€‚
ã™ã¹ã¦ã®ãƒ•ã‚©ãƒ«ãƒ€ã« <code>_index.md</code> ã‚’é…ç½®ã—ã¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³åŒ–ã™ã‚‹ã¨ã„ã†è¨­è¨ˆæ€æƒ³ã®ã‚ˆã†ã ã€‚</p>
<p>ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒæœ¨æ§‹é€ ã«ãªã£ã¦ã„ã¦ã€page ãŒ leaf ã«ãªã‚‹ã€‚</p>
<ul>
<li>section<ul>
<li>subsections</li>
<li>pages</li>
</ul>
</li>
</ul>
<p>ãŒå†å¸°çš„ã«ç¶šãã€‚</p>
<h3>zola ã‚’æ”¹é€ ã—ã¦ã¿ãŸã€‚</h3>
<p>orphan page ãŒ section.pages ã«å…¥ã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚
https://github.com/ousttrue/zola/commit/7842d0b2d05eb15400dbe20b20791b57af077de1</p>
<h2>zola è¨­å®š config.toml</h2>
<p>https://www.getzola.org/documentation/getting-started/configuration/</p>
<h2>Tera ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h2>
<p>https://tera.netlify.app/docs</p>
<h3>extends</h3>
<p>åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã‚’éƒ¨åˆ†çš„ã« override ã™ã‚‹
https://tera.netlify.app/docs/#inheritance</p>
<h3>include</h3>
<p>åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã®éƒ¨å“ã‚’èª­ã¿è¾¼ã‚€
https://tera.netlify.app/docs/#include</p>
<h3>date format</h3>
<p>https://tera.netlify.app/docs/#include</p>
<h2>ã¨ã‚Šã‚ãˆãšãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­ãƒ»ãƒ»ãƒ»</h2>
<p>hugo ã«æ¯”ã¹ã¦ template ã®æ§‹æˆãŒã‚·ãƒ³ãƒ—ãƒ«ã§ã‚ã‹ã‚Šã‚„ã™ã„ã‚ˆã†ãªæ°—ãŒã™ã‚‹
(hugo ã«æ…£ã‚Œã¦ã„ã‚‹ã›ã„ã‹ã‚‚ã—ã‚Œãªã„)ã€‚
ãã‚‚ãã‚‚ hugo ã®æ™‚ç‚¹ã§ã¡ã‚ƒã‚“ã¨ç®¡ç†ã—ã¦ãªã‹ã£ãŸã®ã§ã€
ã¼ã¡ã¼ã¡ç¶šãã‚’ã‚„ã‚‹ã€‚</p>
</div>
                </div>
            </article>
</div>
    
        <ul class="pager postindexpager clearfix">
<li class="previous"><a href="index-15.html" rel="prev">æ–°ã—ã„è¨˜äº‹</a></li>
            <li class="next"><a href="index-13.html" rel="next">éå»ã®è¨˜äº‹</a></li>
        </ul>
<script>var disqus_shortname="nikolademo";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><!--End of body content--><footer id="footer">
            Contents Â© 2021         <a href="mailto:ousttrue@gmail.com">ousttrue</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
            
        </footer>
</div>
</div>


        <script src="assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
