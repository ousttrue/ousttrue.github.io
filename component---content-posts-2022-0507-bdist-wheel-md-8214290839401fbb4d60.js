"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5070],{4236:function(e,n,t){t.r(n);var l=t(1151),a=t(7294);function c(e){const n=Object.assign({h1:"h1",pre:"pre",code:"code",p:"p"},(0,l.ah)(),e.components);return a.createElement(a.Fragment,null,a.createElement(n.h1,null,"bdist_wheel + pep517 ではまる"),"\n",a.createElement(n.pre,null,a.createElement(n.code,null,"setup.py bdist_wheel\n")),"\n",a.createElement(n.p,null,"なら成功するが、"),"\n",a.createElement(n.pre,null,a.createElement(n.code,null,"pip wheel .\n")),"\n",a.createElement(n.p,null,"だと失敗するという現象に悩まされる。\ncmake でビルドしている extension の pyd が含まれないのである。"),"\n",a.createElement(n.p,null,"原因は、 ",a.createElement(n.code,null,"setup.py")," の下記の記述。"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-python"},"class build_ext_cmake(build_ext):\n\n    def run(self):\n        for ext in self.extensions:\n            self.build_cmake(ext)\n\n    def build_cmake(self, ext):\n        # these dirs will be created in build_py, so if you don't have\n        # any python sources to bundle, the dirs will be missing\n        build_temp = pathlib.Path(self.build_temp)\n        build_temp.mkdir(parents=True, exist_ok=True)\n        ext_path = pathlib.Path(self.get_ext_fullpath(ext.name)) # <- これ\n        ext_path.parent.mkdir(parents=True, exist_ok=True)\n")),"\n",a.createElement(n.p,null,"直した。"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-python"},"        ext_path = pathlib.Path(self.get_ext_fullpath(ext.name)).absolute()\n")),"\n",a.createElement(n.p,null,"たぶん、 ",a.createElement(n.code,null,"get_ext_fullpath")," が相対パスを返していて、変なところに ",a.createElement(n.code,null,"pyd")," が出力されていた。\npip の時だけフォルダの構成や pwd が変わっている様子。"),"\n",a.createElement(n.pre,null,a.createElement(n.code,null,"pip wheel . -v\n")),"\n",a.createElement(n.p,null,"として、ログと睨めっこしていたら気付いた。\npip が subprocess とか使うので、デバッガがアタッチできなくて、なかなかわからなかった。"))}n.default=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,l.ah)(),e.components);return n?a.createElement(n,e,a.createElement(c,e)):c(e)}},1151:function(e,n,t){t.d(n,{ah:function(){return c}});var l=t(7294);const a=l.createContext({});function c(e){const n=l.useContext(a);return l.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}}}]);
//# sourceMappingURL=component---content-posts-2022-0507-bdist-wheel-md-8214290839401fbb4d60.js.map